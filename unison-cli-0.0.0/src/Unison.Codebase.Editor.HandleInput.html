<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Unison.Codebase.Editor.HandleInput</span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#loop"><span class="hs-identifier">loop</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#typecheckHelper"><span class="hs-identifier">typecheckHelper</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-5"></span><span class="hs-keyword">where</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">-- TODO: Don't import backend</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Concurrent.STM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">atomically</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modifyTVar'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newTVarIO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readTVar</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">readTVarIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Error.Util</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ErrorUtil</span></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StateT</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WriterT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Configurator</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Foldable</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable.Extra</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Foldable</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">nubOrd</span></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Nel</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Seq</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NESet</span></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set.NonEmpty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NESet</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UTCTime</span></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tuple.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">uncurry3</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.Console.Regions</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Console.Regions</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">withArgs</span></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Text.Megaparsec</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.HashTags</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CausalHash</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Reflog</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reflog</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">U.Codebase.Sqlite.Operations</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ops</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">U.Util.Hash</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hash</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">U.Util.Hash32</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Hash32</span></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">U.Util.Hash32</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hash32</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ABT</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ABT</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Builtin</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin.Decls</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Builtin.Terms</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Builtin</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html"><span class="hs-identifier">Unison.Cli.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier">Cli</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html"><span class="hs-identifier">Unison.Cli.Monad</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cli</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Cli.MonadUtils.html"><span class="hs-identifier">Unison.Cli.MonadUtils</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cli</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Codebase</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Preprocessing</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PushGitBranchOpts</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codebase</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Branch</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Branch0</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch.Merge</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Branch.Names</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Branch</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.BranchDiff</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BranchDiff</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.BranchUtil</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BranchUtil</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Causal</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Causal</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.AuthorInfo.html"><span class="hs-identifier">Unison.Codebase.Editor.AuthorInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.AuthorInfo.html#AuthorInfo"><span class="hs-identifier">AuthorInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.AuthorInfo.html"><span class="hs-identifier">Unison.Codebase.Editor.AuthorInfo</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AuthorInfo</span></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.DisplayObject</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.Git</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Git</span></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.AuthLogin.html"><span class="hs-identifier">Unison.Codebase.Editor.HandleInput.AuthLogin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.AuthLogin.html#authLogin"><span class="hs-identifier">authLogin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.AuthLogin.html#ensureAuthenticatedWithCodeserver"><span class="hs-identifier">ensureAuthenticatedWithCodeserver</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.MoveBranch.html"><span class="hs-identifier">Unison.Codebase.Editor.HandleInput.MoveBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.MoveBranch.html#doMoveBranch"><span class="hs-identifier">doMoveBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.NamespaceDependencies.html"><span class="hs-identifier">Unison.Codebase.Editor.HandleInput.NamespaceDependencies</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamespaceDependencies</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html"><span class="hs-identifier">Unison.Codebase.Editor.Input</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html"><span class="hs-identifier">Unison.Codebase.Editor.Input</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Input</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html"><span class="hs-identifier">Unison.Codebase.Editor.Output</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html"><span class="hs-identifier">Unison.Codebase.Editor.Output</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Output</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.BranchDiff.html"><span class="hs-identifier">Unison.Codebase.Editor.Output.BranchDiff</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OBranchDiff</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.DumpNamespace.html"><span class="hs-identifier">Unison.Codebase.Editor.Output.DumpNamespace</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Output.DN</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.PushPull.html"><span class="hs-identifier">Unison.Codebase.Editor.Output.PushPull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Output.PushPull.html#PushPull"><span class="hs-identifier">PushPull</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Output.PushPull.html#Pull"><span class="hs-identifier">Pull</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.PushPull.html#Push"><span class="hs-identifier">Push</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Propagate.html"><span class="hs-identifier">Unison.Codebase.Editor.Propagate</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Propagate</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.RemoteRepo</span></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">ReadGitRemoteNamespace</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="hs-identifier">ReadRemoteNamespace</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="hs-identifier">ReadShareRemoteNamespace</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><span class="hs-identifier">WriteGitRemotePath</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><span class="hs-identifier">WriteGitRepo</span></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-identifier">WriteRemotePath</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><span class="hs-identifier">WriteShareRemotePath</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="hs-identifier">printNamespace</span></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="hs-identifier">writePathToRead</span></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="hs-identifier">writeToReadGit</span></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Editor.RemoteRepo</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RemoteRepo</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Slurp.html"><span class="hs-identifier">Unison.Codebase.Editor.Slurp</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Slurp</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpComponent.html"><span class="hs-identifier">Unison.Codebase.Editor.SlurpComponent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.SlurpComponent.html#SlurpComponent"><span class="hs-identifier">SlurpComponent</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpComponent.html"><span class="hs-identifier">Unison.Codebase.Editor.SlurpComponent</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SC</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpResult.html"><span class="hs-identifier">Unison.Codebase.Editor.SlurpResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.SlurpResult.html#SlurpResult"><span class="hs-identifier">SlurpResult</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpResult.html"><span class="hs-identifier">Unison.Codebase.Editor.SlurpResult</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Slurp</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpResult.html"><span class="hs-identifier">Unison.Codebase.Editor.SlurpResult</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SlurpResult</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.TodoOutput.html"><span class="hs-identifier">Unison.Codebase.Editor.TodoOutput</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TO</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.UriParser.html"><span class="hs-identifier">Unison.Codebase.Editor.UriParser</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UriParser</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.IntegrityCheck</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IntegrityCheck</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">integrityCheckFullCodebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.MainTerm</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MainTerm</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Metadata</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Metadata</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Patch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Patch</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Patch</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Patch</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Path'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Path.Parse</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Path</span></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.PushBehavior</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PushBehavior</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.PushBehavior</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PushBehavior</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Runtime</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Runtime</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.ShortBranchHash</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBH</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SqliteCodebase.Conversions</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cv</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.SyncMode</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SyncMode</span></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.TermEdit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TermEdit</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.TermEdit</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TermEdit</span></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.TermEdit.Typing</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TermEdit</span></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GitPushBehavior</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.TypeEdit</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TypeEdit</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Codebase.Verbosity</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Verbosity</span></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.CommandLine.Completion.html"><span class="hs-identifier">Unison.CommandLine.Completion</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Completion</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.CommandLine.DisplayValues.html"><span class="hs-identifier">Unison.CommandLine.DisplayValues</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DisplayValues</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.CommandLine.FuzzySelect.html"><span class="hs-identifier">Unison.CommandLine.FuzzySelect</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Fuzzy</span></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.CommandLine.InputPattern.html"><span class="hs-identifier">Unison.CommandLine.InputPattern</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InputPattern</span></span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.CommandLine.InputPatterns.html"><span class="hs-identifier">Unison.CommandLine.InputPatterns</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IP</span></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.CommandLine.InputPatterns.html"><span class="hs-identifier">Unison.CommandLine.InputPatterns</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InputPatterns</span></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">GConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.DataDeclaration</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.FileParsers</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">parseAndSynthesizeFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ</span></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.HashQualified'</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HQ'</span></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Hashing.V2.Convert</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hashing</span></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.LabeledDependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LabeledDependency</span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.LabeledDependency</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LD</span></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Name</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Name</span></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NameSegment</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NameSegment</span></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Names</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Names</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Names</span></span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NamesWithHistory</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.NamesWithHistory</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">NamesWithHistory</span></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ann</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parser.Ann</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ann</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Parsers</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Parsers</span></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Position</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Position</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Prelude</span></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnv.Names</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">biasTo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPED</span></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.PrettyPrintEnvDecl.Names</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PPE</span></span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reference</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeReference</span></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Reference</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Reference</span></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Referent</span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Referent</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Referent</span></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Result</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Result</span></span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Runtime.IOSource</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isTest</span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Runtime.IOSource</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DD</span></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Runtime.IOSource</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">IOSource</span></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.Backend</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ShallowListEntry</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TermEntry</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypeEntry</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.Backend</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Backend</span></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.CodebaseServer</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Server</span></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.QueryResult</span></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.SearchResult</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SearchResult</span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.SearchResult</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SR</span></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Server.SearchResult'</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SR'</span></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Share.Codeserver.html"><span class="hs-identifier">Unison.Share.Codeserver</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Codeserver</span></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Share.Sync.html"><span class="hs-identifier">Unison.Share.Sync</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Share</span></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Unison.Share.Sync.Types.html"><span class="hs-identifier">Unison.Share.Sync.Types</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Share</span></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Share.Types</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">codeserverBaseURL</span></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.ShortHash</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SH</span></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Sync.Types</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Share</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Path</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hashJWTHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Lexer</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Syntax.Parser</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Parser</span></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Term</span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Term</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Term</span></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Type.Names</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Typechecker</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Typechecker</span></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Typechecker.TypeLookup</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TypeLookup</span></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TypecheckedUnisonFile</span></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UF</span></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.UnisonFile.Names</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UF</span></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Find</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Find</span></span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">uniqueBy</span></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Monoid</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Monoid</span></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Pretty</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Relation</span></span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Relation4</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R4</span></span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.Star3</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Star3</span></span><span>
</span><span id="line-188"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Util.TransitiveClosure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">transitiveClosure</span></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Var</span></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.Var</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Var</span></span><span>
</span><span id="line-191"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Unison.WatchKind</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WK</span></span><span>
</span><span id="line-192"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Web.Browser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">openBrowser</span></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span id="local-6989586621679407172"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-type">prettyPrintEnvDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407172"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnvDecl</span></span></span><span>
</span><span id="line-195"></span><span id="prettyPrintEnvDecl"><span class="annot"><span class="annottext">prettyPrintEnvDecl :: NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var hs-var">prettyPrintEnvDecl</span></a></span></span><span> </span><span id="local-6989586621679405901"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405901"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405899"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
</span><a href="Unison.Cli.Monad.html#%24sel%3Acodebase%3AEnv"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405899"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r Int
-&gt; (Int -&gt; PrettyPrintEnvDecl) -&gt; Cli r PrettyPrintEnvDecl
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-operator hs-var">`PPE.fromNamesDecl`</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405901"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- | Get a pretty print env decl for the current names at the current path.</span><span>
</span><span id="line-200"></span><span id="local-6989586621679407059"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#currentPrettyPrintEnvDecl"><span class="hs-identifier hs-type">currentPrettyPrintEnvDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Backend.NameScoping</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407059"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnvDecl</span></span></span><span>
</span><span id="line-201"></span><span id="currentPrettyPrintEnvDecl"><span class="annot"><span class="annottext">currentPrettyPrintEnvDecl :: (Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#currentPrettyPrintEnvDecl"><span class="hs-identifier hs-var hs-var">currentPrettyPrintEnvDecl</span></a></span></span><span> </span><span id="local-6989586621679405892"><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="#local-6989586621679405892"><span class="hs-identifier hs-var">scoping</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405891"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405891"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621679405890"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405890"><span class="hs-identifier hs-var">root'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621679405888"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405888"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621679405886"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405886"><span class="hs-identifier hs-var">hqLen</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405891"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NameScoping -&gt; Branch IO -&gt; PrettyPrintEnvDecl
forall (m :: * -&gt; *).
Int -&gt; NameScoping -&gt; Branch m -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">Backend.getCurrentPrettyNames</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405886"><span class="hs-identifier hs-var">hqLen</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="#local-6989586621679405892"><span class="hs-identifier hs-var">scoping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405888"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405890"><span class="hs-identifier hs-var">root'</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">------------------------------------------------------------------------------------------------------------------------</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- Main loop</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span id="local-6989586621679405883"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#loop"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679405883"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-212"></span><span id="loop"><span class="annot"><span class="annottext">loop :: Either Event Input -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#loop"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621679405882"><span class="annot"><span class="annottext">Either Event Input
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679407186"><span class="annot"><a href="#local-6989586621679405881"><span class="hs-identifier hs-type">withFile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-comment">-- ambient abilities</span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-216"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.Token</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.Lexeme</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407186"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-219"></span><span>      </span><span id="local-6989586621679405881"><span class="annot"><span class="annottext">withFile :: [Type Symbol Ann]
-&gt; Text
-&gt; (Text, [Token Lexeme])
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621679405881"><span class="hs-identifier hs-var hs-var">withFile</span></a></span></span><span> </span><span id="local-6989586621679405880"><span class="annot"><span class="annottext">[Type Symbol Ann]
</span><a href="#local-6989586621679405880"><span class="hs-identifier hs-var">ambient</span></a></span></span><span> </span><span id="local-6989586621679405879"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405879"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621679405878"><span class="annot"><span class="annottext">lexed :: (Text, [Token Lexeme])
</span><a href="#local-6989586621679405878"><span class="hs-identifier hs-var">lexed</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679405877"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405877"><span class="hs-identifier hs-var">text</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405876"><span class="annot"><span class="annottext">[Token Lexeme]
</span><a href="#local-6989586621679405876"><span class="hs-identifier hs-var">tokens</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-220"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405875"><span class="annot"><span class="annottext">getHQ :: Lexeme -&gt; Maybe (HashQualified Name)
</span><a href="#local-6989586621679405875"><span class="hs-identifier hs-var hs-var">getHQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-221"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">L.WordyId</span></span><span> </span><span id="local-6989586621679405873"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405873"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405872"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405872"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe (HashQualified Name)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ShortHash -&gt; HashQualified Name
forall n. n -&gt; ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashQualified</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405873"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405872"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">L.SymbolyId</span></span><span> </span><span id="local-6989586621679405868"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405868"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405867"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405867"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe (HashQualified Name)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ShortHash -&gt; HashQualified Name
forall n. n -&gt; ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashQualified</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405868"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405867"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">L.Hash</span></span><span> </span><span id="local-6989586621679405865"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405865"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe (HashQualified Name)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; HashQualified Name
forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405865"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>              </span><span class="annot"><span class="annottext">Lexeme
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HashQualified Name)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-225"></span><span>            </span><span id="local-6989586621679405863"><span class="annot"><span class="annottext">hqs :: Set (HashQualified Name)
</span><a href="#local-6989586621679405863"><span class="hs-identifier hs-var hs-var">hqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Set (HashQualified Name)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; Set (HashQualified Name))
-&gt; ([Token Lexeme] -&gt; [HashQualified Name])
-&gt; [Token Lexeme]
-&gt; Set (HashQualified Name)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Token Lexeme -&gt; Maybe (HashQualified Name))
-&gt; [Token Lexeme] -&gt; [HashQualified Name]
forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lexeme -&gt; Maybe (HashQualified Name)
</span><a href="#local-6989586621679405875"><span class="hs-identifier hs-var">getHQ</span></a></span><span> </span><span class="annot"><span class="annottext">(Lexeme -&gt; Maybe (HashQualified Name))
-&gt; (Token Lexeme -&gt; Lexeme)
-&gt; Token Lexeme
-&gt; Maybe (HashQualified Name)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Token Lexeme -&gt; Lexeme
forall a. Token a -&gt; a
</span><span class="hs-identifier hs-var hs-var">L.payload</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Token Lexeme] -&gt; Set (HashQualified Name))
-&gt; [Token Lexeme] -&gt; Set (HashQualified Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Token Lexeme]
</span><a href="#local-6989586621679405876"><span class="hs-identifier hs-var">tokens</span></a></span><span>
</span><span id="line-226"></span><span>        </span><span id="local-6989586621679405858"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405858"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-227"></span><span>        </span><span id="local-6989586621679405857"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405857"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-228"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405856"><span class="annot"><span class="annottext">parseNames :: NamesWithHistory
</span><a href="#local-6989586621679405856"><span class="hs-identifier hs-var hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameScoping -&gt; Branch IO -&gt; NamesWithHistory
forall (m :: * -&gt; *). NameScoping -&gt; Branch m -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">Backend.getCurrentParseNames</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405857"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405858"><span class="hs-identifier hs-var">rootBranch</span></a></span><span>
</span><span id="line-229"></span><span>        </span><span class="annot"><span class="annottext">(LoopState -&gt; LoopState) -&gt; Cli r ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">State.modify'</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679405852"><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679405852"><span class="hs-identifier hs-var">loopState</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-230"></span><span>          </span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679405852"><span class="hs-identifier hs-var">loopState</span></a></span><span>
</span><span id="line-231"></span><span>            </span><span class="annot"><span class="annottext">LoopState -&gt; (LoopState -&gt; LoopState) -&gt; LoopState
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;latestFile&quot;
  (ASetter
     LoopState LoopState (Maybe (String, Bool)) (Maybe (String, Bool)))
ASetter
  LoopState LoopState (Maybe (String, Bool)) (Maybe (String, Bool))
</span><a href="#local-6989586621679405850"><span class="hs-var">#latestFile</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  LoopState LoopState (Maybe (String, Bool)) (Maybe (String, Bool))
-&gt; Maybe (String, Bool) -&gt; LoopState -&gt; LoopState
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool) -&gt; Maybe (String, Bool)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405879"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>            </span><span class="annot"><span class="annottext">LoopState -&gt; (LoopState -&gt; LoopState) -&gt; LoopState
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;latestTypecheckedFile&quot;
  (ASetter
     LoopState
     LoopState
     (Maybe (TypecheckedUnisonFile Symbol Ann))
     (Maybe (TypecheckedUnisonFile Symbol Ann)))
ASetter
  LoopState
  LoopState
  (Maybe (TypecheckedUnisonFile Symbol Ann))
  (Maybe (TypecheckedUnisonFile Symbol Ann))
</span><a href="#local-6989586621679405847"><span class="hs-var">#latestTypecheckedFile</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  LoopState
  LoopState
  (Maybe (TypecheckedUnisonFile Symbol Ann))
  (Maybe (TypecheckedUnisonFile Symbol Ann))
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; LoopState
-&gt; LoopState
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-233"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">MaybeT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriterT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679405843"><span class="annot"><span class="annottext">Maybe
  (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
</span><a href="#local-6989586621679405843"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405842"><span class="annot"><span class="annottext">Seq (Note Symbol Ann)
</span><a href="#local-6989586621679405842"><span class="hs-identifier hs-var">notes</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type Symbol Ann]
-&gt; NamesWithHistory
-&gt; Text
-&gt; (Text, [Token Lexeme])
-&gt; Cli
     r
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall r.
[Type Symbol Ann]
-&gt; NamesWithHistory
-&gt; Text
-&gt; (Text, [Token Lexeme])
-&gt; Cli
     r
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
</span><a href="Unison.Codebase.Editor.HandleInput.html#typecheck"><span class="hs-identifier hs-var">typecheck</span></a></span><span> </span><span class="annot"><span class="annottext">[Type Symbol Ann]
</span><a href="#local-6989586621679405880"><span class="hs-identifier hs-var">ambient</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405856"><span class="hs-identifier hs-var">parseNames</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405879"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">(Text, [Token Lexeme])
</span><a href="#local-6989586621679405878"><span class="hs-identifier hs-var">lexed</span></a></span><span>
</span><span id="line-234"></span><span>        </span><span id="local-6989586621679405840"><span class="annot"><span class="annottext">Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621679405840"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe
  (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
</span><a href="#local-6989586621679405843"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
-&gt; (Maybe
      (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
    -&gt; Cli
         r
         (Either
            (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
-&gt; Cli
     r
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli
  r
  (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
-&gt; Maybe
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
-&gt; Cli
     r
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output
-&gt; Cli
     r
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; [Err Symbol] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ParseErrors"><span class="hs-identifier hs-var">ParseErrors</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405877"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Err Symbol
</span><a href="#local-6989586621679405836"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Result.Parsing</span></span><span> </span><span id="local-6989586621679405836"><span class="annot"><span class="annottext">Err Symbol
</span><a href="#local-6989586621679405836"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Seq (Note Symbol Ann) -&gt; [Note Symbol Ann]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq (Note Symbol Ann)
</span><a href="#local-6989586621679405842"><span class="hs-identifier hs-var">notes</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span>        </span><span class="annot"><span class="annottext">Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621679405840"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)
-&gt; (Either
      (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)
    -&gt; Cli r (TypecheckedUnisonFile Symbol Ann))
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(UnisonFile Symbol Ann -&gt; Cli r (TypecheckedUnisonFile Symbol Ann))
-&gt; Either
     (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m b) -&gt; Either a b -&gt; m b
</span><span class="hs-identifier hs-var">onLeft</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679405832"><span class="annot"><span class="annottext">UnisonFile Symbol Ann
</span><a href="#local-6989586621679405832"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>          </span><span id="local-6989586621679405831"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405831"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; Names -&gt; Cli r NamesWithHistory
forall r.
Set (HashQualified Name) -&gt; Names -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makeShadowedPrintNamesFromHQ"><span class="hs-identifier hs-var">makeShadowedPrintNamesFromHQ</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679405863"><span class="hs-identifier hs-var">hqs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnisonFile Symbol Ann -&gt; Names
forall v a. Var v =&gt; UnisonFile v a -&gt; Names
</span><span class="hs-identifier hs-var">UF.toNames</span></span><span> </span><span class="annot"><span class="annottext">UnisonFile Symbol Ann
</span><a href="#local-6989586621679405832"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>          </span><span id="local-6989586621679405828"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405828"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#suffixifiedPPE"><span class="hs-identifier hs-var">suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405831"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-238"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405826"><span class="annot"><span class="annottext">tes :: [ErrorNote Symbol Ann]
</span><a href="#local-6989586621679405826"><span class="hs-identifier hs-var hs-var">tes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ErrorNote Symbol Ann
</span><a href="#local-6989586621679405825"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Result.TypeError</span></span><span> </span><span id="local-6989586621679405825"><span class="annot"><span class="annottext">ErrorNote Symbol Ann
</span><a href="#local-6989586621679405825"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Seq (Note Symbol Ann) -&gt; [Note Symbol Ann]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq (Note Symbol Ann)
</span><a href="#local-6989586621679405842"><span class="hs-identifier hs-var">notes</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-239"></span><span>              </span><span id="local-6989586621679405823"><span class="annot"><span class="annottext">cbs :: [CompilerBug Symbol Ann]
</span><a href="#local-6989586621679405823"><span class="hs-identifier hs-var hs-var">cbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-240"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">CompilerBug Symbol Ann
</span><a href="#local-6989586621679405822"><span class="hs-identifier hs-var">bug</span></a></span><span>
</span><span id="line-241"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Result.CompilerBug</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Result.TypecheckerBug</span></span><span> </span><span id="local-6989586621679405822"><span class="annot"><span class="annottext">CompilerBug Symbol Ann
</span><a href="#local-6989586621679405822"><span class="hs-identifier hs-var">bug</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-242"></span><span>                      </span><span class="annot"><span class="annottext">Seq (Note Symbol Ann) -&gt; [Note Symbol Ann]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq (Note Symbol Ann)
</span><a href="#local-6989586621679405842"><span class="hs-identifier hs-var">notes</span></a></span><span>
</span><span id="line-243"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ErrorNote Symbol Ann] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[ErrorNote Symbol Ann]
</span><a href="#local-6989586621679405826"><span class="hs-identifier hs-var">tes</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>            </span><span id="local-6989586621679405816"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405816"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-246"></span><span>            </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute
-&gt; Text -&gt; PrettyPrintEnv -&gt; [ErrorNote Symbol Ann] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TypeErrors"><span class="hs-identifier hs-var">TypeErrors</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405816"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405877"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405828"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrorNote Symbol Ann]
</span><a href="#local-6989586621679405826"><span class="hs-identifier hs-var">tes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CompilerBug Symbol Ann] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[CompilerBug Symbol Ann]
</span><a href="#local-6989586621679405823"><span class="hs-identifier hs-var">cbs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>            </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; PrettyPrintEnv -&gt; [CompilerBug Symbol Ann] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#CompilerBugs"><span class="hs-identifier hs-var">CompilerBugs</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405877"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405828"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">[CompilerBug Symbol Ann]
</span><a href="#local-6989586621679405823"><span class="hs-identifier hs-var">cbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>          </span><span class="annot"><span class="annottext">Cli r (TypecheckedUnisonFile Symbol Ann)
forall r a. Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarlyWithoutOutput"><span class="hs-identifier hs-var">Cli.returnEarlyWithoutOutput</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>      </span><span id="local-6989586621679407134"><span class="annot"><a href="#local-6989586621679405811"><span class="hs-identifier hs-type">loadUnisonFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407134"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-252"></span><span>      </span><span id="local-6989586621679405811"><span class="annot"><span class="annottext">loadUnisonFile :: Text -&gt; Text -&gt; Cli r ()
</span><a href="#local-6989586621679405811"><span class="hs-identifier hs-var hs-var">loadUnisonFile</span></a></span></span><span> </span><span id="local-6989586621679405810"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405810"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621679405809"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405809"><span class="hs-identifier hs-var">text</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405808"><span class="annot"><span class="annottext">lexed :: [Token Lexeme]
</span><a href="#local-6989586621679405808"><span class="hs-identifier hs-var hs-var">lexed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [Token Lexeme]
</span><span class="hs-identifier hs-var">L.lexer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405810"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405809"><span class="hs-identifier hs-var">text</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>        </span><span id="local-6989586621679405806"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679405806"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type Symbol Ann]
-&gt; Text
-&gt; (Text, [Token Lexeme])
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
forall r.
[Type Symbol Ann]
-&gt; Text
-&gt; (Text, [Token Lexeme])
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621679405881"><span class="hs-identifier hs-var">withFile</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405810"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405809"><span class="hs-identifier hs-var">text</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Token Lexeme]
</span><a href="#local-6989586621679405808"><span class="hs-identifier hs-var">lexed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>        </span><span id="local-6989586621679405805"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405805"><span class="hs-identifier hs-var">currentNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Names) -&gt; Cli r (Branch0 IO) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405801"><span class="annot"><span class="annottext">sr :: SlurpResult Symbol
</span><a href="#local-6989586621679405801"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Set Symbol -&gt; SlurpOp -&gt; Names -&gt; SlurpResult Symbol
forall v.
Var v =&gt;
TypecheckedUnisonFile v Ann
-&gt; Set v -&gt; SlurpOp -&gt; Names -&gt; SlurpResult v
</span><a href="Unison.Codebase.Editor.Slurp.html#slurpFile"><span class="hs-identifier hs-var">Slurp.slurpFile</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679405806"><span class="hs-identifier hs-var">unisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">SlurpOp
</span><a href="Unison.Codebase.Editor.Slurp.html#CheckOp"><span class="hs-identifier hs-var">Slurp.CheckOp</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405805"><span class="hs-identifier hs-var">currentNames</span></a></span><span>
</span><span id="line-257"></span><span>        </span><span id="local-6989586621679405798"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405798"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Cli r NamesWithHistory
forall v a r.
Var v =&gt;
TypecheckedUnisonFile v a -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayNames"><span class="hs-identifier hs-var">displayNames</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679405806"><span class="hs-identifier hs-var">unisonFile</span></a></span><span>
</span><span id="line-258"></span><span>        </span><span id="local-6989586621679405796"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405796"><span class="hs-identifier hs-var">pped</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405798"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405795"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnv
</span><a href="#local-6989586621679405795"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405796"><span class="hs-identifier hs-var">pped</span></a></span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; PrettyPrintEnv
-&gt; SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#Typechecked"><span class="hs-identifier hs-var">Typechecked</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405810"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405795"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679405801"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679405806"><span class="hs-identifier hs-var">unisonFile</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679405792"><span class="annot"><span class="annottext">[(Symbol, Term Symbol ())]
</span><a href="#local-6989586621679405792"><span class="hs-identifier hs-var">bindings</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405791"><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
</span><a href="#local-6989586621679405791"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; PrettyPrintEnv
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; [String]
-&gt; Cli
     r
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
forall r.
Bool
-&gt; PrettyPrintEnv
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; [String]
-&gt; Cli
     r
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonFile"><span class="hs-identifier hs-var">evalUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405795"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679405806"><span class="hs-identifier hs-var">unisonFile</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405789"><span class="annot"><span class="annottext">e' :: Map Symbol (Ann, String, Term Symbol (), Bool)
</span><a href="#local-6989586621679405789"><span class="hs-identifier hs-var hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
 -&gt; (Ann, String, Term Symbol (), Bool))
-&gt; Map
     Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
-&gt; Map Symbol (Ann, String, Term Symbol (), Bool)
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="annot"><span class="annottext">(Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
-&gt; (Ann, String, Term Symbol (), Bool)
forall a b c d c d. (a, b, c, d, c, d) -&gt; (a, b, c, d)
</span><a href="#local-6989586621679405787"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
</span><a href="#local-6989586621679405791"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-263"></span><span>            </span><span id="local-6989586621679405787"><span class="annot"><span class="annottext">go :: (a, b, c, d, c, d) -&gt; (a, b, c, d)
</span><a href="#local-6989586621679405787"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679405786"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405786"><span class="hs-identifier hs-var">ann</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405785"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679405785"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405784"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679405784"><span class="hs-identifier hs-var">_hash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405783"><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679405783"><span class="hs-identifier hs-var">_uneval</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405782"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679405782"><span class="hs-identifier hs-var">eval</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405781"><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679405781"><span class="hs-identifier hs-var">isHit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679405786"><span class="hs-identifier hs-var">ann</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679405785"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679405782"><span class="hs-identifier hs-var">eval</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679405781"><span class="hs-identifier hs-var">isHit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Symbol (Ann, String, Term Symbol (), Bool) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Ann, String, Term Symbol (), Bool)
</span><a href="#local-6989586621679405789"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-265"></span><span>          </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; PrettyPrintEnv
-&gt; [(Symbol, Term Symbol ())]
-&gt; Map Symbol (Ann, String, Term Symbol (), Bool)
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#Evaluated"><span class="hs-identifier hs-var">Evaluated</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405809"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405795"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Symbol, Term Symbol ())]
</span><a href="#local-6989586621679405792"><span class="hs-identifier hs-var">bindings</span></a></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Ann, String, Term Symbol (), Bool)
</span><a href="#local-6989586621679405789"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-cpp">
        #latestTypecheckedFile .= (Just unisonFile)
</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either Event Input
</span><a href="#local-6989586621679405882"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#IncomingRootBranch"><span class="hs-identifier hs-type">IncomingRootBranch</span></a></span><span> </span><span id="local-6989586621679405776"><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679405776"><span class="hs-identifier hs-var">hashes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>      </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405775"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405775"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-271"></span><span>      </span><span id="local-6989586621679405774"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405774"><span class="hs-identifier hs-var">sbhLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.branchHashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405775"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>      </span><span id="local-6989586621679405772"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405772"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-273"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-274"></span><span>        </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; Set ShortBranchHash -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#WarnIncomingRootBranch"><span class="hs-identifier hs-var">WarnIncomingRootBranch</span></a></span><span>
</span><span id="line-275"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CausalHash -&gt; ShortBranchHash
forall h. Coercible h Hash =&gt; Int -&gt; h -&gt; ShortBranchHash
</span><span class="hs-identifier hs-var">SBH.fromHash</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405774"><span class="hs-identifier hs-var">sbhLength</span></a></span><span> </span><span class="annot"><span class="annottext">(CausalHash -&gt; ShortBranchHash) -&gt; CausalHash -&gt; ShortBranchHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; CausalHash
forall (m :: * -&gt; *). Branch m -&gt; CausalHash
</span><span class="hs-identifier hs-var">Branch.headHash</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405772"><span class="hs-identifier hs-var">rootBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CausalHash -&gt; ShortBranchHash)
-&gt; Set CausalHash -&gt; Set ShortBranchHash
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CausalHash -&gt; ShortBranchHash
forall h. Coercible h Hash =&gt; Int -&gt; h -&gt; ShortBranchHash
</span><span class="hs-identifier hs-var">SBH.fromHash</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405774"><span class="hs-identifier hs-var">sbhLength</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679405776"><span class="hs-identifier hs-var">hashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#UnisonFileChanged"><span class="hs-identifier hs-type">UnisonFileChanged</span></a></span><span> </span><span id="local-6989586621679405766"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405766"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621679405765"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405765"><span class="hs-identifier hs-var">text</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>      </span><span class="hs-comment">-- We skip this update if it was programmatically generated</span><span>
</span><span id="line-279"></span><span>      </span><span class="annot"><span class="annottext">Cli r (Maybe (String, Bool))
forall r. Cli r (Maybe (String, Bool))
</span><a href="Unison.Cli.MonadUtils.html#getLatestFile"><span class="hs-identifier hs-var">Cli.getLatestFile</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (String, Bool))
-&gt; (Maybe (String, Bool) -&gt; Cli r ()) -&gt; Cli r ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsLabel
  &quot;latestFile&quot;
  (ASetter
     LoopState LoopState (Maybe (String, Bool)) (Maybe (String, Bool)))
ASetter
  LoopState LoopState (Maybe (String, Bool)) (Maybe (String, Bool))
</span><a href="#local-6989586621679405763"><span class="hs-var">#latestFile</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  LoopState LoopState (Maybe (String, Bool)) (Maybe (String, Bool))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; Maybe (String, Bool) -&gt; Identity (Maybe (String, Bool)))
-&gt; (Bool -&gt; Identity Bool)
-&gt; LoopState
-&gt; Identity LoopState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((String, Bool) -&gt; Identity (String, Bool))
-&gt; Maybe (String, Bool) -&gt; Identity (Maybe (String, Bool))
forall a b. Prism (Maybe a) (Maybe b) a b
</span><span class="hs-identifier hs-var">_Just</span></span><span> </span><span class="annot"><span class="annottext">(((String, Bool) -&gt; Identity (String, Bool))
 -&gt; Maybe (String, Bool) -&gt; Identity (Maybe (String, Bool)))
-&gt; ((Bool -&gt; Identity Bool)
    -&gt; (String, Bool) -&gt; Identity (String, Bool))
-&gt; (Bool -&gt; Identity Bool)
-&gt; Maybe (String, Bool)
-&gt; Identity (Maybe (String, Bool))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; (String, Bool) -&gt; Identity (String, Bool)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Bool -&gt; Identity Bool) -&gt; LoopState -&gt; Identity LoopState)
-&gt; Bool -&gt; Cli r ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-281"></span><span>        </span><span class="annot"><span class="annottext">Maybe (String, Bool)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Cli r ()
forall r. Text -&gt; Text -&gt; Cli r ()
</span><a href="#local-6989586621679405811"><span class="hs-identifier hs-var">loadUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405766"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405765"><span class="hs-identifier hs-var">text</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679405760"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679405759"><span class="hs-identifier hs-type">typeReferences</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span>          </span><span id="local-6989586621679405759"><span class="annot"><span class="annottext">typeReferences :: [SearchResult] -&gt; [Reference]
</span><a href="#local-6989586621679405759"><span class="hs-identifier hs-var hs-var">typeReferences</span></a></span></span><span> </span><span id="local-6989586621679405758"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405758"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405757"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SR.Tp</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SR.TypeResult</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679405757"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405757"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405758"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-286"></span><span>          </span><span class="annot"><a href="#local-6989586621679405754"><span class="hs-identifier hs-type">termReferences</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">]</span><span>
</span><span id="line-287"></span><span>          </span><span id="local-6989586621679405754"><span class="annot"><span class="annottext">termReferences :: [SearchResult] -&gt; [Reference]
</span><a href="#local-6989586621679405754"><span class="hs-identifier hs-var hs-var">termReferences</span></a></span></span><span> </span><span id="local-6989586621679405753"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405753"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>            </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405752"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SR.Tm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SR.TermResult</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679405752"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405752"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405753"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-289"></span><span>          </span><span id="local-6989586621679405748"><span class="annot"><span class="annottext">termResults :: [SearchResult] -&gt; [TermResult]
</span><a href="#local-6989586621679405748"><span class="hs-identifier hs-var hs-var">termResults</span></a></span></span><span> </span><span id="local-6989586621679405747"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405747"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TermResult
</span><a href="#local-6989586621679405746"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SR.Tm</span></span><span> </span><span id="local-6989586621679405746"><span class="annot"><span class="annottext">TermResult
</span><a href="#local-6989586621679405746"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405747"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span>          </span><span id="local-6989586621679405745"><span class="annot"><span class="annottext">typeResults :: [SearchResult] -&gt; [TypeResult]
</span><a href="#local-6989586621679405745"><span class="hs-identifier hs-var hs-var">typeResults</span></a></span></span><span> </span><span id="local-6989586621679405744"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405744"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TypeResult
</span><a href="#local-6989586621679405743"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SR.Tp</span></span><span> </span><span id="local-6989586621679405743"><span class="annot"><span class="annottext">TypeResult
</span><a href="#local-6989586621679405743"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405744"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-291"></span><span>          </span><span id="local-6989586621679406546"><span class="annot"><a href="#local-6989586621679405742"><span class="hs-identifier hs-type">doRemoveReplacement</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PatchPath"><span class="hs-identifier hs-type">PatchPath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406546"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-292"></span><span>          </span><span id="local-6989586621679405742"><span class="annot"><span class="annottext">doRemoveReplacement :: HashQualified Name -&gt; Maybe PatchPath -&gt; Bool -&gt; Cli r ()
</span><a href="#local-6989586621679405742"><span class="hs-identifier hs-var hs-var">doRemoveReplacement</span></a></span></span><span> </span><span id="local-6989586621679405741"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405741"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621679405740"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679405740"><span class="hs-identifier hs-var">patchPath</span></a></span></span><span> </span><span id="local-6989586621679405739"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405739"><span class="hs-identifier hs-var">isTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-293"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405738"><span class="annot"><span class="annottext">patchPath' :: PatchPath
</span><a href="#local-6989586621679405738"><span class="hs-identifier hs-var hs-var">patchPath'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Maybe PatchPath -&gt; PatchPath
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="Unison.Cli.MonadUtils.html#defaultPatchPath"><span class="hs-identifier hs-var">Cli.defaultPatchPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679405740"><span class="hs-identifier hs-var">patchPath</span></a></span><span>
</span><span id="line-294"></span><span>            </span><span id="local-6989586621679405735"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405735"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Patch
forall r. PatchPath -&gt; Cli r Patch
</span><a href="Unison.Cli.MonadUtils.html#getPatchAt"><span class="hs-identifier hs-var">Cli.getPatchAt</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405738"><span class="hs-identifier hs-var">patchPath'</span></a></span><span>
</span><span id="line-295"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">QueryResult</span></span><span> </span><span id="local-6989586621679405732"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405732"><span class="hs-identifier hs-var">misses</span></a></span></span><span> </span><span id="local-6989586621679405731"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405731"><span class="hs-identifier hs-var">allHits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Cli r QueryResult
forall r. [HashQualified Name] -&gt; Cli r QueryResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#hqNameQuery"><span class="hs-identifier hs-var">hqNameQuery</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405741"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-296"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405729"><span class="annot"><span class="annottext">tpRefs :: Set Reference
</span><a href="#local-6989586621679405729"><span class="hs-identifier hs-var hs-var">tpRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; Set Reference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Reference] -&gt; Set Reference) -&gt; [Reference] -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [Reference]
</span><a href="#local-6989586621679405759"><span class="hs-identifier hs-var">typeReferences</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405731"><span class="hs-identifier hs-var">allHits</span></a></span><span>
</span><span id="line-297"></span><span>                </span><span id="local-6989586621679405728"><span class="annot"><span class="annottext">tmRefs :: Set Reference
</span><a href="#local-6989586621679405728"><span class="hs-identifier hs-var hs-var">tmRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; Set Reference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Reference] -&gt; Set Reference) -&gt; [Reference] -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [Reference]
</span><a href="#local-6989586621679405754"><span class="hs-identifier hs-var">termReferences</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405731"><span class="hs-identifier hs-var">allHits</span></a></span><span>
</span><span id="line-298"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679405727"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679405727"><span class="hs-identifier hs-var">hits</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405726"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679405726"><span class="hs-identifier hs-var">opHits</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-299"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405725"><span class="annot"><span class="annottext">tmResults :: Set (HashQualified Name)
</span><a href="#local-6989586621679405725"><span class="hs-identifier hs-var hs-var">tmResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Set (HashQualified Name)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; Set (HashQualified Name))
-&gt; [HashQualified Name] -&gt; Set (HashQualified Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TermResult -&gt; HashQualified Name
</span><span class="hs-identifier hs-var hs-var">SR.termName</span></span><span> </span><span class="annot"><span class="annottext">(TermResult -&gt; HashQualified Name)
-&gt; [TermResult] -&gt; [HashQualified Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [TermResult]
</span><a href="#local-6989586621679405748"><span class="hs-identifier hs-var">termResults</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405731"><span class="hs-identifier hs-var">allHits</span></a></span><span>
</span><span id="line-300"></span><span>                      </span><span id="local-6989586621679405723"><span class="annot"><span class="annottext">tpResults :: Set (HashQualified Name)
</span><a href="#local-6989586621679405723"><span class="hs-identifier hs-var hs-var">tpResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Set (HashQualified Name)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; Set (HashQualified Name))
-&gt; [HashQualified Name] -&gt; Set (HashQualified Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypeResult -&gt; HashQualified Name
</span><span class="hs-identifier hs-var hs-var">SR.typeName</span></span><span> </span><span class="annot"><span class="annottext">(TypeResult -&gt; HashQualified Name)
-&gt; [TypeResult] -&gt; [HashQualified Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [TypeResult]
</span><a href="#local-6989586621679405745"><span class="hs-identifier hs-var">typeResults</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679405731"><span class="hs-identifier hs-var">allHits</span></a></span><span>
</span><span id="line-301"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405739"><span class="hs-identifier hs-var">isTerm</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-302"></span><span>                        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679405725"><span class="hs-identifier hs-var">tmResults</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679405723"><span class="hs-identifier hs-var">tpResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span>                        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679405723"><span class="hs-identifier hs-var">tpResults</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679405725"><span class="hs-identifier hs-var">tmResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>                </span><span id="local-6989586621679405721"><span class="annot"><a href="#local-6989586621679405720"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679405721"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-305"></span><span>                </span><span id="local-6989586621679405720"><span class="annot"><span class="annottext">go :: Text -&gt; Reference -&gt; Cli r ()
</span><a href="#local-6989586621679405720"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679405719"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405719"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span id="local-6989586621679405718"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405718"><span class="hs-identifier hs-var">fr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-306"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405717"><span class="annot"><span class="annottext">termPatch :: Patch
</span><a href="#local-6989586621679405717"><span class="hs-identifier hs-var hs-var">termPatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  Patch
  Patch
  (Relation Reference TermEdit)
  (Relation Reference TermEdit)
-&gt; (Relation Reference TermEdit -&gt; Relation Reference TermEdit)
-&gt; Patch
-&gt; Patch
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  Patch
  Patch
  (Relation Reference TermEdit)
  (Relation Reference TermEdit)
Lens' Patch (Relation Reference TermEdit)
</span><span class="hs-identifier hs-var">Patch.termEdits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
-&gt; Relation Reference TermEdit -&gt; Relation Reference TermEdit
forall a b. (Ord a, Ord b) =&gt; a -&gt; Relation a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.deleteDom</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405718"><span class="hs-identifier hs-var">fr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405735"><span class="hs-identifier hs-var">patch</span></a></span><span>
</span><span id="line-307"></span><span>                      </span><span id="local-6989586621679405713"><span class="annot"><span class="annottext">typePatch :: Patch
</span><a href="#local-6989586621679405713"><span class="hs-identifier hs-var hs-var">typePatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  Patch
  Patch
  (Relation Reference TypeEdit)
  (Relation Reference TypeEdit)
-&gt; (Relation Reference TypeEdit -&gt; Relation Reference TypeEdit)
-&gt; Patch
-&gt; Patch
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  Patch
  Patch
  (Relation Reference TypeEdit)
  (Relation Reference TypeEdit)
Lens' Patch (Relation Reference TypeEdit)
</span><span class="hs-identifier hs-var">Patch.typeEdits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
-&gt; Relation Reference TypeEdit -&gt; Relation Reference TypeEdit
forall a b. (Ord a, Ord b) =&gt; a -&gt; Relation a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.deleteDom</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405718"><span class="hs-identifier hs-var">fr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405735"><span class="hs-identifier hs-var">patch</span></a></span><span>
</span><span id="line-308"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621679405711"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405711"><span class="hs-identifier hs-var">patchPath''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405710"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405710"><span class="hs-identifier hs-var">patchName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405738"><span class="hs-identifier hs-var">patchPath'</span></a></span><span>
</span><span id="line-309"></span><span>                  </span><span class="hs-comment">-- Save the modified patch</span><span>
</span><span id="line-310"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
forall r. Text -&gt; (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAtM"><span class="hs-identifier hs-var">stepAtM</span></a></span><span>
</span><span id="line-311"></span><span>                    </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405719"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-312"></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405711"><span class="hs-identifier hs-var">patchPath''</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-313"></span><span>                      </span><span class="annot"><span class="annottext">NameSegment -&gt; (Patch -&gt; Patch) -&gt; Branch0 IO -&gt; IO (Branch0 IO)
forall (m :: * -&gt; *).
Monad m =&gt;
NameSegment -&gt; (Patch -&gt; Patch) -&gt; Branch0 m -&gt; m (Branch0 m)
</span><span class="hs-identifier hs-var">Branch.modifyPatches</span></span><span>
</span><span id="line-314"></span><span>                        </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405710"><span class="hs-identifier hs-var">patchName</span></a></span><span>
</span><span id="line-315"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Patch -&gt; Patch -&gt; Patch
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405739"><span class="hs-identifier hs-var">isTerm</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405717"><span class="hs-identifier hs-var">termPatch</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405713"><span class="hs-identifier hs-var">typePatch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>                    </span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>                  </span><span class="hs-comment">-- Say something</span><span>
</span><span id="line-318"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-319"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679405727"><span class="hs-identifier hs-var">hits</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-320"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; [HashQualified Name] -&gt; [HashQualified Name] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SearchTermsNotFoundDetailed"><span class="hs-identifier hs-var">SearchTermsNotFoundDetailed</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405739"><span class="hs-identifier hs-var">isTerm</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405732"><span class="hs-identifier hs-var">misses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; [HashQualified Name]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679405726"><span class="hs-identifier hs-var">opHits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>            </span><span id="local-6989586621679405701"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405701"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-322"></span><span>            </span><span class="annot"><span class="annottext">(Reference -&gt; Cli r ()) -&gt; Set Reference -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Reference -&gt; Cli r ()
</span><a href="#local-6989586621679405720"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405701"><span class="hs-identifier hs-var">description</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405739"><span class="hs-identifier hs-var">isTerm</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405728"><span class="hs-identifier hs-var">tmRefs</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405729"><span class="hs-identifier hs-var">tpRefs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>          </span><span id="local-6989586621679406789"><span class="annot"><a href="#local-6989586621679405698"><span class="hs-identifier hs-type">saveAndApplyPatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Patch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406789"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-324"></span><span>          </span><span id="local-6989586621679405698"><span class="annot"><span class="annottext">saveAndApplyPatch :: Path -&gt; NameSegment -&gt; Patch -&gt; Cli r ()
</span><a href="#local-6989586621679405698"><span class="hs-identifier hs-var hs-var">saveAndApplyPatch</span></a></span></span><span> </span><span id="local-6989586621679405697"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679405697"><span class="hs-identifier hs-var">patchPath''</span></a></span></span><span> </span><span id="local-6989586621679405696"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405696"><span class="hs-identifier hs-var">patchName</span></a></span></span><span> </span><span id="local-6989586621679405695"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405695"><span class="hs-identifier hs-var">patch'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>            </span><span id="local-6989586621679405694"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405694"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-326"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
forall r. Text -&gt; (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAtM"><span class="hs-identifier hs-var">stepAtM</span></a></span><span>
</span><span id="line-327"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405694"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; (1/2)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679405697"><span class="hs-identifier hs-var">patchPath''</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-329"></span><span>                </span><span class="annot"><span class="annottext">NameSegment -&gt; (Patch -&gt; Patch) -&gt; Branch0 IO -&gt; IO (Branch0 IO)
forall (m :: * -&gt; *).
Monad m =&gt;
NameSegment -&gt; (Patch -&gt; Patch) -&gt; Branch0 m -&gt; m (Branch0 m)
</span><span class="hs-identifier hs-var">Branch.modifyPatches</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405696"><span class="hs-identifier hs-var">patchName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Patch -&gt; Patch -&gt; Patch
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405695"><span class="hs-identifier hs-var">patch'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>            </span><span class="hs-comment">-- Apply the modified patch to the current path</span><span>
</span><span id="line-332"></span><span>            </span><span class="hs-comment">-- since we might be able to propagate further.</span><span>
</span><span id="line-333"></span><span>            </span><span id="local-6989586621679405693"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405693"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-334"></span><span>            </span><span class="annot"><span class="annottext">Cli r Bool -&gt; Cli r ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Cli r Bool -&gt; Cli r ()) -&gt; Cli r Bool -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Patch -&gt; Absolute -&gt; Cli r Bool
forall r. Text -&gt; Patch -&gt; Absolute -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#propagatePatch"><span class="hs-identifier hs-var">propagatePatch</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405694"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405695"><span class="hs-identifier hs-var">patch'</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405693"><span class="hs-identifier hs-var">currentPath</span></a></span><span>
</span><span id="line-335"></span><span>            </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-336"></span><span>          </span><span id="local-6989586621679405690"><span class="annot"><span class="annottext">previewResponse :: String
-&gt; SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Cli r ()
</span><a href="#local-6989586621679405690"><span class="hs-identifier hs-var hs-var">previewResponse</span></a></span></span><span> </span><span id="local-6989586621679405689"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405689"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621679405688"><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679405688"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span id="local-6989586621679405687"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679405687"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>            </span><span id="local-6989586621679405686"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405686"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Cli r NamesWithHistory
forall v a r.
Var v =&gt;
TypecheckedUnisonFile v a -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayNames"><span class="hs-identifier hs-var">displayNames</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679405687"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-338"></span><span>            </span><span id="local-6989586621679405685"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405685"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">(PrettyPrintEnvDecl -&gt; PrettyPrintEnv)
-&gt; Cli r PrettyPrintEnvDecl -&gt; Cli r PrettyPrintEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405686"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-339"></span><span>            </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; PrettyPrintEnv
-&gt; SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#Typechecked"><span class="hs-identifier hs-var">Typechecked</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405689"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405685"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679405688"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679405687"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>          </span><span id="local-6989586621679406825"><span class="annot"><a href="#local-6989586621679405683"><span class="hs-identifier hs-type">delete</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-342"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HQSegment</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406825"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- compute matching terms</span><span>
</span><span id="line-343"></span><span>            </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HQSegment</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406825"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- compute matching types</span><span>
</span><span id="line-344"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-345"></span><span>            </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406825"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-346"></span><span>          </span><span id="local-6989586621679405683"><span class="annot"><span class="annottext">delete :: ((Absolute, HQSegment) -&gt; Cli r (Set Referent))
-&gt; ((Absolute, HQSegment) -&gt; Cli r (Set Reference))
-&gt; HQSplit'
-&gt; Cli r ()
</span><a href="#local-6989586621679405683"><span class="hs-identifier hs-var hs-var">delete</span></a></span></span><span> </span><span id="local-6989586621679405682"><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="#local-6989586621679405682"><span class="hs-identifier hs-var">getTerms</span></a></span></span><span> </span><span id="local-6989586621679405681"><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679405681"><span class="hs-identifier hs-var">getTypes</span></a></span></span><span> </span><span id="local-6989586621679405680"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405680"><span class="hs-identifier hs-var">hq'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-347"></span><span>            </span><span id="local-6989586621679405679"><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405679"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r (Absolute, HQSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405680"><span class="hs-identifier hs-var">hq'</span></a></span><span>
</span><span id="line-348"></span><span>            </span><span id="local-6989586621679405678"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405678"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="#local-6989586621679405682"><span class="hs-identifier hs-var">getTerms</span></a></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405679"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-349"></span><span>            </span><span id="local-6989586621679405677"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405677"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679405681"><span class="hs-identifier hs-var">getTypes</span></a></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405679"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-350"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405678"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405677"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#NameNotFound"><span class="hs-identifier hs-var">NameNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405680"><span class="hs-identifier hs-var">hq'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>            </span><span class="hs-comment">-- Mitchell: stripping hash seems wrong here...</span><span>
</span><span id="line-352"></span><span>            </span><span id="local-6989586621679405674"><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679405674"><span class="hs-identifier hs-var">resolvedPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">((Absolute, NameSegment) -&gt; Split)
-&gt; Cli r (Absolute, NameSegment) -&gt; Cli r Split
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSegment -&gt; NameSegment
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">(HQSegment -&gt; NameSegment) -&gt; HQSplit' -&gt; PatchPath
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405680"><span class="hs-identifier hs-var">hq'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>            </span><span id="local-6989586621679405671"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405671"><span class="hs-identifier hs-var">rootNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Names) -&gt; Cli r (Branch0 IO) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-354"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405669"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621679405669"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Name
</span><span class="hs-identifier hs-var">Path.unsafeToName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; Path
</span><span class="hs-identifier hs-var">Path.unsplit</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679405674"><span class="hs-identifier hs-var">resolvedPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>                </span><span id="local-6989586621679407074"><span class="annot"><a href="#local-6989586621679405666"><span class="hs-identifier hs-type">toRel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679407074"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679407074"><span class="hs-identifier hs-type">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">R.Relation</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="annot"><a href="#local-6989586621679407074"><span class="hs-identifier hs-type">ref</span></a></span></span><span>
</span><span id="line-356"></span><span>                </span><span id="local-6989586621679405666"><span class="annot"><span class="annottext">toRel :: Set ref -&gt; Relation Name ref
</span><a href="#local-6989586621679405666"><span class="hs-identifier hs-var hs-var">toRel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, ref)] -&gt; Relation Name ref
forall a b. (Ord a, Ord b) =&gt; [(a, b)] -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Name, ref)] -&gt; Relation Name ref)
-&gt; (Set ref -&gt; [(Name, ref)]) -&gt; Set ref -&gt; Relation Name ref
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ref -&gt; (Name, ref)) -&gt; [ref] -&gt; [(Name, ref)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679405669"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ref] -&gt; [(Name, ref)])
-&gt; (Set ref -&gt; [ref]) -&gt; Set ref -&gt; [(Name, ref)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set ref -&gt; [ref]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span>
</span><span id="line-357"></span><span>                </span><span class="hs-comment">-- these names are relative to the root</span><span>
</span><span id="line-358"></span><span>                </span><span id="local-6989586621679405664"><span class="annot"><span class="annottext">toDelete :: Names
</span><a href="#local-6989586621679405664"><span class="hs-identifier hs-var hs-var">toDelete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Relation Name Referent -&gt; Relation Name Reference -&gt; Names
</span><span class="hs-identifier hs-var">Names</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; Relation Name Referent
forall ref. Ord ref =&gt; Set ref -&gt; Relation Name ref
</span><a href="#local-6989586621679405666"><span class="hs-identifier hs-var">toRel</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405678"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Relation Name Reference
forall ref. Ord ref =&gt; Set ref -&gt; Relation Name ref
</span><a href="#local-6989586621679405666"><span class="hs-identifier hs-var">toRel</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405677"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>            </span><span id="local-6989586621679405663"><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency)
</span><a href="#local-6989586621679405663"><span class="hs-identifier hs-var">endangerments</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Names
-&gt; Names -&gt; Cli r (Map LabeledDependency (NESet LabeledDependency))
forall r.
Names
-&gt; Names -&gt; Cli r (Map LabeledDependency (NESet LabeledDependency))
</span><a href="Unison.Codebase.Editor.HandleInput.html#getEndangeredDependents"><span class="hs-identifier hs-var">getEndangeredDependents</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405664"><span class="hs-identifier hs-var">toDelete</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405671"><span class="hs-identifier hs-var">rootNames</span></a></span><span>
</span><span id="line-360"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency)
</span><a href="#local-6989586621679405663"><span class="hs-identifier hs-var">endangerments</span></a></span><span>
</span><span id="line-361"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-362"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405661"><span class="annot"><span class="annottext">makeDeleteTermNames :: [(Path, Branch0 IO -&gt; Branch0 IO)]
</span><a href="#local-6989586621679405661"><span class="hs-identifier hs-var hs-var">makeDeleteTermNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; (Path, Branch0 IO -&gt; Branch0 IO))
-&gt; [Referent] -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteTermName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679405674"><span class="hs-identifier hs-var">resolvedPath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Referent] -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)])
-&gt; (Set Referent -&gt; [Referent])
-&gt; Set Referent
-&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)])
-&gt; Set Referent -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405678"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-363"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405659"><span class="annot"><span class="annottext">makeDeleteTypeNames :: [(Path, Branch0 IO -&gt; Branch0 IO)]
</span><a href="#local-6989586621679405659"><span class="hs-identifier hs-var hs-var">makeDeleteTypeNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; (Path, Branch0 IO -&gt; Branch0 IO))
-&gt; [Reference] -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Reference -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteTypeName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679405674"><span class="hs-identifier hs-var">resolvedPath</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Reference] -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)])
-&gt; (Set Reference -&gt; [Reference])
-&gt; Set Reference
-&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)])
-&gt; Set Reference -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405677"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-364"></span><span>                </span><span id="local-6989586621679405657"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405657"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-365"></span><span>                </span><span id="local-6989586621679405656"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405656"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-366"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-var">stepManyAt</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405656"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; Branch0 IO)]
</span><a href="#local-6989586621679405661"><span class="hs-identifier hs-var">makeDeleteTermNames</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; Branch0 IO)]
-&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
-&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; Branch0 IO)]
</span><a href="#local-6989586621679405659"><span class="hs-identifier hs-var">makeDeleteTypeNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>                </span><span id="local-6989586621679405654"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405654"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-368"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679405653"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405653"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405652"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405652"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405657"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405654"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-369"></span><span>                </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; BranchDiffOutput Symbol Ann -&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffAfterDeleteDefinitions"><span class="hs-identifier hs-var">ShowDiffAfterDeleteDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405653"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405652"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>                </span><span id="local-6989586621679405648"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405648"><span class="hs-identifier hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
forall r. (Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#currentPrettyPrintEnvDecl"><span class="hs-identifier hs-var">currentPrettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span>
</span><span id="line-372"></span><span>                </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Map LabeledDependency (NESet LabeledDependency)
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#CantDeleteDefinitions"><span class="hs-identifier hs-var">CantDeleteDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405648"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency)
</span><a href="#local-6989586621679405663"><span class="hs-identifier hs-var">endangerments</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#ApiI"><span class="hs-identifier hs-var">ApiI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-375"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405645"><span class="annot"><span class="annottext">Maybe BaseUrl
$sel:serverBaseUrl:Env :: Env -&gt; Maybe BaseUrl
serverBaseUrl :: Maybe BaseUrl
</span><a href="Unison.Cli.Monad.html#%24sel%3AserverBaseUrl%3AEnv"><span class="hs-identifier hs-var hs-var">serverBaseUrl</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-376"></span><span>              </span><span class="annot"><span class="annottext">Maybe BaseUrl -&gt; (BaseUrl -&gt; Cli r ()) -&gt; Cli r ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">whenJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe BaseUrl
</span><a href="#local-6989586621679405645"><span class="hs-identifier hs-var">serverBaseUrl</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679405642"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679405642"><span class="hs-identifier hs-var">baseUrl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-377"></span><span>                </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-378"></span><span>                  </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#PrintMessage"><span class="hs-identifier hs-var">PrintMessage</span></a></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Output) -&gt; Pretty ColorText -&gt; Output
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-379"></span><span>                    </span><span class="annot"><span class="annottext">[Pretty ColorText] -&gt; Pretty ColorText
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span>
</span><span id="line-380"></span><span>                      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;The API information is as follows:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-381"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span class="hs-special">,</span><span>
</span><span id="line-382"></span><span>                        </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.hiBlue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;UI: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrlPath -&gt; BaseUrl -&gt; String
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="annot"><span class="annottext">BaseUrlPath
</span><span class="hs-identifier hs-var">Server.UI</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679405642"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-383"></span><span>                        </span><span class="annot"><span class="annottext">Pretty ColorText
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span class="hs-special">,</span><span>
</span><span id="line-384"></span><span>                        </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; Pretty ColorText
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText
</span><span class="hs-identifier hs-var">P.hiBlue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-string">&quot;API: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Pretty ColorText -&gt; Pretty ColorText
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Pretty ColorText
forall a. IsString a =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">fromString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrlPath -&gt; BaseUrl -&gt; String
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="annot"><span class="annottext">BaseUrlPath
</span><span class="hs-identifier hs-var">Server.Api</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679405642"><span class="hs-identifier hs-var">baseUrl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>                      </span><span class="hs-special">]</span><span>
</span><span id="line-386"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#CreateMessage"><span class="hs-identifier hs-type">CreateMessage</span></a></span><span> </span><span id="local-6989586621679405632"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679405632"><span class="hs-identifier hs-var">pretty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-387"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#PrintMessage"><span class="hs-identifier hs-var">PrintMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679405632"><span class="hs-identifier hs-var">pretty</span></a></span><span>
</span><span id="line-388"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#ShowReflogI"><span class="hs-identifier hs-var">ShowReflogI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-389"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405630"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405630"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-390"></span><span>              </span><span id="local-6989586621679405629"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405629"><span class="hs-identifier hs-var">sbhLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.branchHashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405630"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405628"><span class="annot"><span class="annottext">numEntriesToShow :: Int
</span><a href="#local-6989586621679405628"><span class="hs-identifier hs-var hs-var">numEntriesToShow</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">500</span></span><span>
</span><span id="line-392"></span><span>              </span><span id="local-6989586621679405627"><span class="annot"><span class="annottext">[Entry ShortBranchHash Text]
</span><a href="#local-6989586621679405627"><span class="hs-identifier hs-var">entries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Entry CausalHash Text] -&gt; Cli r [Entry CausalHash Text]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Int -&gt; IO [Entry CausalHash Text]
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Int -&gt; m [Entry CausalHash Text]
</span><span class="hs-identifier hs-var hs-var">Codebase.getReflog</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405630"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405628"><span class="hs-identifier hs-var">numEntriesToShow</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r [Entry CausalHash Text]
-&gt; ([Entry CausalHash Text] -&gt; [Entry ShortBranchHash Text])
-&gt; Cli r [Entry ShortBranchHash Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Entry CausalHash Text -&gt; Entry ShortBranchHash Text)
-&gt; [Entry CausalHash Text] -&gt; [Entry ShortBranchHash Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CausalHash -&gt; ShortBranchHash)
-&gt; Entry CausalHash Text -&gt; Entry ShortBranchHash Text
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">((CausalHash -&gt; ShortBranchHash)
 -&gt; Entry CausalHash Text -&gt; Entry ShortBranchHash Text)
-&gt; (CausalHash -&gt; ShortBranchHash)
-&gt; Entry CausalHash Text
-&gt; Entry ShortBranchHash Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; CausalHash -&gt; ShortBranchHash
forall h. Coercible h Hash =&gt; Int -&gt; h -&gt; ShortBranchHash
</span><span class="hs-identifier hs-var">SBH.fromHash</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405629"><span class="hs-identifier hs-var">sbhLength</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405625"><span class="annot"><span class="annottext">moreEntriesToLoad :: Bool
</span><a href="#local-6989586621679405625"><span class="hs-identifier hs-var hs-var">moreEntriesToLoad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Entry ShortBranchHash Text] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Entry ShortBranchHash Text]
</span><a href="#local-6989586621679405627"><span class="hs-identifier hs-var">entries</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405628"><span class="hs-identifier hs-var">numEntriesToShow</span></a></span><span>
</span><span id="line-394"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405623"><span class="annot"><span class="annottext">expandedEntries :: [(Maybe UTCTime, ShortBranchHash, Text)]
</span><a href="#local-6989586621679405623"><span class="hs-identifier hs-var hs-var">expandedEntries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool)
 -&gt; Maybe
      ((Maybe UTCTime, ShortBranchHash, Text),
       ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool)))
-&gt; ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool)
-&gt; [(Maybe UTCTime, ShortBranchHash, Text)]
forall b a. (b -&gt; Maybe (a, b)) -&gt; b -&gt; [a]
</span><span class="hs-identifier hs-var">List.unfoldr</span></span><span> </span><span class="annot"><span class="annottext">([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool)
-&gt; Maybe
     ((Maybe UTCTime, ShortBranchHash, Text),
      ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
</span><a href="#local-6989586621679405621"><span class="hs-identifier hs-var">expandEntries</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Entry ShortBranchHash Text]
</span><a href="#local-6989586621679405627"><span class="hs-identifier hs-var">entries</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ShortBranchHash
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405625"><span class="hs-identifier hs-var">moreEntriesToLoad</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405620"><span class="annot"><span class="annottext">numberedEntries :: [String]
</span><a href="#local-6989586621679405620"><span class="hs-identifier hs-var hs-var">numberedEntries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Maybe UTCTime, ShortBranchHash, Text)]
</span><a href="#local-6989586621679405623"><span class="hs-identifier hs-var">expandedEntries</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe UTCTime, ShortBranchHash, Text)]
-&gt; ((Maybe UTCTime, ShortBranchHash, Text) -&gt; String) -&gt; [String]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679405619"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621679405619"><span class="hs-identifier hs-var">_time</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405618"><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405618"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405617"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405617"><span class="hs-identifier hs-var">_reason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; String
</span><span class="hs-identifier hs-var">SBH.toString</span></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405618"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-cpp">
              #numberedArgs .= numberedEntries
</span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Maybe UTCTime, ShortBranchHash, Text)] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ShowReflog"><span class="hs-identifier hs-var">ShowReflog</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe UTCTime, ShortBranchHash, Text)]
</span><a href="#local-6989586621679405623"><span class="hs-identifier hs-var">expandedEntries</span></a></span><span>
</span><span id="line-398"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-399"></span><span>                </span><span class="annot"><a href="#local-6989586621679405621"><span class="hs-identifier hs-type">expandEntries</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-400"></span><span>                  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Reflog.Entry</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SBH.ShortBranchHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SBH.ShortBranchHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-401"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTCTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SBH.ShortBranchHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Reflog.Entry</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SBH.ShortBranchHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SBH.ShortBranchHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>                </span><span id="local-6989586621679405621"><span class="annot"><span class="annottext">expandEntries :: ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool)
-&gt; Maybe
     ((Maybe UTCTime, ShortBranchHash, Text),
      ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
</span><a href="#local-6989586621679405621"><span class="hs-identifier hs-var hs-var">expandEntries</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405613"><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405613"><span class="hs-identifier hs-var">expectedHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405612"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405612"><span class="hs-identifier hs-var">moreEntriesToLoad</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-403"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405612"><span class="hs-identifier hs-var">moreEntriesToLoad</span></a></span><span>
</span><span id="line-404"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe
  ((Maybe UTCTime, ShortBranchHash, Text),
   ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-405"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">((Maybe UTCTime, ShortBranchHash, Text),
 ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
-&gt; Maybe
     ((Maybe UTCTime, ShortBranchHash, Text),
      ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405613"><span class="hs-identifier hs-var">expectedHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;history starts here&quot;</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ShortBranchHash
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405612"><span class="hs-identifier hs-var">moreEntriesToLoad</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-406"></span><span>                </span><span class="annot"><a href="#local-6989586621679405621"><span class="hs-identifier hs-var">expandEntries</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ShortBranchHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405611"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405611"><span class="hs-identifier hs-var">_moreEntriesToLoad</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe
  ((Maybe UTCTime, ShortBranchHash, Text),
   ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-407"></span><span>                </span><span class="annot"><a href="#local-6989586621679405621"><span class="hs-identifier hs-var">expandEntries</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679405610"><span class="annot"><span class="annottext">entries :: [Entry ShortBranchHash Text]
</span><a href="#local-6989586621679405610"><span class="hs-identifier hs-var">entries</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reflog.Entry</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405608"><span class="annot"><span class="annottext">UTCTime
time :: forall causal text. Entry causal text -&gt; UTCTime
time :: UTCTime
</span><span class="hs-identifier hs-var hs-var">time</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405606"><span class="annot"><span class="annottext">ShortBranchHash
fromRootCausalHash :: forall causal text. Entry causal text -&gt; causal
fromRootCausalHash :: ShortBranchHash
</span><span class="hs-identifier hs-var hs-var">fromRootCausalHash</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405604"><span class="annot"><span class="annottext">ShortBranchHash
toRootCausalHash :: forall causal text. Entry causal text -&gt; causal
toRootCausalHash :: ShortBranchHash
</span><span class="hs-identifier hs-var hs-var">toRootCausalHash</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405602"><span class="annot"><span class="annottext">Text
reason :: forall causal text. Entry causal text -&gt; text
reason :: Text
</span><span class="hs-identifier hs-var hs-var">reason</span></span></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679405600"><span class="annot"><span class="annottext">[Entry ShortBranchHash Text]
</span><a href="#local-6989586621679405600"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405599"><span class="annot"><span class="annottext">Maybe ShortBranchHash
</span><a href="#local-6989586621679405599"><span class="hs-identifier hs-var">mayExpectedHash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405598"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405598"><span class="hs-identifier hs-var">moreEntriesToLoad</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-408"></span><span>                  </span><span class="annot"><span class="annottext">((Maybe UTCTime, ShortBranchHash, Text),
 ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
-&gt; Maybe
     ((Maybe UTCTime, ShortBranchHash, Text),
      ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(((Maybe UTCTime, ShortBranchHash, Text),
  ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
 -&gt; Maybe
      ((Maybe UTCTime, ShortBranchHash, Text),
       ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool)))
-&gt; ((Maybe UTCTime, ShortBranchHash, Text),
    ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
-&gt; Maybe
     ((Maybe UTCTime, ShortBranchHash, Text),
      ([Entry ShortBranchHash Text], Maybe ShortBranchHash, Bool))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-409"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ShortBranchHash
</span><a href="#local-6989586621679405599"><span class="hs-identifier hs-var">mayExpectedHash</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-410"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405597"><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405597"><span class="hs-identifier hs-var">expectedHash</span></a></span></span><span>
</span><span id="line-411"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405597"><span class="hs-identifier hs-var">expectedHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; ShortBranchHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405604"><span class="hs-identifier hs-var">toRootCausalHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; Maybe UTCTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405608"><span class="hs-identifier hs-var">time</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405604"><span class="hs-identifier hs-var">toRootCausalHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405602"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Entry ShortBranchHash Text]
</span><a href="#local-6989586621679405600"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; Maybe ShortBranchHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405606"><span class="hs-identifier hs-var">fromRootCausalHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405598"><span class="hs-identifier hs-var">moreEntriesToLoad</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-412"></span><span>                        </span><span class="hs-comment">-- Historical discontinuity, insert a synthetic entry</span><span>
</span><span id="line-413"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405604"><span class="hs-identifier hs-var">toRootCausalHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(external change)&quot;</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Entry ShortBranchHash Text]
</span><a href="#local-6989586621679405610"><span class="hs-identifier hs-var">entries</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ShortBranchHash
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405598"><span class="hs-identifier hs-var">moreEntriesToLoad</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>                      </span><span class="hs-comment">-- No expectation, either because this is the most recent entry or</span><span>
</span><span id="line-415"></span><span>                      </span><span class="hs-comment">-- because we're recovering from a discontinuity</span><span>
</span><span id="line-416"></span><span>                      </span><span class="annot"><span class="annottext">Maybe ShortBranchHash
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; Maybe UTCTime
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621679405608"><span class="hs-identifier hs-var">time</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405604"><span class="hs-identifier hs-var">toRootCausalHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405602"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Entry ShortBranchHash Text]
</span><a href="#local-6989586621679405600"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; Maybe ShortBranchHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405606"><span class="hs-identifier hs-var">fromRootCausalHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405598"><span class="hs-identifier hs-var">moreEntriesToLoad</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ResetRootI"><span class="hs-identifier hs-type">ResetRootI</span></a></span><span> </span><span id="local-6989586621679405595"><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405595"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-418"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; Cli r () -&gt; Cli r ()
forall r a. String -&gt; Cli r a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#time"><span class="hs-identifier hs-var">Cli.time</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reset-root&quot;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-419"></span><span>                </span><span id="local-6989586621679405593"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405593"><span class="hs-identifier hs-var">newRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-420"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405595"><span class="hs-identifier hs-var">src0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-421"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679405592"><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405592"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; Cli r (Branch IO)
forall r. ShortBranchHash -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#resolveShortBranchHash"><span class="hs-identifier hs-var">Cli.resolveShortBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405592"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-422"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679405590"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405590"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r (Branch IO)
forall r. Path' -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#expectBranchAtPath%27"><span class="hs-identifier hs-var">Cli.expectBranchAtPath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405590"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-423"></span><span>                </span><span id="local-6989586621679405588"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405588"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-424"></span><span>                </span><span class="annot"><span class="annottext">Branch IO -&gt; Text -&gt; Cli r ()
forall r. Branch IO -&gt; Text -&gt; Cli r ()
</span><a href="Unison.Cli.MonadUtils.html#updateRoot"><span class="hs-identifier hs-var">Cli.updateRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405593"><span class="hs-identifier hs-var">newRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405588"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-425"></span><span>                </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-426"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ForkLocalBranchI"><span class="hs-identifier hs-type">ForkLocalBranchI</span></a></span><span> </span><span id="local-6989586621679405585"><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405585"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679405584"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405584"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-427"></span><span>              </span><span id="local-6989586621679405583"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405583"><span class="hs-identifier hs-var">srcb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-428"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405585"><span class="hs-identifier hs-var">src0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-429"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679405582"><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405582"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; Cli r (Branch IO)
forall r. ShortBranchHash -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#resolveShortBranchHash"><span class="hs-identifier hs-var">Cli.resolveShortBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405582"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-430"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679405581"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405581"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r (Branch IO)
forall r. Path' -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#expectBranchAtPath%27"><span class="hs-identifier hs-var">Cli.expectBranchAtPath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405581"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-431"></span><span>              </span><span class="annot"><span class="annottext">Path' -&gt; Cli r ()
forall r. Path' -&gt; Cli r ()
</span><a href="Unison.Cli.MonadUtils.html#assertNoBranchAtPath%27"><span class="hs-identifier hs-var">Cli.assertNoBranchAtPath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405584"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-432"></span><span>              </span><span id="local-6989586621679405579"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405579"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-433"></span><span>              </span><span id="local-6989586621679405578"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405578"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405584"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-434"></span><span>              </span><span id="local-6989586621679405576"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405576"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
forall r.
Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
</span><a href="Unison.Cli.MonadUtils.html#updateAtM"><span class="hs-identifier hs-var">Cli.updateAtM</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405579"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405578"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cli r (Branch IO) -&gt; Branch IO -&gt; Cli r (Branch IO)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Cli r (Branch IO) -&gt; Branch IO -&gt; Cli r (Branch IO))
-&gt; Cli r (Branch IO) -&gt; Branch IO -&gt; Cli r (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Cli r (Branch IO)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405583"><span class="hs-identifier hs-var">srcb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405576"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#BranchEmpty"><span class="hs-identifier hs-var">BranchEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405585"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-436"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MergeLocalBranchI"><span class="hs-identifier hs-type">MergeLocalBranchI</span></a></span><span> </span><span id="local-6989586621679405572"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405572"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679405571"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405571"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span id="local-6989586621679405570"><span class="annot"><span class="annottext">MergeMode
</span><a href="#local-6989586621679405570"><span class="hs-identifier hs-var">mergeMode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-437"></span><span>              </span><span id="local-6989586621679405569"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405569"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-438"></span><span>              </span><span id="local-6989586621679405568"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405568"><span class="hs-identifier hs-var">srcb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r (Branch IO)
forall r. Path' -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#expectBranchAtPath%27"><span class="hs-identifier hs-var">Cli.expectBranchAtPath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405572"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-439"></span><span>              </span><span id="local-6989586621679405567"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405567"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405571"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-440"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405566"><span class="annot"><span class="annottext">err :: Maybe Output
</span><a href="#local-6989586621679405566"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Maybe Output
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Maybe Output) -&gt; Output -&gt; Maybe Output
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Path' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeAlreadyUpToDate"><span class="hs-identifier hs-var">MergeAlreadyUpToDate</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405572"><span class="hs-identifier hs-var">src0</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405571"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-441"></span><span>              </span><span class="annot"><span class="annottext">MergeMode
-&gt; Text
-&gt; Maybe Output
-&gt; Branch IO
-&gt; Maybe Path'
-&gt; Absolute
-&gt; Cli r ()
forall r.
MergeMode
-&gt; Text
-&gt; Maybe Output
-&gt; Branch IO
-&gt; Maybe Path'
-&gt; Absolute
-&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#mergeBranchAndPropagateDefaultPatch"><span class="hs-identifier hs-var">mergeBranchAndPropagateDefaultPatch</span></a></span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><a href="#local-6989586621679405570"><span class="hs-identifier hs-var">mergeMode</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405569"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Output
</span><a href="#local-6989586621679405566"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405568"><span class="hs-identifier hs-var">srcb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path' -&gt; Maybe Path'
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405571"><span class="hs-identifier hs-var">dest0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405567"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-442"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PreviewMergeLocalBranchI"><span class="hs-identifier hs-type">PreviewMergeLocalBranchI</span></a></span><span> </span><span id="local-6989586621679405562"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405562"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679405561"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405561"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-443"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405560"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405560"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-444"></span><span>              </span><span id="local-6989586621679405559"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405559"><span class="hs-identifier hs-var">srcb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r (Branch IO)
forall r. Path' -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#expectBranchAtPath%27"><span class="hs-identifier hs-var">Cli.expectBranchAtPath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405562"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-445"></span><span>              </span><span id="local-6989586621679405558"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405558"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405561"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-446"></span><span>              </span><span id="local-6989586621679405557"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405557"><span class="hs-identifier hs-var">destb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch IO)
forall r. Absolute -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranchAt"><span class="hs-identifier hs-var">Cli.getBranchAt</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405558"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-447"></span><span>              </span><span id="local-6989586621679405555"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405555"><span class="hs-identifier hs-var">merged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO)))
-&gt; MergeMode -&gt; Branch IO -&gt; Branch IO -&gt; IO (Branch IO)
forall (m :: * -&gt; *).
Monad m =&gt;
(Branch m -&gt; Branch m -&gt; m (Maybe (Branch m)))
-&gt; MergeMode -&gt; Branch m -&gt; Branch m -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Branch.merge''</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Branch m -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.lca</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405560"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><span class="hs-identifier hs-var">Branch.RegularMerge</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405559"><span class="hs-identifier hs-var">srcb</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405557"><span class="hs-identifier hs-var">destb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405555"><span class="hs-identifier hs-var">merged</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch IO -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405557"><span class="hs-identifier hs-var">destb</span></a></span><span>
</span><span id="line-449"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path' -&gt; Path' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#PreviewMergeAlreadyUpToDate"><span class="hs-identifier hs-var">PreviewMergeAlreadyUpToDate</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405562"><span class="hs-identifier hs-var">src0</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405561"><span class="hs-identifier hs-var">dest0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-451"></span><span>                  </span><span class="hs-special">(</span><span id="local-6989586621679405550"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405550"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405549"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405549"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405557"><span class="hs-identifier hs-var">destb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405555"><span class="hs-identifier hs-var">merged</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>                  </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path'
-&gt; Absolute
-&gt; PrettyPrintEnv
-&gt; BranchDiffOutput Symbol Ann
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffAfterMergePreview"><span class="hs-identifier hs-var">ShowDiffAfterMergePreview</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405561"><span class="hs-identifier hs-var">dest0</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405558"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405550"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405549"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DiffNamespaceI"><span class="hs-identifier hs-type">DiffNamespaceI</span></a></span><span> </span><span id="local-6989586621679405545"><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405545"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621679405544"><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405544"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-454"></span><span>              </span><span id="local-6989586621679405543"><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405543"><span class="hs-identifier hs-var">absBefore</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LensLike
  (Cli r) (Either ShortBranchHash Path') AbsBranchId Path' Absolute
-&gt; LensLike
     (Cli r) (Either ShortBranchHash Path') AbsBranchId Path' Absolute
forall (f :: * -&gt; *) s t a b.
LensLike f s t a b -&gt; LensLike f s t a b
</span><span class="hs-identifier hs-var">traverseOf</span></span><span> </span><span class="annot"><span class="annottext">LensLike
  (Cli r) (Either ShortBranchHash Path') AbsBranchId Path' Absolute
forall c a b. Prism (Either c a) (Either c b) a b
</span><span class="hs-identifier hs-var">_Right</span></span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405545"><span class="hs-identifier hs-var">before</span></a></span><span>
</span><span id="line-455"></span><span>              </span><span id="local-6989586621679405540"><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405540"><span class="hs-identifier hs-var">absAfter</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LensLike
  (Cli r) (Either ShortBranchHash Path') AbsBranchId Path' Absolute
-&gt; LensLike
     (Cli r) (Either ShortBranchHash Path') AbsBranchId Path' Absolute
forall (f :: * -&gt; *) s t a b.
LensLike f s t a b -&gt; LensLike f s t a b
</span><span class="hs-identifier hs-var">traverseOf</span></span><span> </span><span class="annot"><span class="annottext">LensLike
  (Cli r) (Either ShortBranchHash Path') AbsBranchId Path' Absolute
forall c a b. Prism (Either c a) (Either c b) a b
</span><span class="hs-identifier hs-var">_Right</span></span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405544"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-456"></span><span>              </span><span id="local-6989586621679405539"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405539"><span class="hs-identifier hs-var">beforeBranch0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch0 IO)
-&gt; Cli r (Branch IO) -&gt; Cli r (Branch0 IO)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AbsBranchId -&gt; Cli r (Branch IO)
forall r. AbsBranchId -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#resolveAbsBranchId"><span class="hs-identifier hs-var">Cli.resolveAbsBranchId</span></a></span><span> </span><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405543"><span class="hs-identifier hs-var">absBefore</span></a></span><span>
</span><span id="line-457"></span><span>              </span><span id="local-6989586621679405537"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405537"><span class="hs-identifier hs-var">afterBranch0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch0 IO)
-&gt; Cli r (Branch IO) -&gt; Cli r (Branch0 IO)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">AbsBranchId -&gt; Cli r (Branch IO)
forall r. AbsBranchId -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#resolveAbsBranchId"><span class="hs-identifier hs-var">Cli.resolveAbsBranchId</span></a></span><span> </span><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405540"><span class="hs-identifier hs-var">absAfter</span></a></span><span>
</span><span id="line-458"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO -&gt; Bool
forall (m :: * -&gt; *). Branch0 m -&gt; Bool
</span><span class="hs-identifier hs-var">Branch.isEmpty0</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405539"><span class="hs-identifier hs-var">beforeBranch0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Bool
forall (m :: * -&gt; *). Branch0 m -&gt; Bool
</span><span class="hs-identifier hs-var">Branch.isEmpty0</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405537"><span class="hs-identifier hs-var">afterBranch0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-459"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ())
-&gt; (NonEmpty AbsBranchId -&gt; Output)
-&gt; NonEmpty AbsBranchId
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty AbsBranchId -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#NamespaceEmpty"><span class="hs-identifier hs-var">NamespaceEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty AbsBranchId -&gt; Cli r ())
-&gt; NonEmpty AbsBranchId -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405543"><span class="hs-identifier hs-var">absBefore</span></a></span><span> </span><span class="annot"><span class="annottext">AbsBranchId -&gt; [AbsBranchId] -&gt; NonEmpty AbsBranchId
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">Nel.:|</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405540"><span class="hs-identifier hs-var">absAfter</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ())
-&gt; (NonEmpty AbsBranchId -&gt; Output)
-&gt; NonEmpty AbsBranchId
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty AbsBranchId -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#NamespaceEmpty"><span class="hs-identifier hs-var">NamespaceEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty AbsBranchId -&gt; Cli r ())
-&gt; NonEmpty AbsBranchId -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405543"><span class="hs-identifier hs-var">absBefore</span></a></span><span> </span><span class="annot"><span class="annottext">AbsBranchId -&gt; [AbsBranchId] -&gt; NonEmpty AbsBranchId
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">Nel.:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-461"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ())
-&gt; (NonEmpty AbsBranchId -&gt; Output)
-&gt; NonEmpty AbsBranchId
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty AbsBranchId -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#NamespaceEmpty"><span class="hs-identifier hs-var">NamespaceEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty AbsBranchId -&gt; Cli r ())
-&gt; NonEmpty AbsBranchId -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405540"><span class="hs-identifier hs-var">absAfter</span></a></span><span> </span><span class="annot"><span class="annottext">AbsBranchId -&gt; [AbsBranchId] -&gt; NonEmpty AbsBranchId
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">Nel.:|</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Cli r ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679405533"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405533"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405532"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405532"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405539"><span class="hs-identifier hs-var">beforeBranch0</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405537"><span class="hs-identifier hs-var">afterBranch0</span></a></span><span>
</span><span id="line-464"></span><span>              </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AbsBranchId
-&gt; AbsBranchId
-&gt; PrettyPrintEnv
-&gt; BranchDiffOutput Symbol Ann
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffNamespace"><span class="hs-identifier hs-var">ShowDiffNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405543"><span class="hs-identifier hs-var">absBefore</span></a></span><span> </span><span class="annot"><span class="annottext">AbsBranchId
</span><a href="#local-6989586621679405540"><span class="hs-identifier hs-var">absAfter</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405533"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405532"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#CreatePullRequestI"><span class="hs-identifier hs-type">CreatePullRequestI</span></a></span><span> </span><span id="local-6989586621679405529"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405529"><span class="hs-identifier hs-var">baseRepo</span></a></span></span><span> </span><span id="local-6989586621679405528"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405528"><span class="hs-identifier hs-var">headRepo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; ReadRemoteNamespace -&gt; Cli r ()
forall r. ReadRemoteNamespace -&gt; ReadRemoteNamespace -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleCreatePullRequest"><span class="hs-identifier hs-var">handleCreatePullRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405529"><span class="hs-identifier hs-var">baseRepo</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405528"><span class="hs-identifier hs-var">headRepo</span></a></span><span>
</span><span id="line-466"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#LoadPullRequestI"><span class="hs-identifier hs-type">LoadPullRequestI</span></a></span><span> </span><span id="local-6989586621679405525"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405525"><span class="hs-identifier hs-var">baseRepo</span></a></span></span><span> </span><span id="local-6989586621679405524"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405524"><span class="hs-identifier hs-var">headRepo</span></a></span></span><span> </span><span id="local-6989586621679405523"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405523"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-467"></span><span>              </span><span class="annot"><span class="annottext">Path' -&gt; Cli r ()
forall r. Path' -&gt; Cli r ()
</span><a href="Unison.Cli.MonadUtils.html#assertNoBranchAtPath%27"><span class="hs-identifier hs-var">Cli.assertNoBranchAtPath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405523"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-468"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405522"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405522"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-469"></span><span>              </span><span id="local-6989586621679405521"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405521"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-470"></span><span>              </span><span id="local-6989586621679405520"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405520"><span class="hs-identifier hs-var">destAbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405523"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-471"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405519"><span class="annot"><span class="annottext">getBranch :: ReadRemoteNamespace -&gt; Cli r (Branch IO)
</span><a href="#local-6989586621679405519"><span class="hs-identifier hs-var hs-var">getBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-472"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">ReadRemoteNamespaceGit</span></span><span> </span><span id="local-6989586621679405517"><span class="annot"><span class="annottext">ReadGitRemoteNamespace
</span><a href="#local-6989586621679405517"><span class="hs-identifier hs-var">repo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-473"></span><span>                      </span><span class="annot"><span class="annottext">IO (Either GitError (Branch IO))
-&gt; (GitError -&gt; Cli r (Branch IO)) -&gt; Cli r (Branch IO)
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ReadGitRemoteNamespace
-&gt; SyncMode
-&gt; Preprocessing IO
-&gt; IO (Either GitError (Branch IO))
forall (m :: * -&gt; *) v a.
MonadUnliftIO m =&gt;
Codebase m v a
-&gt; ReadGitRemoteNamespace
-&gt; SyncMode
-&gt; Preprocessing m
-&gt; m (Either GitError (Branch m))
</span><span class="hs-identifier hs-var">Codebase.importRemoteBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405522"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ReadGitRemoteNamespace
</span><a href="#local-6989586621679405517"><span class="hs-identifier hs-var">repo</span></a></span><span> </span><span class="annot"><span class="annottext">SyncMode
</span><span class="hs-identifier hs-var">SyncMode.ShortCircuit</span></span><span> </span><span class="annot"><span class="annottext">Preprocessing IO
forall (m :: * -&gt; *). Preprocessing m
</span><span class="hs-identifier hs-var">Unmodified</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679405512"><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679405512"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-474"></span><span>                        </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Branch IO)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GitError -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#GitError"><span class="hs-identifier hs-var">Output.GitError</span></a></span><span> </span><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679405512"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">ReadRemoteNamespaceShare</span></span><span> </span><span id="local-6989586621679405509"><span class="annot"><span class="annottext">ReadShareRemoteNamespace
</span><a href="#local-6989586621679405509"><span class="hs-identifier hs-var">repo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReadShareRemoteNamespace -&gt; Cli r (Branch IO)
forall r. ReadShareRemoteNamespace -&gt; Cli r (Branch IO)
</span><a href="Unison.Codebase.Editor.HandleInput.html#importRemoteShareBranch"><span class="hs-identifier hs-var">importRemoteShareBranch</span></a></span><span> </span><span class="annot"><span class="annottext">ReadShareRemoteNamespace
</span><a href="#local-6989586621679405509"><span class="hs-identifier hs-var">repo</span></a></span><span>
</span><span id="line-476"></span><span>              </span><span id="local-6989586621679405507"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405507"><span class="hs-identifier hs-var">baseb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; Cli r (Branch IO)
</span><a href="#local-6989586621679405519"><span class="hs-identifier hs-var">getBranch</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405525"><span class="hs-identifier hs-var">baseRepo</span></a></span><span>
</span><span id="line-477"></span><span>              </span><span id="local-6989586621679405506"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405506"><span class="hs-identifier hs-var">headb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; Cli r (Branch IO)
</span><a href="#local-6989586621679405519"><span class="hs-identifier hs-var">getBranch</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405524"><span class="hs-identifier hs-var">headRepo</span></a></span><span>
</span><span id="line-478"></span><span>              </span><span id="local-6989586621679405505"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405505"><span class="hs-identifier hs-var">mergedb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO)))
-&gt; MergeMode -&gt; Branch IO -&gt; Branch IO -&gt; IO (Branch IO)
forall (m :: * -&gt; *).
Monad m =&gt;
(Branch m -&gt; Branch m -&gt; m (Maybe (Branch m)))
-&gt; MergeMode -&gt; Branch m -&gt; Branch m -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Branch.merge''</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Branch m -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.lca</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405522"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><span class="hs-identifier hs-var">Branch.RegularMerge</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405507"><span class="hs-identifier hs-var">baseb</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405506"><span class="hs-identifier hs-var">headb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>              </span><span id="local-6989586621679405504"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405504"><span class="hs-identifier hs-var">squashedb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO)))
-&gt; MergeMode -&gt; Branch IO -&gt; Branch IO -&gt; IO (Branch IO)
forall (m :: * -&gt; *).
Monad m =&gt;
(Branch m -&gt; Branch m -&gt; m (Maybe (Branch m)))
-&gt; MergeMode -&gt; Branch m -&gt; Branch m -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Branch.merge''</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Branch m -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.lca</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405522"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><span class="hs-identifier hs-var">Branch.SquashMerge</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405506"><span class="hs-identifier hs-var">headb</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405507"><span class="hs-identifier hs-var">baseb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>              </span><span class="hs-comment">-- Perform all child updates in a single step.</span><span>
</span><span id="line-481"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; (Branch IO -&gt; Branch IO) -&gt; Cli r Bool
forall r.
Text -&gt; Absolute -&gt; (Branch IO -&gt; Branch IO) -&gt; Cli r Bool
</span><a href="Unison.Cli.MonadUtils.html#updateAt"><span class="hs-identifier hs-var">Cli.updateAt</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405521"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405520"><span class="hs-identifier hs-var">destAbs</span></a></span><span> </span><span class="annot"><span class="annottext">((Branch IO -&gt; Branch IO) -&gt; Cli r Bool)
-&gt; (Branch IO -&gt; Branch IO) -&gt; Cli r Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Branch0 IO) -&gt; Branch IO -&gt; Branch IO
forall (m :: * -&gt; *).
Applicative m =&gt;
(Branch0 m -&gt; Branch0 m) -&gt; Branch m -&gt; Branch m
</span><span class="hs-identifier hs-var">Branch.step</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679405500"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405500"><span class="hs-identifier hs-var">destBranch0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-482"></span><span>                </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405500"><span class="hs-identifier hs-var">destBranch0</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; (Branch0 IO -&gt; Branch0 IO) -&gt; Branch0 IO
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Map NameSegment (Branch IO)
 -&gt; Identity (Map NameSegment (Branch IO)))
-&gt; Branch0 IO -&gt; Identity (Branch0 IO)
forall (m :: * -&gt; *).
Lens' (Branch0 m) (Map NameSegment (Branch m))
</span><span class="hs-identifier hs-var">Branch.children</span></span><span>
</span><span id="line-483"></span><span>                  </span><span class="annot"><span class="annottext">((Map NameSegment (Branch IO)
  -&gt; Identity (Map NameSegment (Branch IO)))
 -&gt; Branch0 IO -&gt; Identity (Branch0 IO))
-&gt; (Map NameSegment (Branch IO) -&gt; Map NameSegment (Branch IO))
-&gt; Branch0 IO
-&gt; Branch0 IO
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679405497"><span class="annot"><span class="annottext">Map NameSegment (Branch IO)
</span><a href="#local-6989586621679405497"><span class="hs-identifier hs-var">childMap</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-484"></span><span>                         </span><span class="annot"><span class="annottext">Map NameSegment (Branch IO)
</span><a href="#local-6989586621679405497"><span class="hs-identifier hs-var">childMap</span></a></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Branch IO)
-&gt; (Map NameSegment (Branch IO) -&gt; Map NameSegment (Branch IO))
-&gt; Map NameSegment (Branch IO)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NameSegment (Branch IO))
-&gt; Lens'
     (Map NameSegment (Branch IO))
     (Maybe (IxValue (Map NameSegment (Branch IO))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NameSegment (Branch IO))
</span><span class="hs-string">&quot;base&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Maybe (Branch IO) -&gt; Identity (Maybe (Branch IO)))
 -&gt; Map NameSegment (Branch IO)
 -&gt; Identity (Map NameSegment (Branch IO)))
-&gt; Branch IO
-&gt; Map NameSegment (Branch IO)
-&gt; Map NameSegment (Branch IO)
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">?~</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405507"><span class="hs-identifier hs-var">baseb</span></a></span><span>
</span><span id="line-485"></span><span>                           </span><span class="annot"><span class="annottext">Map NameSegment (Branch IO)
-&gt; (Map NameSegment (Branch IO) -&gt; Map NameSegment (Branch IO))
-&gt; Map NameSegment (Branch IO)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NameSegment (Branch IO))
-&gt; Lens'
     (Map NameSegment (Branch IO))
     (Maybe (IxValue (Map NameSegment (Branch IO))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NameSegment (Branch IO))
</span><span class="hs-string">&quot;head&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Maybe (Branch IO) -&gt; Identity (Maybe (Branch IO)))
 -&gt; Map NameSegment (Branch IO)
 -&gt; Identity (Map NameSegment (Branch IO)))
-&gt; Branch IO
-&gt; Map NameSegment (Branch IO)
-&gt; Map NameSegment (Branch IO)
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">?~</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405506"><span class="hs-identifier hs-var">headb</span></a></span><span>
</span><span id="line-486"></span><span>                           </span><span class="annot"><span class="annottext">Map NameSegment (Branch IO)
-&gt; (Map NameSegment (Branch IO) -&gt; Map NameSegment (Branch IO))
-&gt; Map NameSegment (Branch IO)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NameSegment (Branch IO))
-&gt; Lens'
     (Map NameSegment (Branch IO))
     (Maybe (IxValue (Map NameSegment (Branch IO))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NameSegment (Branch IO))
</span><span class="hs-string">&quot;merged&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Maybe (Branch IO) -&gt; Identity (Maybe (Branch IO)))
 -&gt; Map NameSegment (Branch IO)
 -&gt; Identity (Map NameSegment (Branch IO)))
-&gt; Branch IO
-&gt; Map NameSegment (Branch IO)
-&gt; Map NameSegment (Branch IO)
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">?~</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405505"><span class="hs-identifier hs-var">mergedb</span></a></span><span>
</span><span id="line-487"></span><span>                           </span><span class="annot"><span class="annottext">Map NameSegment (Branch IO)
-&gt; (Map NameSegment (Branch IO) -&gt; Map NameSegment (Branch IO))
-&gt; Map NameSegment (Branch IO)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NameSegment (Branch IO))
-&gt; Lens'
     (Map NameSegment (Branch IO))
     (Maybe (IxValue (Map NameSegment (Branch IO))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map NameSegment (Branch IO))
</span><span class="hs-string">&quot;squashed&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Maybe (Branch IO) -&gt; Identity (Maybe (Branch IO)))
 -&gt; Map NameSegment (Branch IO)
 -&gt; Identity (Map NameSegment (Branch IO)))
-&gt; Branch IO
-&gt; Map NameSegment (Branch IO)
-&gt; Map NameSegment (Branch IO)
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">?~</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405504"><span class="hs-identifier hs-var">squashedb</span></a></span><span>
</span><span id="line-488"></span><span>                     </span><span class="hs-special">)</span><span>
</span><span id="line-489"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405494"><span class="annot"><span class="annottext">base :: Path'
</span><a href="#local-6989586621679405494"><span class="hs-identifier hs-var hs-var">base</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; NameSegment -&gt; Path'
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-identifier hs-var">snoc</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405523"><span class="hs-identifier hs-var">dest0</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;base&quot;</span></span><span>
</span><span id="line-490"></span><span>                  </span><span id="local-6989586621679405492"><span class="annot"><span class="annottext">head :: Path'
</span><a href="#local-6989586621679405492"><span class="hs-identifier hs-var hs-var">head</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; NameSegment -&gt; Path'
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-identifier hs-var">snoc</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405523"><span class="hs-identifier hs-var">dest0</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;head&quot;</span></span><span>
</span><span id="line-491"></span><span>                  </span><span id="local-6989586621679405491"><span class="annot"><span class="annottext">merged :: Path'
</span><a href="#local-6989586621679405491"><span class="hs-identifier hs-var hs-var">merged</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; NameSegment -&gt; Path'
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-identifier hs-var">snoc</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405523"><span class="hs-identifier hs-var">dest0</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;merged&quot;</span></span><span>
</span><span id="line-492"></span><span>                  </span><span id="local-6989586621679405490"><span class="annot"><span class="annottext">squashed :: Path'
</span><a href="#local-6989586621679405490"><span class="hs-identifier hs-var hs-var">squashed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; NameSegment -&gt; Path'
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-identifier hs-var">snoc</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405523"><span class="hs-identifier hs-var">dest0</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;squashed&quot;</span></span><span>
</span><span id="line-493"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
-&gt; ReadRemoteNamespace
-&gt; Path'
-&gt; Path'
-&gt; Path'
-&gt; Path'
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#LoadPullRequest"><span class="hs-identifier hs-var">LoadPullRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405525"><span class="hs-identifier hs-var">baseRepo</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679405524"><span class="hs-identifier hs-var">headRepo</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405494"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405492"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405491"><span class="hs-identifier hs-var">merged</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405490"><span class="hs-identifier hs-var">squashed</span></a></span><span>
</span><span id="line-494"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Maybe Path' -&gt; Absolute -&gt; Cli r ()
forall r. Text -&gt; Maybe Path' -&gt; Absolute -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadPropagateDiffDefaultPatch"><span class="hs-identifier hs-var">loadPropagateDiffDefaultPatch</span></a></span><span>
</span><span id="line-495"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405521"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-496"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path' -&gt; Maybe Path'
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405491"><span class="hs-identifier hs-var">merged</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; NameSegment -&gt; Absolute
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-identifier hs-var">snoc</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405520"><span class="hs-identifier hs-var">destAbs</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;merged&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MoveBranchI"><span class="hs-identifier hs-type">MoveBranchI</span></a></span><span> </span><span id="local-6989586621679405486"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405486"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span id="local-6989586621679405485"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405485"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>              </span><span id="local-6989586621679405484"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405484"><span class="hs-identifier hs-var">hasConfirmed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Bool
forall r. Input -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#confirmedCommand"><span class="hs-identifier hs-var">confirmedCommand</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-500"></span><span>              </span><span id="local-6989586621679405482"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405482"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-501"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Bool -&gt; Path' -&gt; Path' -&gt; Cli r ()
forall r. Text -&gt; Bool -&gt; Path' -&gt; Path' -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.MoveBranch.html#doMoveBranch"><span class="hs-identifier hs-var">doMoveBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405482"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405484"><span class="hs-identifier hs-var">hasConfirmed</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405486"><span class="hs-identifier hs-var">src'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405485"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-502"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MovePatchI"><span class="hs-identifier hs-type">MovePatchI</span></a></span><span> </span><span id="local-6989586621679405480"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405480"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span id="local-6989586621679405479"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405479"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-503"></span><span>              </span><span id="local-6989586621679405478"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405478"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-504"></span><span>              </span><span id="local-6989586621679405477"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405477"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Patch
forall r. PatchPath -&gt; Cli r Patch
</span><a href="Unison.Cli.MonadUtils.html#expectPatchAt"><span class="hs-identifier hs-var">Cli.expectPatchAt</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405480"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-505"></span><span>              </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r ()
forall r. PatchPath -&gt; Cli r ()
</span><a href="Unison.Cli.MonadUtils.html#assertNoPatchAt"><span class="hs-identifier hs-var">Cli.assertNoPatchAt</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405479"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-506"></span><span>              </span><span id="local-6989586621679405474"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405474"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405480"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-507"></span><span>              </span><span id="local-6989586621679405473"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405473"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405479"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-508"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-var">stepManyAt</span></a></span><span>
</span><span id="line-509"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405478"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-510"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Split -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *). Split -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeletePatch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405474"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-511"></span><span>                  </span><span class="annot"><span class="annottext">Split -&gt; Patch -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Applicative m =&gt;
Split -&gt; Patch -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeReplacePatch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405473"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405477"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-512"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-513"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-514"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#CopyPatchI"><span class="hs-identifier hs-type">CopyPatchI</span></a></span><span> </span><span id="local-6989586621679405469"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405469"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621679405468"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405468"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-515"></span><span>              </span><span id="local-6989586621679405467"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405467"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-516"></span><span>              </span><span id="local-6989586621679405466"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405466"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Patch
forall r. PatchPath -&gt; Cli r Patch
</span><a href="Unison.Cli.MonadUtils.html#expectPatchAt"><span class="hs-identifier hs-var">Cli.expectPatchAt</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405469"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-517"></span><span>              </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r ()
forall r. PatchPath -&gt; Cli r ()
</span><a href="Unison.Cli.MonadUtils.html#assertNoPatchAt"><span class="hs-identifier hs-var">Cli.assertNoPatchAt</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405468"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-518"></span><span>              </span><span id="local-6989586621679405465"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405465"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405468"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-519"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall r. Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt"><span class="hs-identifier hs-var">stepAt</span></a></span><span>
</span><span id="line-520"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405467"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-521"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; Patch -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Applicative m =&gt;
Split -&gt; Patch -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeReplacePatch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405465"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679405466"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-523"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeletePatchI"><span class="hs-identifier hs-type">DeletePatchI</span></a></span><span> </span><span id="local-6989586621679405462"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405462"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-524"></span><span>              </span><span class="annot"><span class="annottext">Patch
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Patch
forall r. PatchPath -&gt; Cli r Patch
</span><a href="Unison.Cli.MonadUtils.html#expectPatchAt"><span class="hs-identifier hs-var">Cli.expectPatchAt</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405462"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-525"></span><span>              </span><span id="local-6989586621679405461"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405461"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-526"></span><span>              </span><span id="local-6989586621679405460"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405460"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405462"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-527"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall r. Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt"><span class="hs-identifier hs-var">stepAt</span></a></span><span>
</span><span id="line-528"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405461"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-529"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *). Split -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeletePatch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405460"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-531"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteBranchI"><span class="hs-identifier hs-type">DeleteBranchI</span></a></span><span> </span><span id="local-6989586621679405458"><span class="annot"><span class="annottext">Insistence
</span><a href="#local-6989586621679405458"><span class="hs-identifier hs-var">insistence</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-532"></span><span>              </span><span id="local-6989586621679405457"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405457"><span class="hs-identifier hs-var">hasConfirmed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Bool
forall r. Input -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#confirmedCommand"><span class="hs-identifier hs-var">confirmedCommand</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-533"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405457"><span class="hs-identifier hs-var">hasConfirmed</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Insistence
</span><a href="#local-6989586621679405458"><span class="hs-identifier hs-var">insistence</span></a></span><span> </span><span class="annot"><span class="annottext">Insistence -&gt; Insistence -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Insistence
</span><a href="Unison.Codebase.Editor.Input.html#Force"><span class="hs-identifier hs-var">Force</span></a></span><span>
</span><span id="line-534"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-535"></span><span>                  </span><span id="local-6989586621679405454"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405454"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-536"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall r. Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt"><span class="hs-identifier hs-var">stepAt</span></a></span><span>
</span><span id="line-537"></span><span>                    </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405454"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-538"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Branch0 IO -&gt; Branch0 IO
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
forall (m :: * -&gt; *). Branch0 m
</span><span class="hs-identifier hs-var">Branch.empty0</span></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#DeletedEverything"><span class="hs-identifier hs-var">DeletedEverything</span></a></span><span>
</span><span id="line-540"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#DeleteEverythingConfirmation"><span class="hs-identifier hs-var">DeleteEverythingConfirmation</span></a></span><span>
</span><span id="line-541"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteBranchI"><span class="hs-identifier hs-type">DeleteBranchI</span></a></span><span> </span><span id="local-6989586621679405449"><span class="annot"><span class="annottext">Insistence
</span><a href="#local-6989586621679405449"><span class="hs-identifier hs-var">insistence</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405448"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405448"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-542"></span><span>              </span><span id="local-6989586621679405447"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405447"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r (Branch IO)
forall r. Path' -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#expectBranchAtPath%27"><span class="hs-identifier hs-var">Cli.expectBranchAtPath'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath -&gt; Path'
</span><span class="hs-identifier hs-var">Path.unsplit'</span></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405448"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-543"></span><span>              </span><span id="local-6989586621679405445"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405445"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-544"></span><span>              </span><span id="local-6989586621679405444"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405444"><span class="hs-identifier hs-var">absPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405448"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-545"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405443"><span class="annot"><span class="annottext">toDelete :: Names
</span><a href="#local-6989586621679405443"><span class="hs-identifier hs-var hs-var">toDelete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-546"></span><span>                    </span><span class="annot"><span class="annottext">Name -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.prefix0</span></span><span>
</span><span id="line-547"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Name
</span><span class="hs-identifier hs-var">Path.unsafeToName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; Path
</span><span class="hs-identifier hs-var">Path.unsplit</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405444"><span class="hs-identifier hs-var">absPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405447"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>              </span><span id="local-6989586621679405441"><span class="annot"><span class="annottext">Cli r ()
</span><a href="#local-6989586621679405441"><span class="hs-identifier hs-var">afterDelete</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-550"></span><span>                </span><span id="local-6989586621679405440"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405440"><span class="hs-identifier hs-var">rootNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Names) -&gt; Cli r (Branch0 IO) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-551"></span><span>                </span><span id="local-6989586621679405439"><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency)
</span><a href="#local-6989586621679405439"><span class="hs-identifier hs-var">endangerments</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Names
-&gt; Names -&gt; Cli r (Map LabeledDependency (NESet LabeledDependency))
forall r.
Names
-&gt; Names -&gt; Cli r (Map LabeledDependency (NESet LabeledDependency))
</span><a href="Unison.Codebase.Editor.HandleInput.html#getEndangeredDependents"><span class="hs-identifier hs-var">getEndangeredDependents</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405443"><span class="hs-identifier hs-var">toDelete</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405440"><span class="hs-identifier hs-var">rootNames</span></a></span><span>
</span><span id="line-552"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency)
</span><a href="#local-6989586621679405439"><span class="hs-identifier hs-var">endangerments</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Insistence
</span><a href="#local-6989586621679405449"><span class="hs-identifier hs-var">insistence</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-553"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Insistence
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r () -&gt; Cli r (Cli r ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-554"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Insistence
</span><a href="Unison.Codebase.Editor.Input.html#Force"><span class="hs-identifier hs-var">Force</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-555"></span><span>                    </span><span id="local-6989586621679405438"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405438"><span class="hs-identifier hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
forall r. (Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#currentPrettyPrintEnvDecl"><span class="hs-identifier hs-var">currentPrettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span>
</span><span id="line-556"></span><span>                    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>                      </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-558"></span><span>                      </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="annot"><span class="annottext">(NumberedOutput -&gt; Cli r ()) -&gt; NumberedOutput -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Map LabeledDependency (NESet LabeledDependency)
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#DeletedDespiteDependents"><span class="hs-identifier hs-var">DeletedDespiteDependents</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405438"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency)
</span><a href="#local-6989586621679405439"><span class="hs-identifier hs-var">endangerments</span></a></span><span>
</span><span id="line-559"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Insistence
</span><a href="Unison.Codebase.Editor.Input.html#Try"><span class="hs-identifier hs-var">Try</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-560"></span><span>                    </span><span id="local-6989586621679405435"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405435"><span class="hs-identifier hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
forall r. (Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#currentPrettyPrintEnvDecl"><span class="hs-identifier hs-var">currentPrettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span>
</span><span id="line-561"></span><span>                    </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="annot"><span class="annottext">(NumberedOutput -&gt; Cli r ()) -&gt; NumberedOutput -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; Map LabeledDependency (NESet LabeledDependency)
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#CantDeleteNamespace"><span class="hs-identifier hs-var">CantDeleteNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405435"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency)
</span><a href="#local-6989586621679405439"><span class="hs-identifier hs-var">endangerments</span></a></span><span>
</span><span id="line-562"></span><span>                    </span><span class="annot"><span class="annottext">Cli r (Cli r ())
forall r a. Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarlyWithoutOutput"><span class="hs-identifier hs-var">Cli.returnEarlyWithoutOutput</span></a></span><span>
</span><span id="line-563"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall r. Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt"><span class="hs-identifier hs-var">stepAt</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405445"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">((Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ())
-&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-564"></span><span>                </span><span class="annot"><span class="annottext">Split -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Applicative m =&gt;
Split -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteBranch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405444"><span class="hs-identifier hs-var">absPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>              </span><span class="annot"><span class="annottext">Cli r ()
</span><a href="#local-6989586621679405441"><span class="hs-identifier hs-var">afterDelete</span></a></span><span>
</span><span id="line-566"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#SwitchBranchI"><span class="hs-identifier hs-type">SwitchBranchI</span></a></span><span> </span><span id="local-6989586621679405431"><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679405431"><span class="hs-identifier hs-var">maybePath'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-567"></span><span>              </span><span id="local-6989586621679405430"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405430"><span class="hs-identifier hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-568"></span><span>              </span><span id="local-6989586621679405429"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405429"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-569"></span><span>                </span><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679405431"><span class="hs-identifier hs-var">maybePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path' -&gt; (Maybe Path' -&gt; Cli r Path') -&gt; Cli r Path'
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Path' -&gt; Maybe Path' -&gt; Cli r Path'
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-570"></span><span>                  </span><span class="annot"><span class="annottext">Position -&gt; Branch0 IO -&gt; Cli r (Maybe [Path'])
forall (m :: * -&gt; *) (m0 :: * -&gt; *).
MonadIO m =&gt;
Position -&gt; Branch0 m0 -&gt; m (Maybe [Path'])
</span><a href="Unison.Codebase.Editor.HandleInput.html#fuzzySelectNamespace"><span class="hs-identifier hs-var">fuzzySelectNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">Absolute</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405430"><span class="hs-identifier hs-var">root0</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe [Path'])
-&gt; (Maybe [Path'] -&gt; Cli r Path') -&gt; Cli r Path'
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-571"></span><span>                    </span><span class="hs-comment">-- Shouldn't be possible to get multiple paths here, we can just take</span><span>
</span><span id="line-572"></span><span>                    </span><span class="hs-comment">-- the first.</span><span>
</span><span id="line-573"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679405426"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405426"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Path']
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Path'
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405426"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-574"></span><span>                    </span><span class="annot"><span class="annottext">Maybe [Path']
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Path'
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputPattern -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#HelpMessage"><span class="hs-identifier hs-var">HelpMessage</span></a></span><span> </span><span class="annot"><span class="annottext">InputPattern
</span><a href="Unison.CommandLine.InputPatterns.html#cd"><span class="hs-identifier hs-var">InputPatterns.cd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>              </span><span id="local-6989586621679405423"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405423"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405429"><span class="hs-identifier hs-var">path'</span></a></span><span class="hs-cpp">
              #currentPathStack %= Nel.cons path
</span><span>              </span><span id="local-6989586621679405419"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405419"><span class="hs-identifier hs-var">branch'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch0 IO)
forall r. Absolute -&gt; Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranch0At"><span class="hs-identifier hs-var">Cli.getBranch0At</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405423"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-578"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO -&gt; Bool
forall (m :: * -&gt; *). Branch0 m -&gt; Bool
</span><span class="hs-identifier hs-var">Branch.isEmpty0</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405419"><span class="hs-identifier hs-var">branch'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#CreatedNewBranch"><span class="hs-identifier hs-var">CreatedNewBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405423"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#UpI"><span class="hs-identifier hs-var">UpI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-580"></span><span>              </span><span id="local-6989586621679405415"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405415"><span class="hs-identifier hs-var">path0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-581"></span><span>              </span><span class="annot"><span class="annottext">Maybe (Absolute, NameSegment)
-&gt; ((Absolute, NameSegment) -&gt; Cli r ()) -&gt; Cli r ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">whenJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Maybe (Absolute, NameSegment)
forall s a. Snoc s s a a =&gt; s -&gt; Maybe (s, a)
</span><span class="hs-identifier hs-var">unsnoc</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405415"><span class="hs-identifier hs-var">path0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679405413"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405413"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-cpp">
                #currentPathStack %= Nel.cons path
</span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#PopBranchI"><span class="hs-identifier hs-var">PopBranchI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-584"></span><span>              </span><span id="local-6989586621679405410"><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679405410"><span class="hs-identifier hs-var">loopState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r LoopState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">State.get</span></span><span>
</span><span id="line-585"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NonEmpty Absolute -&gt; (Absolute, Maybe (NonEmpty Absolute))
forall a. NonEmpty a -&gt; (a, Maybe (NonEmpty a))
</span><span class="hs-identifier hs-var">Nel.uncons</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679405410"><span class="hs-identifier hs-var">loopState</span></a></span><span> </span><span class="annot"><span class="annottext">LoopState
-&gt; Getting (NonEmpty Absolute) LoopState (NonEmpty Absolute)
-&gt; NonEmpty Absolute
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;currentPathStack&quot;
  (Getting (NonEmpty Absolute) LoopState (NonEmpty Absolute))
Getting (NonEmpty Absolute) LoopState (NonEmpty Absolute)
</span><a href="#local-6989586621679405406"><span class="hs-var">#currentPathStack</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-586"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty Absolute)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#StartOfCurrentPathHistory"><span class="hs-identifier hs-var">StartOfCurrentPathHistory</span></a></span><span>
</span><span id="line-587"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405404"><span class="annot"><span class="annottext">NonEmpty Absolute
</span><a href="#local-6989586621679405404"><span class="hs-identifier hs-var">paths</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LoopState -&gt; Cli r ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">State.put</span></span><span> </span><span class="annot"><span class="annottext">(LoopState -&gt; Cli r ()) -&gt; LoopState -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679405410"><span class="hs-identifier hs-var">loopState</span></a></span><span> </span><span class="annot"><span class="annottext">LoopState -&gt; (LoopState -&gt; LoopState) -&gt; LoopState
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;currentPathStack&quot;
  (ASetter
     LoopState LoopState (NonEmpty Absolute) (NonEmpty Absolute))
ASetter LoopState LoopState (NonEmpty Absolute) (NonEmpty Absolute)
</span><a href="#local-6989586621679405401"><span class="hs-var">#currentPathStack</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter LoopState LoopState (NonEmpty Absolute) (NonEmpty Absolute)
-&gt; NonEmpty Absolute -&gt; LoopState -&gt; LoopState
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty Absolute
</span><a href="#local-6989586621679405404"><span class="hs-identifier hs-var">paths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#HistoryI"><span class="hs-identifier hs-type">HistoryI</span></a></span><span> </span><span id="local-6989586621679405399"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679405399"><span class="hs-identifier hs-var">resultsCap</span></a></span></span><span> </span><span id="local-6989586621679405398"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679405398"><span class="hs-identifier hs-var">diffCap</span></a></span></span><span> </span><span id="local-6989586621679405397"><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405397"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-589"></span><span>              </span><span id="local-6989586621679405396"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405396"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-590"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679405397"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-591"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679405395"><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405395"><span class="hs-identifier hs-var">hash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; Cli r (Branch IO)
forall r. ShortBranchHash -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#resolveShortBranchHash"><span class="hs-identifier hs-var">Cli.resolveShortBranchHash</span></a></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash
</span><a href="#local-6989586621679405395"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-592"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679405394"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405394"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-593"></span><span>                    </span><span id="local-6989586621679405393"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405393"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405394"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-594"></span><span>                    </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Maybe (Branch IO))
forall r. Absolute -&gt; Cli r (Maybe (Branch IO))
</span><a href="Unison.Cli.MonadUtils.html#getMaybeBranchAt"><span class="hs-identifier hs-var">Cli.getMaybeBranchAt</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405393"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Branch IO))
-&gt; (Cli r (Maybe (Branch IO)) -&gt; Cli r (Branch IO))
-&gt; Cli r (Branch IO)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO) -&gt; Cli r (Maybe (Branch IO)) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><span class="hs-identifier hs-var">onNothingM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Cli r (Branch IO)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#CreatedNewBranch"><span class="hs-identifier hs-var">CreatedNewBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405393"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405390"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405390"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-596"></span><span>              </span><span id="local-6989586621679405389"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405389"><span class="hs-identifier hs-var">sbhLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.branchHashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405390"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>              </span><span id="local-6989586621679405388"><span class="annot"><span class="annottext">NumberedOutput
</span><a href="#local-6989586621679405388"><span class="hs-identifier hs-var">history</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO NumberedOutput -&gt; Cli r NumberedOutput
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
-&gt; Int -&gt; Branch IO -&gt; [(CausalHash, Diff)] -&gt; IO NumberedOutput
</span><a href="#local-6989586621679405387"><span class="hs-identifier hs-var">doHistory</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405389"><span class="hs-identifier hs-var">sbhLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405396"><span class="hs-identifier hs-var">branch</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>              </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="annot"><span class="annottext">NumberedOutput
</span><a href="#local-6989586621679405388"><span class="hs-identifier hs-var">history</span></a></span><span>
</span><span id="line-599"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-600"></span><span>                </span><span class="annot"><a href="#local-6989586621679405387"><span class="hs-identifier hs-type">doHistory</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Causal.CausalHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory.Diff</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#NumberedOutput"><span class="hs-identifier hs-type">NumberedOutput</span></a></span><span>
</span><span id="line-601"></span><span>                </span><span id="local-6989586621679405387"><span class="annot"><span class="annottext">doHistory :: Int
-&gt; Int -&gt; Branch IO -&gt; [(CausalHash, Diff)] -&gt; IO NumberedOutput
</span><a href="#local-6989586621679405387"><span class="hs-identifier hs-var hs-var">doHistory</span></a></span></span><span> </span><span id="local-6989586621679405386"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405386"><span class="hs-identifier hs-var">sbhLength</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679405385"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405385"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679405384"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405384"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679405383"><span class="annot"><span class="annottext">[(CausalHash, Diff)]
</span><a href="#local-6989586621679405383"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-602"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (Int -&gt; Bool) -&gt; Maybe Int -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405385"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679405399"><span class="hs-identifier hs-var">resultsCap</span></a></span><span>
</span><span id="line-603"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">NumberedOutput -&gt; IO NumberedOutput
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
-&gt; Int -&gt; [(CausalHash, Diff)] -&gt; HistoryTail -&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#History"><span class="hs-identifier hs-var">History</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679405398"><span class="hs-identifier hs-var">diffCap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405386"><span class="hs-identifier hs-var">sbhLength</span></a></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, Diff)]
</span><a href="#local-6989586621679405383"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Int -&gt; HistoryTail
</span><a href="Unison.Codebase.Editor.Output.html#PageEnd"><span class="hs-identifier hs-var">PageEnd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; CausalHash
forall (m :: * -&gt; *). Branch m -&gt; CausalHash
</span><span class="hs-identifier hs-var">Branch.headHash</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405384"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405385"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; UnwrappedBranch IO
forall (m :: * -&gt; *). Branch m -&gt; UnwrappedBranch m
</span><span class="hs-identifier hs-var hs-var">Branch._history</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405384"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-605"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Causal.One</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NumberedOutput -&gt; IO NumberedOutput
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
-&gt; Int -&gt; [(CausalHash, Diff)] -&gt; HistoryTail -&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#History"><span class="hs-identifier hs-var">History</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679405398"><span class="hs-identifier hs-var">diffCap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405386"><span class="hs-identifier hs-var">sbhLength</span></a></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, Diff)]
</span><a href="#local-6989586621679405383"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; HistoryTail
</span><a href="Unison.Codebase.Editor.Output.html#EndOfLog"><span class="hs-identifier hs-var">EndOfLog</span></a></span><span> </span><span class="annot"><span class="annottext">(CausalHash -&gt; HistoryTail) -&gt; CausalHash -&gt; HistoryTail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; CausalHash
forall (m :: * -&gt; *). Branch m -&gt; CausalHash
</span><span class="hs-identifier hs-var">Branch.headHash</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405384"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Causal.Merge</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HashFor (Branch0 IO)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679405375"><span class="annot"><span class="annottext">Map CausalHash (IO (UnwrappedBranch IO))
</span><a href="#local-6989586621679405375"><span class="hs-identifier hs-var">tails</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-607"></span><span>                        </span><span class="annot"><span class="annottext">NumberedOutput -&gt; IO NumberedOutput
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Int
-&gt; Int -&gt; [(CausalHash, Diff)] -&gt; HistoryTail -&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#History"><span class="hs-identifier hs-var">History</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679405398"><span class="hs-identifier hs-var">diffCap</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405386"><span class="hs-identifier hs-var">sbhLength</span></a></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, Diff)]
</span><a href="#local-6989586621679405383"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; [CausalHash] -&gt; HistoryTail
</span><a href="Unison.Codebase.Editor.Output.html#MergeTail"><span class="hs-identifier hs-var">MergeTail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; CausalHash
forall (m :: * -&gt; *). Branch m -&gt; CausalHash
</span><span class="hs-identifier hs-var">Branch.headHash</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405384"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([CausalHash] -&gt; HistoryTail) -&gt; [CausalHash] -&gt; HistoryTail
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map CausalHash (IO (UnwrappedBranch IO)) -&gt; [CausalHash]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">Map CausalHash (IO (UnwrappedBranch IO))
</span><a href="#local-6989586621679405375"><span class="hs-identifier hs-var">tails</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Causal.Cons</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HashFor (Branch0 IO)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679405371"><span class="annot"><span class="annottext">(CausalHash, IO (UnwrappedBranch IO))
</span><a href="#local-6989586621679405371"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-609"></span><span>                        </span><span id="local-6989586621679405370"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405370"><span class="hs-identifier hs-var">b'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UnwrappedBranch IO -&gt; Branch IO)
-&gt; IO (UnwrappedBranch IO) -&gt; IO (Branch IO)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">UnwrappedBranch IO -&gt; Branch IO
forall (m :: * -&gt; *). UnwrappedBranch m -&gt; Branch m
</span><span class="hs-identifier hs-var">Branch.Branch</span></span><span> </span><span class="annot"><span class="annottext">(IO (UnwrappedBranch IO) -&gt; IO (Branch IO))
-&gt; IO (UnwrappedBranch IO) -&gt; IO (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash, IO (UnwrappedBranch IO)) -&gt; IO (UnwrappedBranch IO)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash, IO (UnwrappedBranch IO))
</span><a href="#local-6989586621679405371"><span class="hs-identifier hs-var">tail</span></a></span><span>
</span><span id="line-610"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405368"><span class="annot"><span class="annottext">elem :: (CausalHash, Diff)
</span><a href="#local-6989586621679405368"><span class="hs-identifier hs-var hs-var">elem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; CausalHash
forall (m :: * -&gt; *). Branch m -&gt; CausalHash
</span><span class="hs-identifier hs-var">Branch.headHash</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405384"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch IO -&gt; Diff
forall (m :: * -&gt; *). Branch m -&gt; Branch m -&gt; Diff
</span><span class="hs-identifier hs-var">Branch.namesDiff</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405370"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405384"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>                        </span><span class="annot"><span class="annottext">Int
-&gt; Int -&gt; Branch IO -&gt; [(CausalHash, Diff)] -&gt; IO NumberedOutput
</span><a href="#local-6989586621679405387"><span class="hs-identifier hs-var">doHistory</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405386"><span class="hs-identifier hs-var">sbhLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405385"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405370"><span class="hs-identifier hs-var">b'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CausalHash, Diff)
</span><a href="#local-6989586621679405368"><span class="hs-identifier hs-var">elem</span></a></span><span> </span><span class="annot"><span class="annottext">(CausalHash, Diff) -&gt; [(CausalHash, Diff)] -&gt; [(CausalHash, Diff)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, Diff)]
</span><a href="#local-6989586621679405383"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#UndoI"><span class="hs-identifier hs-var">UndoI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-613"></span><span>              </span><span id="local-6989586621679405364"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405364"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-614"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405363"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405363"><span class="hs-identifier hs-var">prev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-615"></span><span>                </span><span class="annot"><span class="annottext">IO (Maybe (Branch0 IO, Branch IO))
-&gt; Cli r (Maybe (Branch0 IO, Branch IO))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; IO (Maybe (Branch0 IO, Branch IO))
forall (m :: * -&gt; *).
Applicative m =&gt;
Branch m -&gt; m (Maybe (Branch0 m, Branch m))
</span><span class="hs-identifier hs-var">Branch.uncons</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405364"><span class="hs-identifier hs-var">rootBranch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Branch0 IO, Branch IO))
-&gt; (Cli r (Maybe (Branch0 IO, Branch IO))
    -&gt; Cli r (Branch0 IO, Branch IO))
-&gt; Cli r (Branch0 IO, Branch IO)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO, Branch IO)
-&gt; Cli r (Maybe (Branch0 IO, Branch IO))
-&gt; Cli r (Branch0 IO, Branch IO)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><span class="hs-identifier hs-var">onNothingM</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-616"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Branch0 IO, Branch IO)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r (Branch0 IO, Branch IO))
-&gt; (UndoFailureReason -&gt; Output)
-&gt; UndoFailureReason
-&gt; Cli r (Branch0 IO, Branch IO)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UndoFailureReason -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#CantUndo"><span class="hs-identifier hs-var">CantUndo</span></a></span><span> </span><span class="annot"><span class="annottext">(UndoFailureReason -&gt; Cli r (Branch0 IO, Branch IO))
-&gt; UndoFailureReason -&gt; Cli r (Branch0 IO, Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-617"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Bool
forall (m :: * -&gt; *). Branch m -&gt; Bool
</span><span class="hs-identifier hs-var">Branch.isOne</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405364"><span class="hs-identifier hs-var">rootBranch</span></a></span><span>
</span><span id="line-618"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">UndoFailureReason
</span><a href="Unison.Codebase.Editor.Output.html#CantUndoPastStart"><span class="hs-identifier hs-var">CantUndoPastStart</span></a></span><span>
</span><span id="line-619"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">UndoFailureReason
</span><a href="Unison.Codebase.Editor.Output.html#CantUndoPastMerge"><span class="hs-identifier hs-var">CantUndoPastMerge</span></a></span><span>
</span><span id="line-620"></span><span>              </span><span id="local-6989586621679405357"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405357"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-621"></span><span>              </span><span class="annot"><span class="annottext">Branch IO -&gt; Text -&gt; Cli r ()
forall r. Branch IO -&gt; Text -&gt; Cli r ()
</span><a href="Unison.Cli.MonadUtils.html#updateRoot"><span class="hs-identifier hs-var">Cli.updateRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405363"><span class="hs-identifier hs-var">prev</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405357"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-622"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679405356"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405356"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405355"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405355"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405363"><span class="hs-identifier hs-var">prev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405364"><span class="hs-identifier hs-var">rootBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>              </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; BranchDiffOutput Symbol Ann -&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffAfterUndo"><span class="hs-identifier hs-var">Output.ShowDiffAfterUndo</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405356"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405355"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#UiI"><span class="hs-identifier hs-var">UiI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-625"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405352"><span class="annot"><span class="annottext">Maybe BaseUrl
serverBaseUrl :: Maybe BaseUrl
$sel:serverBaseUrl:Env :: Env -&gt; Maybe BaseUrl
</span><a href="#local-6989586621679405352"><span class="hs-identifier hs-var hs-var">serverBaseUrl</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-626"></span><span>              </span><span class="annot"><span class="annottext">Maybe BaseUrl -&gt; (BaseUrl -&gt; Cli r ()) -&gt; Cli r ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">whenJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe BaseUrl
</span><a href="#local-6989586621679405352"><span class="hs-identifier hs-var">serverBaseUrl</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679405351"><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679405351"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-627"></span><span>                </span><span id="local-6989586621679405350"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405350"><span class="hs-identifier hs-var">_success</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; Cli r Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><span class="hs-identifier hs-var">openBrowser</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BaseUrlPath -&gt; BaseUrl -&gt; String
</span><span class="hs-identifier hs-var">Server.urlFor</span></span><span> </span><span class="annot"><span class="annottext">BaseUrlPath
</span><span class="hs-identifier hs-var">Server.UI</span></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679405351"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>                </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DocsToHtmlI"><span class="hs-identifier hs-type">DocsToHtmlI</span></a></span><span> </span><span id="local-6989586621679405348"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405348"><span class="hs-identifier hs-var">namespacePath'</span></a></span></span><span> </span><span id="local-6989586621679405347"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405347"><span class="hs-identifier hs-var">sourceDirectory</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-630"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405346"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405346"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405345"><span class="annot"><span class="annottext">Runtime Symbol
$sel:sandboxedRuntime:Env :: Env -&gt; Runtime Symbol
sandboxedRuntime :: Runtime Symbol
</span><a href="Unison.Cli.Monad.html#%24sel%3AsandboxedRuntime%3AEnv"><span class="hs-identifier hs-var hs-var">sandboxedRuntime</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-631"></span><span>              </span><span id="local-6989586621679405343"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405343"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-632"></span><span>              </span><span id="local-6989586621679405342"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679405342"><span class="hs-identifier hs-var">absPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">(Absolute -&gt; Path) -&gt; Cli r Absolute -&gt; Cli r Path
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405348"><span class="hs-identifier hs-var">namespacePath'</span></a></span><span>
</span><span id="line-633"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; Codebase IO Symbol Ann -&gt; Branch IO -&gt; Path -&gt; String -&gt; IO ()
</span><span class="hs-identifier hs-var">Backend.docsInBranchToHtmlFiles</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679405345"><span class="hs-identifier hs-var">sandboxedRuntime</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405346"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405343"><span class="hs-identifier hs-var">rootBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679405342"><span class="hs-identifier hs-var">absPath</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405347"><span class="hs-identifier hs-var">sourceDirectory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#AliasTermI"><span class="hs-identifier hs-type">AliasTermI</span></a></span><span> </span><span id="local-6989586621679405339"><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679405339"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span id="local-6989586621679405338"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405338"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-635"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405337"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405337"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-636"></span><span>              </span><span id="local-6989586621679405336"><span class="annot"><span class="annottext">Either ShortHash (Absolute, HQSegment)
</span><a href="#local-6989586621679405336"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LensLike
  (Cli r)
  HashOrHQSplit'
  (Either ShortHash (Absolute, HQSegment))
  HQSplit'
  (Absolute, HQSegment)
-&gt; LensLike
     (Cli r)
     HashOrHQSplit'
     (Either ShortHash (Absolute, HQSegment))
     HQSplit'
     (Absolute, HQSegment)
forall (f :: * -&gt; *) s t a b.
LensLike f s t a b -&gt; LensLike f s t a b
</span><span class="hs-identifier hs-var">traverseOf</span></span><span> </span><span class="annot"><span class="annottext">LensLike
  (Cli r)
  HashOrHQSplit'
  (Either ShortHash (Absolute, HQSegment))
  HQSplit'
  (Absolute, HQSegment)
forall c a b. Prism (Either c a) (Either c b) a b
</span><span class="hs-identifier hs-var">_Right</span></span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r (Absolute, HQSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679405339"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-637"></span><span>              </span><span id="local-6989586621679405335"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405335"><span class="hs-identifier hs-var">srcTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-638"></span><span>                </span><span class="annot"><span class="annottext">(ShortHash -&gt; Cli r (Set Referent))
-&gt; ((Absolute, HQSegment) -&gt; Cli r (Set Referent))
-&gt; Either ShortHash (Absolute, HQSegment)
-&gt; Cli r (Set Referent)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span>
</span><span id="line-639"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Set Referent) -&gt; Cli r (Set Referent)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Referent) -&gt; Cli r (Set Referent))
-&gt; (ShortHash -&gt; IO (Set Referent))
-&gt; ShortHash
-&gt; Cli r (Set Referent)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; ShortHash -&gt; IO (Set Referent)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Referent)
</span><span class="hs-identifier hs-var">Backend.termReferentsByShortHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405337"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>                  </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="Unison.Cli.MonadUtils.html#getTermsAt"><span class="hs-identifier hs-var">Cli.getTermsAt</span></a></span><span>
</span><span id="line-641"></span><span>                  </span><span class="annot"><span class="annottext">Either ShortHash (Absolute, HQSegment)
</span><a href="#local-6989586621679405336"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-642"></span><span>              </span><span id="local-6989586621679405331"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405331"><span class="hs-identifier hs-var">srcTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-643"></span><span>                </span><span class="annot"><span class="annottext">Set Referent -&gt; Maybe Referent
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405335"><span class="hs-identifier hs-var">srcTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Referent
-&gt; (Maybe Referent -&gt; Cli r Referent) -&gt; Cli r Referent
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Referent -&gt; Maybe Referent -&gt; Cli r Referent
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-644"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r Referent
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r Referent) -&gt; Cli r Output -&gt; Cli r Referent
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405335"><span class="hs-identifier hs-var">srcTerms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679405339"><span class="hs-identifier hs-var">src'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-645"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679405328"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405328"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Output
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TermNotFound%27"><span class="hs-identifier hs-var">TermNotFound'</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405328"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679405326"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405326"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Output
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TermNotFound"><span class="hs-identifier hs-var">TermNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405326"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679405324"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405324"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Output
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; Set Referent -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#HashAmbiguous"><span class="hs-identifier hs-var">HashAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405324"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405335"><span class="hs-identifier hs-var">srcTerms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679405322"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405322"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>                      </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405321"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405321"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-650"></span><span>                      </span><span id="local-6989586621679405320"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405320"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405321"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-651"></span><span>                      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; HQSplit' -&gt; Set Referent -&gt; Set Reference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DeleteNameAmbiguous"><span class="hs-identifier hs-var">DeleteNameAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405320"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405322"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405335"><span class="hs-identifier hs-var">srcTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-652"></span><span>              </span><span id="local-6989586621679405317"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405317"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405338"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-653"></span><span>              </span><span id="local-6989586621679405316"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405316"><span class="hs-identifier hs-var">destTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="Unison.Cli.MonadUtils.html#getTermsAt"><span class="hs-identifier hs-var">Cli.getTermsAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; (Absolute, HQSegment)
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405317"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405316"><span class="hs-identifier hs-var">destTerms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-655"></span><span>                </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath -&gt; Set Referent -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TermAlreadyExists"><span class="hs-identifier hs-var">TermAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405338"><span class="hs-identifier hs-var">dest'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405316"><span class="hs-identifier hs-var">destTerms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>              </span><span id="local-6989586621679405314"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405314"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-657"></span><span>              </span><span id="local-6989586621679405313"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679405313"><span class="hs-identifier hs-var">srcMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-658"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ShortHash (Absolute, HQSegment)
</span><a href="#local-6989586621679405336"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-659"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Cli r Metadata
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><span class="hs-identifier hs-var">Metadata.empty</span></span><span>
</span><span id="line-660"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679405311"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405311"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-661"></span><span>                    </span><span id="local-6989586621679405310"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405310"><span class="hs-identifier hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-662"></span><span>                    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Path, ()) -&gt; Referent -&gt; Branch0 IO -&gt; Metadata
forall a (m :: * -&gt; *).
(Path, a) -&gt; Referent -&gt; Branch0 m -&gt; Metadata
</span><span class="hs-identifier hs-var">BranchUtil.getTermMetadataAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405311"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405331"><span class="hs-identifier hs-var">srcTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405310"><span class="hs-identifier hs-var">root0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall r. Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt"><span class="hs-identifier hs-var">stepAt</span></a></span><span>
</span><span id="line-664"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405314"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-665"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTermName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405317"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405331"><span class="hs-identifier hs-var">srcTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679405313"><span class="hs-identifier hs-var">srcMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-667"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#AliasTypeI"><span class="hs-identifier hs-type">AliasTypeI</span></a></span><span> </span><span id="local-6989586621679405306"><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679405306"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span id="local-6989586621679405305"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405305"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405304"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405304"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-669"></span><span>              </span><span id="local-6989586621679405303"><span class="annot"><span class="annottext">Either ShortHash (Absolute, HQSegment)
</span><a href="#local-6989586621679405303"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LensLike
  (Cli r)
  HashOrHQSplit'
  (Either ShortHash (Absolute, HQSegment))
  HQSplit'
  (Absolute, HQSegment)
-&gt; LensLike
     (Cli r)
     HashOrHQSplit'
     (Either ShortHash (Absolute, HQSegment))
     HQSplit'
     (Absolute, HQSegment)
forall (f :: * -&gt; *) s t a b.
LensLike f s t a b -&gt; LensLike f s t a b
</span><span class="hs-identifier hs-var">traverseOf</span></span><span> </span><span class="annot"><span class="annottext">LensLike
  (Cli r)
  HashOrHQSplit'
  (Either ShortHash (Absolute, HQSegment))
  HQSplit'
  (Absolute, HQSegment)
forall c a b. Prism (Either c a) (Either c b) a b
</span><span class="hs-identifier hs-var">_Right</span></span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r (Absolute, HQSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679405306"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-670"></span><span>              </span><span id="local-6989586621679405302"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405302"><span class="hs-identifier hs-var">srcTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-671"></span><span>                </span><span class="annot"><span class="annottext">(ShortHash -&gt; Cli r (Set Reference))
-&gt; ((Absolute, HQSegment) -&gt; Cli r (Set Reference))
-&gt; Either ShortHash (Absolute, HQSegment)
-&gt; Cli r (Set Reference)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span>
</span><span id="line-672"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; Cli r (Set Reference)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Reference) -&gt; Cli r (Set Reference))
-&gt; (ShortHash -&gt; IO (Set Reference))
-&gt; ShortHash
-&gt; Cli r (Set Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; ShortHash -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Backend.typeReferencesByShortHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405304"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>                  </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="Unison.Cli.MonadUtils.html#getTypesAt"><span class="hs-identifier hs-var">Cli.getTypesAt</span></a></span><span>
</span><span id="line-674"></span><span>                  </span><span class="annot"><span class="annottext">Either ShortHash (Absolute, HQSegment)
</span><a href="#local-6989586621679405303"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-675"></span><span>              </span><span id="local-6989586621679405299"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405299"><span class="hs-identifier hs-var">srcType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-676"></span><span>                </span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe Reference
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405302"><span class="hs-identifier hs-var">srcTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Reference
-&gt; (Maybe Reference -&gt; Cli r Reference) -&gt; Cli r Reference
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Reference -&gt; Maybe Reference -&gt; Cli r Reference
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-677"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r Reference
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r Reference) -&gt; Cli r Output -&gt; Cli r Reference
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405302"><span class="hs-identifier hs-var">srcTypes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679405306"><span class="hs-identifier hs-var">src'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-678"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679405298"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405298"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Output
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TypeNotFound%27"><span class="hs-identifier hs-var">TypeNotFound'</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405298"><span class="hs-identifier hs-var">hash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679405296"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405296"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Output
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TypeNotFound"><span class="hs-identifier hs-var">TypeNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405296"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679405294"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405294"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Output
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; Set Referent -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#HashAmbiguous"><span class="hs-identifier hs-var">HashAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679405294"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Reference -&gt; Referent) -&gt; Set Reference -&gt; Set Referent
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405302"><span class="hs-identifier hs-var">srcTypes</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679405293"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405293"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-682"></span><span>                      </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405292"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405292"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-683"></span><span>                      </span><span id="local-6989586621679405291"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405291"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405292"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>                      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; HQSplit' -&gt; Set Referent -&gt; Set Reference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DeleteNameAmbiguous"><span class="hs-identifier hs-var">DeleteNameAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405291"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405293"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405302"><span class="hs-identifier hs-var">srcTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>              </span><span id="local-6989586621679405290"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405290"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405305"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-686"></span><span>              </span><span id="local-6989586621679405289"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405289"><span class="hs-identifier hs-var">destTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="Unison.Cli.MonadUtils.html#getTypesAt"><span class="hs-identifier hs-var">Cli.getTypesAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; (Absolute, HQSegment)
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405290"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405289"><span class="hs-identifier hs-var">destTypes</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-688"></span><span>                </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath -&gt; Set Reference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TypeAlreadyExists"><span class="hs-identifier hs-var">TypeAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405305"><span class="hs-identifier hs-var">dest'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405289"><span class="hs-identifier hs-var">destTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-689"></span><span>              </span><span id="local-6989586621679405287"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405287"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-690"></span><span>              </span><span id="local-6989586621679405286"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679405286"><span class="hs-identifier hs-var">srcMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-691"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ShortHash (Absolute, HQSegment)
</span><a href="#local-6989586621679405303"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-692"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Cli r Metadata
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><span class="hs-identifier hs-var">Metadata.empty</span></span><span>
</span><span id="line-693"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679405285"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405285"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>                    </span><span id="local-6989586621679405284"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405284"><span class="hs-identifier hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-695"></span><span>                    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Path, ()) -&gt; Reference -&gt; Branch0 IO -&gt; Metadata
forall a (m :: * -&gt; *).
(Path, a) -&gt; Reference -&gt; Branch0 m -&gt; Metadata
</span><span class="hs-identifier hs-var">BranchUtil.getTypeMetadataAt</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405285"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405299"><span class="hs-identifier hs-var">srcType</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405284"><span class="hs-identifier hs-var">root0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-696"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall r. Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt"><span class="hs-identifier hs-var">stepAt</span></a></span><span>
</span><span id="line-697"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405287"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-698"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTypeName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405290"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405299"><span class="hs-identifier hs-var">srcType</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679405286"><span class="hs-identifier hs-var">srcMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span>            </span><span class="hs-comment">-- this implementation will happily produce name conflicts,</span><span>
</span><span id="line-702"></span><span>            </span><span class="hs-comment">-- but will surface them in a normal diff at the end of the operation.</span><span>
</span><span id="line-703"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#AliasManyI"><span class="hs-identifier hs-type">AliasManyI</span></a></span><span> </span><span id="local-6989586621679405280"><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405280"><span class="hs-identifier hs-var">srcs</span></a></span></span><span> </span><span id="local-6989586621679405279"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405279"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-704"></span><span>              </span><span id="local-6989586621679405278"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405278"><span class="hs-identifier hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-705"></span><span>              </span><span id="local-6989586621679405277"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405277"><span class="hs-identifier hs-var">currentBranch0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-706"></span><span>              </span><span id="local-6989586621679405276"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405276"><span class="hs-identifier hs-var">destAbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405279"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-707"></span><span>              </span><span id="local-6989586621679405275"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405275"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch0 IO)
forall r. Absolute -&gt; Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranch0At"><span class="hs-identifier hs-var">Cli.getBranch0At</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405276"><span class="hs-identifier hs-var">destAbs</span></a></span><span>
</span><span id="line-708"></span><span>              </span><span id="local-6989586621679405274"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405274"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-709"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679405273"><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405273"><span class="hs-identifier hs-var">unknown</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405272"><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; Branch0 IO)]
</span><a href="#local-6989586621679405272"><span class="hs-identifier hs-var">actions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([HQSplit], [(Path, Branch0 IO -&gt; Branch0 IO)])
 -&gt; HQSplit -&gt; ([HQSplit], [(Path, Branch0 IO -&gt; Branch0 IO)]))
-&gt; ([HQSplit], [(Path, Branch0 IO -&gt; Branch0 IO)])
-&gt; [HQSplit]
-&gt; ([HQSplit], [(Path, Branch0 IO -&gt; Branch0 IO)])
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Absolute
-&gt; ([HQSplit], [(Path, Branch0 IO -&gt; Branch0 IO)])
-&gt; HQSplit
-&gt; ([HQSplit], [(Path, Branch0 IO -&gt; Branch0 IO)])
forall (m :: * -&gt; *).
Branch0 IO
-&gt; Branch0 IO
-&gt; Absolute
-&gt; ([HQSplit], [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; HQSplit
-&gt; ([HQSplit], [(Path, Branch0 m -&gt; Branch0 m)])
</span><a href="#local-6989586621679405270"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405278"><span class="hs-identifier hs-var">root0</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405277"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405276"><span class="hs-identifier hs-var">destAbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([HQSplit], [(Path, Branch0 IO -&gt; Branch0 IO)])
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405280"><span class="hs-identifier hs-var">srcs</span></a></span><span>
</span><span id="line-710"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-var">stepManyAt</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405274"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; Branch0 IO)]
</span><a href="#local-6989586621679405272"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-711"></span><span>              </span><span id="local-6989586621679405269"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405269"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch0 IO)
forall r. Absolute -&gt; Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranch0At"><span class="hs-identifier hs-var">Cli.getBranch0At</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405276"><span class="hs-identifier hs-var">destAbs</span></a></span><span>
</span><span id="line-712"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679405268"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405268"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405267"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405267"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405275"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405269"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-713"></span><span>              </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path'
-&gt; Absolute
-&gt; PrettyPrintEnv
-&gt; BranchDiffOutput Symbol Ann
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffAfterModifyBranch"><span class="hs-identifier hs-var">ShowDiffAfterModifyBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405279"><span class="hs-identifier hs-var">dest'</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405276"><span class="hs-identifier hs-var">destAbs</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405268"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405267"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HQSplit] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405273"><span class="hs-identifier hs-var">unknown</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-715"></span><span>                </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ())
-&gt; ([HQSplit] -&gt; Output) -&gt; [HQSplit] -&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SearchTermsNotFound"><span class="hs-identifier hs-var">SearchTermsNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; Output)
-&gt; ([HQSplit] -&gt; [HashQualified Name]) -&gt; [HQSplit] -&gt; Output
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HQSplit -&gt; HashQualified Name)
-&gt; [HQSplit] -&gt; [HashQualified Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">HQSplit -&gt; HashQualified Name
</span><a href="#local-6989586621679405264"><span class="hs-identifier hs-var">fixupOutput</span></a></span><span> </span><span class="annot"><span class="annottext">([HQSplit] -&gt; Cli r ()) -&gt; [HQSplit] -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405273"><span class="hs-identifier hs-var">unknown</span></a></span><span>
</span><span id="line-716"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-717"></span><span>                </span><span class="hs-comment">-- a list of missing sources (if any) and the actions that do the work</span><span>
</span><span id="line-718"></span><span>                </span><span id="local-6989586621679406885"><span class="annot"><a href="#local-6989586621679405270"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-719"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-720"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-721"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-722"></span><span>                  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406885"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406885"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-723"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-724"></span><span>                  </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406885"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406885"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-725"></span><span>                </span><span id="local-6989586621679405270"><span class="annot"><span class="annottext">go :: Branch0 IO
-&gt; Branch0 IO
-&gt; Absolute
-&gt; ([HQSplit], [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; HQSplit
-&gt; ([HQSplit], [(Path, Branch0 m -&gt; Branch0 m)])
</span><a href="#local-6989586621679405270"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679405263"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405263"><span class="hs-identifier hs-var">root0</span></a></span></span><span> </span><span id="local-6989586621679405262"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405262"><span class="hs-identifier hs-var">currentBranch0</span></a></span></span><span> </span><span id="local-6989586621679405261"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405261"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679405260"><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405260"><span class="hs-identifier hs-var">missingSrcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405259"><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405259"><span class="hs-identifier hs-var">actions</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679405258"><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405258"><span class="hs-identifier hs-var">hqsrc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-726"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679405257"><span class="hs-identifier hs-type">src</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Split</span></span><span>
</span><span id="line-727"></span><span>                      </span><span id="local-6989586621679405257"><span class="annot"><span class="annottext">src :: Split
</span><a href="#local-6989586621679405257"><span class="hs-identifier hs-var hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HQSegment -&gt; NameSegment) -&gt; HQSplit -&gt; Split
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; NameSegment
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405258"><span class="hs-identifier hs-var">hqsrc</span></a></span><span>
</span><span id="line-728"></span><span>                      </span><span class="annot"><a href="#local-6989586621679405256"><span class="hs-identifier hs-type">proposedDest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Split</span></span><span>
</span><span id="line-729"></span><span>                      </span><span id="local-6989586621679405256"><span class="annot"><span class="annottext">proposedDest :: Split
</span><a href="#local-6989586621679405256"><span class="hs-identifier hs-var hs-var">proposedDest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HQSegment -&gt; NameSegment) -&gt; HQSplit -&gt; Split
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; NameSegment
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405255"><span class="hs-identifier hs-var">hqProposedDest</span></a></span><span>
</span><span id="line-730"></span><span>                      </span><span class="annot"><a href="#local-6989586621679405255"><span class="hs-identifier hs-type">hqProposedDest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit</span></span><span>
</span><span id="line-731"></span><span>                      </span><span id="local-6989586621679405255"><span class="annot"><span class="annottext">hqProposedDest :: HQSplit
</span><a href="#local-6989586621679405255"><span class="hs-identifier hs-var hs-var">hqProposedDest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Absolute -&gt; Path) -&gt; (Absolute, HQSegment) -&gt; HQSplit
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">((Absolute, HQSegment) -&gt; HQSplit)
-&gt; (Absolute, HQSegment) -&gt; HQSplit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; HQSplit -&gt; (Absolute, HQSegment)
forall l r o. Resolve l r o =&gt; l -&gt; r -&gt; o
</span><span class="hs-identifier hs-var">Path.resolve</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405261"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405258"><span class="hs-identifier hs-var">hqsrc</span></a></span><span>
</span><span id="line-732"></span><span>                      </span><span class="hs-comment">-- `Nothing` if src doesn't exist</span><span>
</span><span id="line-733"></span><span>                      </span><span id="local-6989586621679406871"><span class="annot"><a href="#local-6989586621679405253"><span class="hs-identifier hs-type">doType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406871"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406871"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-734"></span><span>                      </span><span id="local-6989586621679405253"><span class="annot"><span class="annottext">doType :: Maybe [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405253"><span class="hs-identifier hs-var hs-var">doType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HQSplit -&gt; Branch0 IO -&gt; Set Reference
forall (m :: * -&gt; *). HQSplit -&gt; Branch0 m -&gt; Set Reference
</span><span class="hs-identifier hs-var">BranchUtil.getType</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405258"><span class="hs-identifier hs-var">hqsrc</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405262"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-735"></span><span>                                      </span><span class="annot"><span class="annottext">HQSplit -&gt; Branch0 IO -&gt; Set Reference
forall (m :: * -&gt; *). HQSplit -&gt; Branch0 m -&gt; Set Reference
</span><span class="hs-identifier hs-var">BranchUtil.getType</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405255"><span class="hs-identifier hs-var">hqProposedDest</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405263"><span class="hs-identifier hs-var">root0</span></a></span><span>
</span><span id="line-736"></span><span>                                    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-737"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- missing src</span><span>
</span><span id="line-738"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621679405251"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405251"><span class="hs-identifier hs-var">rsrcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405250"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405250"><span class="hs-identifier hs-var">existing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-739"></span><span>                          </span><span class="hs-comment">-- happy path</span><span>
</span><span id="line-740"></span><span>                          </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
-&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([(Path, Branch0 m -&gt; Branch0 m)]
 -&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; (Set Reference -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; Set Reference
-&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; (Path, Branch0 m -&gt; Branch0 m))
-&gt; [Reference] -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679405249"><span class="hs-identifier hs-var">addAlias</span></a></span><span> </span><span class="annot"><span class="annottext">([Reference] -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; (Set Reference -&gt; [Reference])
-&gt; Set Reference
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; Set Reference -&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Set Reference -&gt; Set Reference
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405251"><span class="hs-identifier hs-var">rsrcs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405250"><span class="hs-identifier hs-var">existing</span></a></span><span>
</span><span id="line-741"></span><span>                          </span><span class="hs-keyword">where</span><span>
</span><span id="line-742"></span><span>                            </span><span id="local-6989586621679405249"><span class="annot"><span class="annottext">addAlias :: Reference -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679405249"><span class="hs-identifier hs-var hs-var">addAlias</span></a></span></span><span> </span><span id="local-6989586621679405247"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405247"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall (m :: * -&gt; *).
Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTypeName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679405256"><span class="hs-identifier hs-var">proposedDest</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405247"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Metadata
</span><a href="#local-6989586621679405246"><span class="hs-identifier hs-var">oldMD</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405247"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>                            </span><span id="local-6989586621679405246"><span class="annot"><span class="annottext">oldMD :: Reference -&gt; Metadata
</span><a href="#local-6989586621679405246"><span class="hs-identifier hs-var hs-var">oldMD</span></a></span></span><span> </span><span id="local-6989586621679405245"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405245"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; Branch0 IO -&gt; Metadata
forall a (m :: * -&gt; *).
(Path, a) -&gt; Reference -&gt; Branch0 m -&gt; Metadata
</span><span class="hs-identifier hs-var">BranchUtil.getTypeMetadataAt</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679405257"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405245"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405262"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span>
</span><span id="line-744"></span><span>                      </span><span id="local-6989586621679405244"><span class="annot"><a href="#local-6989586621679405243"><span class="hs-identifier hs-type">doTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679405244"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679405244"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-745"></span><span>                      </span><span id="local-6989586621679405243"><span class="annot"><span class="annottext">doTerm :: Maybe [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405243"><span class="hs-identifier hs-var hs-var">doTerm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HQSplit -&gt; Branch0 IO -&gt; Set Referent
forall (m :: * -&gt; *). HQSplit -&gt; Branch0 m -&gt; Set Referent
</span><span class="hs-identifier hs-var">BranchUtil.getTerm</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405258"><span class="hs-identifier hs-var">hqsrc</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405262"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-746"></span><span>                                      </span><span class="annot"><span class="annottext">HQSplit -&gt; Branch0 IO -&gt; Set Referent
forall (m :: * -&gt; *). HQSplit -&gt; Branch0 m -&gt; Set Referent
</span><span class="hs-identifier hs-var">BranchUtil.getTerm</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405255"><span class="hs-identifier hs-var">hqProposedDest</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405263"><span class="hs-identifier hs-var">root0</span></a></span><span>
</span><span id="line-747"></span><span>                                    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-748"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-comment">-- missing src</span><span>
</span><span id="line-749"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621679405241"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405241"><span class="hs-identifier hs-var">rsrcs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405240"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405240"><span class="hs-identifier hs-var">existing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-750"></span><span>                          </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
-&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">([(Path, Branch0 m -&gt; Branch0 m)]
 -&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; (Set Referent -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; Set Referent
-&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; (Path, Branch0 m -&gt; Branch0 m))
-&gt; [Referent] -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679405239"><span class="hs-identifier hs-var">addAlias</span></a></span><span> </span><span class="annot"><span class="annottext">([Referent] -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; (Set Referent -&gt; [Referent])
-&gt; Set Referent
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; Set Referent -&gt; Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Set Referent -&gt; Set Referent
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405241"><span class="hs-identifier hs-var">rsrcs</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405240"><span class="hs-identifier hs-var">existing</span></a></span><span>
</span><span id="line-751"></span><span>                          </span><span class="hs-keyword">where</span><span>
</span><span id="line-752"></span><span>                            </span><span id="local-6989586621679405239"><span class="annot"><span class="annottext">addAlias :: Referent -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679405239"><span class="hs-identifier hs-var hs-var">addAlias</span></a></span></span><span> </span><span id="local-6989586621679405238"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405238"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTermName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679405256"><span class="hs-identifier hs-var">proposedDest</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405238"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent -&gt; Metadata
</span><a href="#local-6989586621679405237"><span class="hs-identifier hs-var">oldMD</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405238"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-753"></span><span>                            </span><span id="local-6989586621679405237"><span class="annot"><span class="annottext">oldMD :: Referent -&gt; Metadata
</span><a href="#local-6989586621679405237"><span class="hs-identifier hs-var hs-var">oldMD</span></a></span></span><span> </span><span id="local-6989586621679405236"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405236"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Branch0 IO -&gt; Metadata
forall a (m :: * -&gt; *).
(Path, a) -&gt; Referent -&gt; Branch0 m -&gt; Metadata
</span><span class="hs-identifier hs-var">BranchUtil.getTermMetadataAt</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679405257"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405236"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405262"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span>
</span><span id="line-754"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall (m :: * -&gt; *). Maybe [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405253"><span class="hs-identifier hs-var">doType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [(Path, Branch0 m -&gt; Branch0 m)]
forall (m :: * -&gt; *). Maybe [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405243"><span class="hs-identifier hs-var">doTerm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-755"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [(Path, Branch0 m -&gt; Branch0 m)]
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [(Path, Branch0 m -&gt; Branch0 m)]
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405260"><span class="hs-identifier hs-var">missingSrcs</span></a></span><span> </span><span class="annot"><span class="annottext">[HQSplit] -&gt; HQSplit -&gt; [HQSplit]
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">:&gt;</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405258"><span class="hs-identifier hs-var">hqsrc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405259"><span class="hs-identifier hs-var">actions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405234"><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405234"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [(Path, Branch0 m -&gt; Branch0 m)]
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405260"><span class="hs-identifier hs-var">missingSrcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405259"><span class="hs-identifier hs-var">actions</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405234"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [(Path, Branch0 m -&gt; Branch0 m)]
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405233"><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405233"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405260"><span class="hs-identifier hs-var">missingSrcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405259"><span class="hs-identifier hs-var">actions</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405233"><span class="hs-keyword hs-var">as</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405232"><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405232"><span class="hs-identifier hs-var">as1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679405231"><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405231"><span class="hs-identifier hs-var">as2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679405260"><span class="hs-identifier hs-var">missingSrcs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405259"><span class="hs-identifier hs-var">actions</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405232"><span class="hs-identifier hs-var">as1</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679405231"><span class="hs-identifier hs-var">as2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span>                </span><span class="annot"><a href="#local-6989586621679405264"><span class="hs-identifier hs-type">fixupOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-761"></span><span>                </span><span id="local-6989586621679405264"><span class="annot"><span class="annottext">fixupOutput :: HQSplit -&gt; HashQualified Name
</span><a href="#local-6989586621679405264"><span class="hs-identifier hs-var hs-var">fixupOutput</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Name) -&gt; HashQualified Path -&gt; HashQualified Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Name
</span><span class="hs-identifier hs-var">Path.unsafeToName</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Path -&gt; HashQualified Name)
-&gt; (HQSplit -&gt; HashQualified Path) -&gt; HQSplit -&gt; HashQualified Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Path -&gt; HashQualified Path
forall n. HashQualified n -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ'.toHQ</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Path -&gt; HashQualified Path)
-&gt; (HQSplit -&gt; HashQualified Path) -&gt; HQSplit -&gt; HashQualified Path
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HQSplit -&gt; HashQualified Path
</span><span class="hs-identifier hs-var">Path.unsplitHQ</span></span><span>
</span><span id="line-762"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#NamesI"><span class="hs-identifier hs-type">NamesI</span></a></span><span> </span><span id="local-6989586621679405227"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405227"><span class="hs-identifier hs-var">global</span></a></span></span><span> </span><span id="local-6989586621679405226"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405226"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-763"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405225"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405225"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-764"></span><span>              </span><span id="local-6989586621679405224"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679405224"><span class="hs-identifier hs-var">currentPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">(Absolute -&gt; Path) -&gt; Cli r Absolute -&gt; Cli r Path
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-765"></span><span>              </span><span id="local-6989586621679405223"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405223"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405225"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>              </span><span id="local-6989586621679405222"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405222"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-767"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679405221"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405221"><span class="hs-identifier hs-var">names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405220"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405220"><span class="hs-identifier hs-var">pped</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-768"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405227"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; HashQualified Name -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><span class="hs-identifier hs-var">Name.isAbsolute</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405226"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-769"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-770"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405217"><span class="annot"><span class="annottext">root0 :: Branch0 IO
</span><a href="#local-6989586621679405217"><span class="hs-identifier hs-var hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405222"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-771"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405216"><span class="annot"><span class="annottext">names :: NamesWithHistory
</span><a href="#local-6989586621679405216"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; NamesWithHistory)
-&gt; (Names -&gt; Names) -&gt; Names -&gt; NamesWithHistory
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.makeAbsolute</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; NamesWithHistory) -&gt; Names -&gt; NamesWithHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405217"><span class="hs-identifier hs-var">root0</span></a></span><span>
</span><span id="line-772"></span><span>                    </span><span class="hs-comment">-- Use an absolutely qualified ppe for view.global</span><span>
</span><span id="line-773"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405213"><span class="annot"><span class="annottext">pped :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679405213"><span class="hs-identifier hs-var hs-var">pped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPE.fromNamesDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405223"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405216"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-774"></span><span>                    </span><span class="annot"><span class="annottext">(NamesWithHistory, PrettyPrintEnvDecl)
-&gt; Cli r (NamesWithHistory, PrettyPrintEnvDecl)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405216"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405213"><span class="hs-identifier hs-var">pped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-776"></span><span>                    </span><span id="local-6989586621679405212"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405212"><span class="hs-identifier hs-var">currentBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-777"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405211"><span class="annot"><span class="annottext">currentNames :: NamesWithHistory
</span><a href="#local-6989586621679405211"><span class="hs-identifier hs-var hs-var">currentNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; NamesWithHistory) -&gt; Names -&gt; NamesWithHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405212"><span class="hs-identifier hs-var">currentBranch</span></a></span><span>
</span><span id="line-778"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405210"><span class="annot"><span class="annottext">pped :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679405210"><span class="hs-identifier hs-var hs-var">pped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NameScoping -&gt; Branch IO -&gt; PrettyPrintEnvDecl
forall (m :: * -&gt; *).
Int -&gt; NameScoping -&gt; Branch m -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">Backend.getCurrentPrettyNames</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405223"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679405224"><span class="hs-identifier hs-var">currentPath'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405222"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-779"></span><span>                    </span><span class="annot"><span class="annottext">(NamesWithHistory, PrettyPrintEnvDecl)
-&gt; Cli r (NamesWithHistory, PrettyPrintEnvDecl)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405211"><span class="hs-identifier hs-var">currentNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405210"><span class="hs-identifier hs-var">pped</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-780"></span><span>
</span><span id="line-781"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405209"><span class="annot"><span class="annottext">unsuffixifiedPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679405209"><span class="hs-identifier hs-var hs-var">unsuffixifiedPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPED.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679405220"><span class="hs-identifier hs-var">pped</span></a></span><span>
</span><span id="line-782"></span><span>                  </span><span id="local-6989586621679405207"><span class="annot"><span class="annottext">terms :: Set Referent
</span><a href="#local-6989586621679405207"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Referent
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupHQTerm</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405226"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405221"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-783"></span><span>                  </span><span id="local-6989586621679405205"><span class="annot"><span class="annottext">types :: Set Reference
</span><a href="#local-6989586621679405205"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Reference
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupHQType</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405226"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679405221"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-784"></span><span>                  </span><span class="annot"><a href="#local-6989586621679405203"><span class="hs-identifier hs-type">terms'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>                  </span><span id="local-6989586621679405203"><span class="annot"><span class="annottext">terms' :: Set (Referent, Set (HashQualified Name))
</span><a href="#local-6989586621679405203"><span class="hs-identifier hs-var hs-var">terms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; (Referent, Set (HashQualified Name)))
-&gt; Set Referent -&gt; Set (Referent, Set (HashQualified Name))
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; (Referent, Set (HashQualified Name))
</span><a href="#local-6989586621679405202"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405207"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-786"></span><span>                    </span><span class="hs-keyword">where</span><span>
</span><span id="line-787"></span><span>                      </span><span id="local-6989586621679405202"><span class="annot"><span class="annottext">go :: Referent -&gt; (Referent, Set (HashQualified Name))
</span><a href="#local-6989586621679405202"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679405201"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405201"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405201"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Set (HashQualified Name)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; Set (HashQualified Name))
-&gt; [HashQualified Name] -&gt; Set (HashQualified Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; [HashQualified Name]
</span><span class="hs-identifier hs-var">PPE.allTermNames</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405209"><span class="hs-identifier hs-var">unsuffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405201"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>                  </span><span class="annot"><a href="#local-6989586621679405199"><span class="hs-identifier hs-type">types'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>                  </span><span id="local-6989586621679405199"><span class="annot"><span class="annottext">types' :: Set (Reference, Set (HashQualified Name))
</span><a href="#local-6989586621679405199"><span class="hs-identifier hs-var hs-var">types'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; (Reference, Set (HashQualified Name)))
-&gt; Set Reference -&gt; Set (Reference, Set (HashQualified Name))
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; (Reference, Set (HashQualified Name))
</span><a href="#local-6989586621679405198"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405205"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-790"></span><span>                    </span><span class="hs-keyword">where</span><span>
</span><span id="line-791"></span><span>                      </span><span id="local-6989586621679405198"><span class="annot"><span class="annottext">go :: Reference -&gt; (Reference, Set (HashQualified Name))
</span><a href="#local-6989586621679405198"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679405197"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405197"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405197"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Set (HashQualified Name)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; Set (HashQualified Name))
-&gt; [HashQualified Name] -&gt; Set (HashQualified Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Reference -&gt; [HashQualified Name]
</span><span class="hs-identifier hs-var">PPE.allTypeNames</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405209"><span class="hs-identifier hs-var">unsuffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405197"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-792"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Int
-&gt; [(Reference, Set (HashQualified Name))]
-&gt; [(Referent, Set (HashQualified Name))]
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ListNames"><span class="hs-identifier hs-var">ListNames</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405227"><span class="hs-identifier hs-var">global</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405223"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (Reference, Set (HashQualified Name))
-&gt; [(Reference, Set (HashQualified Name))]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set (Reference, Set (HashQualified Name))
</span><a href="#local-6989586621679405199"><span class="hs-identifier hs-var">types'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (Referent, Set (HashQualified Name))
-&gt; [(Referent, Set (HashQualified Name))]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set (Referent, Set (HashQualified Name))
</span><a href="#local-6989586621679405203"><span class="hs-identifier hs-var">terms'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-793"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#LinkI"><span class="hs-identifier hs-type">LinkI</span></a></span><span> </span><span id="local-6989586621679405193"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405193"><span class="hs-identifier hs-var">mdValue</span></a></span></span><span> </span><span id="local-6989586621679405192"><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405192"><span class="hs-identifier hs-var">srcs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-794"></span><span>              </span><span id="local-6989586621679405191"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405191"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-795"></span><span>              </span><span class="annot"><span class="annottext">Bool
-&gt; [HQSplit']
-&gt; [HashQualified Name]
-&gt; (forall r.
    Ord r =&gt;
    (r, Reference, Reference)
    -&gt; Star r NameSegment -&gt; Star r NameSegment)
-&gt; Cli r ()
forall r.
Bool
-&gt; [HQSplit']
-&gt; [HashQualified Name]
-&gt; (forall r.
    Ord r =&gt;
    (r, Reference, Reference)
    -&gt; Star r NameSegment -&gt; Star r NameSegment)
-&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#manageLinks"><span class="hs-identifier hs-var">manageLinks</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405192"><span class="hs-identifier hs-var">srcs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405193"><span class="hs-identifier hs-var">mdValue</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall r.
Ord r =&gt;
(r, Reference, Reference)
-&gt; Star r NameSegment -&gt; Star r NameSegment
forall a n.
(Ord a, Ord n) =&gt;
(a, Reference, Reference) -&gt; Star a n -&gt; Star a n
</span><span class="hs-identifier hs-var">Metadata.insert</span></span><span>
</span><span id="line-796"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Cli r ()
forall r. Text -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-var">syncRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405191"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-797"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#UnlinkI"><span class="hs-identifier hs-type">UnlinkI</span></a></span><span> </span><span id="local-6989586621679405186"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405186"><span class="hs-identifier hs-var">mdValue</span></a></span></span><span> </span><span id="local-6989586621679405185"><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405185"><span class="hs-identifier hs-var">srcs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-798"></span><span>              </span><span id="local-6989586621679405184"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405184"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-799"></span><span>              </span><span class="annot"><span class="annottext">Bool
-&gt; [HQSplit']
-&gt; [HashQualified Name]
-&gt; (forall r.
    Ord r =&gt;
    (r, Reference, Reference)
    -&gt; Star r NameSegment -&gt; Star r NameSegment)
-&gt; Cli r ()
forall r.
Bool
-&gt; [HQSplit']
-&gt; [HashQualified Name]
-&gt; (forall r.
    Ord r =&gt;
    (r, Reference, Reference)
    -&gt; Star r NameSegment -&gt; Star r NameSegment)
-&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#manageLinks"><span class="hs-identifier hs-var">manageLinks</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405185"><span class="hs-identifier hs-var">srcs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679405186"><span class="hs-identifier hs-var">mdValue</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">forall r.
Ord r =&gt;
(r, Reference, Reference)
-&gt; Star r NameSegment -&gt; Star r NameSegment
forall a n.
(Ord a, Ord n) =&gt;
(a, Reference, Reference) -&gt; Star a n -&gt; Star a n
</span><span class="hs-identifier hs-var">Metadata.delete</span></span><span>
</span><span id="line-800"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Cli r ()
forall r. Text -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-var">syncRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405184"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-801"></span><span>
</span><span id="line-802"></span><span>            </span><span class="hs-comment">-- &gt; links List.map (.Docs .English)</span><span>
</span><span id="line-803"></span><span>            </span><span class="hs-comment">-- &gt; links List.map -- give me all the</span><span>
</span><span id="line-804"></span><span>            </span><span class="hs-comment">-- &gt; links Optional License</span><span>
</span><span id="line-805"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#LinksI"><span class="hs-identifier hs-type">LinksI</span></a></span><span> </span><span id="local-6989586621679405181"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405181"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621679405180"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679405180"><span class="hs-identifier hs-var">mdTypeStr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-806"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679405179"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405179"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405178"><span class="annot"><span class="annottext">[(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679405178"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; HQSplit'
-&gt; Either (Set Reference) (Maybe String)
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
forall r.
String
-&gt; HQSplit'
-&gt; Either (Set Reference) (Maybe String)
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
</span><a href="Unison.Codebase.Editor.HandleInput.html#getLinks"><span class="hs-identifier hs-var">getLinks</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405181"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String -&gt; Either (Set Reference) (Maybe String)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679405180"><span class="hs-identifier hs-var">mdTypeStr</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
              #numberedArgs .= fmap (HQ.toString . view _1) out
</span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405171"><span class="annot"><span class="annottext">biasedPPE :: PrettyPrintEnv
</span><a href="#local-6989586621679405171"><span class="hs-identifier hs-var hs-var">biasedPPE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnv -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.biasTo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Name -&gt; [Name]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Name -&gt; [Name])
-&gt; (HashQualified Path' -&gt; Maybe Name)
-&gt; HashQualified Path'
-&gt; [Name]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Path.toName'</span></span><span> </span><span class="annot"><span class="annottext">(Path' -&gt; Maybe Name)
-&gt; (HashQualified Path' -&gt; Path')
-&gt; HashQualified Path'
-&gt; Maybe Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Path' -&gt; Path'
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Path' -&gt; [Name]) -&gt; HashQualified Path' -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; HashQualified Path'
</span><span class="hs-identifier hs-var">Path.unsplitHQ'</span></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405181"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405179"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; [(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ListOfLinks"><span class="hs-identifier hs-var">ListOfLinks</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405171"><span class="hs-identifier hs-var">biasedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">[(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679405178"><span class="hs-identifier hs-var">out</span></a></span><span>
</span><span id="line-810"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DocsI"><span class="hs-identifier hs-type">DocsI</span></a></span><span> </span><span id="local-6989586621679405164"><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405164"><span class="hs-identifier hs-var">srcs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-811"></span><span>              </span><span id="local-6989586621679405163"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405163"><span class="hs-identifier hs-var">currentBranch0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-812"></span><span>              </span><span id="local-6989586621679405162"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405162"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#getBasicPrettyPrintNames"><span class="hs-identifier hs-var">getBasicPrettyPrintNames</span></a></span><span>
</span><span id="line-813"></span><span>              </span><span id="local-6989586621679405160"><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405160"><span class="hs-identifier hs-var">srcs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405164"><span class="hs-identifier hs-var">srcs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-814"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-815"></span><span>                  </span><span id="local-6989586621679405159"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405159"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-816"></span><span>                    </span><span class="annot"><span class="annottext">Position -&gt; Branch0 IO -&gt; Cli r (Maybe [HashQualified Name])
forall (m :: * -&gt; *) (m0 :: * -&gt; *).
MonadIO m =&gt;
Position -&gt; Branch0 m0 -&gt; m (Maybe [HashQualified Name])
</span><a href="Unison.Codebase.Editor.HandleInput.html#fuzzySelectDefinition"><span class="hs-identifier hs-var">fuzzySelectDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">Absolute</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405163"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe [HashQualified Name])
-&gt; (Cli r (Maybe [HashQualified Name])
    -&gt; Cli r [HashQualified Name])
-&gt; Cli r [HashQualified Name]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r [HashQualified Name]
-&gt; Cli r (Maybe [HashQualified Name]) -&gt; Cli r [HashQualified Name]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><span class="hs-identifier hs-var">onNothingM</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-817"></span><span>                      </span><span class="annot"><span class="annottext">Output -&gt; Cli r [HashQualified Name]
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputPattern -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#HelpMessage"><span class="hs-identifier hs-var">HelpMessage</span></a></span><span> </span><span class="annot"><span class="annottext">InputPattern
</span><a href="Unison.CommandLine.InputPatterns.html#docs"><span class="hs-identifier hs-var">InputPatterns.docs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span>                  </span><span class="hs-comment">-- HQ names should always parse as a valid split, so we just discard any</span><span>
</span><span id="line-819"></span><span>                  </span><span class="hs-comment">-- that don't to satisfy the type-checker.</span><span>
</span><span id="line-820"></span><span>                  </span><span class="annot"><span class="annottext">[HQSplit'] -&gt; Cli r [HQSplit']
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([HQSplit'] -&gt; Cli r [HQSplit'])
-&gt; ([HashQualified Name] -&gt; [HQSplit'])
-&gt; [HashQualified Name]
-&gt; Cli r [HQSplit']
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Maybe HQSplit')
-&gt; [HashQualified Name] -&gt; [HQSplit']
forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either String HQSplit' -&gt; Maybe HQSplit'
forall a b. Either a b -&gt; Maybe b
</span><span class="hs-identifier hs-var">eitherToMaybe</span></span><span> </span><span class="annot"><span class="annottext">(Either String HQSplit' -&gt; Maybe HQSplit')
-&gt; (HashQualified Name -&gt; Either String HQSplit')
-&gt; HashQualified Name
-&gt; Maybe HQSplit'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String HQSplit'
</span><span class="hs-identifier hs-var">Path.parseHQSplit'</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String HQSplit')
-&gt; (HashQualified Name -&gt; String)
-&gt; HashQualified Name
-&gt; Either String HQSplit'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ.toString</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; Cli r [HQSplit'])
-&gt; [HashQualified Name] -&gt; Cli r [HQSplit']
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405159"><span class="hs-identifier hs-var">defs</span></a></span><span>
</span><span id="line-821"></span><span>                </span><span id="local-6989586621679405154"><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405154"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[HQSplit'] -&gt; Cli r [HQSplit']
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405154"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-822"></span><span>              </span><span class="annot"><span class="annottext">[HQSplit'] -&gt; (HQSplit' -&gt; Cli r ()) -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679405160"><span class="hs-identifier hs-var">srcs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Names -&gt; HQSplit' -&gt; Cli r ()
forall r. String -&gt; Names -&gt; HQSplit' -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#docsI"><span class="hs-identifier hs-var">docsI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405162"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#CreateAuthorI"><span class="hs-identifier hs-type">CreateAuthorI</span></a></span><span> </span><span id="local-6989586621679405150"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405150"><span class="hs-identifier hs-var">authorNameSegment</span></a></span></span><span> </span><span id="local-6989586621679405149"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405149"><span class="hs-identifier hs-var">authorFullName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-824"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405148"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405148"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-825"></span><span>              </span><span id="local-6989586621679405147"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405147"><span class="hs-identifier hs-var">initialBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch"><span class="hs-identifier hs-var">Cli.getCurrentBranch</span></a></span><span>
</span><span id="line-826"></span><span>              </span><span class="annot"><a href="Unison.Codebase.Editor.AuthorInfo.html#AuthorInfo"><span class="hs-identifier hs-type">AuthorInfo</span></a></span><span>
</span><span id="line-827"></span><span>                </span><span id="local-6989586621679405144"><span class="annot"><span class="annottext">guid :: (Id, Term Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679405144"><span class="hs-identifier hs-var">guid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679405143"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679405143"><span class="hs-identifier hs-var">guidRef</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-828"></span><span>                </span><span id="local-6989586621679405142"><span class="annot"><span class="annottext">author :: (Id, Term Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679405142"><span class="hs-identifier hs-var">author</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679405141"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679405141"><span class="hs-identifier hs-var">authorRef</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-829"></span><span>                </span><span id="local-6989586621679405140"><span class="annot"><span class="annottext">copyrightHolder :: (Id, Term Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679405140"><span class="hs-identifier hs-var">copyrightHolder</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679405139"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679405139"><span class="hs-identifier hs-var">copyrightHolderRef</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-830"></span><span>                </span><span class="annot"><span class="annottext">Ann -&gt; Text -&gt; Cli r (AuthorInfo Symbol Ann)
forall (m :: * -&gt; *) v a.
(MonadIO m, Var v) =&gt;
a -&gt; Text -&gt; m (AuthorInfo v a)
</span><a href="Unison.Codebase.Editor.AuthorInfo.html#createAuthorInfo"><span class="hs-identifier hs-var">AuthorInfo.createAuthorInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.External</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405149"><span class="hs-identifier hs-var">authorFullName</span></a></span><span>
</span><span id="line-831"></span><span>              </span><span id="local-6989586621679405136"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405136"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-832"></span><span>              </span><span class="hs-comment">-- add the new definitions to the codebase and to the namespace</span><span>
</span><span id="line-833"></span><span>              </span><span class="annot"><span class="annottext">((Id, Term Symbol Ann, Type Symbol Ann) -&gt; Cli r ())
-&gt; [(Id, Term Symbol Ann, Type Symbol Ann)] -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Cli r ())
-&gt; ((Id, Term Symbol Ann, Type Symbol Ann) -&gt; IO ())
-&gt; (Id, Term Symbol Ann, Type Symbol Ann)
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Term Symbol Ann -&gt; Type Symbol Ann -&gt; IO ())
-&gt; (Id, Term Symbol Ann, Type Symbol Ann) -&gt; IO ()
forall a b c d. (a -&gt; b -&gt; c -&gt; d) -&gt; (a, b, c) -&gt; d
</span><span class="hs-identifier hs-var">uncurry3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Id -&gt; Term Symbol Ann -&gt; Type Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; Term v a -&gt; Type v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405148"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Id, Term Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679405144"><span class="hs-identifier hs-var">guid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Id, Term Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679405142"><span class="hs-identifier hs-var">author</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Id, Term Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679405140"><span class="hs-identifier hs-var">copyrightHolder</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-834"></span><span>              </span><span id="local-6989586621679405134"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405134"><span class="hs-identifier hs-var">authorPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405133"><span class="hs-identifier hs-var">authorPath'</span></a></span><span>
</span><span id="line-835"></span><span>              </span><span id="local-6989586621679405132"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405132"><span class="hs-identifier hs-var">copyrightHolderPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405131"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; NameSegment -&gt; PatchPath
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;copyrightHolders&quot;</span></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; NameSegment -&gt; PatchPath
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405150"><span class="hs-identifier hs-var">authorNameSegment</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>              </span><span id="local-6989586621679405129"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405129"><span class="hs-identifier hs-var">guidPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405133"><span class="hs-identifier hs-var">authorPath'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; NameSegment -&gt; PatchPath
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;guid&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-var">stepManyAt</span></a></span><span>
</span><span id="line-838"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405136"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-839"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTermName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405134"><span class="hs-identifier hs-var">authorPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Referent
</span><a href="#local-6989586621679405128"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679405141"><span class="hs-identifier hs-var">authorRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Metadata
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-840"></span><span>                  </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTermName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405132"><span class="hs-identifier hs-var">copyrightHolderPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Referent
</span><a href="#local-6989586621679405128"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679405139"><span class="hs-identifier hs-var">copyrightHolderRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Metadata
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-841"></span><span>                  </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTermName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405129"><span class="hs-identifier hs-var">guidPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Referent
</span><a href="#local-6989586621679405128"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679405143"><span class="hs-identifier hs-var">guidRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Metadata
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-842"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-843"></span><span>              </span><span id="local-6989586621679405127"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405127"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-844"></span><span>              </span><span id="local-6989586621679405126"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405126"><span class="hs-identifier hs-var">finalBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-845"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679405125"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405125"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405124"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405124"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405147"><span class="hs-identifier hs-var">initialBranch</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405126"><span class="hs-identifier hs-var">finalBranch</span></a></span><span>
</span><span id="line-846"></span><span>              </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="annot"><span class="annottext">(NumberedOutput -&gt; Cli r ()) -&gt; NumberedOutput -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-847"></span><span>                </span><span class="annot"><span class="annottext">NameSegment
-&gt; Path'
-&gt; Absolute
-&gt; PrettyPrintEnv
-&gt; BranchDiffOutput Symbol Ann
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffAfterCreateAuthor"><span class="hs-identifier hs-var">ShowDiffAfterCreateAuthor</span></a></span><span>
</span><span id="line-848"></span><span>                  </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405150"><span class="hs-identifier hs-var">authorNameSegment</span></a></span><span>
</span><span id="line-849"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath -&gt; Path'
</span><span class="hs-identifier hs-var">Path.unsplit'</span></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405131"><span class="hs-identifier hs-var">base</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-850"></span><span>                  </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405127"><span class="hs-identifier hs-var">currentPath</span></a></span><span>
</span><span id="line-851"></span><span>                  </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405125"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-852"></span><span>                  </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679405124"><span class="hs-identifier hs-var">diff</span></a></span><span>
</span><span id="line-853"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-854"></span><span>                </span><span class="annot"><a href="#local-6989586621679405128"><span class="hs-identifier hs-type">d</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span>
</span><span id="line-855"></span><span>                </span><span id="local-6989586621679405128"><span class="annot"><span class="annottext">d :: Id -&gt; Referent
</span><a href="#local-6989586621679405128"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Referent) -&gt; (Id -&gt; Reference) -&gt; Id -&gt; Referent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Reference
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span>
</span><span id="line-856"></span><span>                </span><span id="local-6989586621679405131"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405131"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Split'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path'
</span><span class="hs-identifier hs-var">Path.relativeEmpty'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;metadata&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-857"></span><span>                </span><span id="local-6989586621679405133"><span class="annot"><span class="annottext">authorPath' :: PatchPath
</span><a href="#local-6989586621679405133"><span class="hs-identifier hs-var hs-var">authorPath'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405131"><span class="hs-identifier hs-var">base</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; NameSegment -&gt; PatchPath
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;authors&quot;</span></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; NameSegment -&gt; PatchPath
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405150"><span class="hs-identifier hs-var">authorNameSegment</span></a></span><span>
</span><span id="line-858"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MoveTermI"><span class="hs-identifier hs-type">MoveTermI</span></a></span><span> </span><span id="local-6989586621679405118"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405118"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span id="local-6989586621679405117"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405117"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-859"></span><span>              </span><span id="local-6989586621679405116"><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405116"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r (Absolute, HQSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405118"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-860"></span><span>              </span><span id="local-6989586621679405115"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405115"><span class="hs-identifier hs-var">srcTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="Unison.Cli.MonadUtils.html#getTermsAt"><span class="hs-identifier hs-var">Cli.getTermsAt</span></a></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405116"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-861"></span><span>              </span><span id="local-6989586621679405114"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405114"><span class="hs-identifier hs-var">srcTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-862"></span><span>                </span><span class="annot"><span class="annottext">Set Referent -&gt; Maybe Referent
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405115"><span class="hs-identifier hs-var">srcTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Referent
-&gt; (Maybe Referent -&gt; Cli r Referent) -&gt; Cli r Referent
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Referent -&gt; Maybe Referent -&gt; Cli r Referent
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-863"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405115"><span class="hs-identifier hs-var">srcTerms</span></a></span><span>
</span><span id="line-864"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Referent
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TermNotFound"><span class="hs-identifier hs-var">TermNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405118"><span class="hs-identifier hs-var">src'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-865"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-866"></span><span>                      </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405113"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405113"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-867"></span><span>                      </span><span id="local-6989586621679405112"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405112"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405113"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-868"></span><span>                      </span><span class="annot"><span class="annottext">Output -&gt; Cli r Referent
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; HQSplit' -&gt; Set Referent -&gt; Set Reference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DeleteNameAmbiguous"><span class="hs-identifier hs-var">DeleteNameAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405112"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405118"><span class="hs-identifier hs-var">src'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405115"><span class="hs-identifier hs-var">srcTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-869"></span><span>              </span><span id="local-6989586621679405111"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405111"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405117"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-870"></span><span>              </span><span id="local-6989586621679405110"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405110"><span class="hs-identifier hs-var">destTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="Unison.Cli.MonadUtils.html#getTermsAt"><span class="hs-identifier hs-var">Cli.getTermsAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; (Absolute, HQSegment)
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405111"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405110"><span class="hs-identifier hs-var">destTerms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-872"></span><span>                </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath -&gt; Set Referent -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TermAlreadyExists"><span class="hs-identifier hs-var">TermAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405117"><span class="hs-identifier hs-var">dest'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405110"><span class="hs-identifier hs-var">destTerms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-873"></span><span>              </span><span id="local-6989586621679405109"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405109"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-874"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405108"><span class="annot"><span class="annottext">p :: HQSplit
</span><a href="#local-6989586621679405108"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; HQSplit
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405116"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-875"></span><span>              </span><span id="local-6989586621679405107"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679405107"><span class="hs-identifier hs-var">srcMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-876"></span><span>                </span><span id="local-6989586621679405106"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405106"><span class="hs-identifier hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-877"></span><span>                </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit -&gt; Referent -&gt; Branch0 IO -&gt; Metadata
forall a (m :: * -&gt; *).
(Path, a) -&gt; Referent -&gt; Branch0 m -&gt; Metadata
</span><span class="hs-identifier hs-var">BranchUtil.getTermMetadataAt</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405108"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405114"><span class="hs-identifier hs-var">srcTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405106"><span class="hs-identifier hs-var">root0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-var">stepManyAt</span></a></span><span>
</span><span id="line-879"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405109"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-880"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- Mitchell: throwing away any hash-qualification here seems wrong!</span><span>
</span><span id="line-881"></span><span>                  </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteTermName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter HQSplit Split HQSegment NameSegment
-&gt; (HQSegment -&gt; NameSegment) -&gt; HQSplit -&gt; Split
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter HQSplit Split HQSegment NameSegment
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; NameSegment
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405108"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405114"><span class="hs-identifier hs-var">srcTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-882"></span><span>                  </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTermName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405111"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405114"><span class="hs-identifier hs-var">srcTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679405107"><span class="hs-identifier hs-var">srcMetadata</span></a></span><span>
</span><span id="line-883"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-884"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-885"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MoveTypeI"><span class="hs-identifier hs-type">MoveTypeI</span></a></span><span> </span><span id="local-6989586621679405104"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405104"><span class="hs-identifier hs-var">src'</span></a></span></span><span> </span><span id="local-6989586621679405103"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405103"><span class="hs-identifier hs-var">dest'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-886"></span><span>              </span><span id="local-6989586621679405102"><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405102"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r (Absolute, HQSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405104"><span class="hs-identifier hs-var">src'</span></a></span><span>
</span><span id="line-887"></span><span>              </span><span id="local-6989586621679405101"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405101"><span class="hs-identifier hs-var">srcTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="Unison.Cli.MonadUtils.html#getTypesAt"><span class="hs-identifier hs-var">Cli.getTypesAt</span></a></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405102"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-888"></span><span>              </span><span id="local-6989586621679405100"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405100"><span class="hs-identifier hs-var">srcType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-889"></span><span>                </span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe Reference
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405101"><span class="hs-identifier hs-var">srcTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Reference
-&gt; (Maybe Reference -&gt; Cli r Reference) -&gt; Cli r Reference
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Reference -&gt; Maybe Reference -&gt; Cli r Reference
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-890"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405101"><span class="hs-identifier hs-var">srcTypes</span></a></span><span>
</span><span id="line-891"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Reference
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TypeNotFound"><span class="hs-identifier hs-var">TypeNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405104"><span class="hs-identifier hs-var">src'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-892"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-893"></span><span>                      </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405099"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405099"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-894"></span><span>                      </span><span id="local-6989586621679405098"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405098"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405099"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>                      </span><span class="annot"><span class="annottext">Output -&gt; Cli r Reference
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; HQSplit' -&gt; Set Referent -&gt; Set Reference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DeleteNameAmbiguous"><span class="hs-identifier hs-var">DeleteNameAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405098"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405104"><span class="hs-identifier hs-var">src'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405101"><span class="hs-identifier hs-var">srcTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-896"></span><span>              </span><span id="local-6989586621679405097"><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405097"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405103"><span class="hs-identifier hs-var">dest'</span></a></span><span>
</span><span id="line-897"></span><span>              </span><span id="local-6989586621679405096"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405096"><span class="hs-identifier hs-var">destTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="Unison.Cli.MonadUtils.html#getTypesAt"><span class="hs-identifier hs-var">Cli.getTypesAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; (Absolute, HQSegment)
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405097"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-898"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405096"><span class="hs-identifier hs-var">destTypes</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-899"></span><span>                </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath -&gt; Set Reference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TypeAlreadyExists"><span class="hs-identifier hs-var">TypeAlreadyExists</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679405103"><span class="hs-identifier hs-var">dest'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405096"><span class="hs-identifier hs-var">destTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-900"></span><span>              </span><span id="local-6989586621679405095"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405095"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-901"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405094"><span class="annot"><span class="annottext">p :: HQSplit
</span><a href="#local-6989586621679405094"><span class="hs-identifier hs-var hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; HQSplit
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405102"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-902"></span><span>              </span><span id="local-6989586621679405093"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679405093"><span class="hs-identifier hs-var">srcMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-903"></span><span>                </span><span id="local-6989586621679405092"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405092"><span class="hs-identifier hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-904"></span><span>                </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit -&gt; Reference -&gt; Branch0 IO -&gt; Metadata
forall a (m :: * -&gt; *).
(Path, a) -&gt; Reference -&gt; Branch0 m -&gt; Metadata
</span><span class="hs-identifier hs-var">BranchUtil.getTypeMetadataAt</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405094"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405100"><span class="hs-identifier hs-var">srcType</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405092"><span class="hs-identifier hs-var">root0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-905"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-var">stepManyAt</span></a></span><span>
</span><span id="line-906"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405095"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-907"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- Mitchell: throwing away any hash-qualification here seems wrong!</span><span>
</span><span id="line-908"></span><span>                  </span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Reference -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteTypeName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter HQSplit Split HQSegment NameSegment
-&gt; (HQSegment -&gt; NameSegment) -&gt; HQSplit -&gt; Split
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter HQSplit Split HQSegment NameSegment
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; NameSegment
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679405094"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405100"><span class="hs-identifier hs-var">srcType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-909"></span><span>                  </span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTypeName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, NameSegment)
</span><a href="#local-6989586621679405097"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405100"><span class="hs-identifier hs-var">srcType</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679405093"><span class="hs-identifier hs-var">srcMetadata</span></a></span><span>
</span><span id="line-910"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-911"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-912"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteI"><span class="hs-identifier hs-type">DeleteI</span></a></span><span> </span><span id="local-6989586621679405090"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405090"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((Absolute, HQSegment) -&gt; Cli r (Set Referent))
-&gt; ((Absolute, HQSegment) -&gt; Cli r (Set Reference))
-&gt; HQSplit'
-&gt; Cli r ()
forall r.
((Absolute, HQSegment) -&gt; Cli r (Set Referent))
-&gt; ((Absolute, HQSegment) -&gt; Cli r (Set Reference))
-&gt; HQSplit'
-&gt; Cli r ()
</span><a href="#local-6989586621679405683"><span class="hs-identifier hs-var">delete</span></a></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="Unison.Cli.MonadUtils.html#getTermsAt"><span class="hs-identifier hs-var">Cli.getTermsAt</span></a></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="Unison.Cli.MonadUtils.html#getTypesAt"><span class="hs-identifier hs-var">Cli.getTypesAt</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405090"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-913"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteTypeI"><span class="hs-identifier hs-type">DeleteTypeI</span></a></span><span> </span><span id="local-6989586621679405088"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405088"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((Absolute, HQSegment) -&gt; Cli r (Set Referent))
-&gt; ((Absolute, HQSegment) -&gt; Cli r (Set Reference))
-&gt; HQSplit'
-&gt; Cli r ()
forall r.
((Absolute, HQSegment) -&gt; Cli r (Set Referent))
-&gt; ((Absolute, HQSegment) -&gt; Cli r (Set Reference))
-&gt; HQSplit'
-&gt; Cli r ()
</span><a href="#local-6989586621679405683"><span class="hs-identifier hs-var">delete</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cli r (Set Referent)
-&gt; (Absolute, HQSegment) -&gt; Cli r (Set Referent)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; Cli r (Set Referent)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="Unison.Cli.MonadUtils.html#getTypesAt"><span class="hs-identifier hs-var">Cli.getTypesAt</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405088"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-914"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteTermI"><span class="hs-identifier hs-type">DeleteTermI</span></a></span><span> </span><span id="local-6989586621679405086"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405086"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((Absolute, HQSegment) -&gt; Cli r (Set Referent))
-&gt; ((Absolute, HQSegment) -&gt; Cli r (Set Reference))
-&gt; HQSplit'
-&gt; Cli r ()
forall r.
((Absolute, HQSegment) -&gt; Cli r (Set Referent))
-&gt; ((Absolute, HQSegment) -&gt; Cli r (Set Reference))
-&gt; HQSplit'
-&gt; Cli r ()
</span><a href="#local-6989586621679405683"><span class="hs-identifier hs-var">delete</span></a></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="Unison.Cli.MonadUtils.html#getTermsAt"><span class="hs-identifier hs-var">Cli.getTermsAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cli r (Set Reference)
-&gt; (Absolute, HQSegment) -&gt; Cli r (Set Reference)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Cli r (Set Reference)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405086"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-915"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DisplayI"><span class="hs-identifier hs-type">DisplayI</span></a></span><span> </span><span id="local-6989586621679405084"><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679405084"><span class="hs-identifier hs-var">outputLoc</span></a></span></span><span> </span><span id="local-6989586621679405083"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405083"><span class="hs-identifier hs-var">names'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-916"></span><span>              </span><span id="local-6989586621679405082"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405082"><span class="hs-identifier hs-var">currentBranch0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-917"></span><span>              </span><span id="local-6989586621679405081"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405081"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#getBasicPrettyPrintNames"><span class="hs-identifier hs-var">getBasicPrettyPrintNames</span></a></span><span>
</span><span id="line-918"></span><span>              </span><span id="local-6989586621679405080"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405080"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405083"><span class="hs-identifier hs-var">names'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-919"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-920"></span><span>                  </span><span class="annot"><span class="annottext">Position -&gt; Branch0 IO -&gt; Cli r (Maybe [HashQualified Name])
forall (m :: * -&gt; *) (m0 :: * -&gt; *).
MonadIO m =&gt;
Position -&gt; Branch0 m0 -&gt; m (Maybe [HashQualified Name])
</span><a href="Unison.Codebase.Editor.HandleInput.html#fuzzySelectDefinition"><span class="hs-identifier hs-var">fuzzySelectDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">Absolute</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405082"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe [HashQualified Name])
-&gt; (Cli r (Maybe [HashQualified Name])
    -&gt; Cli r [HashQualified Name])
-&gt; Cli r [HashQualified Name]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r [HashQualified Name]
-&gt; Cli r (Maybe [HashQualified Name]) -&gt; Cli r [HashQualified Name]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><span class="hs-identifier hs-var">onNothingM</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-921"></span><span>                    </span><span class="annot"><span class="annottext">Output -&gt; Cli r [HashQualified Name]
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputPattern -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#HelpMessage"><span class="hs-identifier hs-var">HelpMessage</span></a></span><span> </span><span class="annot"><span class="annottext">InputPattern
</span><a href="Unison.CommandLine.InputPatterns.html#display"><span class="hs-identifier hs-var">InputPatterns.display</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>                </span><span id="local-6989586621679405078"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405078"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Cli r [HashQualified Name]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405078"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-923"></span><span>              </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Cli r ())
-&gt; [HashQualified Name] -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; OutputLocation -&gt; HashQualified Name -&gt; Cli r ()
forall r. Names -&gt; OutputLocation -&gt; HashQualified Name -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayI"><span class="hs-identifier hs-var">displayI</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679405081"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679405084"><span class="hs-identifier hs-var">outputLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405080"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-924"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ShowDefinitionI"><span class="hs-identifier hs-type">ShowDefinitionI</span></a></span><span> </span><span id="local-6989586621679405075"><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679405075"><span class="hs-identifier hs-var">outputLoc</span></a></span></span><span> </span><span id="local-6989586621679405074"><span class="annot"><span class="annottext">ShowDefinitionScope
</span><a href="#local-6989586621679405074"><span class="hs-identifier hs-var">showDefinitionScope</span></a></span></span><span> </span><span id="local-6989586621679405073"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405073"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OutputLocation
-&gt; ShowDefinitionScope -&gt; [HashQualified Name] -&gt; Cli r ()
forall r.
OutputLocation
-&gt; ShowDefinitionScope -&gt; [HashQualified Name] -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleShowDefinition"><span class="hs-identifier hs-var">handleShowDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679405075"><span class="hs-identifier hs-var">outputLoc</span></a></span><span> </span><span class="annot"><span class="annottext">ShowDefinitionScope
</span><a href="#local-6989586621679405074"><span class="hs-identifier hs-var">showDefinitionScope</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679405073"><span class="hs-identifier hs-var">query</span></a></span><span>
</span><span id="line-925"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#FindPatchI"><span class="hs-identifier hs-var">FindPatchI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-926"></span><span>              </span><span id="local-6989586621679405070"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405070"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-927"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405069"><span class="annot"><span class="annottext">patches :: [Name]
</span><a href="#local-6989586621679405069"><span class="hs-identifier hs-var hs-var">patches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-928"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Name
</span><span class="hs-identifier hs-var">Path.unsafeToName</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Name) -&gt; Path -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameSegment -&gt; Path
</span><span class="hs-identifier hs-var">Path.snoc</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679405067"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405066"><span class="hs-identifier hs-var">seg</span></a></span><span>
</span><span id="line-929"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679405067"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679405067"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679405065"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405065"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; [(Path, Branch0 IO)]
forall (m :: * -&gt; *). Branch0 m -&gt; [(Path, Branch0 m)]
</span><span class="hs-identifier hs-var">Branch.toList0</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405070"><span class="hs-identifier hs-var">branch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-930"></span><span>                        </span><span class="hs-special">(</span><span id="local-6989586621679405066"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405066"><span class="hs-identifier hs-var">seg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Hash, IO Patch)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Hash, IO Patch)
-&gt; [(NameSegment, (Hash, IO Patch))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO -&gt; Map NameSegment (Hash, IO Patch)
forall (m :: * -&gt; *). Branch0 m -&gt; Map NameSegment (Hash, m Patch)
</span><span class="hs-identifier hs-var hs-var">Branch._edits</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405065"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-931"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-932"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ListOfPatches"><span class="hs-identifier hs-var">ListOfPatches</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Name -&gt; Output) -&gt; Set Name -&gt; Output
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; Set Name
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679405069"><span class="hs-identifier hs-var">patches</span></a></span><span class="hs-cpp">
              #numberedArgs .= fmap Name.toString patches
</span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FindShallowI"><span class="hs-identifier hs-type">FindShallowI</span></a></span><span> </span><span id="local-6989586621679405057"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405057"><span class="hs-identifier hs-var">pathArg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-935"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405056"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405056"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-936"></span><span>              </span><span id="local-6989586621679405055"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405055"><span class="hs-identifier hs-var">sbhLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.branchHashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405056"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>              </span><span id="local-6989586621679405054"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405054"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-938"></span><span>
</span><span id="line-939"></span><span>              </span><span id="local-6989586621679405053"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405053"><span class="hs-identifier hs-var">pathArgAbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405057"><span class="hs-identifier hs-var">pathArg</span></a></span><span>
</span><span id="line-940"></span><span>              </span><span id="local-6989586621679405052"><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679405052"><span class="hs-identifier hs-var">entries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [ShallowListEntry Symbol Ann]
-&gt; Cli r [ShallowListEntry Symbol Ann]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Maybe (Branch IO)
-&gt; Absolute
-&gt; IO [ShallowListEntry Symbol Ann]
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; Maybe (Branch m) -&gt; Absolute -&gt; m [ShallowListEntry Symbol Ann]
</span><span class="hs-identifier hs-var">Backend.lsAtPath</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405056"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Branch IO)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405053"><span class="hs-identifier hs-var">pathArgAbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>              </span><span class="hs-comment">-- caching the result as an absolute path, for easier jumping around</span><span class="hs-cpp">
              #numberedArgs .= fmap entryToHQString entries
</span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679405048"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnv
</span><a href="#local-6989586621679405048"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-944"></span><span>                    </span><span class="annot"><span class="annottext">Int -&gt; Branch IO -&gt; NameScoping -&gt; PrettyPrintEnv
forall (m :: * -&gt; *).
Int -&gt; Branch m -&gt; NameScoping -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">Backend.basicSuffixifiedNames</span></span><span>
</span><span id="line-945"></span><span>                      </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405055"><span class="hs-identifier hs-var">sbhLength</span></a></span><span>
</span><span id="line-946"></span><span>                      </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679405054"><span class="hs-identifier hs-var">rootBranch</span></a></span><span>
</span><span id="line-947"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.AllNames</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679405053"><span class="hs-identifier hs-var">pathArgAbs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; [ShallowListEntry Symbol Ann] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ListShallow"><span class="hs-identifier hs-var">ListShallow</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679405048"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">[ShallowListEntry Symbol Ann]
</span><a href="#local-6989586621679405052"><span class="hs-identifier hs-var">entries</span></a></span><span>
</span><span id="line-949"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-950"></span><span>                </span><span id="local-6989586621679406813"><span class="annot"><a href="#local-6989586621679405049"><span class="hs-identifier hs-type">entryToHQString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShallowListEntry</span></span><span> </span><span class="annot"><a href="#local-6989586621679406813"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span><span>
</span><span id="line-951"></span><span>                </span><span id="local-6989586621679405049"><span class="annot"><span class="annottext">entryToHQString :: ShallowListEntry v Ann -&gt; String
</span><a href="#local-6989586621679405049"><span class="hs-identifier hs-var hs-var">entryToHQString</span></a></span></span><span> </span><span id="local-6989586621679405044"><span class="annot"><span class="annottext">ShallowListEntry v Ann
</span><a href="#local-6989586621679405044"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-952"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621679405043"><span class="hs-identifier hs-var">fixup</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShallowListEntry v Ann
</span><a href="#local-6989586621679405044"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-953"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">ShallowTypeEntry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypeEntry</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679405040"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679405040"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="annot"><span class="annottext">TypeTag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ'.toString</span></span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679405040"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-954"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">ShallowTermEntry</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TermEntry</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679405036"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679405036"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type v Ann)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe TermTag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ'.toString</span></span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679405036"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-955"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">ShallowBranchEntry</span></span><span> </span><span id="local-6989586621679405034"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405034"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NamespaceStats
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; String
</span><span class="hs-identifier hs-var">NameSegment.toString</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405034"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-956"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">ShallowPatchEntry</span></span><span> </span><span id="local-6989586621679405031"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405031"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; String
</span><span class="hs-identifier hs-var">NameSegment.toString</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679405031"><span class="hs-identifier hs-var">ns</span></a></span><span>
</span><span id="line-957"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-958"></span><span>                    </span><span id="local-6989586621679405043"><span class="annot"><span class="annottext">fixup :: String -&gt; String
</span><a href="#local-6989586621679405043"><span class="hs-identifier hs-var hs-var">fixup</span></a></span></span><span> </span><span id="local-6989586621679405030"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405030"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405029"><span class="hs-identifier hs-var">pathArgStr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-959"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405030"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-960"></span><span>                      </span><span id="local-6989586621679405028"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405028"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String -&gt; Char
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405028"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405028"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405030"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-961"></span><span>                      </span><span id="local-6989586621679405026"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405026"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405026"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679405030"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-962"></span><span>                    </span><span id="local-6989586621679405029"><span class="annot"><span class="annottext">pathArgStr :: String
</span><a href="#local-6989586621679405029"><span class="hs-identifier hs-var hs-var">pathArgStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679405057"><span class="hs-identifier hs-var">pathArg</span></a></span><span>
</span><span id="line-963"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FindI"><span class="hs-identifier hs-type">FindI</span></a></span><span> </span><span id="local-6989586621679405024"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405024"><span class="hs-identifier hs-var">isVerbose</span></a></span></span><span> </span><span id="local-6989586621679405023"><span class="annot"><span class="annottext">FindScope
</span><a href="#local-6989586621679405023"><span class="hs-identifier hs-var">fscope</span></a></span></span><span> </span><span id="local-6989586621679405022"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679405022"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; FindScope -&gt; [String] -&gt; Input -&gt; Cli r ()
forall r. Bool -&gt; FindScope -&gt; [String] -&gt; Input -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleFindI"><span class="hs-identifier hs-var">handleFindI</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679405024"><span class="hs-identifier hs-var">isVerbose</span></a></span><span> </span><span class="annot"><span class="annottext">FindScope
</span><a href="#local-6989586621679405023"><span class="hs-identifier hs-var">fscope</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679405022"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-964"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ResolveTypeNameI"><span class="hs-identifier hs-type">ResolveTypeNameI</span></a></span><span> </span><span id="local-6989586621679405019"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405019"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-965"></span><span>              </span><span id="local-6989586621679405018"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405018"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-966"></span><span>              </span><span id="local-6989586621679405017"><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405017"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r (Absolute, HQSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405019"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-967"></span><span>              </span><span id="local-6989586621679405016"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405016"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-968"></span><span>                </span><span id="local-6989586621679405015"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405015"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="Unison.Cli.MonadUtils.html#getTypesAt"><span class="hs-identifier hs-var">Cli.getTypesAt</span></a></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405017"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-969"></span><span>                </span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe Reference
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405015"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Reference
-&gt; (Maybe Reference -&gt; Cli r Reference) -&gt; Cli r Reference
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Reference -&gt; Maybe Reference -&gt; Cli r Reference
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-970"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405015"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-971"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Reference
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TypeNotFound"><span class="hs-identifier hs-var">TypeNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405019"><span class="hs-identifier hs-var">path'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-972"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-973"></span><span>                      </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405014"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405014"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-974"></span><span>                      </span><span id="local-6989586621679405013"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405013"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405014"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-975"></span><span>                      </span><span class="annot"><span class="annottext">Output -&gt; Cli r Reference
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; HQSplit' -&gt; Set Referent -&gt; Set Reference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DeleteNameAmbiguous"><span class="hs-identifier hs-var">DeleteNameAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405013"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405019"><span class="hs-identifier hs-var">path'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679405015"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-976"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall r. Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt"><span class="hs-identifier hs-var">stepAt</span></a></span><span>
</span><span id="line-977"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405018"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-978"></span><span>                </span><span class="hs-comment">-- Mitchell: throwing away HQ seems wrong</span><span>
</span><span id="line-979"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Reference -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteTypeName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter
  (Absolute, HQSegment) (Absolute, NameSegment) HQSegment NameSegment
-&gt; (HQSegment -&gt; NameSegment)
-&gt; (Absolute, HQSegment)
-&gt; (Absolute, NameSegment)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Absolute, HQSegment) (Absolute, NameSegment) HQSegment NameSegment
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; NameSegment
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405017"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679405016"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-980"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ResolveTermNameI"><span class="hs-identifier hs-type">ResolveTermNameI</span></a></span><span> </span><span id="local-6989586621679405011"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405011"><span class="hs-identifier hs-var">path'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-981"></span><span>              </span><span id="local-6989586621679405010"><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405010"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r (Absolute, HQSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405011"><span class="hs-identifier hs-var">path'</span></a></span><span>
</span><span id="line-982"></span><span>              </span><span id="local-6989586621679405009"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405009"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-983"></span><span>                </span><span id="local-6989586621679405008"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405008"><span class="hs-identifier hs-var">rootBranch0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-984"></span><span>                </span><span id="local-6989586621679405007"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405007"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit -&gt; Branch0 IO -&gt; Cli r (Set Referent)
forall (m :: * -&gt; *) r.
Monad m =&gt;
HQSplit -&gt; Branch0 m -&gt; Cli r (Set Referent)
</span><a href="Unison.Codebase.Editor.HandleInput.html#getTermsIncludingHistorical"><span class="hs-identifier hs-var">getTermsIncludingHistorical</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; HQSplit
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405010"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679405008"><span class="hs-identifier hs-var">rootBranch0</span></a></span><span>
</span><span id="line-985"></span><span>                </span><span class="annot"><span class="annottext">Set Referent -&gt; Maybe Referent
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405007"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-986"></span><span>                  </span><span class="annot"><span class="annottext">Maybe Referent
-&gt; (Maybe Referent -&gt; Cli r Referent) -&gt; Cli r Referent
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Referent -&gt; Maybe Referent -&gt; Cli r Referent
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span>
</span><span id="line-987"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405007"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-988"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Referent
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TermNotFound"><span class="hs-identifier hs-var">TermNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405011"><span class="hs-identifier hs-var">path'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-989"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-990"></span><span>                        </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679405005"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679405005"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-991"></span><span>                        </span><span id="local-6989586621679405004"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405004"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679405005"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-992"></span><span>                        </span><span class="annot"><span class="annottext">Output -&gt; Cli r Referent
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; HQSplit' -&gt; Set Referent -&gt; Set Reference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DeleteNameAmbiguous"><span class="hs-identifier hs-var">DeleteNameAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679405004"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679405011"><span class="hs-identifier hs-var">path'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405007"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-993"></span><span>              </span><span id="local-6989586621679405003"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405003"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-994"></span><span>              </span><span id="local-6989586621679405002"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405002"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="Unison.Cli.MonadUtils.html#getTermsAt"><span class="hs-identifier hs-var">Cli.getTermsAt</span></a></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405010"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-995"></span><span>              </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679405002"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-996"></span><span>                </span><span class="annot"><span class="annottext">Set Referent -&gt; (Set Referent -&gt; Set Referent) -&gt; Set Referent
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Set Referent -&gt; Set Referent
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679405009"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-997"></span><span>                </span><span class="annot"><span class="annottext">Set Referent -&gt; (Set Referent -&gt; [Referent]) -&gt; [Referent]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span>
</span><span id="line-998"></span><span>                </span><span class="hs-comment">-- Mitchell: throwing away HQ seems wrong</span><span>
</span><span id="line-999"></span><span>                </span><span class="annot"><span class="annottext">[Referent]
-&gt; ([Referent] -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)])
-&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; (Path, Branch0 IO -&gt; Branch0 IO))
-&gt; [Referent] -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; (Path, Branch0 IO -&gt; Branch0 IO)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteTermName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Absolute, NameSegment) -&gt; Split
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ASetter
  (Absolute, HQSegment) (Absolute, NameSegment) HQSegment NameSegment
-&gt; (HQSegment -&gt; NameSegment)
-&gt; (Absolute, HQSegment)
-&gt; (Absolute, NameSegment)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Absolute, HQSegment) (Absolute, NameSegment) HQSegment NameSegment
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; NameSegment
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment)
</span><a href="#local-6989586621679405010"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1000"></span><span>                </span><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; Branch0 IO)]
-&gt; ([(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()) -&gt; Cli r ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-var">stepManyAt</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679405003"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-1001"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ReplaceI"><span class="hs-identifier hs-type">ReplaceI</span></a></span><span> </span><span id="local-6989586621679404999"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404999"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621679404998"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404998"><span class="hs-identifier hs-var">to</span></a></span></span><span> </span><span id="local-6989586621679404997"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404997"><span class="hs-identifier hs-var">patchPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1002"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404996"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404996"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1003"></span><span>              </span><span id="local-6989586621679404995"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404995"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404996"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404994"><span class="annot"><span class="annottext">patchPath' :: PatchPath
</span><a href="#local-6989586621679404994"><span class="hs-identifier hs-var hs-var">patchPath'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Maybe PatchPath -&gt; PatchPath
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="Unison.Cli.MonadUtils.html#defaultPatchPath"><span class="hs-identifier hs-var">Cli.defaultPatchPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404997"><span class="hs-identifier hs-var">patchPath</span></a></span><span>
</span><span id="line-1006"></span><span>              </span><span id="local-6989586621679404993"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404993"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Patch
forall r. PatchPath -&gt; Cli r Patch
</span><a href="Unison.Cli.MonadUtils.html#getPatchAt"><span class="hs-identifier hs-var">Cli.getPatchAt</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404994"><span class="hs-identifier hs-var">patchPath'</span></a></span><span>
</span><span id="line-1007"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">QueryResult</span></span><span> </span><span id="local-6989586621679404992"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404992"><span class="hs-identifier hs-var">fromMisses'</span></a></span></span><span> </span><span id="local-6989586621679404991"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404991"><span class="hs-identifier hs-var">fromHits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Cli r QueryResult
forall r. [HashQualified Name] -&gt; Cli r QueryResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#hqNameQuery"><span class="hs-identifier hs-var">hqNameQuery</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404999"><span class="hs-identifier hs-var">from</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1008"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">QueryResult</span></span><span> </span><span id="local-6989586621679404990"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404990"><span class="hs-identifier hs-var">toMisses'</span></a></span></span><span> </span><span id="local-6989586621679404989"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404989"><span class="hs-identifier hs-var">toHits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Cli r QueryResult
forall r. [HashQualified Name] -&gt; Cli r QueryResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#hqNameQuery"><span class="hs-identifier hs-var">hqNameQuery</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404998"><span class="hs-identifier hs-var">to</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1009"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404988"><span class="annot"><span class="annottext">termsFromRefs :: [Reference]
</span><a href="#local-6989586621679404988"><span class="hs-identifier hs-var hs-var">termsFromRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [Reference]
</span><a href="#local-6989586621679405754"><span class="hs-identifier hs-var">termReferences</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404991"><span class="hs-identifier hs-var">fromHits</span></a></span><span>
</span><span id="line-1010"></span><span>                  </span><span id="local-6989586621679404987"><span class="annot"><span class="annottext">termsToRefs :: [Reference]
</span><a href="#local-6989586621679404987"><span class="hs-identifier hs-var hs-var">termsToRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [Reference]
</span><a href="#local-6989586621679405754"><span class="hs-identifier hs-var">termReferences</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404989"><span class="hs-identifier hs-var">toHits</span></a></span><span>
</span><span id="line-1011"></span><span>                  </span><span id="local-6989586621679404986"><span class="annot"><span class="annottext">typesFromRefs :: [Reference]
</span><a href="#local-6989586621679404986"><span class="hs-identifier hs-var hs-var">typesFromRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [Reference]
</span><a href="#local-6989586621679405759"><span class="hs-identifier hs-var">typeReferences</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404991"><span class="hs-identifier hs-var">fromHits</span></a></span><span>
</span><span id="line-1012"></span><span>                  </span><span id="local-6989586621679404985"><span class="annot"><span class="annottext">typesToRefs :: [Reference]
</span><a href="#local-6989586621679404985"><span class="hs-identifier hs-var hs-var">typesToRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [Reference]
</span><a href="#local-6989586621679405759"><span class="hs-identifier hs-var">typeReferences</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404989"><span class="hs-identifier hs-var">toHits</span></a></span><span>
</span><span id="line-1013"></span><span>                  </span><span class="hs-comment">--- Here are all the kinds of misses</span><span>
</span><span id="line-1014"></span><span>                  </span><span class="hs-comment">--- [X] [X]</span><span>
</span><span id="line-1015"></span><span>                  </span><span class="hs-comment">--- [Type] [Term]</span><span>
</span><span id="line-1016"></span><span>                  </span><span class="hs-comment">--- [Term] [Type]</span><span>
</span><span id="line-1017"></span><span>                  </span><span class="hs-comment">--- [Type] [X]</span><span>
</span><span id="line-1018"></span><span>                  </span><span class="hs-comment">--- [Term] [X]</span><span>
</span><span id="line-1019"></span><span>                  </span><span class="hs-comment">--- [X] [Type]</span><span>
</span><span id="line-1020"></span><span>                  </span><span class="hs-comment">--- [X] [Term]</span><span>
</span><span id="line-1021"></span><span>                  </span><span class="hs-comment">-- Type hits are term misses</span><span>
</span><span id="line-1022"></span><span>                  </span><span id="local-6989586621679404984"><span class="annot"><span class="annottext">termFromMisses :: [HashQualified Name]
</span><a href="#local-6989586621679404984"><span class="hs-identifier hs-var hs-var">termFromMisses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404992"><span class="hs-identifier hs-var">fromMisses'</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeResult -&gt; HashQualified Name
</span><span class="hs-identifier hs-var hs-var">SR.typeName</span></span><span> </span><span class="annot"><span class="annottext">(TypeResult -&gt; HashQualified Name)
-&gt; [TypeResult] -&gt; [HashQualified Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [TypeResult]
</span><a href="#local-6989586621679405745"><span class="hs-identifier hs-var">typeResults</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404991"><span class="hs-identifier hs-var">fromHits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1023"></span><span>                  </span><span id="local-6989586621679404983"><span class="annot"><span class="annottext">termToMisses :: [HashQualified Name]
</span><a href="#local-6989586621679404983"><span class="hs-identifier hs-var hs-var">termToMisses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404990"><span class="hs-identifier hs-var">toMisses'</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeResult -&gt; HashQualified Name
</span><span class="hs-identifier hs-var hs-var">SR.typeName</span></span><span> </span><span class="annot"><span class="annottext">(TypeResult -&gt; HashQualified Name)
-&gt; [TypeResult] -&gt; [HashQualified Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [TypeResult]
</span><a href="#local-6989586621679405745"><span class="hs-identifier hs-var">typeResults</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404989"><span class="hs-identifier hs-var">toHits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span>                  </span><span class="hs-comment">-- Term hits are type misses</span><span>
</span><span id="line-1025"></span><span>                  </span><span id="local-6989586621679404982"><span class="annot"><span class="annottext">typeFromMisses :: [HashQualified Name]
</span><a href="#local-6989586621679404982"><span class="hs-identifier hs-var hs-var">typeFromMisses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404992"><span class="hs-identifier hs-var">fromMisses'</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermResult -&gt; HashQualified Name
</span><span class="hs-identifier hs-var hs-var">SR.termName</span></span><span> </span><span class="annot"><span class="annottext">(TermResult -&gt; HashQualified Name)
-&gt; [TermResult] -&gt; [HashQualified Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [TermResult]
</span><a href="#local-6989586621679405748"><span class="hs-identifier hs-var">termResults</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404991"><span class="hs-identifier hs-var">fromHits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1026"></span><span>                  </span><span id="local-6989586621679404981"><span class="annot"><span class="annottext">typeToMisses :: [HashQualified Name]
</span><a href="#local-6989586621679404981"><span class="hs-identifier hs-var hs-var">typeToMisses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404990"><span class="hs-identifier hs-var">toMisses'</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TermResult -&gt; HashQualified Name
</span><span class="hs-identifier hs-var hs-var">SR.termName</span></span><span> </span><span class="annot"><span class="annottext">(TermResult -&gt; HashQualified Name)
-&gt; [TermResult] -&gt; [HashQualified Name]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [TermResult]
</span><a href="#local-6989586621679405748"><span class="hs-identifier hs-var">termResults</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404989"><span class="hs-identifier hs-var">toHits</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1027"></span><span>
</span><span id="line-1028"></span><span>                  </span><span id="local-6989586621679404980"><span class="annot"><span class="annottext">termMisses :: [HashQualified Name]
</span><a href="#local-6989586621679404980"><span class="hs-identifier hs-var hs-var">termMisses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404984"><span class="hs-identifier hs-var">termFromMisses</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404983"><span class="hs-identifier hs-var">termToMisses</span></a></span><span>
</span><span id="line-1029"></span><span>                  </span><span id="local-6989586621679404979"><span class="annot"><span class="annottext">typeMisses :: [HashQualified Name]
</span><a href="#local-6989586621679404979"><span class="hs-identifier hs-var hs-var">typeMisses</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404982"><span class="hs-identifier hs-var">typeFromMisses</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404981"><span class="hs-identifier hs-var">typeToMisses</span></a></span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span>                  </span><span id="local-6989586621679406784"><span class="annot"><a href="#local-6989586621679404978"><span class="hs-identifier hs-type">replaceTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406784"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1032"></span><span>                  </span><span id="local-6989586621679404978"><span class="annot"><span class="annottext">replaceTerms :: Reference -&gt; Reference -&gt; Cli r ()
</span><a href="#local-6989586621679404978"><span class="hs-identifier hs-var hs-var">replaceTerms</span></a></span></span><span> </span><span id="local-6989586621679404977"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404977"><span class="hs-identifier hs-var">fr</span></a></span></span><span> </span><span id="local-6989586621679404976"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404976"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1033"></span><span>                    </span><span id="local-6989586621679404975"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679404975"><span class="hs-identifier hs-var">mft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a.
(Applicative m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Reference -&gt; m (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404996"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404977"><span class="hs-identifier hs-var">fr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1034"></span><span>                    </span><span id="local-6989586621679404973"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679404973"><span class="hs-identifier hs-var">mtt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a.
(Applicative m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Reference -&gt; m (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404996"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404976"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1035"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404972"><span class="annot"><span class="annottext">termNotFound :: Reference -&gt; Cli r (Type Symbol Ann)
</span><a href="#local-6989586621679404972"><span class="hs-identifier hs-var hs-var">termNotFound</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1036"></span><span>                          </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Type Symbol Ann)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span>
</span><span id="line-1037"></span><span>                            </span><span class="annot"><span class="annottext">(Output -&gt; Cli r (Type Symbol Ann))
-&gt; (Reference -&gt; Output) -&gt; Reference -&gt; Cli r (Type Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TermNotFound%27"><span class="hs-identifier hs-var">TermNotFound'</span></a></span><span>
</span><span id="line-1038"></span><span>                            </span><span class="annot"><span class="annottext">(ShortHash -&gt; Output)
-&gt; (Reference -&gt; ShortHash) -&gt; Reference -&gt; Output
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ShortHash -&gt; ShortHash
</span><span class="hs-identifier hs-var">SH.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404995"><span class="hs-identifier hs-var">hqLength</span></a></span><span>
</span><span id="line-1039"></span><span>                            </span><span class="annot"><span class="annottext">(ShortHash -&gt; ShortHash)
-&gt; (Reference -&gt; ShortHash) -&gt; Reference -&gt; ShortHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span>
</span><span id="line-1040"></span><span>                    </span><span id="local-6989586621679404969"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404969"><span class="hs-identifier hs-var">ft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679404975"><span class="hs-identifier hs-var">mft</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
-&gt; (Maybe (Type Symbol Ann) -&gt; Cli r (Type Symbol Ann))
-&gt; Cli r (Type Symbol Ann)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Type Symbol Ann)
-&gt; Maybe (Type Symbol Ann) -&gt; Cli r (Type Symbol Ann)
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Cli r (Type Symbol Ann)
</span><a href="#local-6989586621679404972"><span class="hs-identifier hs-var">termNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404977"><span class="hs-identifier hs-var">fr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1041"></span><span>                    </span><span id="local-6989586621679404968"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404968"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679404973"><span class="hs-identifier hs-var">mtt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
-&gt; (Maybe (Type Symbol Ann) -&gt; Cli r (Type Symbol Ann))
-&gt; Cli r (Type Symbol Ann)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Type Symbol Ann)
-&gt; Maybe (Type Symbol Ann) -&gt; Cli r (Type Symbol Ann)
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Cli r (Type Symbol Ann)
</span><a href="#local-6989586621679404972"><span class="hs-identifier hs-var">termNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404976"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404967"><span class="annot"><span class="annottext">patch' :: Patch
</span><a href="#local-6989586621679404967"><span class="hs-identifier hs-var hs-var">patch'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1043"></span><span>                          </span><span class="hs-comment">-- The modified patch</span><span>
</span><span id="line-1044"></span><span>                          </span><span class="annot"><span class="annottext">ASetter
  Patch
  Patch
  (Relation Reference TermEdit)
  (Relation Reference TermEdit)
-&gt; (Relation Reference TermEdit -&gt; Relation Reference TermEdit)
-&gt; Patch
-&gt; Patch
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span>
</span><span id="line-1045"></span><span>                            </span><span class="annot"><span class="annottext">ASetter
  Patch
  Patch
  (Relation Reference TermEdit)
  (Relation Reference TermEdit)
Lens' Patch (Relation Reference TermEdit)
</span><span class="hs-identifier hs-var">Patch.termEdits</span></span><span>
</span><span id="line-1046"></span><span>                            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Reference
-&gt; TermEdit
-&gt; Relation Reference TermEdit
-&gt; Relation Reference TermEdit
forall a b.
(Ord a, Ord b) =&gt;
a -&gt; b -&gt; Relation a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.insert</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404977"><span class="hs-identifier hs-var">fr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Typing -&gt; TermEdit
</span><span class="hs-identifier hs-var">Replace</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404976"><span class="hs-identifier hs-var">tr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Type Symbol Ann -&gt; Typing
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Typing
</span><span class="hs-identifier hs-var">TermEdit.typing</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404968"><span class="hs-identifier hs-var">tt</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404969"><span class="hs-identifier hs-var">ft</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1047"></span><span>                                </span><span class="annot"><span class="annottext">(Relation Reference TermEdit -&gt; Relation Reference TermEdit)
-&gt; (Relation Reference TermEdit -&gt; Relation Reference TermEdit)
-&gt; Relation Reference TermEdit
-&gt; Relation Reference TermEdit
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Reference
-&gt; Relation Reference TermEdit -&gt; Relation Reference TermEdit
forall a b. (Ord a, Ord b) =&gt; a -&gt; Relation a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.deleteDom</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404977"><span class="hs-identifier hs-var">fr</span></a></span><span>
</span><span id="line-1048"></span><span>                            </span><span class="hs-special">)</span><span>
</span><span id="line-1049"></span><span>                            </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404993"><span class="hs-identifier hs-var">patch</span></a></span><span>
</span><span id="line-1050"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621679404963"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404963"><span class="hs-identifier hs-var">patchPath''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404962"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679404962"><span class="hs-identifier hs-var">patchName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404994"><span class="hs-identifier hs-var">patchPath'</span></a></span><span>
</span><span id="line-1051"></span><span>                    </span><span class="annot"><span class="annottext">Path -&gt; NameSegment -&gt; Patch -&gt; Cli r ()
forall r. Path -&gt; NameSegment -&gt; Patch -&gt; Cli r ()
</span><a href="#local-6989586621679405698"><span class="hs-identifier hs-var">saveAndApplyPatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404963"><span class="hs-identifier hs-var">patchPath''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679404962"><span class="hs-identifier hs-var">patchName</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404967"><span class="hs-identifier hs-var">patch'</span></a></span><span>
</span><span id="line-1052"></span><span>
</span><span id="line-1053"></span><span>                  </span><span id="local-6989586621679404961"><span class="annot"><a href="#local-6989586621679404960"><span class="hs-identifier hs-type">replaceTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679404961"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1054"></span><span>                  </span><span id="local-6989586621679404960"><span class="annot"><span class="annottext">replaceTypes :: Reference -&gt; Reference -&gt; Cli r ()
</span><a href="#local-6989586621679404960"><span class="hs-identifier hs-var hs-var">replaceTypes</span></a></span></span><span> </span><span id="local-6989586621679404959"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404959"><span class="hs-identifier hs-var">fr</span></a></span></span><span> </span><span id="local-6989586621679404958"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404958"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1055"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404957"><span class="annot"><span class="annottext">patch' :: Patch
</span><a href="#local-6989586621679404957"><span class="hs-identifier hs-var hs-var">patch'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1056"></span><span>                          </span><span class="hs-comment">-- The modified patch</span><span>
</span><span id="line-1057"></span><span>                          </span><span class="annot"><span class="annottext">ASetter
  Patch
  Patch
  (Relation Reference TypeEdit)
  (Relation Reference TypeEdit)
-&gt; (Relation Reference TypeEdit -&gt; Relation Reference TypeEdit)
-&gt; Patch
-&gt; Patch
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span>
</span><span id="line-1058"></span><span>                            </span><span class="annot"><span class="annottext">ASetter
  Patch
  Patch
  (Relation Reference TypeEdit)
  (Relation Reference TypeEdit)
Lens' Patch (Relation Reference TypeEdit)
</span><span class="hs-identifier hs-var">Patch.typeEdits</span></span><span>
</span><span id="line-1059"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
-&gt; TypeEdit
-&gt; Relation Reference TypeEdit
-&gt; Relation Reference TypeEdit
forall a b.
(Ord a, Ord b) =&gt;
a -&gt; b -&gt; Relation a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.insert</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404959"><span class="hs-identifier hs-var">fr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; TypeEdit
</span><span class="hs-identifier hs-var">TypeEdit.Replace</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404958"><span class="hs-identifier hs-var">tr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Relation Reference TypeEdit -&gt; Relation Reference TypeEdit)
-&gt; (Relation Reference TypeEdit -&gt; Relation Reference TypeEdit)
-&gt; Relation Reference TypeEdit
-&gt; Relation Reference TypeEdit
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Reference
-&gt; Relation Reference TypeEdit -&gt; Relation Reference TypeEdit
forall a b. (Ord a, Ord b) =&gt; a -&gt; Relation a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.deleteDom</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404959"><span class="hs-identifier hs-var">fr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1060"></span><span>                            </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404993"><span class="hs-identifier hs-var">patch</span></a></span><span>
</span><span id="line-1061"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621679404955"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404955"><span class="hs-identifier hs-var">patchPath''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404954"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679404954"><span class="hs-identifier hs-var">patchName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r (Absolute, NameSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404994"><span class="hs-identifier hs-var">patchPath'</span></a></span><span>
</span><span id="line-1062"></span><span>                    </span><span class="annot"><span class="annottext">Path -&gt; NameSegment -&gt; Patch -&gt; Cli r ()
forall r. Path -&gt; NameSegment -&gt; Patch -&gt; Cli r ()
</span><a href="#local-6989586621679405698"><span class="hs-identifier hs-var">saveAndApplyPatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404955"><span class="hs-identifier hs-var">patchPath''</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679404954"><span class="hs-identifier hs-var">patchName</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404957"><span class="hs-identifier hs-var">patch'</span></a></span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span>                  </span><span id="local-6989586621679406782"><span id="local-6989586621679406783"><span class="annot"><a href="#local-6989586621679404953"><span class="hs-identifier hs-type">ambiguous</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406783"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406782"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1065"></span><span>                  </span><span id="local-6989586621679404953"><span class="annot"><span class="annottext">ambiguous :: HashQualified Name -&gt; [Reference] -&gt; Cli r a
</span><a href="#local-6989586621679404953"><span class="hs-identifier hs-var hs-var">ambiguous</span></a></span></span><span> </span><span id="local-6989586621679404952"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404952"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679404951"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404951"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1066"></span><span>                    </span><span class="annot"><span class="annottext">Output -&gt; Cli r a
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404952"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1067"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashOnly</span></span><span> </span><span id="local-6989586621679404950"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679404950"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Set Referent -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#HashAmbiguous"><span class="hs-identifier hs-var">HashAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679404950"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679404949"><span class="hs-identifier hs-var">rs'</span></a></span><span>
</span><span id="line-1068"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Either String HQSplit'
</span><span class="hs-identifier hs-var">Path.parseHQSplit'</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String HQSplit')
-&gt; (HashQualified Name -&gt; String)
-&gt; HashQualified Name
-&gt; Either String HQSplit'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ.toString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679404948"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404948"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; HQSplit' -&gt; Set Referent -&gt; Set Reference -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DeleteNameAmbiguous"><span class="hs-identifier hs-var">DeleteNameAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404995"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404948"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679404949"><span class="hs-identifier hs-var">rs'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-1069"></span><span>                      </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#BadName"><span class="hs-identifier hs-var">BadName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ.toString</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404952"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>                    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1071"></span><span>                      </span><span id="local-6989586621679404949"><span class="annot"><span class="annottext">rs' :: Set Referent
</span><a href="#local-6989586621679404949"><span class="hs-identifier hs-var hs-var">rs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Referent) -&gt; Set Reference -&gt; Set Referent
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Set Referent) -&gt; Set Reference -&gt; Set Referent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; Set Reference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404951"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span>                  </span><span id="local-6989586621679404946"><span class="annot"><span class="annottext">mismatch :: HashQualified Name -&gt; HashQualified Name -&gt; Cli r ()
</span><a href="#local-6989586621679404946"><span class="hs-identifier hs-var hs-var">mismatch</span></a></span></span><span> </span><span id="local-6989586621679404945"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404945"><span class="hs-identifier hs-var">typeName</span></a></span></span><span> </span><span id="local-6989586621679404944"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404944"><span class="hs-identifier hs-var">termName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; HashQualified Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TypeTermMismatch"><span class="hs-identifier hs-var">TypeTermMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404945"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404944"><span class="hs-identifier hs-var">termName</span></a></span><span>
</span><span id="line-1074"></span><span>
</span><span id="line-1075"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404988"><span class="hs-identifier hs-var">termsFromRefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404987"><span class="hs-identifier hs-var">termsToRefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404986"><span class="hs-identifier hs-var">typesFromRefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404985"><span class="hs-identifier hs-var">typesToRefs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1076"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SearchTermsNotFound"><span class="hs-identifier hs-var">SearchTermsNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404980"><span class="hs-identifier hs-var">termMisses</span></a></span><span>
</span><span id="line-1077"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; HashQualified Name -&gt; Cli r ()
forall r. HashQualified Name -&gt; HashQualified Name -&gt; Cli r ()
</span><a href="#local-6989586621679404946"><span class="hs-identifier hs-var">mismatch</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404998"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404999"><span class="hs-identifier hs-var">from</span></a></span><span>
</span><span id="line-1078"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; HashQualified Name -&gt; Cli r ()
forall r. HashQualified Name -&gt; HashQualified Name -&gt; Cli r ()
</span><a href="#local-6989586621679404946"><span class="hs-identifier hs-var">mismatch</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404999"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404998"><span class="hs-identifier hs-var">to</span></a></span><span>
</span><span id="line-1079"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SearchTermsNotFound"><span class="hs-identifier hs-var">SearchTermsNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404980"><span class="hs-identifier hs-var">termMisses</span></a></span><span>
</span><span id="line-1080"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SearchTermsNotFound"><span class="hs-identifier hs-var">SearchTermsNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404980"><span class="hs-identifier hs-var">termMisses</span></a></span><span>
</span><span id="line-1081"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SearchTermsNotFound"><span class="hs-identifier hs-var">SearchTermsNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404979"><span class="hs-identifier hs-var">typeMisses</span></a></span><span>
</span><span id="line-1082"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SearchTermsNotFound"><span class="hs-identifier hs-var">SearchTermsNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404979"><span class="hs-identifier hs-var">typeMisses</span></a></span><span>
</span><span id="line-1083"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span id="local-6989586621679404942"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404942"><span class="hs-identifier hs-var">fr</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679404941"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404941"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Cli r ()
forall r. Reference -&gt; Reference -&gt; Cli r ()
</span><a href="#local-6989586621679404978"><span class="hs-identifier hs-var">replaceTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404942"><span class="hs-identifier hs-var">fr</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404941"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-1084"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679404940"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404940"><span class="hs-identifier hs-var">fr</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679404939"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404939"><span class="hs-identifier hs-var">tr</span></a></span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Cli r ()
forall r. Reference -&gt; Reference -&gt; Cli r ()
</span><a href="#local-6989586621679404960"><span class="hs-identifier hs-var">replaceTypes</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404940"><span class="hs-identifier hs-var">fr</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404939"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-1085"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679404938"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404938"><span class="hs-identifier hs-var">froms</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [Reference] -&gt; Cli r ()
forall r a. HashQualified Name -&gt; [Reference] -&gt; Cli r a
</span><a href="#local-6989586621679404953"><span class="hs-identifier hs-var">ambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404999"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404938"><span class="hs-identifier hs-var">froms</span></a></span><span>
</span><span id="line-1086"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404937"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404937"><span class="hs-identifier hs-var">froms</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [Reference] -&gt; Cli r ()
forall r a. HashQualified Name -&gt; [Reference] -&gt; Cli r a
</span><a href="#local-6989586621679404953"><span class="hs-identifier hs-var">ambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404999"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404937"><span class="hs-identifier hs-var">froms</span></a></span><span>
</span><span id="line-1087"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404936"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404936"><span class="hs-identifier hs-var">tos</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [Reference] -&gt; Cli r ()
forall r a. HashQualified Name -&gt; [Reference] -&gt; Cli r a
</span><a href="#local-6989586621679404953"><span class="hs-identifier hs-var">ambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404998"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404936"><span class="hs-identifier hs-var">tos</span></a></span><span>
</span><span id="line-1088"></span><span>                </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404935"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404935"><span class="hs-identifier hs-var">tos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; [Reference] -&gt; Cli r ()
forall r a. HashQualified Name -&gt; [Reference] -&gt; Cli r a
</span><a href="#local-6989586621679404953"><span class="hs-identifier hs-var">ambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404998"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404935"><span class="hs-identifier hs-var">tos</span></a></span><span>
</span><span id="line-1089"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Cli r ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unpossible&quot;</span></span><span>
</span><span id="line-1090"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#LoadI"><span class="hs-identifier hs-type">LoadI</span></a></span><span> </span><span id="local-6989586621679404932"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679404932"><span class="hs-identifier hs-var">maybePath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1091"></span><span>              </span><span id="local-6989586621679404931"><span class="annot"><span class="annottext">Maybe (String, Bool)
</span><a href="#local-6989586621679404931"><span class="hs-identifier hs-var">latestFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (String, Bool))
forall r. Cli r (Maybe (String, Bool))
</span><a href="Unison.Cli.MonadUtils.html#getLatestFile"><span class="hs-identifier hs-var">Cli.getLatestFile</span></a></span><span>
</span><span id="line-1092"></span><span>              </span><span id="local-6989586621679404930"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404930"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679404932"><span class="hs-identifier hs-var">maybePath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Maybe String -&gt; Maybe String
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((String, Bool) -&gt; String) -&gt; Maybe (String, Bool) -&gt; Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (String, Bool)
</span><a href="#local-6989586621679404931"><span class="hs-identifier hs-var">latestFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; (Maybe String -&gt; Cli r String) -&gt; Cli r String
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r String -&gt; Maybe String -&gt; Cli r String
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Cli r String
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#NoUnisonFile"><span class="hs-identifier hs-var">NoUnisonFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1093"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404927"><span class="annot"><span class="annottext">Text -&gt; IO LoadSourceResult
$sel:loadSource:Env :: Env -&gt; Text -&gt; IO LoadSourceResult
loadSource :: Text -&gt; IO LoadSourceResult
</span><a href="Unison.Cli.Monad.html#%24sel%3AloadSource%3AEnv"><span class="hs-identifier hs-var hs-var">loadSource</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1094"></span><span>              </span><span id="local-6989586621679404925"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404925"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1095"></span><span>                </span><span class="annot"><span class="annottext">IO LoadSourceResult -&gt; Cli r LoadSourceResult
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; IO LoadSourceResult
</span><a href="#local-6989586621679404927"><span class="hs-identifier hs-var">loadSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404930"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r LoadSourceResult
-&gt; (LoadSourceResult -&gt; Cli r Text) -&gt; Cli r Text
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1096"></span><span>                  </span><span class="annot"><span class="annottext">LoadSourceResult
</span><a href="Unison.Cli.Monad.html#InvalidSourceNameError"><span class="hs-identifier hs-var">Cli.InvalidSourceNameError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Text
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r Text) -&gt; Output -&gt; Cli r Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#InvalidSourceName"><span class="hs-identifier hs-var">InvalidSourceName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404930"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1097"></span><span>                  </span><span class="annot"><span class="annottext">LoadSourceResult
</span><a href="Unison.Cli.Monad.html#LoadError"><span class="hs-identifier hs-var">Cli.LoadError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Text
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r Text) -&gt; Output -&gt; Cli r Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SourceLoadFailed"><span class="hs-identifier hs-var">SourceLoadFailed</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404930"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1098"></span><span>                  </span><span class="annot"><a href="Unison.Cli.Monad.html#LoadSuccess"><span class="hs-identifier hs-type">Cli.LoadSuccess</span></a></span><span> </span><span id="local-6989586621679404919"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404919"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404919"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-1099"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Cli r ()
forall r. Text -&gt; Text -&gt; Cli r ()
</span><a href="#local-6989586621679405811"><span class="hs-identifier hs-var">loadUnisonFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404930"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404925"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-1100"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#AddI"><span class="hs-identifier hs-type">AddI</span></a></span><span> </span><span id="local-6989586621679404917"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404917"><span class="hs-identifier hs-var">requestedNames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1101"></span><span>              </span><span id="local-6989586621679404916"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404916"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-1102"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404915"><span class="annot"><span class="annottext">vars :: Set Symbol
</span><a href="#local-6989586621679404915"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Symbol) -&gt; Set Name -&gt; Set Symbol
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Symbol
forall v. Var v =&gt; Name -&gt; v
</span><span class="hs-identifier hs-var">Name.toVar</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404917"><span class="hs-identifier hs-var">requestedNames</span></a></span><span>
</span><span id="line-1103"></span><span>              </span><span id="local-6989586621679404913"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404913"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (TypecheckedUnisonFile Symbol Ann)
forall r. Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.Cli.MonadUtils.html#expectLatestTypecheckedFile"><span class="hs-identifier hs-var">Cli.expectLatestTypecheckedFile</span></a></span><span>
</span><span id="line-1104"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404911"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404911"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1105"></span><span>              </span><span id="local-6989586621679404910"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404910"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-1106"></span><span>              </span><span id="local-6989586621679404909"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404909"><span class="hs-identifier hs-var">currentNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Names) -&gt; Cli r (Branch0 IO) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-1107"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404908"><span class="annot"><span class="annottext">sr :: SlurpResult Symbol
</span><a href="#local-6989586621679404908"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Set Symbol -&gt; SlurpOp -&gt; Names -&gt; SlurpResult Symbol
forall v.
Var v =&gt;
TypecheckedUnisonFile v Ann
-&gt; Set v -&gt; SlurpOp -&gt; Names -&gt; SlurpResult v
</span><a href="Unison.Codebase.Editor.Slurp.html#slurpFile"><span class="hs-identifier hs-var">Slurp.slurpFile</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404913"><span class="hs-identifier hs-var">uf</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679404915"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpOp
</span><a href="Unison.Codebase.Editor.Slurp.html#AddOp"><span class="hs-identifier hs-var">Slurp.AddOp</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404909"><span class="hs-identifier hs-var">currentNames</span></a></span><span>
</span><span id="line-1108"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404906"><span class="annot"><span class="annottext">adds :: SlurpComponent Symbol
</span><a href="#local-6989586621679404906"><span class="hs-identifier hs-var hs-var">adds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol -&gt; SlurpComponent Symbol
forall v. SlurpResult v -&gt; SlurpComponent v
</span><a href="Unison.Codebase.Editor.SlurpResult.html#%24sel%3Aadds%3ASlurpResult"><span class="hs-identifier hs-var hs-var">SlurpResult.adds</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679404908"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-1109"></span><span>              </span><span class="annot"><span class="annottext">(Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall r. (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAtNoSync"><span class="hs-identifier hs-var">stepAtNoSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404910"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
-&gt; TypecheckedUnisonFile Symbol Ann -&gt; Branch0 IO -&gt; Branch0 IO
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
SlurpComponent v
-&gt; TypecheckedUnisonFile v Ann -&gt; Branch0 m -&gt; Branch0 m
</span><a href="Unison.Codebase.Editor.HandleInput.html#doSlurpAdds"><span class="hs-identifier hs-var">doSlurpAdds</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679404906"><span class="hs-identifier hs-var">adds</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404913"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1110"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Cli r ())
-&gt; (TypecheckedUnisonFile Symbol Ann -&gt; IO ())
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; TypecheckedUnisonFile Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
(Monad m, Var v, Show a) =&gt;
Codebase m v a -&gt; TypecheckedUnisonFile v a -&gt; m ()
</span><span class="hs-identifier hs-var">Codebase.addDefsToCodebase</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404911"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile Symbol Ann -&gt; IO ())
-&gt; (TypecheckedUnisonFile Symbol Ann
    -&gt; TypecheckedUnisonFile Symbol Ann)
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; TypecheckedUnisonFile Symbol Ann
forall v.
Ord v =&gt;
SlurpResult v
-&gt; TypecheckedUnisonFile v Ann -&gt; TypecheckedUnisonFile v Ann
</span><a href="Unison.Codebase.Editor.HandleInput.html#filterBySlurpResult"><span class="hs-identifier hs-var">filterBySlurpResult</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679404908"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile Symbol Ann -&gt; Cli r ())
-&gt; TypecheckedUnisonFile Symbol Ann -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404913"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-1111"></span><span>              </span><span id="local-6989586621679404900"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404900"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl)
-&gt; Cli r NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Cli r NamesWithHistory
forall v a r.
Var v =&gt;
TypecheckedUnisonFile v a -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayNames"><span class="hs-identifier hs-var">displayNames</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404913"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-1112"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Input -&gt; PrettyPrintEnv -&gt; SlurpResult Symbol -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SlurpOutput"><span class="hs-identifier hs-var">SlurpOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404900"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679404908"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-1113"></span><span>              </span><span class="annot"><span class="annottext">SlurpComponent Symbol -&gt; Cli r ()
forall r. SlurpComponent Symbol -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#addDefaultMetadata"><span class="hs-identifier hs-var">addDefaultMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679404906"><span class="hs-identifier hs-var">adds</span></a></span><span>
</span><span id="line-1114"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Cli r ()
forall r. Text -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-var">syncRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404916"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-1115"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#SaveExecuteResultI"><span class="hs-identifier hs-type">SaveExecuteResultI</span></a></span><span> </span><span id="local-6989586621679404896"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404896"><span class="hs-identifier hs-var">resultName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1116"></span><span>              </span><span id="local-6989586621679404895"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404895"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-1117"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404894"><span class="annot"><span class="annottext">resultVar :: Symbol
</span><a href="#local-6989586621679404894"><span class="hs-identifier hs-var hs-var">resultVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Symbol
forall v. Var v =&gt; Name -&gt; v
</span><span class="hs-identifier hs-var">Name.toVar</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404896"><span class="hs-identifier hs-var">resultName</span></a></span><span>
</span><span id="line-1118"></span><span>              </span><span id="local-6989586621679404893"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404893"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
forall r. Name -&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#addSavedTermToUnisonFile"><span class="hs-identifier hs-var">addSavedTermToUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404896"><span class="hs-identifier hs-var">resultName</span></a></span><span>
</span><span id="line-1119"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404891"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404891"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1120"></span><span>              </span><span id="local-6989586621679404890"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404890"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-1121"></span><span>              </span><span id="local-6989586621679404889"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404889"><span class="hs-identifier hs-var">currentNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Names) -&gt; Cli r (Branch0 IO) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-1122"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404888"><span class="annot"><span class="annottext">sr :: SlurpResult Symbol
</span><a href="#local-6989586621679404888"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Set Symbol -&gt; SlurpOp -&gt; Names -&gt; SlurpResult Symbol
forall v.
Var v =&gt;
TypecheckedUnisonFile v Ann
-&gt; Set v -&gt; SlurpOp -&gt; Names -&gt; SlurpResult v
</span><a href="Unison.Codebase.Editor.Slurp.html#slurpFile"><span class="hs-identifier hs-var">Slurp.slurpFile</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404893"><span class="hs-identifier hs-var">uf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Set Symbol
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679404894"><span class="hs-identifier hs-var">resultVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SlurpOp
</span><a href="Unison.Codebase.Editor.Slurp.html#AddOp"><span class="hs-identifier hs-var">Slurp.AddOp</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404889"><span class="hs-identifier hs-var">currentNames</span></a></span><span>
</span><span id="line-1123"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404886"><span class="annot"><span class="annottext">adds :: SlurpComponent Symbol
</span><a href="#local-6989586621679404886"><span class="hs-identifier hs-var hs-var">adds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol -&gt; SlurpComponent Symbol
forall v. SlurpResult v -&gt; SlurpComponent v
</span><a href="Unison.Codebase.Editor.SlurpResult.html#%24sel%3Aadds%3ASlurpResult"><span class="hs-identifier hs-var hs-var">SlurpResult.adds</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679404888"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-1124"></span><span>              </span><span class="annot"><span class="annottext">(Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall r. (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAtNoSync"><span class="hs-identifier hs-var">stepAtNoSync</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404890"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
-&gt; TypecheckedUnisonFile Symbol Ann -&gt; Branch0 IO -&gt; Branch0 IO
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
SlurpComponent v
-&gt; TypecheckedUnisonFile v Ann -&gt; Branch0 m -&gt; Branch0 m
</span><a href="Unison.Codebase.Editor.HandleInput.html#doSlurpAdds"><span class="hs-identifier hs-var">doSlurpAdds</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679404886"><span class="hs-identifier hs-var">adds</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404893"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1125"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Cli r ())
-&gt; (TypecheckedUnisonFile Symbol Ann -&gt; IO ())
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; TypecheckedUnisonFile Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
(Monad m, Var v, Show a) =&gt;
Codebase m v a -&gt; TypecheckedUnisonFile v a -&gt; m ()
</span><span class="hs-identifier hs-var">Codebase.addDefsToCodebase</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404891"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile Symbol Ann -&gt; IO ())
-&gt; (TypecheckedUnisonFile Symbol Ann
    -&gt; TypecheckedUnisonFile Symbol Ann)
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; TypecheckedUnisonFile Symbol Ann
forall v.
Ord v =&gt;
SlurpResult v
-&gt; TypecheckedUnisonFile v Ann -&gt; TypecheckedUnisonFile v Ann
</span><a href="Unison.Codebase.Editor.HandleInput.html#filterBySlurpResult"><span class="hs-identifier hs-var">filterBySlurpResult</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679404888"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile Symbol Ann -&gt; Cli r ())
-&gt; TypecheckedUnisonFile Symbol Ann -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404893"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-1126"></span><span>              </span><span id="local-6989586621679404885"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404885"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl)
-&gt; Cli r NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Cli r NamesWithHistory
forall v a r.
Var v =&gt;
TypecheckedUnisonFile v a -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayNames"><span class="hs-identifier hs-var">displayNames</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404893"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-1127"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r Any
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r Any) -&gt; Output -&gt; Cli r Any
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Input -&gt; PrettyPrintEnv -&gt; SlurpResult Symbol -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SlurpOutput"><span class="hs-identifier hs-var">SlurpOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404885"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679404888"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-1128"></span><span>              </span><span class="annot"><span class="annottext">SlurpComponent Symbol -&gt; Cli r ()
forall r. SlurpComponent Symbol -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#addDefaultMetadata"><span class="hs-identifier hs-var">addDefaultMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679404886"><span class="hs-identifier hs-var">adds</span></a></span><span>
</span><span id="line-1129"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Cli r ()
forall r. Text -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-var">syncRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404895"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-1130"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PreviewAddI"><span class="hs-identifier hs-type">PreviewAddI</span></a></span><span> </span><span id="local-6989586621679404883"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404883"><span class="hs-identifier hs-var">requestedNames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1131"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679404882"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404882"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (String, Bool)
forall r. Cli r (String, Bool)
</span><a href="Unison.Cli.MonadUtils.html#expectLatestFile"><span class="hs-identifier hs-var">Cli.expectLatestFile</span></a></span><span>
</span><span id="line-1132"></span><span>              </span><span id="local-6989586621679404880"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404880"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (TypecheckedUnisonFile Symbol Ann)
forall r. Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.Cli.MonadUtils.html#expectLatestTypecheckedFile"><span class="hs-identifier hs-var">Cli.expectLatestTypecheckedFile</span></a></span><span>
</span><span id="line-1133"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404879"><span class="annot"><span class="annottext">vars :: Set Symbol
</span><a href="#local-6989586621679404879"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Symbol) -&gt; Set Name -&gt; Set Symbol
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Symbol
forall v. Var v =&gt; Name -&gt; v
</span><span class="hs-identifier hs-var">Name.toVar</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404883"><span class="hs-identifier hs-var">requestedNames</span></a></span><span>
</span><span id="line-1134"></span><span>              </span><span id="local-6989586621679404878"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404878"><span class="hs-identifier hs-var">currentNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Names) -&gt; Cli r (Branch0 IO) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-1135"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404877"><span class="annot"><span class="annottext">sr :: SlurpResult Symbol
</span><a href="#local-6989586621679404877"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Set Symbol -&gt; SlurpOp -&gt; Names -&gt; SlurpResult Symbol
forall v.
Var v =&gt;
TypecheckedUnisonFile v Ann
-&gt; Set v -&gt; SlurpOp -&gt; Names -&gt; SlurpResult v
</span><a href="Unison.Codebase.Editor.Slurp.html#slurpFile"><span class="hs-identifier hs-var">Slurp.slurpFile</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404880"><span class="hs-identifier hs-var">uf</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679404879"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpOp
</span><a href="Unison.Codebase.Editor.Slurp.html#AddOp"><span class="hs-identifier hs-var">Slurp.AddOp</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404878"><span class="hs-identifier hs-var">currentNames</span></a></span><span>
</span><span id="line-1136"></span><span>              </span><span class="annot"><span class="annottext">String
-&gt; SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Cli r ()
forall r.
String
-&gt; SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Cli r ()
</span><a href="#local-6989586621679405690"><span class="hs-identifier hs-var">previewResponse</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404882"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679404877"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404880"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-1137"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#UpdateI"><span class="hs-identifier hs-type">UpdateI</span></a></span><span> </span><span id="local-6989586621679404875"><span class="annot"><span class="annottext">OptionalPatch
</span><a href="#local-6989586621679404875"><span class="hs-identifier hs-var">optionalPatch</span></a></span></span><span> </span><span id="local-6989586621679404874"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404874"><span class="hs-identifier hs-var">requestedNames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Input -&gt; OptionalPatch -&gt; Set Name -&gt; Cli r ()
forall r. Input -&gt; OptionalPatch -&gt; Set Name -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleUpdate"><span class="hs-identifier hs-var">handleUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">OptionalPatch
</span><a href="#local-6989586621679404875"><span class="hs-identifier hs-var">optionalPatch</span></a></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404874"><span class="hs-identifier hs-var">requestedNames</span></a></span><span>
</span><span id="line-1138"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PreviewUpdateI"><span class="hs-identifier hs-type">PreviewUpdateI</span></a></span><span> </span><span id="local-6989586621679404871"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404871"><span class="hs-identifier hs-var">requestedNames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1139"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679404870"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404870"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (String, Bool)
forall r. Cli r (String, Bool)
</span><a href="Unison.Cli.MonadUtils.html#expectLatestFile"><span class="hs-identifier hs-var">Cli.expectLatestFile</span></a></span><span>
</span><span id="line-1140"></span><span>              </span><span id="local-6989586621679404869"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404869"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (TypecheckedUnisonFile Symbol Ann)
forall r. Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.Cli.MonadUtils.html#expectLatestTypecheckedFile"><span class="hs-identifier hs-var">Cli.expectLatestTypecheckedFile</span></a></span><span>
</span><span id="line-1141"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404868"><span class="annot"><span class="annottext">vars :: Set Symbol
</span><a href="#local-6989586621679404868"><span class="hs-identifier hs-var hs-var">vars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Symbol) -&gt; Set Name -&gt; Set Symbol
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Symbol
forall v. Var v =&gt; Name -&gt; v
</span><span class="hs-identifier hs-var">Name.toVar</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404871"><span class="hs-identifier hs-var">requestedNames</span></a></span><span>
</span><span id="line-1142"></span><span>              </span><span id="local-6989586621679404867"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404867"><span class="hs-identifier hs-var">currentNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Names) -&gt; Cli r (Branch0 IO) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-1143"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404866"><span class="annot"><span class="annottext">sr :: SlurpResult Symbol
</span><a href="#local-6989586621679404866"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Set Symbol -&gt; SlurpOp -&gt; Names -&gt; SlurpResult Symbol
forall v.
Var v =&gt;
TypecheckedUnisonFile v Ann
-&gt; Set v -&gt; SlurpOp -&gt; Names -&gt; SlurpResult v
</span><a href="Unison.Codebase.Editor.Slurp.html#slurpFile"><span class="hs-identifier hs-var">Slurp.slurpFile</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404869"><span class="hs-identifier hs-var">uf</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679404868"><span class="hs-identifier hs-var">vars</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpOp
</span><a href="Unison.Codebase.Editor.Slurp.html#UpdateOp"><span class="hs-identifier hs-var">Slurp.UpdateOp</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404867"><span class="hs-identifier hs-var">currentNames</span></a></span><span>
</span><span id="line-1144"></span><span>              </span><span class="annot"><span class="annottext">String
-&gt; SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Cli r ()
forall r.
String
-&gt; SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Cli r ()
</span><a href="#local-6989586621679405690"><span class="hs-identifier hs-var">previewResponse</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404870"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679404866"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404869"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-1145"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#TodoI"><span class="hs-identifier hs-type">TodoI</span></a></span><span> </span><span id="local-6989586621679404863"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404863"><span class="hs-identifier hs-var">patchPath</span></a></span></span><span> </span><span id="local-6989586621679404862"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404862"><span class="hs-identifier hs-var">branchPath'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1146"></span><span>              </span><span id="local-6989586621679404861"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404861"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Patch
forall r. PatchPath -&gt; Cli r Patch
</span><a href="Unison.Cli.MonadUtils.html#getPatchAt"><span class="hs-identifier hs-var">Cli.getPatchAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath -&gt; Maybe PatchPath -&gt; PatchPath
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="Unison.Cli.MonadUtils.html#defaultPatchPath"><span class="hs-identifier hs-var">Cli.defaultPatchPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404863"><span class="hs-identifier hs-var">patchPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span>              </span><span id="local-6989586621679404860"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404860"><span class="hs-identifier hs-var">branchPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404862"><span class="hs-identifier hs-var">branchPath'</span></a></span><span>
</span><span id="line-1148"></span><span>              </span><span class="annot"><span class="annottext">Patch -&gt; Absolute -&gt; Cli r ()
forall r. Patch -&gt; Absolute -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#doShowTodoOutput"><span class="hs-identifier hs-var">doShowTodoOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404861"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404860"><span class="hs-identifier hs-var">branchPath</span></a></span><span>
</span><span id="line-1149"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#TestI"><span class="hs-identifier hs-type">TestI</span></a></span><span> </span><span id="local-6989586621679404857"><span class="annot"><span class="annottext">TestInput
</span><a href="#local-6989586621679404857"><span class="hs-identifier hs-var">testInput</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TestInput -&gt; Cli r ()
forall r. TestInput -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleTest"><span class="hs-identifier hs-var">handleTest</span></a></span><span> </span><span class="annot"><span class="annottext">TestInput
</span><a href="#local-6989586621679404857"><span class="hs-identifier hs-var">testInput</span></a></span><span>
</span><span id="line-1150"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PropagatePatchI"><span class="hs-identifier hs-type">PropagatePatchI</span></a></span><span> </span><span id="local-6989586621679404854"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404854"><span class="hs-identifier hs-var">patchPath</span></a></span></span><span> </span><span id="local-6989586621679404853"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404853"><span class="hs-identifier hs-var">scopePath'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1151"></span><span>              </span><span id="local-6989586621679404852"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404852"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-1152"></span><span>              </span><span id="local-6989586621679404851"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404851"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Patch
forall r. PatchPath -&gt; Cli r Patch
</span><a href="Unison.Cli.MonadUtils.html#getPatchAt"><span class="hs-identifier hs-var">Cli.getPatchAt</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404854"><span class="hs-identifier hs-var">patchPath</span></a></span><span>
</span><span id="line-1153"></span><span>              </span><span id="local-6989586621679404850"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404850"><span class="hs-identifier hs-var">scopePath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404853"><span class="hs-identifier hs-var">scopePath'</span></a></span><span>
</span><span id="line-1154"></span><span>              </span><span id="local-6989586621679404849"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404849"><span class="hs-identifier hs-var">updated</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Patch -&gt; Absolute -&gt; Cli r Bool
forall r. Text -&gt; Patch -&gt; Absolute -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#propagatePatch"><span class="hs-identifier hs-var">propagatePatch</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404852"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404851"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404850"><span class="hs-identifier hs-var">scopePath</span></a></span><span>
</span><span id="line-1155"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404849"><span class="hs-identifier hs-var">updated</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Path' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#NothingToPatch"><span class="hs-identifier hs-var">NothingToPatch</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404854"><span class="hs-identifier hs-var">patchPath</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404853"><span class="hs-identifier hs-var">scopePath'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1156"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ExecuteI"><span class="hs-identifier hs-type">ExecuteI</span></a></span><span> </span><span id="local-6989586621679404846"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404846"><span class="hs-identifier hs-var">main</span></a></span></span><span> </span><span id="local-6989586621679404845"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404845"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1157"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679404844"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404844"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404843"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404843"><span class="hs-identifier hs-var">mainResType</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1158"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679404842"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679404842"><span class="hs-identifier hs-var">sym</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404841"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404841"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404840"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404840"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404839"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404839"><span class="hs-identifier hs-var">otyp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Cli
     r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
forall r.
String
-&gt; Cli
     r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#getTerm"><span class="hs-identifier hs-var">getTerm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404846"><span class="hs-identifier hs-var">main</span></a></span><span>
</span><span id="line-1159"></span><span>                </span><span id="local-6989586621679404837"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404837"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Symbol
-&gt; Term Symbol Ann
-&gt; Type Symbol Ann
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
forall r.
Symbol
-&gt; Term Symbol Ann
-&gt; Type Symbol Ann
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#createWatcherFile"><span class="hs-identifier hs-var">createWatcherFile</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679404842"><span class="hs-identifier hs-var">sym</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404841"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404840"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-1160"></span><span>                </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404837"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404839"><span class="hs-identifier hs-var">otyp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>              </span><span id="local-6989586621679404835"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404835"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Cli r PrettyPrintEnv
forall v a r.
Var v =&gt;
TypecheckedUnisonFile v a -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#executePPE"><span class="hs-identifier hs-var">executePPE</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404844"><span class="hs-identifier hs-var">unisonFile</span></a></span><span>
</span><span id="line-1162"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Symbol, Term Symbol ())]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404833"><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
</span><a href="#local-6989586621679404833"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; PrettyPrintEnv
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; [String]
-&gt; Cli
     r
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
forall r.
Bool
-&gt; PrettyPrintEnv
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; [String]
-&gt; Cli
     r
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonFile"><span class="hs-identifier hs-var">evalUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404835"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404844"><span class="hs-identifier hs-var">unisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404845"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1163"></span><span>              </span><span id="local-6989586621679404832"><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679404832"><span class="hs-identifier hs-var">mainRes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1164"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404831"><span class="annot"><span class="annottext">bonk :: (a, (a, a, c, d, b, f)) -&gt; (a, b)
</span><a href="#local-6989586621679404831"><span class="hs-identifier hs-var hs-var">bonk</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404830"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404830"><span class="hs-identifier hs-var">_ann</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404829"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404829"><span class="hs-identifier hs-var">watchKind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404828"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679404828"><span class="hs-identifier hs-var">_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404827"><span class="annot"><span class="annottext">d
</span><a href="#local-6989586621679404827"><span class="hs-identifier hs-var">_term0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404826"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679404826"><span class="hs-identifier hs-var">term1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404825"><span class="annot"><span class="annottext">f
</span><a href="#local-6989586621679404825"><span class="hs-identifier hs-var">_isCacheHit</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404829"><span class="hs-identifier hs-var">watchKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679404826"><span class="hs-identifier hs-var">term1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1165"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(String, Term Symbol ())] -&gt; Maybe (Term Symbol ())
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Unison.Codebase.Editor.HandleInput.html#magicMainWatcherString"><span class="hs-identifier hs-var">magicMainWatcherString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Symbol, (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
 -&gt; (String, Term Symbol ()))
-&gt; [(Symbol,
     (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))]
-&gt; [(String, Term Symbol ())]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Symbol, (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
-&gt; (String, Term Symbol ())
forall a a a c d b f. (a, (a, a, c, d, b, f)) -&gt; (a, b)
</span><a href="#local-6989586621679404831"><span class="hs-identifier hs-var">bonk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
-&gt; [(Symbol,
     (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
</span><a href="#local-6989586621679404833"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1166"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (Term Symbol ())
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1167"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; Cli r (Term Symbol ())
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span>
</span><span id="line-1168"></span><span>                          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible: we manually added the watcher &quot;</span></span><span>
</span><span id="line-1169"></span><span>                              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="Unison.Codebase.Editor.HandleInput.html#magicMainWatcherString"><span class="hs-identifier hs-var">magicMainWatcherString</span></a></span><span>
</span><span id="line-1170"></span><span>                              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; with 'createWatcherFile', but it isn't here.&quot;</span></span><span>
</span><span id="line-1171"></span><span>                          </span><span class="hs-special">)</span><span>
</span><span id="line-1172"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679404822"><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679404822"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term Symbol () -&gt; Cli r (Term Symbol ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Term Symbol () -&gt; Term Symbol ()
forall a.
TypecheckedUnisonFile Symbol a -&gt; Term Symbol () -&gt; Term Symbol ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stripUnisonFileReferences"><span class="hs-identifier hs-var">stripUnisonFileReferences</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404844"><span class="hs-identifier hs-var">unisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679404822"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
              #lastRunResult .= Just (Term.amap (\() -&gt; External) mainRes, mainResType, unisonFile)
</span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Term Symbol () -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#RunResult"><span class="hs-identifier hs-var">RunResult</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404835"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679404832"><span class="hs-identifier hs-var">mainRes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1175"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MakeStandaloneI"><span class="hs-identifier hs-type">MakeStandaloneI</span></a></span><span> </span><span id="local-6989586621679404816"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404816"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621679404815"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404815"><span class="hs-identifier hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1176"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404814"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404814"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404813"><span class="annot"><span class="annottext">Runtime Symbol
$sel:runtime:Env :: Env -&gt; Runtime Symbol
runtime :: Runtime Symbol
</span><a href="Unison.Cli.Monad.html#%24sel%3Aruntime%3AEnv"><span class="hs-identifier hs-var hs-var">runtime</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1177"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404811"><span class="annot"><span class="annottext">mainType :: Type Symbol Ann
</span><a href="#local-6989586621679404811"><span class="hs-identifier hs-var hs-var">mainType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol -&gt; Type Symbol Ann
forall v. Runtime v -&gt; Type v Ann
</span><span class="hs-identifier hs-var hs-var">Runtime.mainType</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679404813"><span class="hs-identifier hs-var">runtime</span></a></span><span>
</span><span id="line-1178"></span><span>              </span><span id="local-6989586621679404809"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404809"><span class="hs-identifier hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1179"></span><span>                </span><span class="annot"><span class="annottext">(Names -&gt; Names -&gt; NamesWithHistory)
-&gt; Names -&gt; Names -&gt; NamesWithHistory
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; NamesWithHistory)
-&gt; Cli r Names -&gt; Cli r NamesWithHistory
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicPrettyPrintNamesA"><span class="hs-identifier hs-var">basicPrettyPrintNamesA</span></a></span><span>
</span><span id="line-1180"></span><span>              </span><span id="local-6989586621679404805"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404805"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#suffixifiedPPE"><span class="hs-identifier hs-var">suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404809"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-1181"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404804"><span class="annot"><span class="annottext">resolved :: [Referent]
</span><a href="#local-6989586621679404804"><span class="hs-identifier hs-var hs-var">resolved</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; [Referent]) -&gt; Set Referent -&gt; [Referent]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Referent
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupHQTerm</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404815"><span class="hs-identifier hs-var">main</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404809"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-1182"></span><span>                  </span><span id="local-6989586621679404803"><span class="annot"><span class="annottext">smain :: String
</span><a href="#local-6989586621679404803"><span class="hs-identifier hs-var hs-var">smain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ.toString</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404815"><span class="hs-identifier hs-var">main</span></a></span><span>
</span><span id="line-1183"></span><span>              </span><span id="local-6989586621679404802"><span class="annot"><span class="annottext">[(Referent, Type Symbol Ann)]
</span><a href="#local-6989586621679404802"><span class="hs-identifier hs-var">filtered</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1184"></span><span>                </span><span class="annot"><span class="annottext">[Maybe (Referent, Type Symbol Ann)]
-&gt; [(Referent, Type Symbol Ann)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span>
</span><span id="line-1185"></span><span>                  </span><span class="annot"><span class="annottext">([Maybe (Referent, Type Symbol Ann)]
 -&gt; [(Referent, Type Symbol Ann)])
-&gt; Cli r [Maybe (Referent, Type Symbol Ann)]
-&gt; Cli r [(Referent, Type Symbol Ann)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; Cli r (Maybe (Referent, Type Symbol Ann)))
-&gt; [Referent] -&gt; Cli r [Maybe (Referent, Type Symbol Ann)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679404799"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679404799"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Type Symbol Ann -&gt; (Referent, Type Symbol Ann))
-&gt; Maybe (Type Symbol Ann) -&gt; Maybe (Referent, Type Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679404799"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann) -&gt; Maybe (Referent, Type Symbol Ann))
-&gt; Cli r (Maybe (Type Symbol Ann))
-&gt; Cli r (Maybe (Referent, Type Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Referent -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *).
Monad m =&gt;
Codebase m Symbol Ann -&gt; Referent -&gt; m (Maybe (Type Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeOfTerm"><span class="hs-identifier hs-var">loadTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404814"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679404799"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679404804"><span class="hs-identifier hs-var">resolved</span></a></span><span>
</span><span id="line-1186"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Referent, Type Symbol Ann)]
</span><a href="#local-6989586621679404802"><span class="hs-identifier hs-var">filtered</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1187"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679404797"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404797"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404796"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404796"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1188"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Type Symbol Ann -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.fitsScheme</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404796"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404811"><span class="hs-identifier hs-var">mainType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1189"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404794"><span class="annot"><span class="annottext">codeLookup :: CodeLookup Symbol IO ()
</span><a href="#local-6989586621679404794"><span class="hs-identifier hs-var hs-var">codeLookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">() -&gt; CodeLookup Symbol IO Ann -&gt; CodeLookup Symbol IO ()
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; CodeLookup Symbol IO Ann
forall (m :: * -&gt; *).
Monad m =&gt;
Codebase m Symbol Ann -&gt; CodeLookup Symbol m Ann
</span><span class="hs-identifier hs-var">Codebase.toCodeLookup</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404814"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-1190"></span><span>                      </span><span class="annot"><span class="annottext">Cli r (Maybe (Pretty ColorText))
-&gt; (Pretty ColorText -&gt; Cli r ()) -&gt; Cli r ()
forall (m :: * -&gt; *) a.
Monad m =&gt;
m (Maybe a) -&gt; (a -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">whenJustM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe (Pretty ColorText)) -&gt; Cli r (Maybe (Pretty ColorText))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime Symbol
-&gt; CodeLookup Symbol IO ()
-&gt; PrettyPrintEnv
-&gt; Reference
-&gt; String
-&gt; IO (Maybe (Pretty ColorText))
forall v.
Runtime v
-&gt; CodeLookup v IO ()
-&gt; PrettyPrintEnv
-&gt; Reference
-&gt; String
-&gt; IO (Maybe (Pretty ColorText))
</span><span class="hs-identifier hs-var hs-var">Runtime.compileTo</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679404813"><span class="hs-identifier hs-var">runtime</span></a></span><span> </span><span class="annot"><span class="annottext">CodeLookup Symbol IO ()
</span><a href="#local-6989586621679404794"><span class="hs-identifier hs-var">codeLookup</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404805"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404797"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404816"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.uc&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404789"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679404789"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1191"></span><span>                        </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#EvaluationFailure"><span class="hs-identifier hs-var">EvaluationFailure</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679404789"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; Type Symbol Ann -&gt; PrettyPrintEnv -&gt; [Type Symbol Ann] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#BadMainFunction"><span class="hs-identifier hs-var">BadMainFunction</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404803"><span class="hs-identifier hs-var">smain</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404796"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404805"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404811"><span class="hs-identifier hs-var">mainType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1193"></span><span>                </span><span class="annot"><span class="annottext">[(Referent, Type Symbol Ann)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PrettyPrintEnv -&gt; [Type Symbol Ann] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#NoMainFunction"><span class="hs-identifier hs-var">NoMainFunction</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404803"><span class="hs-identifier hs-var">smain</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404805"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404811"><span class="hs-identifier hs-var">mainType</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#IOTestI"><span class="hs-identifier hs-type">IOTestI</span></a></span><span> </span><span id="local-6989586621679404784"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404784"><span class="hs-identifier hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1195"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404783"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404783"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404782"><span class="annot"><span class="annottext">Runtime Symbol
runtime :: Runtime Symbol
$sel:runtime:Env :: Env -&gt; Runtime Symbol
</span><a href="#local-6989586621679404782"><span class="hs-identifier hs-var hs-var">runtime</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1196"></span><span>              </span><span class="hs-comment">-- todo - allow this to run tests from scratch file, using addRunMain</span><span>
</span><span id="line-1197"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404781"><span class="annot"><span class="annottext">testType :: Type Symbol Ann
</span><a href="#local-6989586621679404781"><span class="hs-identifier hs-var hs-var">testType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol -&gt; Type Symbol Ann
forall v. Runtime v -&gt; Type v Ann
</span><span class="hs-identifier hs-var hs-var">Runtime.ioTestType</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679404782"><span class="hs-identifier hs-var">runtime</span></a></span><span>
</span><span id="line-1198"></span><span>              </span><span id="local-6989586621679404779"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404779"><span class="hs-identifier hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-operator hs-var">`NamesWithHistory.NamesWithHistory`</span></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Names -&gt; NamesWithHistory)
-&gt; Cli r Names -&gt; Cli r NamesWithHistory
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicParseNames"><span class="hs-identifier hs-var">basicParseNames</span></a></span><span>
</span><span id="line-1199"></span><span>              </span><span id="local-6989586621679404777"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404777"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#suffixifiedPPE"><span class="hs-identifier hs-var">suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404779"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-1200"></span><span>              </span><span class="hs-comment">-- use suffixed names for resolving the argument to display</span><span>
</span><span id="line-1201"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404776"><span class="annot"><span class="annottext">oks :: [(a, Term (F typeVar typeAnn patternAnn) v a)] -&gt; [(a, Text)]
</span><a href="#local-6989586621679404776"><span class="hs-identifier hs-var hs-var">oks</span></a></span></span><span> </span><span id="local-6989586621679404775"><span class="annot"><span class="annottext">[(a, Term (F typeVar typeAnn patternAnn) v a)]
</span><a href="#local-6989586621679404775"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1202"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404774"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404773"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1203"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404774"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404774"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term.List'</span></span><span> </span><span id="local-6989586621679404771"><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404771"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, Term (F typeVar typeAnn patternAnn) v a)]
</span><a href="#local-6989586621679404775"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1204"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Term.App'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Constructor'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span id="local-6989586621679404767"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404767"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679404766"><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404766"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Text'</span></span><span> </span><span id="local-6989586621679404773"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404773"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
-&gt; [Term (F typeVar typeAnn patternAnn) v a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404771"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1205"></span><span>                        </span><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404766"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorId -&gt; ConstructorId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><span class="hs-identifier hs-var">DD.okConstructorId</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404767"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">DD.testResultRef</span></span><span>
</span><span id="line-1206"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1207"></span><span>                  </span><span id="local-6989586621679404762"><span class="annot"><span class="annottext">fails :: [(a, Term (F typeVar typeAnn patternAnn) v a)] -&gt; [(a, Text)]
</span><a href="#local-6989586621679404762"><span class="hs-identifier hs-var hs-var">fails</span></a></span></span><span> </span><span id="local-6989586621679404761"><span class="annot"><span class="annottext">[(a, Term (F typeVar typeAnn patternAnn) v a)]
</span><a href="#local-6989586621679404761"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1208"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404760"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404759"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404760"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404760"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term.List'</span></span><span> </span><span id="local-6989586621679404758"><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404758"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, Term (F typeVar typeAnn patternAnn) v a)]
</span><a href="#local-6989586621679404761"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1210"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Term.App'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Constructor'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span id="local-6989586621679404757"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404757"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679404756"><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404756"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Text'</span></span><span> </span><span id="local-6989586621679404759"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404759"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
-&gt; [Term (F typeVar typeAnn patternAnn) v a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404758"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1211"></span><span>                        </span><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404756"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorId -&gt; ConstructorId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><span class="hs-identifier hs-var">DD.failConstructorId</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404757"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">DD.testResultRef</span></span><span>
</span><span id="line-1212"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span>                  </span><span id="local-6989586621679404754"><span class="annot"><span class="annottext">results :: Set Referent
</span><a href="#local-6989586621679404754"><span class="hs-identifier hs-var hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Referent
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupHQTerm</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404784"><span class="hs-identifier hs-var">main</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404779"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-1215"></span><span>              </span><span id="local-6989586621679404753"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404753"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1216"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404752"><span class="annot"><span class="annottext">noMain :: Cli r Reference
</span><a href="#local-6989586621679404752"><span class="hs-identifier hs-var hs-var">noMain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Reference
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r Reference) -&gt; Output -&gt; Cli r Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; PrettyPrintEnv -&gt; [Type Symbol Ann] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#NoMainFunction"><span class="hs-identifier hs-var">NoMainFunction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ.toString</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404784"><span class="hs-identifier hs-var">main</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404777"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404781"><span class="hs-identifier hs-var">testType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1217"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679404754"><span class="hs-identifier hs-var">results</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1218"></span><span>                  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679404751"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404751"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1219"></span><span>                    </span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Referent -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *).
Monad m =&gt;
Codebase m Symbol Ann -&gt; Referent -&gt; m (Maybe (Type Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeOfTerm"><span class="hs-identifier hs-var">loadTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404783"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404751"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Type Symbol Ann))
-&gt; (Maybe (Type Symbol Ann) -&gt; Cli r Reference) -&gt; Cli r Reference
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1220"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679404750"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404750"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Type Symbol Ann -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isSubtype</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404750"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404781"><span class="hs-identifier hs-var">testType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Cli r Reference
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404751"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1221"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Reference
</span><a href="#local-6989586621679404752"><span class="hs-identifier hs-var">noMain</span></a></span><span>
</span><span id="line-1222"></span><span>                  </span><span class="annot"><span class="annottext">[Referent]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Reference
</span><a href="#local-6989586621679404752"><span class="hs-identifier hs-var">noMain</span></a></span><span>
</span><span id="line-1223"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404748"><span class="annot"><span class="annottext">a :: Ann
</span><a href="#local-6989586621679404748"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Ann
forall (f :: * -&gt; *) v a. Term f v a -&gt; a
</span><span class="hs-identifier hs-var hs-var">ABT.annotation</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404746"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1224"></span><span>                  </span><span id="local-6989586621679404746"><span class="annot"><span class="annottext">tm :: Term Symbol Ann
</span><a href="#local-6989586621679404746"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Ann -&gt; Term Symbol Ann -&gt; Term Symbol Ann
forall v a. Var v =&gt; a -&gt; a -&gt; Term v a -&gt; Term v a
</span><span class="hs-identifier hs-var">DD.forceTerm</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621679404748"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621679404748"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Reference -&gt; Term Symbol Ann
forall v a vt at ap. Ord v =&gt; a -&gt; Reference -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ref</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621679404748"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404753"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1225"></span><span>              </span><span class="hs-comment">-- Don't cache IO tests</span><span>
</span><span id="line-1226"></span><span>              </span><span id="local-6989586621679404743"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404743"><span class="hs-identifier hs-var">tm'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Term Symbol Ann)
forall r.
Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Term Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTerm"><span class="hs-identifier hs-var">evalUnisonTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404777"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404746"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1227"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TestReportStats
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Bool
-&gt; [(Reference, Text)]
-&gt; [(Reference, Text)]
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TestResults"><span class="hs-identifier hs-var">TestResults</span></a></span><span> </span><span class="annot"><span class="annottext">TestReportStats
</span><a href="Unison.Codebase.Editor.Output.html#NewlyComputed"><span class="hs-identifier hs-var">Output.NewlyComputed</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404777"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Reference, Term Symbol Ann)] -&gt; [(Reference, Text)]
forall a typeVar typeAnn patternAnn v a.
[(a, Term (F typeVar typeAnn patternAnn) v a)] -&gt; [(a, Text)]
</span><a href="#local-6989586621679404776"><span class="hs-identifier hs-var">oks</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404753"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404743"><span class="hs-identifier hs-var">tm'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Reference, Term Symbol Ann)] -&gt; [(Reference, Text)]
forall a typeVar typeAnn patternAnn v a.
[(a, Term (F typeVar typeAnn patternAnn) v a)] -&gt; [(a, Text)]
</span><a href="#local-6989586621679404762"><span class="hs-identifier hs-var">fails</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404753"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404743"><span class="hs-identifier hs-var">tm'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1228"></span><span>
</span><span id="line-1229"></span><span>            </span><span class="hs-comment">-- UpdateBuiltinsI -&gt; do</span><span>
</span><span id="line-1230"></span><span>            </span><span class="hs-comment">--   stepAt updateBuiltins</span><span>
</span><span id="line-1231"></span><span>            </span><span class="hs-comment">--   checkTodo</span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#MergeBuiltinsI"><span class="hs-identifier hs-var">MergeBuiltinsI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1234"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404738"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404738"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1235"></span><span>              </span><span id="local-6989586621679404737"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404737"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-1236"></span><span>              </span><span class="hs-comment">-- these were added once, but maybe they've changed and need to be</span><span>
</span><span id="line-1237"></span><span>              </span><span class="hs-comment">-- added again.</span><span>
</span><span id="line-1238"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404736"><span class="annot"><span class="annottext">uf :: TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404736"><span class="hs-identifier hs-var hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1239"></span><span>                    </span><span class="annot"><span class="annottext">Map Symbol (Id, DataDeclaration Symbol Ann)
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
-&gt; [(String, [(Symbol, Term Symbol Ann, Type Symbol Ann)])]
-&gt; TypecheckedUnisonFile Symbol Ann
forall v a.
Var v =&gt;
Map v (Id, DataDeclaration v a)
-&gt; Map v (Id, EffectDeclaration v a)
-&gt; [[(v, Term v a, Type v a)]]
-&gt; [(String, [(v, Term v a, Type v a)])]
-&gt; TypecheckedUnisonFile v a
</span><span class="hs-identifier hs-var">UF.typecheckedUnisonFile</span></span><span>
</span><span id="line-1240"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Symbol, (Id, DataDeclaration Symbol Ann))]
-&gt; Map Symbol (Id, DataDeclaration Symbol Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Symbol, (Id, DataDeclaration Symbol Ann))]
</span><span class="hs-identifier hs-var">Builtin.builtinDataDecls</span></span><span class="hs-special">)</span><span>
</span><span id="line-1241"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Symbol, (Id, EffectDeclaration Symbol Ann))]
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Symbol, (Id, EffectDeclaration Symbol Ann))]
</span><span class="hs-identifier hs-var">Builtin.builtinEffectDecls</span></span><span class="hs-special">)</span><span>
</span><span id="line-1242"></span><span>                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ann -&gt; [(Symbol, Term Symbol Ann, Type Symbol Ann)]
forall a. a -&gt; [(Symbol, Term Symbol a, Type Symbol a)]
</span><span class="hs-identifier hs-var">Builtin.builtinTermsSrc</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Intrinsic</span></span><span class="hs-special">]</span><span>
</span><span id="line-1243"></span><span>                      </span><span class="annot"><span class="annottext">[(String, [(Symbol, Term Symbol Ann, Type Symbol Ann)])]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1244"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; TypecheckedUnisonFile Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
(Monad m, Var v, Show a) =&gt;
Codebase m v a -&gt; TypecheckedUnisonFile v a -&gt; m ()
</span><span class="hs-identifier hs-var">Codebase.addDefsToCodebase</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404738"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404736"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1245"></span><span>              </span><span class="hs-comment">-- add the names; note, there are more names than definitions</span><span>
</span><span id="line-1246"></span><span>              </span><span class="hs-comment">-- due to builtin terms; so we don't just reuse `uf` above.</span><span>
</span><span id="line-1247"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404729"><span class="annot"><span class="annottext">srcb :: Branch IO
</span><a href="#local-6989586621679404729"><span class="hs-identifier hs-var hs-var">srcb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Branch IO
forall (m :: * -&gt; *). Monad m =&gt; Names -&gt; Branch m
</span><span class="hs-identifier hs-var">BranchUtil.fromNames</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><span class="hs-identifier hs-var">Builtin.names0</span></span><span>
</span><span id="line-1248"></span><span>              </span><span id="local-6989586621679404726"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404726"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-1249"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
forall r.
Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
</span><a href="Unison.Cli.MonadUtils.html#updateAtM"><span class="hs-identifier hs-var">Cli.updateAtM</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404737"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404726"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; NameSegment -&gt; Absolute
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">`snoc`</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;builtin&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404725"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404725"><span class="hs-identifier hs-var">destb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1250"></span><span>                </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO)))
-&gt; MergeMode -&gt; Branch IO -&gt; Branch IO -&gt; IO (Branch IO)
forall (m :: * -&gt; *).
Monad m =&gt;
(Branch m -&gt; Branch m -&gt; m (Maybe (Branch m)))
-&gt; MergeMode -&gt; Branch m -&gt; Branch m -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Branch.merge''</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Branch m -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.lca</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404738"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><span class="hs-identifier hs-var">Branch.RegularMerge</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404729"><span class="hs-identifier hs-var">srcb</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404725"><span class="hs-identifier hs-var">destb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-1252"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#MergeIOBuiltinsI"><span class="hs-identifier hs-var">MergeIOBuiltinsI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1253"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404723"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404723"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1254"></span><span>              </span><span id="local-6989586621679404722"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404722"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-1255"></span><span>              </span><span class="hs-comment">-- these were added once, but maybe they've changed and need to be</span><span>
</span><span id="line-1256"></span><span>              </span><span class="hs-comment">-- added again.</span><span>
</span><span id="line-1257"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404721"><span class="annot"><span class="annottext">uf :: TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404721"><span class="hs-identifier hs-var hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1258"></span><span>                    </span><span class="annot"><span class="annottext">Map Symbol (Id, DataDeclaration Symbol Ann)
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
-&gt; [(String, [(Symbol, Term Symbol Ann, Type Symbol Ann)])]
-&gt; TypecheckedUnisonFile Symbol Ann
forall v a.
Var v =&gt;
Map v (Id, DataDeclaration v a)
-&gt; Map v (Id, EffectDeclaration v a)
-&gt; [[(v, Term v a, Type v a)]]
-&gt; [(String, [(v, Term v a, Type v a)])]
-&gt; TypecheckedUnisonFile v a
</span><span class="hs-identifier hs-var">UF.typecheckedUnisonFile</span></span><span>
</span><span id="line-1259"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Symbol, (Id, DataDeclaration Symbol Ann))]
-&gt; Map Symbol (Id, DataDeclaration Symbol Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Symbol, (Id, DataDeclaration Symbol Ann))]
</span><span class="hs-identifier hs-var">Builtin.builtinDataDecls</span></span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Symbol, (Id, EffectDeclaration Symbol Ann))]
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Symbol, (Id, EffectDeclaration Symbol Ann))]
</span><span class="hs-identifier hs-var">Builtin.builtinEffectDecls</span></span><span class="hs-special">)</span><span>
</span><span id="line-1261"></span><span>                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ann -&gt; [(Symbol, Term Symbol Ann, Type Symbol Ann)]
forall a. a -&gt; [(Symbol, Term Symbol a, Type Symbol a)]
</span><span class="hs-identifier hs-var">Builtin.builtinTermsSrc</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Intrinsic</span></span><span class="hs-special">]</span><span>
</span><span id="line-1262"></span><span>                      </span><span class="annot"><span class="annottext">[(String, [(Symbol, Term Symbol Ann, Type Symbol Ann)])]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1263"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; TypecheckedUnisonFile Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
(Monad m, Var v, Show a) =&gt;
Codebase m v a -&gt; TypecheckedUnisonFile v a -&gt; m ()
</span><span class="hs-identifier hs-var">Codebase.addDefsToCodebase</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404723"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404721"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1264"></span><span>              </span><span class="hs-comment">-- these have not necessarily been added yet</span><span>
</span><span id="line-1265"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; TypecheckedUnisonFile Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
(Monad m, Var v, Show a) =&gt;
Codebase m v a -&gt; TypecheckedUnisonFile v a -&gt; m ()
</span><span class="hs-identifier hs-var">Codebase.addDefsToCodebase</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404723"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><span class="hs-identifier hs-var">IOSource.typecheckedFile'</span></span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span>
</span><span id="line-1267"></span><span>              </span><span class="hs-comment">-- add the names; note, there are more names than definitions</span><span>
</span><span id="line-1268"></span><span>              </span><span class="hs-comment">-- due to builtin terms; so we don't just reuse `uf` above.</span><span>
</span><span id="line-1269"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404719"><span class="annot"><span class="annottext">names0 :: Names
</span><a href="#local-6989586621679404719"><span class="hs-identifier hs-var hs-var">names0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><span class="hs-identifier hs-var">Builtin.names0</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Names
forall v a. Var v =&gt; TypecheckedUnisonFile v a -&gt; Names
</span><span class="hs-identifier hs-var">UF.typecheckedToNames</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><span class="hs-identifier hs-var">IOSource.typecheckedFile'</span></span><span>
</span><span id="line-1270"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404717"><span class="annot"><span class="annottext">srcb :: Branch IO
</span><a href="#local-6989586621679404717"><span class="hs-identifier hs-var hs-var">srcb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Branch IO
forall (m :: * -&gt; *). Monad m =&gt; Names -&gt; Branch m
</span><span class="hs-identifier hs-var">BranchUtil.fromNames</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404719"><span class="hs-identifier hs-var">names0</span></a></span><span>
</span><span id="line-1271"></span><span>              </span><span id="local-6989586621679404716"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404716"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-1272"></span><span>              </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
forall r.
Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
</span><a href="Unison.Cli.MonadUtils.html#updateAtM"><span class="hs-identifier hs-var">Cli.updateAtM</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404722"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404716"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; NameSegment -&gt; Absolute
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">`snoc`</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;builtin&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404715"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404715"><span class="hs-identifier hs-var">destb</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1273"></span><span>                </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO)))
-&gt; MergeMode -&gt; Branch IO -&gt; Branch IO -&gt; IO (Branch IO)
forall (m :: * -&gt; *).
Monad m =&gt;
(Branch m -&gt; Branch m -&gt; m (Maybe (Branch m)))
-&gt; MergeMode -&gt; Branch m -&gt; Branch m -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Branch.merge''</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Branch m -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.lca</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404723"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><span class="hs-identifier hs-var">Branch.RegularMerge</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404717"><span class="hs-identifier hs-var">srcb</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404715"><span class="hs-identifier hs-var">destb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1274"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-1275"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ListEditsI"><span class="hs-identifier hs-type">ListEditsI</span></a></span><span> </span><span id="local-6989586621679404713"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404713"><span class="hs-identifier hs-var">maybePath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1276"></span><span>              </span><span id="local-6989586621679404712"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404712"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Patch
forall r. PatchPath -&gt; Cli r Patch
</span><a href="Unison.Cli.MonadUtils.html#getPatchAt"><span class="hs-identifier hs-var">Cli.getPatchAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatchPath -&gt; Maybe PatchPath -&gt; PatchPath
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="Unison.Cli.MonadUtils.html#defaultPatchPath"><span class="hs-identifier hs-var">Cli.defaultPatchPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404713"><span class="hs-identifier hs-var">maybePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1277"></span><span>              </span><span id="local-6989586621679404711"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404711"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1278"></span><span>                </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#suffixifiedPPE"><span class="hs-identifier hs-var">suffixifiedPPE</span></a></span><span>
</span><span id="line-1279"></span><span>                  </span><span class="annot"><span class="annottext">(NamesWithHistory -&gt; Cli r PrettyPrintEnv)
-&gt; Cli r NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Cli r NamesWithHistory
forall r. Set LabeledDependency -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makePrintNamesFromLabeled%27"><span class="hs-identifier hs-var">makePrintNamesFromLabeled'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Patch -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Patch.labeledDependencies</span></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404712"><span class="hs-identifier hs-var">patch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1280"></span><span>              </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="annot"><span class="annottext">(NumberedOutput -&gt; Cli r ()) -&gt; NumberedOutput -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Patch -&gt; PrettyPrintEnv -&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ListEdits"><span class="hs-identifier hs-var">ListEdits</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679404712"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404711"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-1281"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PullRemoteBranchI"><span class="hs-identifier hs-type">PullRemoteBranchI</span></a></span><span> </span><span id="local-6989586621679404706"><span class="annot"><span class="annottext">Maybe ReadRemoteNamespace
</span><a href="#local-6989586621679404706"><span class="hs-identifier hs-var">mayRepo</span></a></span></span><span> </span><span id="local-6989586621679404705"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404705"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span id="local-6989586621679404704"><span class="annot"><span class="annottext">SyncMode
</span><a href="#local-6989586621679404704"><span class="hs-identifier hs-var">syncMode</span></a></span></span><span> </span><span id="local-6989586621679404703"><span class="annot"><span class="annottext">PullMode
</span><a href="#local-6989586621679404703"><span class="hs-identifier hs-var">pullMode</span></a></span></span><span> </span><span id="local-6989586621679404702"><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679404702"><span class="hs-identifier hs-var">verbosity</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1282"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404701"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404701"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1283"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404700"><span class="annot"><span class="annottext">preprocess :: Preprocessing IO
</span><a href="#local-6989586621679404700"><span class="hs-identifier hs-var hs-var">preprocess</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PullMode
</span><a href="#local-6989586621679404703"><span class="hs-identifier hs-var">pullMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1284"></span><span>                    </span><span class="annot"><span class="annottext">PullMode
</span><a href="Unison.Codebase.Editor.Input.html#PullWithHistory"><span class="hs-identifier hs-var">Input.PullWithHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Preprocessing IO
forall (m :: * -&gt; *). Preprocessing m
</span><span class="hs-identifier hs-var">Unmodified</span></span><span>
</span><span id="line-1285"></span><span>                    </span><span class="annot"><span class="annottext">PullMode
</span><a href="Unison.Codebase.Editor.Input.html#PullWithoutHistory"><span class="hs-identifier hs-var">Input.PullWithoutHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Branch IO -&gt; IO (Branch IO)) -&gt; Preprocessing IO
forall (m :: * -&gt; *). (Branch m -&gt; m (Branch m)) -&gt; Preprocessing m
</span><span class="hs-identifier hs-var">Preprocessed</span></span><span> </span><span class="annot"><span class="annottext">((Branch IO -&gt; IO (Branch IO)) -&gt; Preprocessing IO)
-&gt; (Branch IO -&gt; IO (Branch IO)) -&gt; Preprocessing IO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; IO (Branch IO)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Branch IO -&gt; IO (Branch IO))
-&gt; (Branch IO -&gt; Branch IO) -&gt; Branch IO -&gt; IO (Branch IO)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch IO
forall (m :: * -&gt; *). Applicative m =&gt; Branch m -&gt; Branch m
</span><span class="hs-identifier hs-var">Branch.discardHistory</span></span><span>
</span><span id="line-1286"></span><span>              </span><span id="local-6989586621679404695"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404695"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r ReadRemoteNamespace
-&gt; (ReadRemoteNamespace -&gt; Cli r ReadRemoteNamespace)
-&gt; Maybe ReadRemoteNamespace
-&gt; Cli r ReadRemoteNamespace
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteRemotePath -&gt; ReadRemoteNamespace
</span><span class="hs-identifier hs-var">writePathToRead</span></span><span> </span><span class="annot"><span class="annottext">(WriteRemotePath -&gt; ReadRemoteNamespace)
-&gt; Cli r WriteRemotePath -&gt; Cli r ReadRemoteNamespace
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PushPull -&gt; Path' -&gt; Cli r WriteRemotePath
forall r. PushPull -&gt; Path' -&gt; Cli r WriteRemotePath
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveConfiguredUrl"><span class="hs-identifier hs-var">resolveConfiguredUrl</span></a></span><span> </span><span class="annot"><span class="annottext">PushPull
</span><a href="Unison.Codebase.Editor.Output.PushPull.html#Pull"><span class="hs-identifier hs-var">Pull</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404705"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; Cli r ReadRemoteNamespace
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe ReadRemoteNamespace
</span><a href="#local-6989586621679404706"><span class="hs-identifier hs-var">mayRepo</span></a></span><span>
</span><span id="line-1287"></span><span>              </span><span id="local-6989586621679404693"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404693"><span class="hs-identifier hs-var">remoteBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404695"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1288"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">ReadRemoteNamespaceGit</span></span><span> </span><span id="local-6989586621679404692"><span class="annot"><span class="annottext">ReadGitRemoteNamespace
</span><a href="#local-6989586621679404692"><span class="hs-identifier hs-var">repo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1289"></span><span>                  </span><span class="annot"><span class="annottext">IO (Either GitError (Branch IO))
-&gt; (GitError -&gt; Cli r (Branch IO)) -&gt; Cli r (Branch IO)
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ReadGitRemoteNamespace
-&gt; SyncMode
-&gt; Preprocessing IO
-&gt; IO (Either GitError (Branch IO))
forall (m :: * -&gt; *) v a.
MonadUnliftIO m =&gt;
Codebase m v a
-&gt; ReadGitRemoteNamespace
-&gt; SyncMode
-&gt; Preprocessing m
-&gt; m (Either GitError (Branch m))
</span><span class="hs-identifier hs-var">Codebase.importRemoteBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404701"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ReadGitRemoteNamespace
</span><a href="#local-6989586621679404692"><span class="hs-identifier hs-var">repo</span></a></span><span> </span><span class="annot"><span class="annottext">SyncMode
</span><a href="#local-6989586621679404704"><span class="hs-identifier hs-var">syncMode</span></a></span><span> </span><span class="annot"><span class="annottext">Preprocessing IO
</span><a href="#local-6989586621679404700"><span class="hs-identifier hs-var">preprocess</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404691"><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679404691"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1290"></span><span>                    </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Branch IO)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GitError -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#GitError"><span class="hs-identifier hs-var">Output.GitError</span></a></span><span> </span><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679404691"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1291"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">ReadRemoteNamespaceShare</span></span><span> </span><span id="local-6989586621679404690"><span class="annot"><span class="annottext">ReadShareRemoteNamespace
</span><a href="#local-6989586621679404690"><span class="hs-identifier hs-var">repo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReadShareRemoteNamespace -&gt; Cli r (Branch IO)
forall r. ReadShareRemoteNamespace -&gt; Cli r (Branch IO)
</span><a href="Unison.Codebase.Editor.HandleInput.html#importRemoteShareBranch"><span class="hs-identifier hs-var">importRemoteShareBranch</span></a></span><span> </span><span class="annot"><span class="annottext">ReadShareRemoteNamespace
</span><a href="#local-6989586621679404690"><span class="hs-identifier hs-var">repo</span></a></span><span>
</span><span id="line-1292"></span><span>              </span><span id="local-6989586621679404689"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404689"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Cli r Text
forall r. Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679405760"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-1293"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404688"><span class="annot"><span class="annottext">unchangedMsg :: Output
</span><a href="#local-6989586621679404688"><span class="hs-identifier hs-var hs-var">unchangedMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; Path' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#PullAlreadyUpToDate"><span class="hs-identifier hs-var">PullAlreadyUpToDate</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404695"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404705"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1294"></span><span>              </span><span id="local-6989586621679404686"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404686"><span class="hs-identifier hs-var">destAbs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404705"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1295"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404685"><span class="annot"><span class="annottext">printDiffPath :: Maybe Path'
</span><a href="#local-6989586621679404685"><span class="hs-identifier hs-var hs-var">printDiffPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Verbosity -&gt; Bool
</span><span class="hs-identifier hs-var">Verbosity.isSilent</span></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><a href="#local-6989586621679404702"><span class="hs-identifier hs-var">verbosity</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Path'
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Maybe Path'
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404705"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1296"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PullMode
</span><a href="#local-6989586621679404703"><span class="hs-identifier hs-var">pullMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1297"></span><span>                </span><span class="annot"><span class="annottext">PullMode
</span><a href="Unison.Codebase.Editor.Input.html#PullWithHistory"><span class="hs-identifier hs-var">Input.PullWithHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1298"></span><span>                  </span><span id="local-6989586621679404683"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404683"><span class="hs-identifier hs-var">destBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch0 IO)
forall r. Absolute -&gt; Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranch0At"><span class="hs-identifier hs-var">Cli.getBranch0At</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404686"><span class="hs-identifier hs-var">destAbs</span></a></span><span>
</span><span id="line-1299"></span><span>                  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Bool
forall (m :: * -&gt; *). Branch0 m -&gt; Bool
</span><span class="hs-identifier hs-var">Branch.isEmpty0</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404683"><span class="hs-identifier hs-var">destBranch</span></a></span><span>
</span><span id="line-1300"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1301"></span><span>                      </span><span class="annot"><span class="annottext">Cli r Bool -&gt; Cli r ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Cli r Bool -&gt; Cli r ()) -&gt; Cli r Bool -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
forall r.
Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
</span><a href="Unison.Cli.MonadUtils.html#updateAtM"><span class="hs-identifier hs-var">Cli.updateAtM</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404689"><span class="hs-identifier hs-var">description</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404686"><span class="hs-identifier hs-var">destAbs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cli r (Branch IO) -&gt; Branch IO -&gt; Cli r (Branch IO)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Cli r (Branch IO) -&gt; Branch IO -&gt; Cli r (Branch IO))
-&gt; Cli r (Branch IO) -&gt; Branch IO -&gt; Cli r (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Cli r (Branch IO)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404693"><span class="hs-identifier hs-var">remoteBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1302"></span><span>                      </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MergeOverEmpty"><span class="hs-identifier hs-var">MergeOverEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404705"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1303"></span><span>                    </span><span class="hs-keyword">else</span><span>
</span><span id="line-1304"></span><span>                      </span><span class="annot"><span class="annottext">MergeMode
-&gt; Text
-&gt; Maybe Output
-&gt; Branch IO
-&gt; Maybe Path'
-&gt; Absolute
-&gt; Cli r ()
forall r.
MergeMode
-&gt; Text
-&gt; Maybe Output
-&gt; Branch IO
-&gt; Maybe Path'
-&gt; Absolute
-&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#mergeBranchAndPropagateDefaultPatch"><span class="hs-identifier hs-var">mergeBranchAndPropagateDefaultPatch</span></a></span><span>
</span><span id="line-1305"></span><span>                        </span><span class="annot"><span class="annottext">MergeMode
</span><span class="hs-identifier hs-var">Branch.RegularMerge</span></span><span>
</span><span id="line-1306"></span><span>                        </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404689"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-1307"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Maybe Output
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="#local-6989586621679404688"><span class="hs-identifier hs-var">unchangedMsg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1308"></span><span>                        </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404693"><span class="hs-identifier hs-var">remoteBranch</span></a></span><span>
</span><span id="line-1309"></span><span>                        </span><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679404685"><span class="hs-identifier hs-var">printDiffPath</span></a></span><span>
</span><span id="line-1310"></span><span>                        </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404686"><span class="hs-identifier hs-var">destAbs</span></a></span><span>
</span><span id="line-1311"></span><span>                </span><span class="annot"><span class="annottext">PullMode
</span><a href="Unison.Codebase.Editor.Input.html#PullWithoutHistory"><span class="hs-identifier hs-var">Input.PullWithoutHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1312"></span><span>                  </span><span id="local-6989586621679404681"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404681"><span class="hs-identifier hs-var">didUpdate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1313"></span><span>                    </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
forall r.
Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
</span><a href="Unison.Cli.MonadUtils.html#updateAtM"><span class="hs-identifier hs-var">Cli.updateAtM</span></a></span><span>
</span><span id="line-1314"></span><span>                      </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404689"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-1315"></span><span>                      </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404686"><span class="hs-identifier hs-var">destAbs</span></a></span><span>
</span><span id="line-1316"></span><span>                      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679404680"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404680"><span class="hs-identifier hs-var">destBranch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Cli r (Branch IO)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Branch IO -&gt; Cli r (Branch IO)) -&gt; Branch IO -&gt; Cli r (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404693"><span class="hs-identifier hs-var">remoteBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch IO -&gt; Branch IO
forall (m :: * -&gt; *). Monad m =&gt; Branch m -&gt; Branch m -&gt; Branch m
</span><span class="hs-operator hs-var">`Branch.consBranchSnapshot`</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404680"><span class="hs-identifier hs-var">destBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1317"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span>
</span><span id="line-1318"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404681"><span class="hs-identifier hs-var">didUpdate</span></a></span><span>
</span><span id="line-1319"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; Path' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#PullSuccessful"><span class="hs-identifier hs-var">PullSuccessful</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404695"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404705"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-1320"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="#local-6989586621679404688"><span class="hs-identifier hs-var">unchangedMsg</span></a></span><span>
</span><span id="line-1321"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PushRemoteBranchI"><span class="hs-identifier hs-type">PushRemoteBranchI</span></a></span><span> </span><span id="local-6989586621679404676"><span class="annot"><span class="annottext">PushRemoteBranchInput
</span><a href="#local-6989586621679404676"><span class="hs-identifier hs-var">pushRemoteBranchInput</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PushRemoteBranchInput -&gt; Cli r ()
forall r. PushRemoteBranchInput -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handlePushRemoteBranch"><span class="hs-identifier hs-var">handlePushRemoteBranch</span></a></span><span> </span><span class="annot"><span class="annottext">PushRemoteBranchInput
</span><a href="#local-6989586621679404676"><span class="hs-identifier hs-var">pushRemoteBranchInput</span></a></span><span>
</span><span id="line-1322"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ListDependentsI"><span class="hs-identifier hs-type">ListDependentsI</span></a></span><span> </span><span id="local-6989586621679404673"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404673"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Cli r ()
forall r. HashQualified Name -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleDependents"><span class="hs-identifier hs-var">handleDependents</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404673"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-1323"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ListDependenciesI"><span class="hs-identifier hs-type">ListDependenciesI</span></a></span><span> </span><span id="local-6989586621679404670"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404670"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1324"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404669"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404669"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1325"></span><span>              </span><span id="local-6989586621679404668"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404668"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404669"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1326"></span><span>              </span><span class="hs-comment">-- todo: add flag to handle transitive efficiently</span><span>
</span><span id="line-1327"></span><span>              </span><span id="local-6989586621679404667"><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679404667"><span class="hs-identifier hs-var">lds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Cli r (Set LabeledDependency)
forall r. HashQualified Name -&gt; Cli r (Set LabeledDependency)
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveHQToLabeledDependencies"><span class="hs-identifier hs-var">resolveHQToLabeledDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404670"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-1328"></span><span>              </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679404667"><span class="hs-identifier hs-var">lds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1329"></span><span>                </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#LabeledReferenceNotFound"><span class="hs-identifier hs-var">LabeledReferenceNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404670"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1330"></span><span>              </span><span id="local-6989586621679404664"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404664"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-1331"></span><span>              </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; (LabeledDependency -&gt; Cli r ()) -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679404667"><span class="hs-identifier hs-var">lds</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404663"><span class="annot"><span class="annottext">LabeledDependency
</span><a href="#local-6989586621679404663"><span class="hs-identifier hs-var">ld</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1332"></span><span>                </span><span id="local-6989586621679404662"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679404662"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1333"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404661"><span class="annot"><span class="annottext">tp :: Reference -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679404661"><span class="hs-identifier hs-var hs-var">tp</span></a></span></span><span> </span><span id="local-6989586621679404660"><span class="annot"><span class="annottext">r :: Reference
</span><a href="#local-6989586621679404660"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679404659"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404659"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1334"></span><span>                        </span><span class="annot"><span class="annottext">IO (Maybe (Decl Symbol Ann)) -&gt; Cli r (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Id -&gt; IO (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404669"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404659"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Decl Symbol Ann))
-&gt; (Maybe (Decl Symbol Ann) -&gt; Set Reference)
-&gt; Cli r (Set Reference)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1335"></span><span>                          </span><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Set Reference
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Set Reference) -&gt; String -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;What happened to &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404659"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;?&quot;</span></span><span>
</span><span id="line-1336"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679404657"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679404657"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Set Reference -&gt; Set Reference
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404660"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Set Reference)
-&gt; (DataDeclaration Symbol Ann -&gt; Set Reference)
-&gt; DataDeclaration Symbol Ann
-&gt; Set Reference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; Set Reference
forall v a. Ord v =&gt; DataDeclaration v a -&gt; Set Reference
</span><span class="hs-identifier hs-var">DD.dependencies</span></span><span> </span><span class="annot"><span class="annottext">(DataDeclaration Symbol Ann -&gt; Set Reference)
-&gt; DataDeclaration Symbol Ann -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v a. Decl v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var">DD.asDataDecl</span></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679404657"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-1337"></span><span>                      </span><span class="annot"><a href="#local-6989586621679404661"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Cli r (Set Reference)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1338"></span><span>                      </span><span id="local-6989586621679404654"><span class="annot"><span class="annottext">tm :: Referent -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679404654"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679404653"><span class="annot"><span class="annottext">r :: Reference
</span><a href="#local-6989586621679404653"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679404652"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404652"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1339"></span><span>                        </span><span class="annot"><span class="annottext">IO (Maybe (Term Symbol Ann)) -&gt; Cli r (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Id -&gt; IO (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Term v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404669"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404652"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Term Symbol Ann))
-&gt; (Maybe (Term Symbol Ann) -&gt; Set Reference)
-&gt; Cli r (Set Reference)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1340"></span><span>                          </span><span class="annot"><span class="annottext">Maybe (Term Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Set Reference
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Set Reference) -&gt; String -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;What happened to &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404652"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;?&quot;</span></span><span>
</span><span id="line-1341"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679404650"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404650"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Set Reference -&gt; Set Reference
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404653"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Set Reference) -&gt; Set Reference -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Set Reference
forall v vt at ap a.
(Ord v, Ord vt) =&gt;
Term2 vt at ap v a -&gt; Set Reference
</span><span class="hs-identifier hs-var">Term.dependencies</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404650"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1342"></span><span>                      </span><span class="annot"><a href="#local-6989586621679404654"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span id="local-6989586621679404648"><span class="annot"><span class="annottext">con :: Referent
</span><a href="#local-6989586621679404648"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679404646"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404646"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679404645"><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404645"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679404644"><span class="annot"><span class="annottext">ConstructorType
</span><a href="#local-6989586621679404644"><span class="hs-identifier hs-var">_ct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1343"></span><span>                        </span><span class="annot"><span class="annottext">IO (Maybe (Decl Symbol Ann)) -&gt; Cli r (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Id -&gt; IO (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404669"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404646"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Decl Symbol Ann))
-&gt; (Maybe (Decl Symbol Ann) -&gt; Set Reference)
-&gt; Cli r (Set Reference)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1344"></span><span>                          </span><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Set Reference
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Set Reference) -&gt; String -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;What happened to &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404646"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;?&quot;</span></span><span>
</span><span id="line-1345"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679404643"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679404643"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann
-&gt; ConstructorId -&gt; Maybe (Type Symbol Ann)
forall v a.
DataDeclaration v a -&gt; ConstructorId -&gt; Maybe (Type v a)
</span><span class="hs-identifier hs-var">DD.typeOfConstructor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v a. Decl v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var">DD.asDataDecl</span></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679404643"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404645"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1346"></span><span>                            </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Set Reference
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Set Reference) -&gt; String -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;What happened to &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679404648"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;?&quot;</span></span><span>
</span><span id="line-1347"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679404641"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404641"><span class="hs-identifier hs-var">tp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Set Reference
forall v a. Ord v =&gt; Type v a -&gt; Set Reference
</span><span class="hs-identifier hs-var">Type.dependencies</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404641"><span class="hs-identifier hs-var">tp</span></a></span><span>
</span><span id="line-1348"></span><span>                      </span><span class="annot"><a href="#local-6989586621679404654"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Cli r (Set Reference)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1349"></span><span>                   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Cli r (Set Reference))
-&gt; (Referent -&gt; Cli r (Set Reference))
-&gt; LabeledDependency
-&gt; Cli r (Set Reference)
forall a.
(Reference -&gt; a) -&gt; (Referent -&gt; a) -&gt; LabeledDependency -&gt; a
</span><span class="hs-identifier hs-var">LD.fold</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679404661"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679404654"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">LabeledDependency
</span><a href="#local-6989586621679404663"><span class="hs-identifier hs-var">ld</span></a></span><span>
</span><span id="line-1350"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679404638"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679404638"><span class="hs-identifier hs-var">missing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404637"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404637"><span class="hs-identifier hs-var">names0</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set Reference, Names) -&gt; Cli r (Set Reference, Names)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Branch IO -&gt; IO (Set Reference, Names)
forall (m :: * -&gt; *).
Monad m =&gt;
Set Reference -&gt; Branch m -&gt; m (Set Reference, Names)
</span><span class="hs-identifier hs-var">Branch.findHistoricalRefs'</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679404662"><span class="hs-identifier hs-var">dependencies</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404664"><span class="hs-identifier hs-var">rootBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1351"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404635"><span class="annot"><span class="annottext">types :: [(Name, Reference)]
</span><a href="#local-6989586621679404635"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Relation Name Reference -&gt; [(Name, Reference)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">R.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Name Reference -&gt; [(Name, Reference)])
-&gt; Relation Name Reference -&gt; [(Name, Reference)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Relation Name Reference
</span><span class="hs-identifier hs-var hs-var">Names.types</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404637"><span class="hs-identifier hs-var">names0</span></a></span><span>
</span><span id="line-1352"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404632"><span class="annot"><span class="annottext">terms :: [(Name, Reference)]
</span><a href="#local-6989586621679404632"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, Referent) -&gt; (Name, Reference))
-&gt; [(Name, Referent)] -&gt; [(Name, Reference)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Referent -&gt; Reference) -&gt; (Name, Referent) -&gt; (Name, Reference)
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Reference
</span><span class="hs-identifier hs-var">Referent.toReference</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Name, Referent)] -&gt; [(Name, Reference)])
-&gt; [(Name, Referent)] -&gt; [(Name, Reference)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Relation Name Referent -&gt; [(Name, Referent)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">R.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Name Referent -&gt; [(Name, Referent)])
-&gt; Relation Name Referent -&gt; [(Name, Referent)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Relation Name Referent
</span><span class="hs-identifier hs-var hs-var">Names.terms</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404637"><span class="hs-identifier hs-var">names0</span></a></span><span>
</span><span id="line-1353"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404629"><span class="annot"><span class="annottext">names :: [(Name, Reference)]
</span><a href="#local-6989586621679404629"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, Reference)]
</span><a href="#local-6989586621679404635"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference)] -&gt; [(Name, Reference)] -&gt; [(Name, Reference)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference)]
</span><a href="#local-6989586621679404632"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-cpp">
                #numberedArgs .= fmap (Text.unpack . Reference.toText) ((fmap snd names) &lt;&gt; toList missing)
</span><span>                </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int
-&gt; LabeledDependency
-&gt; [(Name, Reference)]
-&gt; Set Reference
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ListDependencies"><span class="hs-identifier hs-var">ListDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404668"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">LabeledDependency
</span><a href="#local-6989586621679404663"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference)]
</span><a href="#local-6989586621679404629"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679404638"><span class="hs-identifier hs-var">missing</span></a></span><span>
</span><span id="line-1356"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#NamespaceDependenciesI"><span class="hs-identifier hs-type">NamespaceDependenciesI</span></a></span><span> </span><span id="local-6989586621679404624"><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679404624"><span class="hs-identifier hs-var">namespacePath'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1357"></span><span>              </span><span id="local-6989586621679404623"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404623"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
-&gt; (Path' -&gt; Cli r Absolute) -&gt; Maybe Path' -&gt; Cli r Absolute
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679404624"><span class="hs-identifier hs-var">namespacePath'</span></a></span><span>
</span><span id="line-1358"></span><span>              </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Maybe (Branch IO))
forall r. Absolute -&gt; Cli r (Maybe (Branch IO))
</span><a href="Unison.Cli.MonadUtils.html#getMaybeBranchAt"><span class="hs-identifier hs-var">Cli.getMaybeBranchAt</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404623"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Branch IO))
-&gt; (Maybe (Branch IO) -&gt; Cli r ()) -&gt; Cli r ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1359"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Branch IO)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#BranchEmpty"><span class="hs-identifier hs-var">BranchEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path' -&gt; Either ShortBranchHash Path'
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path'
</span><span class="hs-identifier hs-var">Path.absoluteToPath'</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404623"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1360"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679404621"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404621"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1361"></span><span>                  </span><span id="local-6989586621679404620"><span class="annot"><span class="annottext">Map LabeledDependency (Set Name)
</span><a href="#local-6989586621679404620"><span class="hs-identifier hs-var">externalDependencies</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Cli r (Map LabeledDependency (Set Name))
forall (m :: * -&gt; *) r.
Branch0 m -&gt; Cli r (Map LabeledDependency (Set Name))
</span><a href="Unison.Codebase.Editor.HandleInput.NamespaceDependencies.html#namespaceDependencies"><span class="hs-identifier hs-var">NamespaceDependencies.namespaceDependencies</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404621"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1362"></span><span>                  </span><span id="local-6989586621679404618"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404618"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">(PrettyPrintEnvDecl -&gt; PrettyPrintEnv)
-&gt; Cli r PrettyPrintEnvDecl -&gt; Cli r PrettyPrintEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
forall r. (Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#currentPrettyPrintEnvDecl"><span class="hs-identifier hs-var">currentPrettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span>
</span><span id="line-1363"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; Absolute -&gt; Map LabeledDependency (Set Name) -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ListNamespaceDependencies"><span class="hs-identifier hs-var">ListNamespaceDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404618"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404623"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">Map LabeledDependency (Set Name)
</span><a href="#local-6989586621679404620"><span class="hs-identifier hs-var">externalDependencies</span></a></span><span>
</span><span id="line-1364"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#DebugNumberedArgsI"><span class="hs-identifier hs-var">DebugNumberedArgsI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1365"></span><span>              </span><span id="local-6989586621679404615"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404615"><span class="hs-identifier hs-var">numArgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting [String] LoopState [String] -&gt; Cli r [String]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;numberedArgs&quot; (Getting [String] LoopState [String])
Getting [String] LoopState [String]
</span><a href="#local-6989586621679404613"><span class="hs-var">#numberedArgs</span></a></span><span>
</span><span id="line-1366"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DumpNumberedArgs"><span class="hs-identifier hs-var">DumpNumberedArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404615"><span class="hs-identifier hs-var">numArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1367"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#DebugTypecheckedUnisonFileI"><span class="hs-identifier hs-var">DebugTypecheckedUnisonFileI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1368"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404610"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404610"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1369"></span><span>              </span><span id="local-6989586621679404609"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404609"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404610"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1370"></span><span>              </span><span id="local-6989586621679404608"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404608"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (TypecheckedUnisonFile Symbol Ann)
forall r. Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.Cli.MonadUtils.html#expectLatestTypecheckedFile"><span class="hs-identifier hs-var">Cli.expectLatestTypecheckedFile</span></a></span><span>
</span><span id="line-1371"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679404607"><span class="hs-identifier hs-type">datas</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679404606"><span class="hs-identifier hs-type">effects</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679404605"><span class="hs-identifier hs-type">terms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1372"></span><span>                  </span><span id="local-6989586621679404607"><span class="annot"><span class="annottext">datas :: [(Name, Id)]
</span><a href="#local-6989586621679404607"><span class="hs-identifier hs-var hs-var">datas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679404603"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404602"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404603"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679404603"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404602"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404602"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404601"><span class="annot"><span class="annottext">DataDeclaration Symbol Ann
</span><a href="#local-6989586621679404601"><span class="hs-identifier hs-var">_d</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Symbol (Id, DataDeclaration Symbol Ann)
-&gt; [(Symbol, (Id, DataDeclaration Symbol Ann))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Symbol (Id, DataDeclaration Symbol Ann)
 -&gt; [(Symbol, (Id, DataDeclaration Symbol Ann))])
-&gt; Map Symbol (Id, DataDeclaration Symbol Ann)
-&gt; [(Symbol, (Id, DataDeclaration Symbol Ann))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Map Symbol (Id, DataDeclaration Symbol Ann)
forall v a.
TypecheckedUnisonFile v a -&gt; Map v (Id, DataDeclaration v a)
</span><span class="hs-identifier hs-var hs-var">UF.dataDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404608"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1373"></span><span>                  </span><span id="local-6989586621679404606"><span class="annot"><span class="annottext">effects :: [(Name, Id)]
</span><a href="#local-6989586621679404606"><span class="hs-identifier hs-var hs-var">effects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679404599"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404598"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404599"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679404599"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404598"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404598"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404597"><span class="annot"><span class="annottext">EffectDeclaration Symbol Ann
</span><a href="#local-6989586621679404597"><span class="hs-identifier hs-var">_e</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Symbol (Id, EffectDeclaration Symbol Ann)
-&gt; [(Symbol, (Id, EffectDeclaration Symbol Ann))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Symbol (Id, EffectDeclaration Symbol Ann)
 -&gt; [(Symbol, (Id, EffectDeclaration Symbol Ann))])
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
-&gt; [(Symbol, (Id, EffectDeclaration Symbol Ann))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
forall v a.
TypecheckedUnisonFile v a -&gt; Map v (Id, EffectDeclaration v a)
</span><span class="hs-identifier hs-var hs-var">UF.effectDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404608"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1374"></span><span>                  </span><span id="local-6989586621679404605"><span class="annot"><span class="annottext">terms :: [(Name, Id)]
</span><a href="#local-6989586621679404605"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679404595"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404594"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404595"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679404595"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404594"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679404594"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404593"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679404593"><span class="hs-identifier hs-var">_wk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404592"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679404592"><span class="hs-identifier hs-var">_tm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404591"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404591"><span class="hs-identifier hs-var">_tp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map Symbol (Id, Maybe String, Term Symbol Ann, Type Symbol Ann)
-&gt; [(Symbol, (Id, Maybe String, Term Symbol Ann, Type Symbol Ann))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Symbol (Id, Maybe String, Term Symbol Ann, Type Symbol Ann)
 -&gt; [(Symbol,
      (Id, Maybe String, Term Symbol Ann, Type Symbol Ann))])
-&gt; Map Symbol (Id, Maybe String, Term Symbol Ann, Type Symbol Ann)
-&gt; [(Symbol, (Id, Maybe String, Term Symbol Ann, Type Symbol Ann))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Map Symbol (Id, Maybe String, Term Symbol Ann, Type Symbol Ann)
forall v a.
TypecheckedUnisonFile v a
-&gt; Map v (Id, Maybe String, Term v a, Type v a)
</span><span class="hs-identifier hs-var hs-var">UF.hashTermsId</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679404608"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1375"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Name, Id)] -&gt; [(Name, Id)] -&gt; [(Name, Id)] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DumpUnisonFileHashes"><span class="hs-identifier hs-var">DumpUnisonFileHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404609"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621679404607"><span class="hs-identifier hs-var">datas</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621679404606"><span class="hs-identifier hs-var">effects</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Id)]
</span><a href="#local-6989586621679404605"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-1376"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugTabCompletionI"><span class="hs-identifier hs-type">DebugTabCompletionI</span></a></span><span> </span><span id="local-6989586621679404587"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404587"><span class="hs-identifier hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1377"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404586"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404586"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1378"></span><span>              </span><span id="local-6989586621679404585"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404585"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-1379"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404584"><span class="annot"><span class="annottext">completionFunc :: CompletionFunc IO
</span><a href="#local-6989586621679404584"><span class="hs-identifier hs-var hs-var">completionFunc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map String InputPattern
-&gt; Codebase IO Symbol Ann -&gt; Absolute -&gt; CompletionFunc IO
forall (m :: * -&gt; *) v a.
MonadIO m =&gt;
Map String InputPattern
-&gt; Codebase m v a -&gt; Absolute -&gt; CompletionFunc m
</span><a href="Unison.CommandLine.Completion.html#haskelineTabComplete"><span class="hs-identifier hs-var">Completion.haskelineTabComplete</span></a></span><span> </span><span class="annot"><span class="annottext">Map String InputPattern
</span><a href="Unison.CommandLine.InputPatterns.html#patternMap"><span class="hs-identifier hs-var">IP.patternMap</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404586"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404585"><span class="hs-identifier hs-var">currentPath</span></a></span><span>
</span><span id="line-1380"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404581"><span class="annot"><span class="annottext">[Completion]
</span><a href="#local-6989586621679404581"><span class="hs-identifier hs-var">completions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (String, [Completion]) -&gt; Cli r (String, [Completion])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (String, [Completion]) -&gt; Cli r (String, [Completion]))
-&gt; IO (String, [Completion]) -&gt; Cli r (String, [Completion])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CompletionFunc IO
</span><a href="#local-6989586621679404584"><span class="hs-identifier hs-var">completionFunc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404587"><span class="hs-identifier hs-var">inputs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1381"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Completion] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DisplayDebugCompletions"><span class="hs-identifier hs-var">DisplayDebugCompletions</span></a></span><span> </span><span class="annot"><span class="annottext">[Completion]
</span><a href="#local-6989586621679404581"><span class="hs-identifier hs-var">completions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1382"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#DebugDumpNamespacesI"><span class="hs-identifier hs-var">DebugDumpNamespacesI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1383"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404576"><span class="annot"><span class="annottext">seen :: a -&gt; m Bool
</span><a href="#local-6989586621679404576"><span class="hs-identifier hs-var hs-var">seen</span></a></span></span><span> </span><span id="local-6989586621679404575"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404575"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set a -&gt; Bool) -&gt; m Bool
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">State.gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404575"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1384"></span><span>                  </span><span id="local-6989586621679404572"><span class="annot"><span class="annottext">set :: a -&gt; m ()
</span><a href="#local-6989586621679404572"><span class="hs-identifier hs-var hs-var">set</span></a></span></span><span> </span><span id="local-6989586621679404571"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404571"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set a -&gt; Set a) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">State.modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Set a
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404571"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1385"></span><span>                  </span><span id="local-6989586621679404568"><span class="annot"><span class="annottext">getCausal :: Branch m -&gt; (CausalHash, f (UnwrappedBranch m))
</span><a href="#local-6989586621679404568"><span class="hs-identifier hs-var hs-var">getCausal</span></a></span></span><span> </span><span id="local-6989586621679404567"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679404567"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch m -&gt; CausalHash
forall (m :: * -&gt; *). Branch m -&gt; CausalHash
</span><span class="hs-identifier hs-var">Branch.headHash</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679404567"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UnwrappedBranch m -&gt; f (UnwrappedBranch m)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(UnwrappedBranch m -&gt; f (UnwrappedBranch m))
-&gt; UnwrappedBranch m -&gt; f (UnwrappedBranch m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; UnwrappedBranch m
forall (m :: * -&gt; *). Branch m -&gt; UnwrappedBranch m
</span><span class="hs-identifier hs-var hs-var">Branch._history</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679404567"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1386"></span><span>                  </span><span class="annot"><a href="#local-6989586621679404566"><span class="hs-identifier hs-type">goCausal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679406607"><span class="annot"><a href="#local-6989586621679406607"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679406607"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch.CausalHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679406607"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch.UnwrappedBranch</span></span><span> </span><span class="annot"><a href="#local-6989586621679406607"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch.CausalHash</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679406607"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1387"></span><span>                  </span><span id="local-6989586621679404566"><span class="annot"><span class="annottext">goCausal :: [(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
</span><a href="#local-6989586621679404566"><span class="hs-identifier hs-var hs-var">goCausal</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; StateT (Set CausalHash) m ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1388"></span><span>                  </span><span class="annot"><a href="#local-6989586621679404566"><span class="hs-identifier hs-var">goCausal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679404565"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404565"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404564"><span class="annot"><span class="annottext">m (UnwrappedBranch m)
</span><a href="#local-6989586621679404564"><span class="hs-identifier hs-var">mc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679404563"><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404563"><span class="hs-identifier hs-var">queue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1389"></span><span>                    </span><span class="annot"><span class="annottext">StateT (Set CausalHash) m Bool
-&gt; StateT (Set CausalHash) m ()
-&gt; StateT (Set CausalHash) m ()
-&gt; StateT (Set CausalHash) m ()
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">ifM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; StateT (Set CausalHash) m Bool
forall a (m :: * -&gt; *).
(MonadState (Set a) m, Ord a) =&gt;
a -&gt; m Bool
</span><a href="#local-6989586621679404576"><span class="hs-identifier hs-var">seen</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404565"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
forall (m :: * -&gt; *).
Monad m =&gt;
[(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
</span><a href="#local-6989586621679404566"><span class="hs-identifier hs-var">goCausal</span></a></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404563"><span class="hs-identifier hs-var">queue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1390"></span><span>                      </span><span class="annot"><span class="annottext">m (UnwrappedBranch m)
-&gt; StateT (Set CausalHash) m (UnwrappedBranch m)
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">m (UnwrappedBranch m)
</span><a href="#local-6989586621679404564"><span class="hs-identifier hs-var">mc</span></a></span><span> </span><span class="annot"><span class="annottext">StateT (Set CausalHash) m (UnwrappedBranch m)
-&gt; (UnwrappedBranch m -&gt; StateT (Set CausalHash) m ())
-&gt; StateT (Set CausalHash) m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1391"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Causal.One</span></span><span> </span><span id="local-6989586621679404560"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404560"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679404559"><span class="annot"><span class="annottext">HashFor (Branch0 m)
</span><a href="#local-6989586621679404559"><span class="hs-identifier hs-var">_bh</span></a></span></span><span> </span><span id="local-6989586621679404558"><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679404558"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CausalHash
-&gt; Branch0 m
-&gt; [CausalHash]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
forall (m :: * -&gt; *).
Monad m =&gt;
CausalHash
-&gt; Branch0 m
-&gt; [CausalHash]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
</span><a href="#local-6989586621679404557"><span class="hs-identifier hs-var">goBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404560"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679404558"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">[CausalHash]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404563"><span class="hs-identifier hs-var">queue</span></a></span><span>
</span><span id="line-1392"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Causal.Cons</span></span><span> </span><span id="local-6989586621679404556"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404556"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679404555"><span class="annot"><span class="annottext">HashFor (Branch0 m)
</span><a href="#local-6989586621679404555"><span class="hs-identifier hs-var">_bh</span></a></span></span><span> </span><span id="local-6989586621679404554"><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679404554"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679404553"><span class="annot"><span class="annottext">(CausalHash, m (UnwrappedBranch m))
</span><a href="#local-6989586621679404553"><span class="hs-identifier hs-var">tail</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CausalHash
-&gt; Branch0 m
-&gt; [CausalHash]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
forall (m :: * -&gt; *).
Monad m =&gt;
CausalHash
-&gt; Branch0 m
-&gt; [CausalHash]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
</span><a href="#local-6989586621679404557"><span class="hs-identifier hs-var">goBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404556"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679404554"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(CausalHash, m (UnwrappedBranch m)) -&gt; CausalHash
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash, m (UnwrappedBranch m))
</span><a href="#local-6989586621679404553"><span class="hs-identifier hs-var">tail</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CausalHash, m (UnwrappedBranch m))
</span><a href="#local-6989586621679404553"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">(CausalHash, m (UnwrappedBranch m))
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404563"><span class="hs-identifier hs-var">queue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1393"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Causal.Merge</span></span><span> </span><span id="local-6989586621679404552"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404552"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679404551"><span class="annot"><span class="annottext">HashFor (Branch0 m)
</span><a href="#local-6989586621679404551"><span class="hs-identifier hs-var">_bh</span></a></span></span><span> </span><span id="local-6989586621679404550"><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679404550"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map CausalHash (m (UnwrappedBranch m))
-&gt; [(CausalHash, m (UnwrappedBranch m))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679404549"><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404549"><span class="hs-identifier hs-var">tails</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CausalHash
-&gt; Branch0 m
-&gt; [CausalHash]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
forall (m :: * -&gt; *).
Monad m =&gt;
CausalHash
-&gt; Branch0 m
-&gt; [CausalHash]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
</span><a href="#local-6989586621679404557"><span class="hs-identifier hs-var">goBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404552"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679404550"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((CausalHash, m (UnwrappedBranch m)) -&gt; CausalHash)
-&gt; [(CausalHash, m (UnwrappedBranch m))] -&gt; [CausalHash]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(CausalHash, m (UnwrappedBranch m)) -&gt; CausalHash
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404549"><span class="hs-identifier hs-var">tails</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404549"><span class="hs-identifier hs-var">tails</span></a></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404563"><span class="hs-identifier hs-var">queue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>                  </span><span class="annot"><a href="#local-6989586621679404557"><span class="hs-identifier hs-type">goBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679406602"><span class="annot"><a href="#local-6989586621679406602"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679406602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch.CausalHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Branch.CausalHash</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch.CausalHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679406602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch.UnwrappedBranch</span></span><span> </span><span class="annot"><a href="#local-6989586621679406602"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch.CausalHash</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679406602"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1395"></span><span>                  </span><span id="local-6989586621679404557"><span class="annot"><span class="annottext">goBranch :: CausalHash
-&gt; Branch0 m
-&gt; [CausalHash]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
</span><a href="#local-6989586621679404557"><span class="hs-identifier hs-var hs-var">goBranch</span></a></span></span><span> </span><span id="local-6989586621679404548"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404548"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679404547"><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679404547"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CausalHash] -&gt; Set CausalHash
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679404546"><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679404546"><span class="hs-identifier hs-var">causalParents</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679404545"><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404545"><span class="hs-identifier hs-var">queue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679404547"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1396"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span id="local-6989586621679404543"><span class="annot"><span class="annottext">Star Referent NameSegment
</span><a href="#local-6989586621679404543"><span class="hs-identifier hs-var">terms0</span></a></span></span><span> </span><span id="local-6989586621679404542"><span class="annot"><span class="annottext">Star Reference NameSegment
</span><a href="#local-6989586621679404542"><span class="hs-identifier hs-var">types0</span></a></span></span><span> </span><span id="local-6989586621679404541"><span class="annot"><span class="annottext">Map NameSegment (Branch m)
</span><a href="#local-6989586621679404541"><span class="hs-identifier hs-var">children0</span></a></span></span><span> </span><span id="local-6989586621679404540"><span class="annot"><span class="annottext">Map NameSegment (Hash, m Patch)
</span><a href="#local-6989586621679404540"><span class="hs-identifier hs-var">patches0</span></a></span></span><span> </span><span class="annot"><span class="annottext">Relation Referent Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Relation Reference Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">R4 Referent Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">R4 Reference Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Set Path
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Map Name Hash
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1397"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679406585"><span id="local-6989586621679406586"><span class="annot"><a href="#local-6989586621679404539"><span class="hs-identifier hs-type">wrangleMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679406586"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679406585"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Metadata.Star</span></span><span> </span><span class="annot"><a href="#local-6989586621679406586"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406585"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406586"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679406586"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679406585"><span class="hs-identifier hs-type">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Metadata.Value</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1398"></span><span>                          </span><span id="local-6989586621679404539"><span class="annot"><span class="annottext">wrangleMetadata :: Star r n -&gt; r -&gt; (r, (Set n, Set Reference))
</span><a href="#local-6989586621679404539"><span class="hs-identifier hs-var hs-var">wrangleMetadata</span></a></span></span><span> </span><span id="local-6989586621679404537"><span class="annot"><span class="annottext">Star r n
</span><a href="#local-6989586621679404537"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679404536"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679404536"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1399"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679404536"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Relation r n -&gt; Set n
forall a b. Ord a =&gt; a -&gt; Relation a b -&gt; Set b
</span><span class="hs-identifier hs-var">R.lookupDom</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679404536"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Relation r n -&gt; Set n) -&gt; Relation r n -&gt; Set n
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Star r n -&gt; Relation r n
forall fact d1 d2 d3. Star3 fact d1 d2 d3 -&gt; Relation fact d1
</span><span class="hs-identifier hs-var hs-var">Star3.d1</span></span><span> </span><span class="annot"><span class="annottext">Star r n
</span><a href="#local-6989586621679404537"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((Reference, Reference) -&gt; Reference)
-&gt; Set (Reference, Reference) -&gt; Set Reference
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">(Reference, Reference) -&gt; Reference
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">(Set (Reference, Reference) -&gt; Set Reference)
-&gt; (Relation r (Reference, Reference)
    -&gt; Set (Reference, Reference))
-&gt; Relation r (Reference, Reference)
-&gt; Set Reference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">r
-&gt; Relation r (Reference, Reference) -&gt; Set (Reference, Reference)
forall a b. Ord a =&gt; a -&gt; Relation a b -&gt; Set b
</span><span class="hs-identifier hs-var">R.lookupDom</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679404536"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(Relation r (Reference, Reference) -&gt; Set Reference)
-&gt; Relation r (Reference, Reference) -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Star r n -&gt; Relation r (Reference, Reference)
forall fact d1 d2 d3. Star3 fact d1 d2 d3 -&gt; Relation fact d3
</span><span class="hs-identifier hs-var hs-var">Star3.d3</span></span><span> </span><span class="annot"><span class="annottext">Star r n
</span><a href="#local-6989586621679404537"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1400"></span><span>                          </span><span id="local-6989586621679404532"><span class="annot"><span class="annottext">terms :: Map Referent (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404532"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Referent, (Set NameSegment, Set Reference))]
-&gt; Map Referent (Set NameSegment, Set Reference)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Referent, (Set NameSegment, Set Reference))]
 -&gt; Map Referent (Set NameSegment, Set Reference))
-&gt; (Set Referent -&gt; [(Referent, (Set NameSegment, Set Reference))])
-&gt; Set Referent
-&gt; Map Referent (Set NameSegment, Set Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; (Referent, (Set NameSegment, Set Reference)))
-&gt; [Referent] -&gt; [(Referent, (Set NameSegment, Set Reference))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Star Referent NameSegment
-&gt; Referent -&gt; (Referent, (Set NameSegment, Set Reference))
forall r n.
(Ord r, Ord n) =&gt;
Star r n -&gt; r -&gt; (r, (Set n, Set Reference))
</span><a href="#local-6989586621679404539"><span class="hs-identifier hs-var">wrangleMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Star Referent NameSegment
</span><a href="#local-6989586621679404543"><span class="hs-identifier hs-var">terms0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Referent] -&gt; [(Referent, (Set NameSegment, Set Reference))])
-&gt; (Set Referent -&gt; [Referent])
-&gt; Set Referent
-&gt; [(Referent, (Set NameSegment, Set Reference))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Foldable.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; Map Referent (Set NameSegment, Set Reference))
-&gt; Set Referent -&gt; Map Referent (Set NameSegment, Set Reference)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Star Referent NameSegment -&gt; Set Referent
forall fact d1 d2 d3. Star3 fact d1 d2 d3 -&gt; Set fact
</span><span class="hs-identifier hs-var hs-var">Star3.fact</span></span><span> </span><span class="annot"><span class="annottext">Star Referent NameSegment
</span><a href="#local-6989586621679404543"><span class="hs-identifier hs-var">terms0</span></a></span><span>
</span><span id="line-1401"></span><span>                          </span><span id="local-6989586621679404530"><span class="annot"><span class="annottext">types :: Map Reference (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404530"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Reference, (Set NameSegment, Set Reference))]
-&gt; Map Reference (Set NameSegment, Set Reference)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Reference, (Set NameSegment, Set Reference))]
 -&gt; Map Reference (Set NameSegment, Set Reference))
-&gt; (Set Reference
    -&gt; [(Reference, (Set NameSegment, Set Reference))])
-&gt; Set Reference
-&gt; Map Reference (Set NameSegment, Set Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; (Reference, (Set NameSegment, Set Reference)))
-&gt; [Reference] -&gt; [(Reference, (Set NameSegment, Set Reference))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Star Reference NameSegment
-&gt; Reference -&gt; (Reference, (Set NameSegment, Set Reference))
forall r n.
(Ord r, Ord n) =&gt;
Star r n -&gt; r -&gt; (r, (Set n, Set Reference))
</span><a href="#local-6989586621679404539"><span class="hs-identifier hs-var">wrangleMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Star Reference NameSegment
</span><a href="#local-6989586621679404542"><span class="hs-identifier hs-var">types0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Reference] -&gt; [(Reference, (Set NameSegment, Set Reference))])
-&gt; (Set Reference -&gt; [Reference])
-&gt; Set Reference
-&gt; [(Reference, (Set NameSegment, Set Reference))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Foldable.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Map Reference (Set NameSegment, Set Reference))
-&gt; Set Reference -&gt; Map Reference (Set NameSegment, Set Reference)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Star Reference NameSegment -&gt; Set Reference
forall fact d1 d2 d3. Star3 fact d1 d2 d3 -&gt; Set fact
</span><span class="hs-identifier hs-var hs-var">Star3.fact</span></span><span> </span><span class="annot"><span class="annottext">Star Reference NameSegment
</span><a href="#local-6989586621679404542"><span class="hs-identifier hs-var">types0</span></a></span><span>
</span><span id="line-1402"></span><span>                          </span><span id="local-6989586621679404529"><span class="annot"><span class="annottext">patches :: Map NameSegment Hash
</span><a href="#local-6989586621679404529"><span class="hs-identifier hs-var hs-var">patches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Hash, m Patch) -&gt; Hash)
-&gt; Map NameSegment (Hash, m Patch) -&gt; Map NameSegment Hash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Hash, m Patch) -&gt; Hash
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Hash, m Patch)
</span><a href="#local-6989586621679404540"><span class="hs-identifier hs-var">patches0</span></a></span><span>
</span><span id="line-1403"></span><span>                          </span><span id="local-6989586621679404528"><span class="annot"><span class="annottext">children :: Map NameSegment CausalHash
</span><a href="#local-6989586621679404528"><span class="hs-identifier hs-var hs-var">children</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Branch m -&gt; CausalHash)
-&gt; Map NameSegment (Branch m) -&gt; Map NameSegment CausalHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; CausalHash
forall (m :: * -&gt; *). Branch m -&gt; CausalHash
</span><span class="hs-identifier hs-var">Branch.headHash</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Branch m)
</span><a href="#local-6989586621679404541"><span class="hs-identifier hs-var">children0</span></a></span><span>
</span><span id="line-1404"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1405"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404527"><span class="annot"><span class="annottext">d :: DumpNamespace
</span><a href="#local-6989586621679404527"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Referent (Set NameSegment, Set Reference)
-&gt; Map Reference (Set NameSegment, Set Reference)
-&gt; Map NameSegment Hash
-&gt; Map NameSegment CausalHash
-&gt; Set CausalHash
-&gt; DumpNamespace
</span><a href="Unison.Codebase.Editor.Output.DumpNamespace.html#DumpNamespace"><span class="hs-identifier hs-var">Output.DN.DumpNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">Map Referent (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404532"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404530"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="annot"><span class="annottext">Map NameSegment Hash
</span><a href="#local-6989586621679404529"><span class="hs-identifier hs-var">patches</span></a></span><span> </span><span class="annot"><span class="annottext">Map NameSegment CausalHash
</span><a href="#local-6989586621679404528"><span class="hs-identifier hs-var">children</span></a></span><span> </span><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679404546"><span class="hs-identifier hs-var">causalParents</span></a></span><span>
</span><span id="line-1406"></span><span>                            </span><span class="hs-comment">-- the alternate implementation that doesn't rely on `traceM` blows up</span><span>
</span><span id="line-1407"></span><span>                            </span><span class="annot"><span class="annottext">String -&gt; StateT (Set CausalHash) m ()
forall (f :: * -&gt; *). Applicative f =&gt; String -&gt; f ()
</span><span class="hs-identifier hs-var">traceM</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; StateT (Set CausalHash) m ())
-&gt; String -&gt; StateT (Set CausalHash) m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty ColorText -&gt; String
</span><span class="hs-identifier hs-var">P.toPlain</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">200</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CausalHash, DumpNamespace) -&gt; Pretty ColorText
forall s a.
(IsString s, ListLike s Char, Show a) =&gt;
(a, DumpNamespace) -&gt; Pretty s
</span><a href="#local-6989586621679404523"><span class="hs-identifier hs-var">prettyDump</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404548"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DumpNamespace
</span><a href="#local-6989586621679404527"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1408"></span><span>                            </span><span class="annot"><span class="annottext">CausalHash -&gt; StateT (Set CausalHash) m ()
forall a (m :: * -&gt; *). (MonadState (Set a) m, Ord a) =&gt; a -&gt; m ()
</span><a href="#local-6989586621679404572"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404548"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1409"></span><span>                            </span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
forall (m :: * -&gt; *).
Monad m =&gt;
[(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
</span><a href="#local-6989586621679404566"><span class="hs-identifier hs-var">goCausal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Branch m -&gt; (CausalHash, m (UnwrappedBranch m)))
-&gt; [Branch m] -&gt; [(CausalHash, m (UnwrappedBranch m))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; (CausalHash, m (UnwrappedBranch m))
forall (f :: * -&gt; *) (m :: * -&gt; *).
Applicative f =&gt;
Branch m -&gt; (CausalHash, f (UnwrappedBranch m))
</span><a href="#local-6989586621679404568"><span class="hs-identifier hs-var">getCausal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NameSegment (Branch m) -&gt; [Branch m]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Foldable.toList</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Branch m)
</span><a href="#local-6989586621679404541"><span class="hs-identifier hs-var">children0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
-&gt; [(CausalHash, m (UnwrappedBranch m))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, m (UnwrappedBranch m))]
</span><a href="#local-6989586621679404545"><span class="hs-identifier hs-var">queue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1410"></span><span>                  </span><span id="local-6989586621679404523"><span class="annot"><span class="annottext">prettyDump :: (a, DumpNamespace) -&gt; Pretty s
</span><a href="#local-6989586621679404523"><span class="hs-identifier hs-var hs-var">prettyDump</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404522"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404522"><span class="hs-identifier hs-var">h</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.DumpNamespace.html#DumpNamespace"><span class="hs-identifier hs-type">Output.DN.DumpNamespace</span></a></span><span> </span><span id="local-6989586621679404521"><span class="annot"><span class="annottext">Map Referent (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404521"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621679404520"><span class="annot"><span class="annottext">Map Reference (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404520"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span id="local-6989586621679404519"><span class="annot"><span class="annottext">Map NameSegment Hash
</span><a href="#local-6989586621679404519"><span class="hs-identifier hs-var">patches</span></a></span></span><span> </span><span id="local-6989586621679404518"><span class="annot"><span class="annottext">Map NameSegment CausalHash
</span><a href="#local-6989586621679404518"><span class="hs-identifier hs-var">children</span></a></span></span><span> </span><span id="local-6989586621679404517"><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679404517"><span class="hs-identifier hs-var">causalParents</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1411"></span><span>                    </span><span class="annot"><span class="annottext">s -&gt; Pretty s
forall s. (IsString s, ListLike s Char) =&gt; s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lit</span></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-string">&quot;Namespace &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Pretty s
forall a s. (Show a, IsString s) =&gt; a -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.shown</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404522"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span>
</span><span id="line-1412"></span><span>                      </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty s -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Pretty s -&gt; Pretty s) -&gt; Pretty s -&gt; Pretty s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1413"></span><span>                             </span><span class="annot"><span class="annottext">[Pretty s] -&gt; Pretty s
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.linesNonEmpty</span></span><span>
</span><span id="line-1414"></span><span>                               </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Pretty s -&gt; Pretty s
forall a. Monoid a =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">Monoid.unlessM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set CausalHash -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679404517"><span class="hs-identifier hs-var">causalParents</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Pretty s -&gt; Pretty s) -&gt; Pretty s -&gt; Pretty s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; Pretty s
forall s. (IsString s, ListLike s Char) =&gt; s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lit</span></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-string">&quot;Causal Parents:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty s -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Pretty s] -&gt; Pretty s
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CausalHash -&gt; Pretty s) -&gt; [CausalHash] -&gt; [Pretty s]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Pretty s
forall a s. (Show a, IsString s) =&gt; a -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.shown</span></span><span> </span><span class="annot"><span class="annottext">([CausalHash] -&gt; [Pretty s]) -&gt; [CausalHash] -&gt; [Pretty s]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set CausalHash -&gt; [CausalHash]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set CausalHash
</span><a href="#local-6989586621679404517"><span class="hs-identifier hs-var">causalParents</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1415"></span><span>                                 </span><span class="annot"><span class="annottext">Bool -&gt; Pretty s -&gt; Pretty s
forall a. Monoid a =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">Monoid.unlessM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Referent (Set NameSegment, Set Reference) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map Referent (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404521"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Pretty s -&gt; Pretty s) -&gt; Pretty s -&gt; Pretty s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; Pretty s
forall s. (IsString s, ListLike s Char) =&gt; s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lit</span></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-string">&quot;Terms:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty s -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Pretty s] -&gt; Pretty s
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Referent, (Set NameSegment, Set Reference)) -&gt; Pretty s)
-&gt; [(Referent, (Set NameSegment, Set Reference))] -&gt; [Pretty s]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Referent -&gt; Text)
-&gt; (Referent, (Set NameSegment, Set Reference)) -&gt; Pretty s
forall (t :: * -&gt; *) (t :: * -&gt; *) s t.
(Foldable t, Foldable t, IsString s, ListLike s Char) =&gt;
(t -&gt; Text) -&gt; (t, (t NameSegment, t Reference)) -&gt; Pretty s
</span><a href="#local-6989586621679404512"><span class="hs-identifier hs-var">prettyDefn</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Referent, (Set NameSegment, Set Reference))] -&gt; [Pretty s])
-&gt; [(Referent, (Set NameSegment, Set Reference))] -&gt; [Pretty s]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Referent (Set NameSegment, Set Reference)
-&gt; [(Referent, (Set NameSegment, Set Reference))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Referent (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404521"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1416"></span><span>                                 </span><span class="annot"><span class="annottext">Bool -&gt; Pretty s -&gt; Pretty s
forall a. Monoid a =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">Monoid.unlessM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Reference (Set NameSegment, Set Reference) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404520"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Pretty s -&gt; Pretty s) -&gt; Pretty s -&gt; Pretty s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; Pretty s
forall s. (IsString s, ListLike s Char) =&gt; s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lit</span></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-string">&quot;Types:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty s -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Pretty s] -&gt; Pretty s
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Reference, (Set NameSegment, Set Reference)) -&gt; Pretty s)
-&gt; [(Reference, (Set NameSegment, Set Reference))] -&gt; [Pretty s]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Reference -&gt; Text)
-&gt; (Reference, (Set NameSegment, Set Reference)) -&gt; Pretty s
forall (t :: * -&gt; *) (t :: * -&gt; *) s t.
(Foldable t, Foldable t, IsString s, ListLike s Char) =&gt;
(t -&gt; Text) -&gt; (t, (t NameSegment, t Reference)) -&gt; Pretty s
</span><a href="#local-6989586621679404512"><span class="hs-identifier hs-var">prettyDefn</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Reference, (Set NameSegment, Set Reference))] -&gt; [Pretty s])
-&gt; [(Reference, (Set NameSegment, Set Reference))] -&gt; [Pretty s]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (Set NameSegment, Set Reference)
-&gt; [(Reference, (Set NameSegment, Set Reference))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (Set NameSegment, Set Reference)
</span><a href="#local-6989586621679404520"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1417"></span><span>                                 </span><span class="annot"><span class="annottext">Bool -&gt; Pretty s -&gt; Pretty s
forall a. Monoid a =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">Monoid.unlessM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NameSegment Hash -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment Hash
</span><a href="#local-6989586621679404519"><span class="hs-identifier hs-var">patches</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Pretty s -&gt; Pretty s) -&gt; Pretty s -&gt; Pretty s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; Pretty s
forall s. (IsString s, ListLike s Char) =&gt; s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lit</span></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-string">&quot;Patches:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty s -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Pretty s, Pretty s)] -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
[(Pretty s, Pretty s)] -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.column2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((NameSegment, Hash) -&gt; (Pretty s, Pretty s))
-&gt; [(NameSegment, Hash)] -&gt; [(Pretty s, Pretty s)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NameSegment -&gt; Pretty s)
-&gt; (Hash -&gt; Pretty s)
-&gt; (NameSegment, Hash)
-&gt; (Pretty s, Pretty s)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Pretty s
forall a s. (Show a, IsString s) =&gt; a -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.shown</span></span><span> </span><span class="annot"><span class="annottext">Hash -&gt; Pretty s
forall a s. (Show a, IsString s) =&gt; a -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.shown</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(NameSegment, Hash)] -&gt; [(Pretty s, Pretty s)])
-&gt; [(NameSegment, Hash)] -&gt; [(Pretty s, Pretty s)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment Hash -&gt; [(NameSegment, Hash)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment Hash
</span><a href="#local-6989586621679404519"><span class="hs-identifier hs-var">patches</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1418"></span><span>                                 </span><span class="annot"><span class="annottext">Bool -&gt; Pretty s -&gt; Pretty s
forall a. Monoid a =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">Monoid.unlessM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map NameSegment CausalHash -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment CausalHash
</span><a href="#local-6989586621679404518"><span class="hs-identifier hs-var">children</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Pretty s -&gt; Pretty s) -&gt; Pretty s -&gt; Pretty s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">s -&gt; Pretty s
forall s. (IsString s, ListLike s Char) =&gt; s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lit</span></span><span> </span><span class="annot"><span class="annottext">s
</span><span class="hs-string">&quot;Children:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty s -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Pretty s, Pretty s)] -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
[(Pretty s, Pretty s)] -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.column2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((NameSegment, CausalHash) -&gt; (Pretty s, Pretty s))
-&gt; [(NameSegment, CausalHash)] -&gt; [(Pretty s, Pretty s)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NameSegment -&gt; Pretty s)
-&gt; (CausalHash -&gt; Pretty s)
-&gt; (NameSegment, CausalHash)
-&gt; (Pretty s, Pretty s)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Pretty s
forall a s. (Show a, IsString s) =&gt; a -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.shown</span></span><span> </span><span class="annot"><span class="annottext">CausalHash -&gt; Pretty s
forall a s. (Show a, IsString s) =&gt; a -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.shown</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(NameSegment, CausalHash)] -&gt; [(Pretty s, Pretty s)])
-&gt; [(NameSegment, CausalHash)] -&gt; [(Pretty s, Pretty s)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment CausalHash -&gt; [(NameSegment, CausalHash)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment CausalHash
</span><a href="#local-6989586621679404518"><span class="hs-identifier hs-var">children</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1419"></span><span>                               </span><span class="hs-special">]</span><span>
</span><span id="line-1420"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-1421"></span><span>                    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1422"></span><span>                      </span><span id="local-6989586621679404508"><span class="annot"><span class="annottext">prettyLinks :: (t -&gt; Text) -&gt; t -&gt; [Reference] -&gt; Pretty s
</span><a href="#local-6989586621679404508"><span class="hs-identifier hs-var hs-var">prettyLinks</span></a></span></span><span> </span><span id="local-6989586621679404507"><span class="annot"><span class="annottext">t -&gt; Text
</span><a href="#local-6989586621679404507"><span class="hs-identifier hs-var">renderR</span></a></span></span><span> </span><span id="local-6989586621679404506"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679404506"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty s -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Pretty s -&gt; Pretty s) -&gt; Pretty s -&gt; Pretty s
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty s
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Text
</span><a href="#local-6989586621679404507"><span class="hs-identifier hs-var">renderR</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679404506"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1423"></span><span>                      </span><span class="annot"><a href="#local-6989586621679404508"><span class="hs-identifier hs-var">prettyLinks</span></a></span><span> </span><span id="local-6989586621679404504"><span class="annot"><span class="annottext">t -&gt; Text
</span><a href="#local-6989586621679404504"><span class="hs-identifier hs-var">renderR</span></a></span></span><span> </span><span id="local-6989586621679404503"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679404503"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679404502"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404502"><span class="hs-identifier hs-var">links</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Width -&gt; Pretty s -&gt; Pretty s
forall s.
(ListLike s Char, IsString s) =&gt;
Width -&gt; Pretty s -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.indentN</span></span><span> </span><span class="annot"><span class="annottext">Width
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Pretty s] -&gt; Pretty s
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Pretty s
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; Text
</span><a href="#local-6989586621679404504"><span class="hs-identifier hs-var">renderR</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679404503"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; [Pretty s] -&gt; [Pretty s]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404502"><span class="hs-identifier hs-var">links</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; (Reference -&gt; Pretty s) -&gt; [Pretty s]
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404501"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404501"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Pretty s
</span><span class="hs-string">&quot;+ &quot;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Pretty s
forall s. IsString s =&gt; Text -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404501"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1424"></span><span>                      </span><span id="local-6989586621679404512"><span class="annot"><span class="annottext">prettyDefn :: (t -&gt; Text) -&gt; (t, (t NameSegment, t Reference)) -&gt; Pretty s
</span><a href="#local-6989586621679404512"><span class="hs-identifier hs-var hs-var">prettyDefn</span></a></span></span><span> </span><span id="local-6989586621679404500"><span class="annot"><span class="annottext">t -&gt; Text
</span><a href="#local-6989586621679404500"><span class="hs-identifier hs-var">renderR</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404499"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679404499"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t NameSegment -&gt; [NameSegment]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Foldable.toList</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679404498"><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621679404498"><span class="hs-identifier hs-var">names</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">t Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Foldable.toList</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679404497"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404497"><span class="hs-identifier hs-var">links</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1425"></span><span>                        </span><span class="annot"><span class="annottext">[Pretty s] -&gt; Pretty s
forall (f :: * -&gt; *) s.
(Foldable f, IsString s) =&gt;
f (Pretty s) -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.lines</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Pretty s
forall a s. (Show a, IsString s) =&gt; a -&gt; Pretty s
</span><span class="hs-identifier hs-var">P.shown</span></span><span> </span><span class="annot"><span class="annottext">(NameSegment -&gt; Pretty s) -&gt; [NameSegment] -&gt; [Pretty s]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[NameSegment] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621679404498"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text -&gt; NameSegment
</span><span class="hs-identifier hs-var">NameSegment</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&lt;unnamed&gt;&quot;</span></span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><a href="#local-6989586621679404498"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Pretty s
forall s. IsString s =&gt; Pretty s
</span><span class="hs-identifier hs-var">P.newline</span></span><span> </span><span class="annot"><span class="annottext">Pretty s -&gt; Pretty s -&gt; Pretty s
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(t -&gt; Text) -&gt; t -&gt; [Reference] -&gt; Pretty s
forall s t.
(ListLike s Char, IsString s) =&gt;
(t -&gt; Text) -&gt; t -&gt; [Reference] -&gt; Pretty s
</span><a href="#local-6989586621679404508"><span class="hs-identifier hs-var">prettyLinks</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; Text
</span><a href="#local-6989586621679404500"><span class="hs-identifier hs-var">renderR</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679404499"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679404497"><span class="hs-identifier hs-var">links</span></a></span><span>
</span><span id="line-1426"></span><span>              </span><span id="local-6989586621679404495"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404495"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-1427"></span><span>              </span><span class="annot"><span class="annottext">Cli r (Set CausalHash) -&gt; Cli r ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Cli r (Set CausalHash) -&gt; Cli r ())
-&gt; (StateT (Set CausalHash) IO () -&gt; Cli r (Set CausalHash))
-&gt; StateT (Set CausalHash) IO ()
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IO (Set CausalHash) -&gt; Cli r (Set CausalHash)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set CausalHash) -&gt; Cli r (Set CausalHash))
-&gt; (StateT (Set CausalHash) IO () -&gt; IO (Set CausalHash))
-&gt; StateT (Set CausalHash) IO ()
-&gt; Cli r (Set CausalHash)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StateT (Set CausalHash) IO ()
 -&gt; Set CausalHash -&gt; IO (Set CausalHash))
-&gt; Set CausalHash
-&gt; StateT (Set CausalHash) IO ()
-&gt; IO (Set CausalHash)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">StateT (Set CausalHash) IO ()
-&gt; Set CausalHash -&gt; IO (Set CausalHash)
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">State.execStateT</span></span><span> </span><span class="annot"><span class="annottext">Set CausalHash
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(StateT (Set CausalHash) IO () -&gt; Cli r ())
-&gt; StateT (Set CausalHash) IO () -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(CausalHash, IO (UnwrappedBranch IO))]
-&gt; StateT (Set CausalHash) IO ()
forall (m :: * -&gt; *).
Monad m =&gt;
[(CausalHash, m (UnwrappedBranch m))]
-&gt; StateT (Set CausalHash) m ()
</span><a href="#local-6989586621679404566"><span class="hs-identifier hs-var">goCausal</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Branch IO -&gt; (CausalHash, IO (UnwrappedBranch IO))
forall (f :: * -&gt; *) (m :: * -&gt; *).
Applicative f =&gt;
Branch m -&gt; (CausalHash, f (UnwrappedBranch m))
</span><a href="#local-6989586621679404568"><span class="hs-identifier hs-var">getCausal</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404495"><span class="hs-identifier hs-var">rootBranch</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1428"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#DebugDumpNamespaceSimpleI"><span class="hs-identifier hs-var">DebugDumpNamespaceSimpleI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1429"></span><span>              </span><span id="local-6989586621679404492"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404492"><span class="hs-identifier hs-var">rootBranch0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-1430"></span><span>              </span><span class="annot"><span class="annottext">[(Reference, Name)] -&gt; ((Reference, Name) -&gt; Cli r ()) -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Reference Name -&gt; [(Reference, Name)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">Relation.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Reference Name -&gt; [(Reference, Name)])
-&gt; (Branch0 IO -&gt; Relation Reference Name)
-&gt; Branch0 IO
-&gt; [(Reference, Name)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Relation Reference Name
forall (m :: * -&gt; *). Branch0 m -&gt; Relation Reference Name
</span><span class="hs-identifier hs-var hs-var">Branch.deepTypes</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; [(Reference, Name)])
-&gt; Branch0 IO -&gt; [(Reference, Name)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404492"><span class="hs-identifier hs-var">rootBranch0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679404490"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404490"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404489"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404489"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1431"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; String -&gt; f ()
</span><span class="hs-identifier hs-var">traceM</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Cli r ()) -&gt; String -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404489"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,Type,&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Text
</span><span class="hs-identifier hs-var">Reference.toText</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404490"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1432"></span><span>              </span><span class="annot"><span class="annottext">[(Referent, Name)] -&gt; ((Referent, Name) -&gt; Cli r ()) -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Referent Name -&gt; [(Referent, Name)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">Relation.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Referent Name -&gt; [(Referent, Name)])
-&gt; (Branch0 IO -&gt; Relation Referent Name)
-&gt; Branch0 IO
-&gt; [(Referent, Name)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Relation Referent Name
forall (m :: * -&gt; *). Branch0 m -&gt; Relation Referent Name
</span><span class="hs-identifier hs-var hs-var">Branch.deepTerms</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; [(Referent, Name)])
-&gt; Branch0 IO -&gt; [(Referent, Name)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404492"><span class="hs-identifier hs-var">rootBranch0</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679404487"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679404487"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404486"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404486"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1433"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; String -&gt; f ()
</span><span class="hs-identifier hs-var">traceM</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Cli r ()) -&gt; String -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404486"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,Term,&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent -&gt; Text
</span><span class="hs-identifier hs-var">Referent.toText</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679404487"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugClearWatchI"><span class="hs-identifier hs-type">DebugClearWatchI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1435"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404484"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404484"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1436"></span><span>              </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.clearWatches</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404484"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1437"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugDoctorI"><span class="hs-identifier hs-type">DebugDoctorI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1438"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404481"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404481"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1439"></span><span>              </span><span id="local-6989586621679404480"><span class="annot"><span class="annottext">IntegrityResult
</span><a href="#local-6989586621679404480"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO IntegrityResult -&gt; Cli r IntegrityResult
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction IntegrityResult -&gt; IO IntegrityResult
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404481"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Transaction IntegrityResult
</span><span class="hs-identifier hs-var">IntegrityCheck.integrityCheckFullCodebase</span></span><span class="hs-special">)</span><span>
</span><span id="line-1440"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IntegrityResult -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#IntegrityCheck"><span class="hs-identifier hs-var">IntegrityCheck</span></a></span><span> </span><span class="annot"><span class="annottext">IntegrityResult
</span><a href="#local-6989586621679404480"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1441"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeprecateTermI"><span class="hs-identifier hs-type">DeprecateTermI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#NotImplemented"><span class="hs-identifier hs-var">NotImplemented</span></a></span><span>
</span><span id="line-1442"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeprecateTypeI"><span class="hs-identifier hs-type">DeprecateTypeI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#NotImplemented"><span class="hs-identifier hs-var">NotImplemented</span></a></span><span>
</span><span id="line-1443"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#RemoveTermReplacementI"><span class="hs-identifier hs-type">RemoveTermReplacementI</span></a></span><span> </span><span id="local-6989586621679404473"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404473"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621679404472"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404472"><span class="hs-identifier hs-var">patchPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe PatchPath -&gt; Bool -&gt; Cli r ()
forall r. HashQualified Name -&gt; Maybe PatchPath -&gt; Bool -&gt; Cli r ()
</span><a href="#local-6989586621679405742"><span class="hs-identifier hs-var">doRemoveReplacement</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404473"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404472"><span class="hs-identifier hs-var">patchPath</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1444"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#RemoveTypeReplacementI"><span class="hs-identifier hs-type">RemoveTypeReplacementI</span></a></span><span> </span><span id="local-6989586621679404470"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404470"><span class="hs-identifier hs-var">from</span></a></span></span><span> </span><span id="local-6989586621679404469"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404469"><span class="hs-identifier hs-var">patchPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe PatchPath -&gt; Bool -&gt; Cli r ()
forall r. HashQualified Name -&gt; Maybe PatchPath -&gt; Bool -&gt; Cli r ()
</span><a href="#local-6989586621679405742"><span class="hs-identifier hs-var">doRemoveReplacement</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404470"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404469"><span class="hs-identifier hs-var">patchPath</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1445"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ShowDefinitionByPrefixI"><span class="hs-identifier hs-type">ShowDefinitionByPrefixI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#NotImplemented"><span class="hs-identifier hs-var">NotImplemented</span></a></span><span>
</span><span id="line-1446"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#UpdateBuiltinsI"><span class="hs-identifier hs-var">UpdateBuiltinsI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#NotImplemented"><span class="hs-identifier hs-var">NotImplemented</span></a></span><span>
</span><span id="line-1447"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#QuitI"><span class="hs-identifier hs-var">QuitI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r ()
forall r a. Cli r a
</span><a href="Unison.Cli.Monad.html#haltRepl"><span class="hs-identifier hs-var">Cli.haltRepl</span></a></span><span>
</span><span id="line-1448"></span><span>            </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#GistI"><span class="hs-identifier hs-type">GistI</span></a></span><span> </span><span id="local-6989586621679404463"><span class="annot"><span class="annottext">GistInput
</span><a href="#local-6989586621679404463"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GistInput -&gt; Cli r ()
forall r. GistInput -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleGist"><span class="hs-identifier hs-var">handleGist</span></a></span><span> </span><span class="annot"><span class="annottext">GistInput
</span><a href="#local-6989586621679404463"><span class="hs-identifier hs-var">input</span></a></span><span>
</span><span id="line-1449"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#AuthLoginI"><span class="hs-identifier hs-var">AuthLoginI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodeserverURI -&gt; Cli r ()
forall r. CodeserverURI -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.AuthLogin.html#authLogin"><span class="hs-identifier hs-var">authLogin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShareCodeserver -&gt; CodeserverURI
</span><a href="Unison.Share.Codeserver.html#resolveCodeserver"><span class="hs-identifier hs-var">Codeserver.resolveCodeserver</span></a></span><span> </span><span class="annot"><span class="annottext">ShareCodeserver
</span><span class="hs-identifier hs-var">RemoteRepo.DefaultCodeserver</span></span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>            </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#VersionI"><span class="hs-identifier hs-var">VersionI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1451"></span><span>              </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404457"><span class="annot"><span class="annottext">Text
$sel:ucmVersion:Env :: Env -&gt; Text
ucmVersion :: Text
</span><a href="Unison.Cli.Monad.html#%24sel%3AucmVersion%3AEnv"><span class="hs-identifier hs-var hs-var">ucmVersion</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1452"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#PrintVersion"><span class="hs-identifier hs-var">PrintVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404457"><span class="hs-identifier hs-var">ucmVersion</span></a></span><span>
</span><span id="line-1453"></span><span>
</span><span id="line-1454"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#magicMainWatcherString"><span class="hs-identifier hs-type">magicMainWatcherString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-1455"></span><span id="magicMainWatcherString"><span class="annot"><span class="annottext">magicMainWatcherString :: String
</span><a href="Unison.Codebase.Editor.HandleInput.html#magicMainWatcherString"><span class="hs-identifier hs-var hs-var">magicMainWatcherString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main&quot;</span></span><span>
</span><span id="line-1456"></span><span>
</span><span id="line-1457"></span><span id="local-6989586621679407099"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-type">inputDescription</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407099"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-1458"></span><span id="inputDescription"><span class="annot"><span class="annottext">inputDescription :: Input -&gt; Cli r Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#inputDescription"><span class="hs-identifier hs-var hs-var">inputDescription</span></a></span></span><span> </span><span id="local-6989586621679404454"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679404454"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1459"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679404454"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1460"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#SaveExecuteResultI"><span class="hs-identifier hs-type">SaveExecuteResultI</span></a></span><span> </span><span id="local-6989586621679404453"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404453"><span class="hs-identifier hs-var">_str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;save-execute-result&quot;</span></span><span>
</span><span id="line-1461"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ForkLocalBranchI"><span class="hs-identifier hs-type">ForkLocalBranchI</span></a></span><span> </span><span id="local-6989586621679404452"><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679404452"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679404451"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404451"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1462"></span><span>      </span><span id="local-6989586621679404450"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404450"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path' -&gt; Cli r Text
forall r. Either ShortBranchHash Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404449"><span class="hs-identifier hs-var">hp'</span></a></span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679404452"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1463"></span><span>      </span><span id="local-6989586621679404448"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404448"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404451"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1464"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;fork &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404450"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404448"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1465"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MergeLocalBranchI"><span class="hs-identifier hs-type">MergeLocalBranchI</span></a></span><span> </span><span id="local-6989586621679404446"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404446"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679404445"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404445"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span id="local-6989586621679404444"><span class="annot"><span class="annottext">MergeMode
</span><a href="#local-6989586621679404444"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1466"></span><span>      </span><span id="local-6989586621679404443"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404443"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404446"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1467"></span><span>      </span><span id="local-6989586621679404442"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404442"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404445"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1468"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404441"><span class="annot"><span class="annottext">command :: Text
</span><a href="#local-6989586621679404441"><span class="hs-identifier hs-var hs-var">command</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1469"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><a href="#local-6989586621679404444"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1470"></span><span>              </span><span class="annot"><span class="annottext">MergeMode
</span><span class="hs-identifier hs-var">Branch.RegularMerge</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;merge&quot;</span></span><span>
</span><span id="line-1471"></span><span>              </span><span class="annot"><span class="annottext">MergeMode
</span><span class="hs-identifier hs-var">Branch.SquashMerge</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;merge.squash&quot;</span></span><span>
</span><span id="line-1472"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404441"><span class="hs-identifier hs-var">command</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404443"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404442"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1473"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ResetRootI"><span class="hs-identifier hs-type">ResetRootI</span></a></span><span> </span><span id="local-6989586621679404440"><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679404440"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1474"></span><span>      </span><span id="local-6989586621679404439"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404439"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path' -&gt; Cli r Text
forall r. Either ShortBranchHash Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404449"><span class="hs-identifier hs-var">hp'</span></a></span><span> </span><span class="annot"><span class="annottext">Either ShortBranchHash Path'
</span><a href="#local-6989586621679404440"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1475"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;reset-root &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404439"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1476"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#AliasTermI"><span class="hs-identifier hs-type">AliasTermI</span></a></span><span> </span><span id="local-6989586621679404438"><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679404438"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679404437"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404437"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1477"></span><span>      </span><span id="local-6989586621679404436"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404436"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashOrHQSplit' -&gt; Cli r Text
forall r. HashOrHQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404435"><span class="hs-identifier hs-var">hhqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679404438"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1478"></span><span>      </span><span id="local-6989586621679404434"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404434"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404437"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1479"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;alias.term &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404436"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404434"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1480"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#AliasTypeI"><span class="hs-identifier hs-type">AliasTypeI</span></a></span><span> </span><span id="local-6989586621679404432"><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679404432"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679404431"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404431"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1481"></span><span>      </span><span id="local-6989586621679404430"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404430"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashOrHQSplit' -&gt; Cli r Text
forall r. HashOrHQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404435"><span class="hs-identifier hs-var">hhqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HashOrHQSplit'
</span><a href="#local-6989586621679404432"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1482"></span><span>      </span><span id="local-6989586621679404429"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404429"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404431"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1483"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;alias.type &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404430"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404429"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1484"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#AliasManyI"><span class="hs-identifier hs-type">AliasManyI</span></a></span><span> </span><span id="local-6989586621679404428"><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679404428"><span class="hs-identifier hs-var">srcs0</span></a></span></span><span> </span><span id="local-6989586621679404427"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404427"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1485"></span><span>      </span><span id="local-6989586621679404426"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679404426"><span class="hs-identifier hs-var">srcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HQSplit -&gt; Cli r Text) -&gt; [HQSplit] -&gt; Cli r [Text]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">HQSplit -&gt; Cli r Text
forall r. HQSplit -&gt; Cli r Text
</span><a href="#local-6989586621679404425"><span class="hs-identifier hs-var">hqs</span></a></span><span> </span><span class="annot"><span class="annottext">[HQSplit]
</span><a href="#local-6989586621679404428"><span class="hs-identifier hs-var">srcs0</span></a></span><span>
</span><span id="line-1486"></span><span>      </span><span id="local-6989586621679404424"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404424"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404427"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1487"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;alias.many &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679404426"><span class="hs-identifier hs-var">srcs</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404424"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1488"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MoveTermI"><span class="hs-identifier hs-type">MoveTermI</span></a></span><span> </span><span id="local-6989586621679404422"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404422"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679404421"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404421"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1489"></span><span>      </span><span id="local-6989586621679404420"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404420"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404422"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1490"></span><span>      </span><span id="local-6989586621679404418"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404418"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404421"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1491"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;move.term &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404420"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404418"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1492"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MoveTypeI"><span class="hs-identifier hs-type">MoveTypeI</span></a></span><span> </span><span id="local-6989586621679404417"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404417"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679404416"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404416"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1493"></span><span>      </span><span id="local-6989586621679404415"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404415"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404417"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1494"></span><span>      </span><span id="local-6989586621679404414"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404414"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404416"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1495"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;move.type &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404415"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404414"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1496"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MoveBranchI"><span class="hs-identifier hs-type">MoveBranchI</span></a></span><span> </span><span id="local-6989586621679404413"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404413"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679404412"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404412"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1497"></span><span>      </span><span id="local-6989586621679404411"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404411"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404413"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1498"></span><span>      </span><span id="local-6989586621679404410"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404410"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404412"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1499"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;move.namespace &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404411"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404410"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1500"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MovePatchI"><span class="hs-identifier hs-type">MovePatchI</span></a></span><span> </span><span id="local-6989586621679404409"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404409"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679404408"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404408"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1501"></span><span>      </span><span id="local-6989586621679404407"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404407"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404409"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1502"></span><span>      </span><span id="local-6989586621679404406"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404406"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404408"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1503"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;move.patch &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404407"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404406"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1504"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#CopyPatchI"><span class="hs-identifier hs-type">CopyPatchI</span></a></span><span> </span><span id="local-6989586621679404405"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404405"><span class="hs-identifier hs-var">src0</span></a></span></span><span> </span><span id="local-6989586621679404404"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404404"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1505"></span><span>      </span><span id="local-6989586621679404403"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404403"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404405"><span class="hs-identifier hs-var">src0</span></a></span><span>
</span><span id="line-1506"></span><span>      </span><span id="local-6989586621679404402"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404402"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404404"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1507"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;copy.patch &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404403"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404402"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1508"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteI"><span class="hs-identifier hs-type">DeleteI</span></a></span><span> </span><span id="local-6989586621679404401"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404401"><span class="hs-identifier hs-var">thing0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1509"></span><span>      </span><span id="local-6989586621679404400"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404400"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404401"><span class="hs-identifier hs-var">thing0</span></a></span><span>
</span><span id="line-1510"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;delete &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404400"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1511"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteTermI"><span class="hs-identifier hs-type">DeleteTermI</span></a></span><span> </span><span id="local-6989586621679404399"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404399"><span class="hs-identifier hs-var">def0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1512"></span><span>      </span><span id="local-6989586621679404398"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404398"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404399"><span class="hs-identifier hs-var">def0</span></a></span><span>
</span><span id="line-1513"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;delete.term &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404398"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1514"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteTypeI"><span class="hs-identifier hs-type">DeleteTypeI</span></a></span><span> </span><span id="local-6989586621679404397"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404397"><span class="hs-identifier hs-var">def0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1515"></span><span>      </span><span id="local-6989586621679404396"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404396"><span class="hs-identifier hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404397"><span class="hs-identifier hs-var">def0</span></a></span><span>
</span><span id="line-1516"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;delete.type &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404396"><span class="hs-identifier hs-var">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1517"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteBranchI"><span class="hs-identifier hs-type">DeleteBranchI</span></a></span><span> </span><span class="annot"><span class="annottext">Insistence
</span><a href="Unison.Codebase.Editor.Input.html#Try"><span class="hs-identifier hs-var">Try</span></a></span><span> </span><span id="local-6989586621679404395"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404395"><span class="hs-identifier hs-var">opath0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1518"></span><span>      </span><span id="local-6989586621679404394"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404394"><span class="hs-identifier hs-var">opath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath -&gt; Cli r Text
forall r. Maybe PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404393"><span class="hs-identifier hs-var">ops'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404395"><span class="hs-identifier hs-var">opath0</span></a></span><span>
</span><span id="line-1519"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;delete.namespace &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404394"><span class="hs-identifier hs-var">opath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1520"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeleteBranchI"><span class="hs-identifier hs-type">DeleteBranchI</span></a></span><span> </span><span class="annot"><span class="annottext">Insistence
</span><a href="Unison.Codebase.Editor.Input.html#Force"><span class="hs-identifier hs-var">Force</span></a></span><span> </span><span id="local-6989586621679404392"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404392"><span class="hs-identifier hs-var">opath0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1521"></span><span>      </span><span id="local-6989586621679404391"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404391"><span class="hs-identifier hs-var">opath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath -&gt; Cli r Text
forall r. Maybe PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404393"><span class="hs-identifier hs-var">ops'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404392"><span class="hs-identifier hs-var">opath0</span></a></span><span>
</span><span id="line-1522"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;delete.namespace.force &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404391"><span class="hs-identifier hs-var">opath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1523"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeletePatchI"><span class="hs-identifier hs-type">DeletePatchI</span></a></span><span> </span><span id="local-6989586621679404390"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404390"><span class="hs-identifier hs-var">path0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1524"></span><span>      </span><span id="local-6989586621679404389"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404389"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404390"><span class="hs-identifier hs-var">path0</span></a></span><span>
</span><span id="line-1525"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;delete.patch &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404389"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1526"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ReplaceI"><span class="hs-identifier hs-type">ReplaceI</span></a></span><span> </span><span id="local-6989586621679404388"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404388"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621679404387"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404387"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621679404386"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404386"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1527"></span><span>      </span><span id="local-6989586621679404385"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404385"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath -&gt; Cli r Text
forall r. Maybe PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404384"><span class="hs-identifier hs-var">opatch</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404386"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-1528"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-1529"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;replace &quot;</span></span><span>
</span><span id="line-1530"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404388"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-1531"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1532"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404387"><span class="hs-identifier hs-var">target</span></a></span><span>
</span><span id="line-1533"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1534"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404385"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1535"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ResolveTermNameI"><span class="hs-identifier hs-type">ResolveTermNameI</span></a></span><span> </span><span id="local-6989586621679404382"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404382"><span class="hs-identifier hs-var">path0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1536"></span><span>      </span><span id="local-6989586621679404381"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404381"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404382"><span class="hs-identifier hs-var">path0</span></a></span><span>
</span><span id="line-1537"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;resolve.termName &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404381"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1538"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ResolveTypeNameI"><span class="hs-identifier hs-type">ResolveTypeNameI</span></a></span><span> </span><span id="local-6989586621679404380"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404380"><span class="hs-identifier hs-var">path0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1539"></span><span>      </span><span id="local-6989586621679404379"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404379"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404380"><span class="hs-identifier hs-var">path0</span></a></span><span>
</span><span id="line-1540"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;resolve.typeName &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404379"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1541"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#AddI"><span class="hs-identifier hs-type">AddI</span></a></span><span> </span><span id="local-6989586621679404378"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404378"><span class="hs-identifier hs-var">_selection</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;add&quot;</span></span><span>
</span><span id="line-1542"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#UpdateI"><span class="hs-identifier hs-type">UpdateI</span></a></span><span> </span><span id="local-6989586621679404377"><span class="annot"><span class="annottext">OptionalPatch
</span><a href="#local-6989586621679404377"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span id="local-6989586621679404376"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679404376"><span class="hs-identifier hs-var">_selection</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1543"></span><span>      </span><span id="local-6989586621679404375"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404375"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1544"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OptionalPatch
</span><a href="#local-6989586621679404377"><span class="hs-identifier hs-var">p0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1545"></span><span>          </span><span class="annot"><span class="annottext">OptionalPatch
</span><a href="Unison.Codebase.Editor.Input.html#NoPatch"><span class="hs-identifier hs-var">NoPatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.nopatch&quot;</span></span><span>
</span><span id="line-1546"></span><span>          </span><span class="annot"><span class="annottext">OptionalPatch
</span><a href="Unison.Codebase.Editor.Input.html#DefaultPatch"><span class="hs-identifier hs-var">DefaultPatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Cli r Text -&gt; Cli r Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="Unison.Cli.MonadUtils.html#defaultPatchPath"><span class="hs-identifier hs-var">Cli.defaultPatchPath</span></a></span><span>
</span><span id="line-1547"></span><span>          </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#UsePatch"><span class="hs-identifier hs-type">UsePatch</span></a></span><span> </span><span id="local-6989586621679404371"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404371"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; Cli r Text -&gt; Cli r Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404371"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-1548"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;update&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404375"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1549"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PropagatePatchI"><span class="hs-identifier hs-type">PropagatePatchI</span></a></span><span> </span><span id="local-6989586621679404370"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404370"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span id="local-6989586621679404369"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404369"><span class="hs-identifier hs-var">scope0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1550"></span><span>      </span><span id="local-6989586621679404368"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404368"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679404370"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-1551"></span><span>      </span><span id="local-6989586621679404367"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404367"><span class="hs-identifier hs-var">scope</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404369"><span class="hs-identifier hs-var">scope0</span></a></span><span>
</span><span id="line-1552"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;patch &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404368"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404367"><span class="hs-identifier hs-var">scope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1553"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#UndoI"><span class="hs-identifier hs-type">UndoI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;undo&quot;</span></span><span>
</span><span id="line-1554"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ExecuteI"><span class="hs-identifier hs-type">ExecuteI</span></a></span><span> </span><span id="local-6989586621679404366"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404366"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679404365"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404365"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;execute &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.unwords</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; [String] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404366"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404365"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1555"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#IOTestI"><span class="hs-identifier hs-type">IOTestI</span></a></span><span> </span><span id="local-6989586621679404363"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404363"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;io.test &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404363"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1556"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#LinkI"><span class="hs-identifier hs-type">LinkI</span></a></span><span> </span><span id="local-6989586621679404362"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404362"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span id="local-6989586621679404361"><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679404361"><span class="hs-identifier hs-var">defs0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1557"></span><span>      </span><span id="local-6989586621679404360"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679404360"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HQSplit' -&gt; Cli r Text) -&gt; [HQSplit'] -&gt; Cli r [Text]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679404361"><span class="hs-identifier hs-var">defs0</span></a></span><span>
</span><span id="line-1558"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;link &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404362"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679404360"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1559"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#UnlinkI"><span class="hs-identifier hs-type">UnlinkI</span></a></span><span> </span><span id="local-6989586621679404359"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404359"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span id="local-6989586621679404358"><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679404358"><span class="hs-identifier hs-var">defs0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1560"></span><span>      </span><span id="local-6989586621679404357"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679404357"><span class="hs-identifier hs-var">defs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HQSplit' -&gt; Cli r Text) -&gt; [HQSplit'] -&gt; Cli r [Text]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679404358"><span class="hs-identifier hs-var">defs0</span></a></span><span>
</span><span id="line-1561"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unlink &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404359"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679404357"><span class="hs-identifier hs-var">defs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1562"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#UpdateBuiltinsI"><span class="hs-identifier hs-var">UpdateBuiltinsI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;builtins.update&quot;</span></span><span>
</span><span id="line-1563"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#MergeBuiltinsI"><span class="hs-identifier hs-var">MergeBuiltinsI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;builtins.merge&quot;</span></span><span>
</span><span id="line-1564"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#MergeIOBuiltinsI"><span class="hs-identifier hs-var">MergeIOBuiltinsI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;builtins.mergeio&quot;</span></span><span>
</span><span id="line-1565"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#MakeStandaloneI"><span class="hs-identifier hs-type">MakeStandaloneI</span></a></span><span> </span><span id="local-6989586621679404356"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404356"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span id="local-6989586621679404355"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404355"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;compile &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404356"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404355"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1566"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PullRemoteBranchI"><span class="hs-identifier hs-type">PullRemoteBranchI</span></a></span><span> </span><span id="local-6989586621679404354"><span class="annot"><span class="annottext">Maybe ReadRemoteNamespace
</span><a href="#local-6989586621679404354"><span class="hs-identifier hs-var">orepo</span></a></span></span><span> </span><span id="local-6989586621679404353"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404353"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span id="local-6989586621679404352"><span class="annot"><span class="annottext">SyncMode
</span><a href="#local-6989586621679404352"><span class="hs-identifier hs-var">_syncMode</span></a></span></span><span> </span><span id="local-6989586621679404351"><span class="annot"><span class="annottext">PullMode
</span><a href="#local-6989586621679404351"><span class="hs-identifier hs-var">pullMode</span></a></span></span><span> </span><span class="annot"><span class="annottext">Verbosity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1567"></span><span>      </span><span id="local-6989586621679404350"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404350"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404353"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1568"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404349"><span class="annot"><span class="annottext">command :: Text
</span><a href="#local-6989586621679404349"><span class="hs-identifier hs-var hs-var">command</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1569"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text)
-&gt; (InputPattern -&gt; String) -&gt; InputPattern -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InputPattern -&gt; String
</span><a href="Unison.CommandLine.InputPattern.html#%24sel%3ApatternName%3AInputPattern"><span class="hs-identifier hs-var hs-var">InputPattern.patternName</span></a></span><span> </span><span class="annot"><span class="annottext">(InputPattern -&gt; Text) -&gt; InputPattern -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1570"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PullMode
</span><a href="#local-6989586621679404351"><span class="hs-identifier hs-var">pullMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1571"></span><span>                </span><span class="annot"><span class="annottext">PullMode
</span><a href="Unison.Codebase.Editor.Input.html#PullWithoutHistory"><span class="hs-identifier hs-var">PullWithoutHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InputPattern
</span><a href="Unison.CommandLine.InputPatterns.html#pullWithoutHistory"><span class="hs-identifier hs-var">InputPatterns.pullWithoutHistory</span></a></span><span>
</span><span id="line-1572"></span><span>                </span><span class="annot"><span class="annottext">PullMode
</span><a href="Unison.Codebase.Editor.Input.html#PullWithHistory"><span class="hs-identifier hs-var">PullWithHistory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InputPattern
</span><a href="Unison.CommandLine.InputPatterns.html#pull"><span class="hs-identifier hs-var">InputPatterns.pull</span></a></span><span>
</span><span id="line-1573"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Cli r Text) -&gt; Text -&gt; Cli r Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1574"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404349"><span class="hs-identifier hs-var">command</span></a></span><span>
</span><span id="line-1575"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1576"></span><span>          </span><span class="hs-comment">-- todo: show the actual config-loaded namespace</span><span>
</span><span id="line-1577"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; (ReadRemoteNamespace -&gt; Text)
-&gt; Maybe ReadRemoteNamespace
-&gt; Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span>
</span><span id="line-1578"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;(remote namespace from .unisonConfig)&quot;</span></span><span>
</span><span id="line-1579"></span><span>            </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; Text
</span><span class="hs-identifier hs-var">printNamespace</span></span><span>
</span><span id="line-1580"></span><span>            </span><span class="annot"><span class="annottext">Maybe ReadRemoteNamespace
</span><a href="#local-6989586621679404354"><span class="hs-identifier hs-var">orepo</span></a></span><span>
</span><span id="line-1581"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1582"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404350"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-1583"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#CreateAuthorI"><span class="hs-identifier hs-type">CreateAuthorI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span id="local-6989586621679404345"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404345"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679404344"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404344"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;create.author &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404345"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404344"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1584"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#LoadPullRequestI"><span class="hs-identifier hs-type">LoadPullRequestI</span></a></span><span> </span><span id="local-6989586621679404343"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404343"><span class="hs-identifier hs-var">base</span></a></span></span><span> </span><span id="local-6989586621679404342"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404342"><span class="hs-identifier hs-var">head</span></a></span></span><span> </span><span id="local-6989586621679404341"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404341"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1585"></span><span>      </span><span id="local-6989586621679404340"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404340"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404341"><span class="hs-identifier hs-var">dest0</span></a></span><span>
</span><span id="line-1586"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-1587"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;pr.load &quot;</span></span><span>
</span><span id="line-1588"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; Text
</span><span class="hs-identifier hs-var">printNamespace</span></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404343"><span class="hs-identifier hs-var">base</span></a></span><span>
</span><span id="line-1589"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1590"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; Text
</span><span class="hs-identifier hs-var">printNamespace</span></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404342"><span class="hs-identifier hs-var">head</span></a></span><span>
</span><span id="line-1591"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-1592"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404340"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-1593"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#RemoveTermReplacementI"><span class="hs-identifier hs-type">RemoveTermReplacementI</span></a></span><span> </span><span id="local-6989586621679404339"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404339"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621679404338"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404338"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1594"></span><span>      </span><span id="local-6989586621679404337"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404337"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath -&gt; Cli r Text
forall r. Maybe PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404384"><span class="hs-identifier hs-var">opatch</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404338"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-1595"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;delete.term-replacement&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404339"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404337"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1596"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#RemoveTypeReplacementI"><span class="hs-identifier hs-type">RemoveTypeReplacementI</span></a></span><span> </span><span id="local-6989586621679404336"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404336"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621679404335"><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404335"><span class="hs-identifier hs-var">p0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1597"></span><span>      </span><span id="local-6989586621679404334"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404334"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath -&gt; Cli r Text
forall r. Maybe PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404384"><span class="hs-identifier hs-var">opatch</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679404335"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-1598"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;delete.type-replacement&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404336"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404334"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1599"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1600"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#ApiI"><span class="hs-identifier hs-var">ApiI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1601"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#AuthLoginI"><span class="hs-identifier hs-type">AuthLoginI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1602"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#CreateMessage"><span class="hs-identifier hs-type">CreateMessage</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1603"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#CreatePullRequestI"><span class="hs-identifier hs-type">CreatePullRequestI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1604"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugClearWatchI"><span class="hs-identifier hs-type">DebugClearWatchI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1605"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugDoctorI"><span class="hs-identifier hs-type">DebugDoctorI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1606"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugDumpNamespaceSimpleI"><span class="hs-identifier hs-type">DebugDumpNamespaceSimpleI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1607"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugDumpNamespacesI"><span class="hs-identifier hs-type">DebugDumpNamespacesI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1608"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugNumberedArgsI"><span class="hs-identifier hs-type">DebugNumberedArgsI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1609"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugTypecheckedUnisonFileI"><span class="hs-identifier hs-type">DebugTypecheckedUnisonFileI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1610"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeprecateTermI"><span class="hs-identifier hs-type">DeprecateTermI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1611"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DeprecateTypeI"><span class="hs-identifier hs-type">DeprecateTypeI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1612"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DiffNamespaceI"><span class="hs-identifier hs-type">DiffNamespaceI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1613"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DisplayI"><span class="hs-identifier hs-type">DisplayI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1614"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DocsI"><span class="hs-identifier hs-type">DocsI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1615"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DocsToHtmlI"><span class="hs-identifier hs-type">DocsToHtmlI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1616"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FindI"><span class="hs-identifier hs-type">FindI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1617"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FindPatchI"><span class="hs-identifier hs-type">FindPatchI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1618"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FindShallowI"><span class="hs-identifier hs-type">FindShallowI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1619"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#GistI"><span class="hs-identifier hs-type">GistI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1620"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#HistoryI"><span class="hs-identifier hs-type">HistoryI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1621"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#LinksI"><span class="hs-identifier hs-type">LinksI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1622"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ListDependenciesI"><span class="hs-identifier hs-type">ListDependenciesI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1623"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ListDependentsI"><span class="hs-identifier hs-type">ListDependentsI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1624"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ListEditsI"><span class="hs-identifier hs-type">ListEditsI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1625"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#LoadI"><span class="hs-identifier hs-type">LoadI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1626"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#NamesI"><span class="hs-identifier hs-type">NamesI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1627"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#NamespaceDependenciesI"><span class="hs-identifier hs-type">NamespaceDependenciesI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1628"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PopBranchI"><span class="hs-identifier hs-type">PopBranchI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1629"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PreviewAddI"><span class="hs-identifier hs-type">PreviewAddI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1630"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PreviewMergeLocalBranchI"><span class="hs-identifier hs-type">PreviewMergeLocalBranchI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1631"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PreviewUpdateI"><span class="hs-identifier hs-type">PreviewUpdateI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1632"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PushRemoteBranchI"><span class="hs-identifier hs-type">PushRemoteBranchI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1633"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#QuitI"><span class="hs-identifier hs-type">QuitI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1634"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ShowDefinitionByPrefixI"><span class="hs-identifier hs-type">ShowDefinitionByPrefixI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1635"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ShowDefinitionI"><span class="hs-identifier hs-type">ShowDefinitionI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1636"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ShowReflogI"><span class="hs-identifier hs-type">ShowReflogI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1637"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#SwitchBranchI"><span class="hs-identifier hs-type">SwitchBranchI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1638"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#TestI"><span class="hs-identifier hs-type">TestI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1639"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#TodoI"><span class="hs-identifier hs-type">TodoI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1640"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#UiI"><span class="hs-identifier hs-var">UiI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1641"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#UpI"><span class="hs-identifier hs-type">UpI</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1642"></span><span>    </span><span class="annot"><span class="annottext">Input
</span><a href="Unison.Codebase.Editor.Input.html#VersionI"><span class="hs-identifier hs-var">VersionI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1643"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#DebugTabCompletionI"><span class="hs-identifier hs-type">DebugTabCompletionI</span></a></span><span> </span><span id="local-6989586621679404332"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404332"><span class="hs-identifier hs-var">_input</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var">wat</span></a></span><span>
</span><span id="line-1644"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1645"></span><span>    </span><span id="local-6989586621679406539"><span class="annot"><a href="#local-6989586621679404449"><span class="hs-identifier hs-type">hp'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SBH.ShortBranchHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406539"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-1646"></span><span>    </span><span id="local-6989586621679404449"><span class="annot"><span class="annottext">hp' :: Either ShortBranchHash Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404449"><span class="hs-identifier hs-var hs-var">hp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ShortBranchHash -&gt; Cli r Text)
-&gt; (Path' -&gt; Cli r Text)
-&gt; Either ShortBranchHash Path'
-&gt; Cli r Text
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Cli r Text)
-&gt; (ShortBranchHash -&gt; Text) -&gt; ShortBranchHash -&gt; Cli r Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text)
-&gt; (ShortBranchHash -&gt; String) -&gt; ShortBranchHash -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span>
</span><span id="line-1647"></span><span>    </span><span id="local-6989586621679406538"><span class="annot"><a href="#local-6989586621679404447"><span class="hs-identifier hs-type">p'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406538"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-1648"></span><span>    </span><span id="local-6989586621679404447"><span class="annot"><span class="annottext">p' :: Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Absolute -&gt; Text) -&gt; Cli r Absolute -&gt; Cli r Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">(Cli r Absolute -&gt; Cli r Text)
-&gt; (Path' -&gt; Cli r Absolute) -&gt; Path' -&gt; Cli r Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span>
</span><span id="line-1649"></span><span>    </span><span id="local-6989586621679406533"><span class="annot"><a href="#local-6989586621679404393"><span class="hs-identifier hs-type">ops'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Split'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406533"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-1650"></span><span>    </span><span id="local-6989586621679404393"><span class="annot"><span class="annottext">ops' :: Maybe PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404393"><span class="hs-identifier hs-var hs-var">ops'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Cli r Text
-&gt; (PatchPath -&gt; Cli r Text) -&gt; Maybe PatchPath -&gt; Cli r Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span>
</span><span id="line-1651"></span><span>    </span><span id="local-6989586621679404330"><span class="annot"><a href="#local-6989586621679404384"><span class="hs-identifier hs-type">opatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Split'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679404330"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-1652"></span><span>    </span><span id="local-6989586621679404384"><span class="annot"><span class="annottext">opatch :: Maybe PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404384"><span class="hs-identifier hs-var hs-var">opatch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Text
forall r. PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var">ps'</span></a></span><span> </span><span class="annot"><span class="annottext">(PatchPath -&gt; Cli r Text)
-&gt; (Maybe PatchPath -&gt; PatchPath) -&gt; Maybe PatchPath -&gt; Cli r Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Maybe PatchPath -&gt; PatchPath
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="Unison.Cli.MonadUtils.html#defaultPatchPath"><span class="hs-identifier hs-var">Cli.defaultPatchPath</span></a></span><span>
</span><span id="line-1653"></span><span>    </span><span id="local-6989586621679404333"><span class="annot"><span class="annottext">wat :: Cli r Text
</span><a href="#local-6989586621679404333"><span class="hs-identifier hs-var hs-var">wat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Cli r Text
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Cli r Text) -&gt; String -&gt; Cli r Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Input -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679404454"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; is not expected to alter the branch&quot;</span></span><span>
</span><span id="line-1654"></span><span>    </span><span id="local-6989586621679406537"><span class="annot"><a href="#local-6989586621679404435"><span class="hs-identifier hs-type">hhqs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SH.ShortHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406537"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-1655"></span><span>    </span><span id="local-6989586621679404435"><span class="annot"><span class="annottext">hhqs' :: HashOrHQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404435"><span class="hs-identifier hs-var hs-var">hhqs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1656"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679404329"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679404329"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; Text
</span><span class="hs-identifier hs-var">SH.toText</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679404329"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1657"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679404327"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404327"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679404327"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1658"></span><span>    </span><span id="local-6989586621679406534"><span class="annot"><a href="#local-6989586621679404419"><span class="hs-identifier hs-type">hqs'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406534"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-1659"></span><span>    </span><span id="local-6989586621679404419"><span class="annot"><span class="annottext">hqs' :: HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var hs-var">hqs'</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404326"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404326"><span class="hs-identifier hs-var">p0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404325"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679404325"><span class="hs-identifier hs-var">hq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1660"></span><span>      </span><span id="local-6989586621679404324"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404324"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Bool
</span><span class="hs-identifier hs-var">Path.isRoot'</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404326"><span class="hs-identifier hs-var">p0</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Text
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404326"><span class="hs-identifier hs-var">p0</span></a></span><span>
</span><span id="line-1661"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404324"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HQSegment -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679404325"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1662"></span><span>    </span><span id="local-6989586621679404425"><span class="annot"><span class="annottext">hqs :: HQSplit -&gt; Cli r Text
</span><a href="#local-6989586621679404425"><span class="hs-identifier hs-var hs-var">hqs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404322"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404322"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404321"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679404321"><span class="hs-identifier hs-var">hq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r Text
forall r. HQSplit' -&gt; Cli r Text
</span><a href="#local-6989586621679404419"><span class="hs-identifier hs-var">hqs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either Absolute Relative -&gt; Path'
</span><span class="hs-identifier hs-var">Path'</span></span><span> </span><span class="annot"><span class="annottext">(Either Absolute Relative -&gt; Path')
-&gt; (Path -&gt; Either Absolute Relative) -&gt; Path -&gt; Path'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Relative -&gt; Either Absolute Relative
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Relative -&gt; Either Absolute Relative)
-&gt; (Path -&gt; Relative) -&gt; Path -&gt; Either Absolute Relative
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Relative
</span><span class="hs-identifier hs-var">Path.Relative</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Path') -&gt; Path -&gt; Path'
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404322"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679404321"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1663"></span><span>    </span><span id="local-6989586621679404433"><span class="annot"><span class="annottext">ps' :: PatchPath -&gt; Cli r Text
</span><a href="#local-6989586621679404433"><span class="hs-identifier hs-var hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Text
forall r. Path' -&gt; Cli r Text
</span><a href="#local-6989586621679404447"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">(Path' -&gt; Cli r Text)
-&gt; (PatchPath -&gt; Path') -&gt; PatchPath -&gt; Cli r Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Path'
</span><span class="hs-identifier hs-var">Path.unsplit'</span></span><span>
</span><span id="line-1664"></span><span>
</span><span id="line-1665"></span><span id="local-6989586621679406991"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#handleCreatePullRequest"><span class="hs-identifier hs-type">handleCreatePullRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReadRemoteNamespace</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReadRemoteNamespace</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406991"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1666"></span><span id="handleCreatePullRequest"><span class="annot"><span class="annottext">handleCreatePullRequest :: ReadRemoteNamespace -&gt; ReadRemoteNamespace -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleCreatePullRequest"><span class="hs-identifier hs-var hs-var">handleCreatePullRequest</span></a></span></span><span> </span><span id="local-6989586621679404318"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404318"><span class="hs-identifier hs-var">baseRepo0</span></a></span></span><span> </span><span id="local-6989586621679404317"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404317"><span class="hs-identifier hs-var">headRepo0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1667"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404316"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404316"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1668"></span><span>
</span><span id="line-1669"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679406506"><span class="annot"><a href="#local-6989586621679404315"><span class="hs-identifier hs-type">withBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReadRemoteNamespace</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679406521"><span class="annot"><a href="#local-6989586621679406521"><span class="hs-identifier hs-type">x</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679406522"><span class="annot"><a href="#local-6989586621679406522"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406522"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406521"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406506"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406521"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1670"></span><span>      </span><span id="local-6989586621679404315"><span class="annot"><span class="annottext">withBranch :: ReadRemoteNamespace
-&gt; forall x. (forall r. Branch IO -&gt; Cli r x) -&gt; Cli r x
</span><a href="#local-6989586621679404315"><span class="hs-identifier hs-var hs-var">withBranch</span></a></span></span><span> </span><span id="local-6989586621679404314"><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404314"><span class="hs-identifier hs-var">rrn</span></a></span></span><span> </span><span id="local-6989586621679404313"><span class="annot"><span class="annottext">forall r. Branch IO -&gt; Cli r x
</span><a href="#local-6989586621679404313"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404314"><span class="hs-identifier hs-var">rrn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1671"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ReadRemoteNamespaceGit</span></span><span> </span><span id="local-6989586621679404312"><span class="annot"><span class="annottext">ReadGitRemoteNamespace
</span><a href="#local-6989586621679404312"><span class="hs-identifier hs-var">repo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1672"></span><span>          </span><span class="annot"><span class="annottext">(forall x. (Branch IO -&gt; IO x) -&gt; IO (Either GitError x))
-&gt; (Either GitError (Branch IO) -&gt; Cli (R r x) x) -&gt; Cli r x
forall a e r b.
(forall x. (a -&gt; IO x) -&gt; IO (Either e x))
-&gt; (Either e a -&gt; Cli (R r b) b) -&gt; Cli r b
</span><a href="Unison.Cli.Monad.html#withE"><span class="hs-identifier hs-var">Cli.withE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; ReadGitRemoteNamespace
-&gt; GitBranchBehavior
-&gt; (Branch IO -&gt; IO x)
-&gt; IO (Either GitError x)
forall (m :: * -&gt; *) v a r.
MonadIO m =&gt;
Codebase m v a
-&gt; ReadGitRemoteNamespace
-&gt; GitBranchBehavior
-&gt; (Branch m -&gt; m r)
-&gt; m (Either GitError r)
</span><span class="hs-identifier hs-var">Codebase.viewRemoteBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404316"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ReadGitRemoteNamespace
</span><a href="#local-6989586621679404312"><span class="hs-identifier hs-var">repo</span></a></span><span> </span><span class="annot"><span class="annottext">GitBranchBehavior
</span><span class="hs-identifier hs-var">Git.RequireExistingBranch</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1673"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679404308"><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679404308"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli (R r x) x
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GitError -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#GitError"><span class="hs-identifier hs-var">Output.GitError</span></a></span><span> </span><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679404308"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1674"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679404307"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404307"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Cli (R r x) x
forall r. Branch IO -&gt; Cli r x
</span><a href="#local-6989586621679404313"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404307"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1675"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ReadRemoteNamespaceShare</span></span><span> </span><span id="local-6989586621679404306"><span class="annot"><span class="annottext">ReadShareRemoteNamespace
</span><a href="#local-6989586621679404306"><span class="hs-identifier hs-var">repo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Cli r x
forall r. Branch IO -&gt; Cli r x
</span><a href="#local-6989586621679404313"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">(Branch IO -&gt; Cli r x) -&gt; Cli r (Branch IO) -&gt; Cli r x
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">ReadShareRemoteNamespace -&gt; Cli r (Branch IO)
forall r. ReadShareRemoteNamespace -&gt; Cli r (Branch IO)
</span><a href="Unison.Codebase.Editor.HandleInput.html#importRemoteShareBranch"><span class="hs-identifier hs-var">importRemoteShareBranch</span></a></span><span> </span><span class="annot"><span class="annottext">ReadShareRemoteNamespace
</span><a href="#local-6989586621679404306"><span class="hs-identifier hs-var">repo</span></a></span><span>
</span><span id="line-1676"></span><span>
</span><span id="line-1677"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679404305"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404305"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404304"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679404304"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
-&gt; (forall r.
    Branch IO -&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann))
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
ReadRemoteNamespace
-&gt; forall x. (forall r. Branch IO -&gt; Cli r x) -&gt; Cli r x
</span><a href="#local-6989586621679404315"><span class="hs-identifier hs-var">withBranch</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404318"><span class="hs-identifier hs-var">baseRepo0</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404303"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404303"><span class="hs-identifier hs-var">baseBranch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
-&gt; (forall r.
    Branch IO -&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann))
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
ReadRemoteNamespace
-&gt; forall x. (forall r. Branch IO -&gt; Cli r x) -&gt; Cli r x
</span><a href="#local-6989586621679404315"><span class="hs-identifier hs-var">withBranch</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404317"><span class="hs-identifier hs-var">headRepo0</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404302"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404302"><span class="hs-identifier hs-var">headBranch</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1678"></span><span>    </span><span id="local-6989586621679404301"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404301"><span class="hs-identifier hs-var">merged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO)))
-&gt; MergeMode -&gt; Branch IO -&gt; Branch IO -&gt; IO (Branch IO)
forall (m :: * -&gt; *).
Monad m =&gt;
(Branch m -&gt; Branch m -&gt; m (Maybe (Branch m)))
-&gt; MergeMode -&gt; Branch m -&gt; Branch m -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Branch.merge''</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Branch m -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.lca</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404316"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><span class="hs-identifier hs-var">Branch.RegularMerge</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404303"><span class="hs-identifier hs-var">baseBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404302"><span class="hs-identifier hs-var">headBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1679"></span><span>    </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404303"><span class="hs-identifier hs-var">baseBranch</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404301"><span class="hs-identifier hs-var">merged</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1680"></span><span>  </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReadRemoteNamespace
-&gt; ReadRemoteNamespace
-&gt; PrettyPrintEnv
-&gt; BranchDiffOutput Symbol Ann
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffAfterCreatePR"><span class="hs-identifier hs-var">ShowDiffAfterCreatePR</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404318"><span class="hs-identifier hs-var">baseRepo0</span></a></span><span> </span><span class="annot"><span class="annottext">ReadRemoteNamespace
</span><a href="#local-6989586621679404317"><span class="hs-identifier hs-var">headRepo0</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404305"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679404304"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1681"></span><span>
</span><span id="line-1682"></span><span id="local-6989586621679406802"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#handleFindI"><span class="hs-identifier hs-type">handleFindI</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1683"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1684"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FindScope"><span class="hs-identifier hs-type">FindScope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1685"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1686"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1687"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406802"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1688"></span><span id="handleFindI"><span class="annot"><span class="annottext">handleFindI :: Bool -&gt; FindScope -&gt; [String] -&gt; Input -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleFindI"><span class="hs-identifier hs-var hs-var">handleFindI</span></a></span></span><span> </span><span id="local-6989586621679404299"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404299"><span class="hs-identifier hs-var">isVerbose</span></a></span></span><span> </span><span id="local-6989586621679404298"><span class="annot"><span class="annottext">FindScope
</span><a href="#local-6989586621679404298"><span class="hs-identifier hs-var">fscope</span></a></span></span><span> </span><span id="local-6989586621679404297"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404297"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span id="local-6989586621679404296"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679404296"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1689"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404295"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404295"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1690"></span><span>  </span><span id="local-6989586621679404294"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404294"><span class="hs-identifier hs-var">root'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-1691"></span><span>  </span><span id="local-6989586621679404293"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404293"><span class="hs-identifier hs-var">currentPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-1692"></span><span>  </span><span id="local-6989586621679404292"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404292"><span class="hs-identifier hs-var">currentBranch0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-1693"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679404291"><span class="hs-identifier hs-type">getNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FindScope"><span class="hs-identifier hs-type">FindScope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-1694"></span><span>      </span><span id="local-6989586621679404291"><span class="annot"><span class="annottext">getNames :: FindScope -&gt; Names
</span><a href="#local-6989586621679404291"><span class="hs-identifier hs-var hs-var">getNames</span></a></span></span><span> </span><span id="local-6989586621679404290"><span class="annot"><span class="annottext">FindScope
</span><a href="#local-6989586621679404290"><span class="hs-identifier hs-var">findScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1695"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404289"><span class="annot"><span class="annottext">cp :: Path
</span><a href="#local-6989586621679404289"><span class="hs-identifier hs-var hs-var">cp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404293"><span class="hs-identifier hs-var">currentPath'</span></a></span><span>
</span><span id="line-1696"></span><span>            </span><span id="local-6989586621679404288"><span class="annot"><span class="annottext">nameScope :: NameScoping
</span><a href="#local-6989586621679404288"><span class="hs-identifier hs-var hs-var">nameScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FindScope
</span><a href="#local-6989586621679404290"><span class="hs-identifier hs-var">findScope</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1697"></span><span>              </span><span class="annot"><span class="annottext">FindScope
</span><a href="Unison.Codebase.Editor.Input.html#FindLocal"><span class="hs-identifier hs-var">FindLocal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404289"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1698"></span><span>              </span><span class="annot"><span class="annottext">FindScope
</span><a href="Unison.Codebase.Editor.Input.html#FindLocalAndDeps"><span class="hs-identifier hs-var">FindLocalAndDeps</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404289"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1699"></span><span>              </span><span class="annot"><span class="annottext">FindScope
</span><a href="Unison.Codebase.Editor.Input.html#FindGlobal"><span class="hs-identifier hs-var">FindGlobal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.AllNames</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404289"><span class="hs-identifier hs-var">cp</span></a></span><span>
</span><span id="line-1700"></span><span>            </span><span id="local-6989586621679404284"><span class="annot"><span class="annottext">scopeFilter :: Names -&gt; Names
</span><a href="#local-6989586621679404284"><span class="hs-identifier hs-var hs-var">scopeFilter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FindScope
</span><a href="#local-6989586621679404290"><span class="hs-identifier hs-var">findScope</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1701"></span><span>              </span><span class="annot"><span class="annottext">FindScope
</span><a href="Unison.Codebase.Editor.Input.html#FindLocal"><span class="hs-identifier hs-var">FindLocal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1702"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404283"><span class="annot"><span class="annottext">f :: Name -&gt; Bool
</span><a href="#local-6989586621679404283"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679404282"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404282"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1703"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404282"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1704"></span><span>                        </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">Nel.:|</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1705"></span><span>                        </span><span class="annot"><span class="annottext">NonEmpty NameSegment
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1706"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.filter</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621679404283"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1707"></span><span>              </span><span class="annot"><span class="annottext">FindScope
</span><a href="Unison.Codebase.Editor.Input.html#FindGlobal"><span class="hs-identifier hs-var">FindGlobal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1708"></span><span>              </span><span class="annot"><span class="annottext">FindScope
</span><a href="Unison.Codebase.Editor.Input.html#FindLocalAndDeps"><span class="hs-identifier hs-var">FindLocalAndDeps</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1709"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404278"><span class="annot"><span class="annottext">f :: Name -&gt; Bool
</span><a href="#local-6989586621679404278"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679404277"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404277"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1710"></span><span>                      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679404277"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1711"></span><span>                        </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">Nel.:|</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1712"></span><span>                        </span><span class="annot"><span class="annottext">NonEmpty NameSegment
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1713"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.filter</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621679404278"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1714"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><a href="#local-6989586621679404284"><span class="hs-identifier hs-var">scopeFilter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; NameScoping -&gt; Names
forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><span class="hs-identifier hs-var">Backend.prettyNamesForBranch</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404294"><span class="hs-identifier hs-var">root'</span></a></span><span> </span><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679404288"><span class="hs-identifier hs-var">nameScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1715"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679406481"><span class="annot"><a href="#local-6989586621679404275"><span class="hs-identifier hs-type">getResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406481"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-1716"></span><span>      </span><span id="local-6989586621679404275"><span class="annot"><span class="annottext">getResults :: Names -&gt; Cli r [SearchResult]
</span><a href="#local-6989586621679404275"><span class="hs-identifier hs-var hs-var">getResults</span></a></span></span><span> </span><span id="local-6989586621679404274"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404274"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1717"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404297"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1718"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Cli r [SearchResult]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SearchResult -&gt; (HashQualified Name, SearchResult))
-&gt; [SearchResult] -&gt; [SearchResult]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679404272"><span class="annot"><span class="annottext">SearchResult
</span><a href="#local-6989586621679404272"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SearchResult -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">SR.name</span></span><span> </span><span class="annot"><span class="annottext">SearchResult
</span><a href="#local-6989586621679404272"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SearchResult
</span><a href="#local-6989586621679404272"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; [SearchResult]
</span><span class="hs-identifier hs-var">SR.fromNames</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404274"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1719"></span><span>          </span><span class="hs-comment">-- type query</span><span>
</span><span id="line-1720"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679404269"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404269"><span class="hs-identifier hs-var">ws</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1721"></span><span>            </span><span id="local-6989586621679404268"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404268"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Cli r (Type Symbol Ann)
forall r. String -&gt; String -&gt; Cli r (Type Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#parseSearchType"><span class="hs-identifier hs-var">parseSearchType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Input -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679404296"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unwords</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679404269"><span class="hs-identifier hs-var">ws</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1722"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404266"><span class="annot"><span class="annottext">named :: Set Referent
</span><a href="#local-6989586621679404266"><span class="hs-identifier hs-var hs-var">named</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Set Referent
forall (m :: * -&gt; *). Branch0 m -&gt; Set Referent
</span><span class="hs-identifier hs-var">Branch.deepReferents</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404292"><span class="hs-identifier hs-var">currentBranch0</span></a></span><span>
</span><span id="line-1723"></span><span>            </span><span id="local-6989586621679404264"><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679404264"><span class="hs-identifier hs-var">matches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1724"></span><span>              </span><span class="annot"><span class="annottext">(Set Referent -&gt; [Referent])
-&gt; Cli r (Set Referent) -&gt; Cli r [Referent]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Referent -&gt; Bool) -&gt; [Referent] -&gt; [Referent]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent -&gt; Set Referent -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679404266"><span class="hs-identifier hs-var">named</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Referent] -&gt; [Referent])
-&gt; (Set Referent -&gt; [Referent]) -&gt; Set Referent -&gt; [Referent]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cli r (Set Referent) -&gt; Cli r [Referent])
-&gt; Cli r (Set Referent) -&gt; Cli r [Referent]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1725"></span><span>                </span><span class="annot"><span class="annottext">IO (Set Referent) -&gt; Cli r (Set Referent)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Type Symbol Ann -&gt; IO (Set Referent)
forall v (m :: * -&gt; *) a.
(Var v, Functor m) =&gt;
Codebase m v a -&gt; Type v a -&gt; m (Set Referent)
</span><span class="hs-identifier hs-var">Codebase.termsOfType</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404295"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404268"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1726"></span><span>            </span><span id="local-6989586621679404262"><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679404262"><span class="hs-identifier hs-var">matches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1727"></span><span>              </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Referent] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679404264"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-1728"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1729"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#NoExactTypeMatches"><span class="hs-identifier hs-var">NoExactTypeMatches</span></a></span><span>
</span><span id="line-1730"></span><span>                  </span><span class="annot"><span class="annottext">(Set Referent -&gt; [Referent])
-&gt; Cli r (Set Referent) -&gt; Cli r [Referent]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Referent -&gt; Bool) -&gt; [Referent] -&gt; [Referent]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent -&gt; Set Referent -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679404266"><span class="hs-identifier hs-var">named</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Referent] -&gt; [Referent])
-&gt; (Set Referent -&gt; [Referent]) -&gt; Set Referent -&gt; [Referent]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cli r (Set Referent) -&gt; Cli r [Referent])
-&gt; Cli r (Set Referent) -&gt; Cli r [Referent]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1731"></span><span>                    </span><span class="annot"><span class="annottext">IO (Set Referent) -&gt; Cli r (Set Referent)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Type Symbol Ann -&gt; IO (Set Referent)
forall v (m :: * -&gt; *) a.
(Var v, Functor m) =&gt;
Codebase m v a -&gt; Type v a -&gt; m (Set Referent)
</span><span class="hs-identifier hs-var">Codebase.termsMentioningType</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404295"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679404268"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1732"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Referent] -&gt; Cli r [Referent]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679404264"><span class="hs-identifier hs-var">matches</span></a></span><span>
</span><span id="line-1733"></span><span>            </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-1734"></span><span>              </span><span class="hs-comment">-- in verbose mode, aliases are shown, so we collapse all</span><span>
</span><span id="line-1735"></span><span>              </span><span class="hs-comment">-- aliases to a single search result; in non-verbose mode,</span><span>
</span><span id="line-1736"></span><span>              </span><span class="hs-comment">-- a separate result may be shown for each alias</span><span>
</span><span id="line-1737"></span><span>              </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404299"><span class="hs-identifier hs-var">isVerbose</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(SearchResult -&gt; Referent) -&gt; [SearchResult] -&gt; [SearchResult]
forall (f :: * -&gt; *) b a.
(Foldable f, Ord b) =&gt;
(a -&gt; b) -&gt; f a -&gt; [a]
</span><span class="hs-identifier hs-var">uniqueBy</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; Referent
</span><span class="hs-identifier hs-var">SR.toReferent</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [SearchResult]
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SearchResult] -&gt; [SearchResult])
-&gt; [SearchResult] -&gt; [SearchResult]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1738"></span><span>                </span><span class="annot"><span class="annottext">Names -&gt; [Referent] -&gt; [Reference] -&gt; [SearchResult]
</span><a href="Unison.Codebase.Editor.HandleInput.html#searchResultsFor"><span class="hs-identifier hs-var">searchResultsFor</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404274"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679404262"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1739"></span><span>
</span><span id="line-1740"></span><span>          </span><span class="hs-comment">-- name query</span><span>
</span><span id="line-1741"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; HashQualified Name) -&gt; [String] -&gt; [HashQualified Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">HQ.unsafeFromString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679404256"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404256"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1742"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404255"><span class="annot"><span class="annottext">srs :: [SearchResult]
</span><a href="#local-6989586621679404255"><span class="hs-identifier hs-var hs-var">srs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
-&gt; (Name -&gt; Name -&gt; Maybe Int)
-&gt; [HashQualified Name]
-&gt; [SearchResult]
forall score.
Ord score =&gt;
Names
-&gt; (Name -&gt; Name -&gt; Maybe score)
-&gt; [HashQualified Name]
-&gt; [SearchResult]
</span><a href="Unison.Codebase.Editor.HandleInput.html#searchBranchScored"><span class="hs-identifier hs-var">searchBranchScored</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679404274"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Maybe Int
</span><a href="Unison.Codebase.Editor.HandleInput.html#fuzzyNameDistance"><span class="hs-identifier hs-var">fuzzyNameDistance</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404256"><span class="hs-identifier hs-var">qs</span></a></span><span>
</span><span id="line-1743"></span><span>            </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Cli r [SearchResult]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([SearchResult] -&gt; Cli r [SearchResult])
-&gt; [SearchResult] -&gt; Cli r [SearchResult]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(SearchResult -&gt; Referent) -&gt; [SearchResult] -&gt; [SearchResult]
forall (f :: * -&gt; *) b a.
(Foldable f, Ord b) =&gt;
(a -&gt; b) -&gt; f a -&gt; [a]
</span><span class="hs-identifier hs-var">uniqueBy</span></span><span> </span><span class="annot"><span class="annottext">SearchResult -&gt; Referent
</span><span class="hs-identifier hs-var">SR.toReferent</span></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404255"><span class="hs-identifier hs-var">srs</span></a></span><span>
</span><span id="line-1744"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404252"><span class="annot"><span class="annottext">respondResults :: [SearchResult] -&gt; Cli r ()
</span><a href="#local-6989586621679404252"><span class="hs-identifier hs-var hs-var">respondResults</span></a></span></span><span> </span><span id="local-6989586621679404251"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404251"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
        #numberedArgs .= fmap searchResultToHQString results
</span><span>        </span><span class="hs-identifier">results'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">liftIO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Backend.loadSearchResults</span><span> </span><span class="hs-identifier">codebase</span><span> </span><span class="hs-identifier">results</span><span class="hs-special">)</span><span>
</span><span id="line-1747"></span><span>        </span><span class="hs-identifier">ppe</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1748"></span><span>          </span><span class="hs-identifier">suffixifiedPPE</span><span>
</span><span id="line-1749"></span><span>            </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">makePrintNamesFromLabeled'</span><span>
</span><span id="line-1750"></span><span>              </span><span class="hs-special">(</span><span class="hs-identifier">foldMap</span><span> </span><span class="hs-identifier">SR'.labeledDependencies</span><span> </span><span class="hs-identifier">results'</span><span class="hs-special">)</span><span>
</span><span id="line-1751"></span><span>        </span><span class="hs-identifier">Cli.respond</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">ListOfDefinitions</span><span> </span><span class="hs-identifier">fscope</span><span> </span><span class="hs-identifier">ppe</span><span> </span><span class="hs-identifier">isVerbose</span><span> </span><span class="hs-identifier">results'</span><span>
</span><span id="line-1752"></span><span>  </span><span id="local-6989586621679404242"><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404242"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Cli r [SearchResult]
forall r. Names -&gt; Cli r [SearchResult]
</span><a href="#local-6989586621679404275"><span class="hs-identifier hs-var">getResults</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FindScope -&gt; Names
</span><a href="#local-6989586621679404291"><span class="hs-identifier hs-var">getNames</span></a></span><span> </span><span class="annot"><span class="annottext">FindScope
</span><a href="#local-6989586621679404298"><span class="hs-identifier hs-var">fscope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1753"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404242"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FindScope
</span><a href="#local-6989586621679404298"><span class="hs-identifier hs-var">fscope</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1754"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FindScope
</span><a href="Unison.Codebase.Editor.Input.html#FindLocal"><span class="hs-identifier hs-var">FindLocal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1755"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#FindNoLocalMatches"><span class="hs-identifier hs-var">FindNoLocalMatches</span></a></span><span>
</span><span id="line-1756"></span><span>      </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Cli r ()
</span><a href="#local-6989586621679404252"><span class="hs-identifier hs-var">respondResults</span></a></span><span> </span><span class="annot"><span class="annottext">([SearchResult] -&gt; Cli r ()) -&gt; Cli r [SearchResult] -&gt; Cli r ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Cli r [SearchResult]
forall r. Names -&gt; Cli r [SearchResult]
</span><a href="#local-6989586621679404275"><span class="hs-identifier hs-var">getResults</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FindScope -&gt; Names
</span><a href="#local-6989586621679404291"><span class="hs-identifier hs-var">getNames</span></a></span><span> </span><span class="annot"><span class="annottext">FindScope
</span><a href="Unison.Codebase.Editor.Input.html#FindLocalAndDeps"><span class="hs-identifier hs-var">FindLocalAndDeps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1757"></span><span>    </span><span class="annot"><span class="annottext">([SearchResult], FindScope)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SearchResult] -&gt; Cli r ()
</span><a href="#local-6989586621679404252"><span class="hs-identifier hs-var">respondResults</span></a></span><span> </span><span class="annot"><span class="annottext">[SearchResult]
</span><a href="#local-6989586621679404242"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-1758"></span><span>
</span><span id="line-1759"></span><span id="local-6989586621679406666"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#handleDependents"><span class="hs-identifier hs-type">handleDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406666"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1760"></span><span id="handleDependents"><span class="annot"><span class="annottext">handleDependents :: HashQualified Name -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleDependents"><span class="hs-identifier hs-var hs-var">handleDependents</span></a></span></span><span> </span><span id="local-6989586621679404240"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404240"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1761"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404239"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404239"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1762"></span><span>  </span><span id="local-6989586621679404238"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404238"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404239"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1763"></span><span>  </span><span class="hs-comment">-- todo: add flag to handle transitive efficiently</span><span>
</span><span id="line-1764"></span><span>  </span><span id="local-6989586621679404237"><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679404237"><span class="hs-identifier hs-var">lds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Cli r (Set LabeledDependency)
forall r. HashQualified Name -&gt; Cli r (Set LabeledDependency)
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveHQToLabeledDependencies"><span class="hs-identifier hs-var">resolveHQToLabeledDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404240"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-1765"></span><span>
</span><span id="line-1766"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679404237"><span class="hs-identifier hs-var">lds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1767"></span><span>    </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#LabeledReferenceNotFound"><span class="hs-identifier hs-var">LabeledReferenceNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404240"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1768"></span><span>
</span><span id="line-1769"></span><span>  </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; (LabeledDependency -&gt; Cli r ()) -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679404237"><span class="hs-identifier hs-var">lds</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404236"><span class="annot"><span class="annottext">LabeledDependency
</span><a href="#local-6989586621679404236"><span class="hs-identifier hs-var">ld</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1770"></span><span>    </span><span class="hs-comment">-- The full set of dependent references, any number of which may not have names in the current namespace.</span><span>
</span><span id="line-1771"></span><span>    </span><span id="local-6989586621679404235"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679404235"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1772"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404234"><span class="annot"><span class="annottext">tp :: Reference -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679404234"><span class="hs-identifier hs-var hs-var">tp</span></a></span></span><span> </span><span id="local-6989586621679404233"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404233"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; Cli r (Set Reference)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Functor m =&gt;
Codebase m v a -&gt; Reference -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Codebase.dependents</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404239"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404233"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1773"></span><span>          </span><span id="local-6989586621679404231"><span class="annot"><span class="annottext">tm :: Referent -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679404231"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679404230"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404230"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; Cli r (Set Reference)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Functor m =&gt;
Codebase m v a -&gt; Reference -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Codebase.dependents</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404239"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404230"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1774"></span><span>          </span><span class="annot"><a href="#local-6989586621679404231"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span id="local-6989586621679404229"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404229"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679404228"><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404228"><span class="hs-identifier hs-var">_cid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679404227"><span class="annot"><span class="annottext">ConstructorType
</span><a href="#local-6989586621679404227"><span class="hs-identifier hs-var">_ct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; Cli r (Set Reference)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Functor m =&gt;
Codebase m v a -&gt; Reference -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Codebase.dependents</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404239"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404229"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1775"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Cli r (Set Reference))
-&gt; (Referent -&gt; Cli r (Set Reference))
-&gt; LabeledDependency
-&gt; Cli r (Set Reference)
forall a.
(Reference -&gt; a) -&gt; (Referent -&gt; a) -&gt; LabeledDependency -&gt; a
</span><span class="hs-identifier hs-var">LD.fold</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679404234"><span class="hs-identifier hs-var">tp</span></a></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Cli r (Set Reference)
</span><a href="#local-6989586621679404231"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">LabeledDependency
</span><a href="#local-6989586621679404236"><span class="hs-identifier hs-var">ld</span></a></span><span>
</span><span id="line-1776"></span><span>    </span><span class="hs-comment">-- Use an unsuffixified PPE here, so we display full names (relative to the current path), rather than the shortest possible</span><span>
</span><span id="line-1777"></span><span>    </span><span class="hs-comment">-- unambiguous name.</span><span>
</span><span id="line-1778"></span><span>    </span><span id="local-6989586621679404226"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404226"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">(PrettyPrintEnvDecl -&gt; PrettyPrintEnv)
-&gt; Cli r PrettyPrintEnvDecl -&gt; Cli r PrettyPrintEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
forall r. (Path -&gt; NameScoping) -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#currentPrettyPrintEnvDecl"><span class="hs-identifier hs-var">currentPrettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span>
</span><span id="line-1779"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679404225"><span class="hs-identifier hs-type">results</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-1780"></span><span>        </span><span id="local-6989586621679404225"><span class="annot"><span class="annottext">results :: [(Reference, Maybe Name)]
</span><a href="#local-6989586621679404225"><span class="hs-identifier hs-var hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1781"></span><span>          </span><span class="hs-comment">-- Currently we only retain dependents that are named in the current namespace (hence `mapMaybe`). In the future, we could</span><span>
</span><span id="line-1782"></span><span>          </span><span class="hs-comment">-- take a flag to control whether we want to show all dependents</span><span>
</span><span id="line-1783"></span><span>          </span><span class="annot"><span class="annottext">(Reference -&gt; Maybe (Reference, Maybe Name))
-&gt; [Reference] -&gt; [(Reference, Maybe Name)]
forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Maybe (Reference, Maybe Name)
</span><a href="#local-6989586621679404224"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679404235"><span class="hs-identifier hs-var">dependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1784"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1785"></span><span>            </span><span class="annot"><a href="#local-6989586621679404224"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-1786"></span><span>            </span><span id="local-6989586621679404224"><span class="annot"><span class="annottext">f :: Reference -&gt; Maybe (Reference, Maybe Name)
</span><a href="#local-6989586621679404224"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679404223"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404223"><span class="hs-identifier hs-var">reference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1787"></span><span>              </span><span class="annot"><span class="annottext">[Maybe (Reference, Maybe Name)] -&gt; Maybe (Reference, Maybe Name)
forall (t :: * -&gt; *) (f :: * -&gt; *) a.
(Foldable t, Alternative f) =&gt;
t (f a) -&gt; f a
</span><span class="hs-identifier hs-var">asum</span></span><span>
</span><span id="line-1788"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; (Reference, Maybe Name)
</span><a href="#local-6989586621679404221"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; (Reference, Maybe Name))
-&gt; Maybe (HashQualified Name) -&gt; Maybe (Reference, Maybe Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; Maybe (HashQualified Name)
</span><span class="hs-identifier hs-var">PPE.terms</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404226"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404223"><span class="hs-identifier hs-var">reference</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1789"></span><span>                  </span><span class="annot"><span class="annottext">HashQualified Name -&gt; (Reference, Maybe Name)
</span><a href="#local-6989586621679404221"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; (Reference, Maybe Name))
-&gt; Maybe (HashQualified Name) -&gt; Maybe (Reference, Maybe Name)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Reference -&gt; Maybe (HashQualified Name)
</span><span class="hs-identifier hs-var">PPE.types</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679404226"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404223"><span class="hs-identifier hs-var">reference</span></a></span><span>
</span><span id="line-1790"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-1791"></span><span>              </span><span class="hs-keyword">where</span><span>
</span><span id="line-1792"></span><span>                </span><span class="annot"><a href="#local-6989586621679404221"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span>
</span><span id="line-1793"></span><span>                </span><span id="local-6989586621679404221"><span class="annot"><span class="annottext">g :: HashQualified Name -&gt; (Reference, Maybe Name)
</span><a href="#local-6989586621679404221"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span id="local-6989586621679404218"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404218"><span class="hs-identifier hs-var">hqName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1794"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404223"><span class="hs-identifier hs-var">reference</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Name
forall n. HashQualified n -&gt; n
</span><span class="hs-identifier hs-var">HQ'.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679404218"><span class="hs-identifier hs-var">hqName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
    #numberedArgs .= map (Text.unpack . Reference.toText . fst) results
</span><span>    </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; LabeledDependency -&gt; [(Reference, Maybe Name)] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ListDependents"><span class="hs-identifier hs-var">ListDependents</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404238"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">LabeledDependency
</span><a href="#local-6989586621679404236"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">[(Reference, Maybe Name)]
</span><a href="#local-6989586621679404225"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1797"></span><span>
</span><span id="line-1798"></span><span class="hs-comment">-- | Handle a @gist@ command.</span><span>
</span><span id="line-1799"></span><span id="local-6989586621679406544"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#handleGist"><span class="hs-identifier hs-type">handleGist</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#GistInput"><span class="hs-identifier hs-type">GistInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406544"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1800"></span><span id="handleGist"><span class="annot"><span class="annottext">handleGist :: GistInput -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleGist"><span class="hs-identifier hs-var hs-var">handleGist</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#GistInput"><span class="hs-identifier hs-type">GistInput</span></a></span><span> </span><span id="local-6989586621679404214"><span class="annot"><span class="annottext">WriteGitRepo
</span><a href="#local-6989586621679404214"><span class="hs-identifier hs-var">repo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1801"></span><span>  </span><span class="annot"><span class="annottext">PushFlavor -&gt; Path' -&gt; SyncMode -&gt; Cli r ()
forall r. PushFlavor -&gt; Path' -&gt; SyncMode -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#doPushRemoteBranch"><span class="hs-identifier hs-var">doPushRemoteBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteGitRepo -&gt; PushFlavor
</span><a href="Unison.Codebase.Editor.HandleInput.html#GistyPush"><span class="hs-identifier hs-var">GistyPush</span></a></span><span> </span><span class="annot"><span class="annottext">WriteGitRepo
</span><a href="#local-6989586621679404214"><span class="hs-identifier hs-var">repo</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Path'
</span><span class="hs-identifier hs-var">Path.relativeEmpty'</span></span><span> </span><span class="annot"><span class="annottext">SyncMode
</span><span class="hs-identifier hs-var">SyncMode.ShortCircuit</span></span><span>
</span><span id="line-1802"></span><span>
</span><span id="line-1803"></span><span class="hs-comment">-- | Handle a @push@ command.</span><span>
</span><span id="line-1804"></span><span id="local-6989586621679406667"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#handlePushRemoteBranch"><span class="hs-identifier hs-type">handlePushRemoteBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PushRemoteBranchInput"><span class="hs-identifier hs-type">PushRemoteBranchInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406667"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1805"></span><span id="handlePushRemoteBranch"><span class="annot"><span class="annottext">handlePushRemoteBranch :: PushRemoteBranchInput -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handlePushRemoteBranch"><span class="hs-identifier hs-var hs-var">handlePushRemoteBranch</span></a></span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#PushRemoteBranchInput"><span class="hs-identifier hs-type">PushRemoteBranchInput</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:maybeRemoteRepo:PushRemoteBranchInput :: PushRemoteBranchInput -&gt; Maybe WriteRemotePath
</span><a href="Unison.Codebase.Editor.Input.html#%24sel%3AmaybeRemoteRepo%3APushRemoteBranchInput"><span class="hs-identifier hs-var">maybeRemoteRepo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679404209"><span class="annot"><span class="annottext">Maybe WriteRemotePath
</span><a href="#local-6989586621679404209"><span class="hs-identifier hs-var">mayRepo</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:localPath:PushRemoteBranchInput :: PushRemoteBranchInput -&gt; Path'
</span><a href="Unison.Codebase.Editor.Input.html#%24sel%3AlocalPath%3APushRemoteBranchInput"><span class="hs-identifier hs-var">localPath</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679404207"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404207"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404206"><span class="annot"><span class="annottext">PushBehavior
$sel:pushBehavior:PushRemoteBranchInput :: PushRemoteBranchInput -&gt; PushBehavior
pushBehavior :: PushBehavior
</span><a href="Unison.Codebase.Editor.Input.html#%24sel%3ApushBehavior%3APushRemoteBranchInput"><span class="hs-identifier hs-var hs-var">pushBehavior</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404204"><span class="annot"><span class="annottext">SyncMode
$sel:syncMode:PushRemoteBranchInput :: PushRemoteBranchInput -&gt; SyncMode
syncMode :: SyncMode
</span><a href="Unison.Codebase.Editor.Input.html#%24sel%3AsyncMode%3APushRemoteBranchInput"><span class="hs-identifier hs-var hs-var">syncMode</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1806"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Cli r () -&gt; Cli r ()
forall r a. String -&gt; Cli r a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#time"><span class="hs-identifier hs-var">Cli.time</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;handlePushRemoteBranch&quot;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1807"></span><span>    </span><span id="local-6989586621679404202"><span class="annot"><span class="annottext">WriteRemotePath
</span><a href="#local-6989586621679404202"><span class="hs-identifier hs-var">repo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe WriteRemotePath
</span><a href="#local-6989586621679404209"><span class="hs-identifier hs-var">mayRepo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe WriteRemotePath
-&gt; (Maybe WriteRemotePath -&gt; Cli r WriteRemotePath)
-&gt; Cli r WriteRemotePath
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r WriteRemotePath
-&gt; Maybe WriteRemotePath -&gt; Cli r WriteRemotePath
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PushPull -&gt; Path' -&gt; Cli r WriteRemotePath
forall r. PushPull -&gt; Path' -&gt; Cli r WriteRemotePath
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveConfiguredUrl"><span class="hs-identifier hs-var">resolveConfiguredUrl</span></a></span><span> </span><span class="annot"><span class="annottext">PushPull
</span><a href="Unison.Codebase.Editor.Output.PushPull.html#Push"><span class="hs-identifier hs-var">Push</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404207"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1808"></span><span>    </span><span class="annot"><span class="annottext">PushFlavor -&gt; Path' -&gt; SyncMode -&gt; Cli r ()
forall r. PushFlavor -&gt; Path' -&gt; SyncMode -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#doPushRemoteBranch"><span class="hs-identifier hs-var">doPushRemoteBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteRemotePath -&gt; PushBehavior -&gt; PushFlavor
</span><a href="Unison.Codebase.Editor.HandleInput.html#NormalPush"><span class="hs-identifier hs-var">NormalPush</span></a></span><span> </span><span class="annot"><span class="annottext">WriteRemotePath
</span><a href="#local-6989586621679404202"><span class="hs-identifier hs-var">repo</span></a></span><span> </span><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404206"><span class="hs-identifier hs-var">pushBehavior</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404207"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="annot"><span class="annottext">SyncMode
</span><a href="#local-6989586621679404204"><span class="hs-identifier hs-var">syncMode</span></a></span><span>
</span><span id="line-1809"></span><span>
</span><span id="line-1810"></span><span class="hs-comment">-- | Either perform a &quot;normal&quot; push (updating a remote path), which takes a 'PushBehavior' (to control whether creating</span><span>
</span><span id="line-1811"></span><span class="hs-comment">-- a new namespace is allowed), or perform a &quot;gisty&quot; push, which doesn't update any paths (and also is currently only</span><span>
</span><span id="line-1812"></span><span class="hs-comment">-- uploaded for remote git repos, not remote Share repos).</span><span>
</span><span id="line-1813"></span><span class="hs-keyword">data</span><span> </span><span id="PushFlavor"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#PushFlavor"><span class="hs-identifier hs-var">PushFlavor</span></a></span></span><span>
</span><span id="line-1814"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NormalPush"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#NormalPush"><span class="hs-identifier hs-var">NormalPush</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteRemotePath</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PushBehavior</span></span><span>
</span><span id="line-1815"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="GistyPush"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#GistyPush"><span class="hs-identifier hs-var">GistyPush</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteGitRepo</span></span><span>
</span><span id="line-1816"></span><span>
</span><span id="line-1817"></span><span class="hs-comment">-- Internal helper that implements pushing to a remote repo, which generalizes @gist@ and @push@.</span><span>
</span><span id="line-1818"></span><span id="local-6989586621679406470"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#doPushRemoteBranch"><span class="hs-identifier hs-type">doPushRemoteBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1819"></span><span>  </span><span class="hs-comment">-- | The repo to push to.</span><span>
</span><span id="line-1820"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#PushFlavor"><span class="hs-identifier hs-type">PushFlavor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1821"></span><span>  </span><span class="hs-comment">-- | The local path to push. If relative, it's resolved relative to the current path (`cd`).</span><span>
</span><span id="line-1822"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1823"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SyncMode.SyncMode</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1824"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406470"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1825"></span><span id="doPushRemoteBranch"><span class="annot"><span class="annottext">doPushRemoteBranch :: PushFlavor -&gt; Path' -&gt; SyncMode -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#doPushRemoteBranch"><span class="hs-identifier hs-var hs-var">doPushRemoteBranch</span></a></span></span><span> </span><span id="local-6989586621679404200"><span class="annot"><span class="annottext">PushFlavor
</span><a href="#local-6989586621679404200"><span class="hs-identifier hs-var">pushFlavor</span></a></span></span><span> </span><span id="local-6989586621679404199"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404199"><span class="hs-identifier hs-var">localPath0</span></a></span></span><span> </span><span id="local-6989586621679404198"><span class="annot"><span class="annottext">SyncMode
</span><a href="#local-6989586621679404198"><span class="hs-identifier hs-var">syncMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1826"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404197"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404197"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1827"></span><span>  </span><span id="local-6989586621679404196"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404196"><span class="hs-identifier hs-var">localPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679404199"><span class="hs-identifier hs-var">localPath0</span></a></span><span>
</span><span id="line-1828"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PushFlavor
</span><a href="#local-6989586621679404200"><span class="hs-identifier hs-var">pushFlavor</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1829"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#NormalPush"><span class="hs-identifier hs-type">NormalPush</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404195"><span class="annot"><span class="annottext">writeRemotePath :: WriteRemotePath
</span><a href="#local-6989586621679404195"><span class="hs-identifier hs-var">writeRemotePath</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriteRemotePathGit</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteGitRemotePath</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404192"><span class="annot"><span class="annottext">WriteGitRepo
$sel:repo:WriteGitRemotePath :: WriteGitRemotePath -&gt; WriteGitRepo
repo :: WriteGitRepo
</span><span class="hs-identifier hs-var hs-var">repo</span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:path:WriteGitRemotePath :: WriteGitRemotePath -&gt; Path
</span><span class="hs-identifier hs-var">path</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679404189"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404189"><span class="hs-identifier hs-var">remotePath</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679404188"><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404188"><span class="hs-identifier hs-var">pushBehavior</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1830"></span><span>      </span><span id="local-6989586621679404187"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404187"><span class="hs-identifier hs-var">sourceBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch IO)
forall r. Absolute -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranchAt"><span class="hs-identifier hs-var">Cli.getBranchAt</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404196"><span class="hs-identifier hs-var">localPath</span></a></span><span>
</span><span id="line-1831"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679404186"><span class="hs-identifier hs-type">withRemoteRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span>
</span><span id="line-1832"></span><span>          </span><span id="local-6989586621679404186"><span class="annot"><span class="annottext">withRemoteRoot :: Branch IO -&gt; Either Output (Branch IO)
</span><a href="#local-6989586621679404186"><span class="hs-identifier hs-var hs-var">withRemoteRoot</span></a></span></span><span> </span><span id="local-6989586621679404185"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404185"><span class="hs-identifier hs-var">remoteRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1833"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- We don't merge `sourceBranch` with `remoteBranch`, we just replace it. This push will be rejected if</span><span>
</span><span id="line-1834"></span><span>                </span><span class="hs-comment">-- this rewinds time or misses any new updates in the remote branch that aren't in `sourceBranch`</span><span>
</span><span id="line-1835"></span><span>                </span><span class="hs-comment">-- already.</span><span>
</span><span id="line-1836"></span><span>                </span><span id="local-6989586621679404184"><span class="annot"><span class="annottext">f :: Branch IO -&gt; Maybe (Branch IO)
</span><a href="#local-6989586621679404184"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679404183"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404183"><span class="hs-identifier hs-var">remoteBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PushBehavior -&gt; Branch IO -&gt; Bool
forall (m :: * -&gt; *). PushBehavior -&gt; Branch m -&gt; Bool
</span><a href="#local-6989586621679404182"><span class="hs-identifier hs-var">shouldPushTo</span></a></span><span> </span><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404188"><span class="hs-identifier hs-var">pushBehavior</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404183"><span class="hs-identifier hs-var">remoteBranch</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Maybe (Branch IO)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404187"><span class="hs-identifier hs-var">sourceBranch</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (Branch IO)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1837"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path
-&gt; (Branch IO -&gt; Maybe (Branch IO))
-&gt; Branch IO
-&gt; Maybe (Branch IO)
forall (n :: * -&gt; *) (m :: * -&gt; *).
(Functor n, Applicative m) =&gt;
Path -&gt; (Branch m -&gt; n (Branch m)) -&gt; Branch m -&gt; n (Branch m)
</span><span class="hs-identifier hs-var">Branch.modifyAtM</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404189"><span class="hs-identifier hs-var">remotePath</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Maybe (Branch IO)
</span><a href="#local-6989586621679404184"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404185"><span class="hs-identifier hs-var">remoteRoot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1838"></span><span>              </span><span class="annot"><span class="annottext">Maybe (Branch IO)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Either Output (Branch IO)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PushBehavior -&gt; WriteRemotePath -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#RefusedToPush"><span class="hs-identifier hs-var">RefusedToPush</span></a></span><span> </span><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404188"><span class="hs-identifier hs-var">pushBehavior</span></a></span><span> </span><span class="annot"><span class="annottext">WriteRemotePath
</span><a href="#local-6989586621679404195"><span class="hs-identifier hs-var">writeRemotePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1839"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679404179"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404179"><span class="hs-identifier hs-var">newRemoteRoot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Either Output (Branch IO)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404179"><span class="hs-identifier hs-var">newRemoteRoot</span></a></span><span>
</span><span id="line-1840"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404178"><span class="annot"><span class="annottext">opts :: PushGitBranchOpts
</span><a href="#local-6989586621679404178"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1841"></span><span>            </span><span class="annot"><span class="annottext">PushGitBranchOpts :: GitPushBehavior -&gt; SyncMode -&gt; PushGitBranchOpts
</span><span class="hs-identifier hs-type">PushGitBranchOpts</span></span><span>
</span><span id="line-1842"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:behavior:PushGitBranchOpts :: GitPushBehavior
</span><span class="hs-identifier hs-var">behavior</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1843"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404188"><span class="hs-identifier hs-var">pushBehavior</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1844"></span><span>                    </span><span class="annot"><span class="annottext">PushBehavior
</span><span class="hs-identifier hs-var">PushBehavior.ForcePush</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GitPushBehavior
</span><span class="hs-identifier hs-var">GitPushBehaviorForce</span></span><span>
</span><span id="line-1845"></span><span>                    </span><span class="annot"><span class="annottext">PushBehavior
</span><span class="hs-identifier hs-var">PushBehavior.RequireEmpty</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GitPushBehavior
</span><span class="hs-identifier hs-var">GitPushBehaviorFf</span></span><span>
</span><span id="line-1846"></span><span>                    </span><span class="annot"><span class="annottext">PushBehavior
</span><span class="hs-identifier hs-var">PushBehavior.RequireNonEmpty</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GitPushBehavior
</span><span class="hs-identifier hs-var">GitPushBehaviorFf</span></span><span class="hs-special">,</span><span>
</span><span id="line-1847"></span><span>                </span><span class="annot"><span class="annottext">SyncMode
$sel:syncMode:PushGitBranchOpts :: SyncMode
syncMode :: SyncMode
</span><span class="hs-identifier hs-var hs-var">syncMode</span></span><span>
</span><span id="line-1848"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1849"></span><span>      </span><span id="local-6989586621679404169"><span class="annot"><span class="annottext">Either Output (Branch IO)
</span><a href="#local-6989586621679404169"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1850"></span><span>        </span><span class="annot"><span class="annottext">IO (Either GitError (Either Output (Branch IO)))
-&gt; (GitError -&gt; Cli r (Either Output (Branch IO)))
-&gt; Cli r (Either Output (Branch IO))
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; WriteGitRepo
-&gt; PushGitBranchOpts
-&gt; (Branch IO -&gt; IO (Either Output (Branch IO)))
-&gt; IO (Either GitError (Either Output (Branch IO)))
forall (m :: * -&gt; *) v a.
Codebase m v a
-&gt; forall e.
   WriteGitRepo
   -&gt; PushGitBranchOpts
   -&gt; (Branch m -&gt; m (Either e (Branch m)))
   -&gt; m (Either GitError (Either e (Branch m)))
</span><span class="hs-identifier hs-var hs-var">Codebase.pushGitBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404197"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">WriteGitRepo
</span><a href="#local-6989586621679404192"><span class="hs-identifier hs-var">repo</span></a></span><span> </span><span class="annot"><span class="annottext">PushGitBranchOpts
</span><a href="#local-6989586621679404178"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679404167"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404167"><span class="hs-identifier hs-var">remoteRoot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Output (Branch IO) -&gt; IO (Either Output (Branch IO))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Either Output (Branch IO)
</span><a href="#local-6989586621679404186"><span class="hs-identifier hs-var">withRemoteRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404167"><span class="hs-identifier hs-var">remoteRoot</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404166"><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679404166"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1851"></span><span>          </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Either Output (Branch IO))
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GitError -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#GitError"><span class="hs-identifier hs-var">Output.GitError</span></a></span><span> </span><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679404166"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1852"></span><span>      </span><span id="local-6989586621679404165"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404165"><span class="hs-identifier hs-var">_branch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either Output (Branch IO)
</span><a href="#local-6989586621679404169"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">Either Output (Branch IO)
-&gt; (Either Output (Branch IO) -&gt; Cli r (Branch IO))
-&gt; Cli r (Branch IO)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r (Branch IO))
-&gt; Either Output (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m b) -&gt; Either a b -&gt; m b
</span><span class="hs-identifier hs-var">onLeft</span></span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Branch IO)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span>
</span><span id="line-1853"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#Success"><span class="hs-identifier hs-var">Success</span></a></span><span>
</span><span id="line-1854"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#NormalPush"><span class="hs-identifier hs-type">NormalPush</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WriteRemotePathShare</span></span><span> </span><span id="local-6989586621679404163"><span class="annot"><span class="annottext">WriteShareRemotePath
</span><a href="#local-6989586621679404163"><span class="hs-identifier hs-var">sharePath</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679404162"><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404162"><span class="hs-identifier hs-var">pushBehavior</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WriteShareRemotePath -&gt; Absolute -&gt; PushBehavior -&gt; Cli r ()
forall r.
WriteShareRemotePath -&gt; Absolute -&gt; PushBehavior -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handlePushToUnisonShare"><span class="hs-identifier hs-var">handlePushToUnisonShare</span></a></span><span> </span><span class="annot"><span class="annottext">WriteShareRemotePath
</span><a href="#local-6989586621679404163"><span class="hs-identifier hs-var">sharePath</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404196"><span class="hs-identifier hs-var">localPath</span></a></span><span> </span><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404162"><span class="hs-identifier hs-var">pushBehavior</span></a></span><span>
</span><span id="line-1855"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#GistyPush"><span class="hs-identifier hs-type">GistyPush</span></a></span><span> </span><span id="local-6989586621679404160"><span class="annot"><span class="annottext">WriteGitRepo
</span><a href="#local-6989586621679404160"><span class="hs-identifier hs-var">repo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1856"></span><span>      </span><span id="local-6989586621679404159"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404159"><span class="hs-identifier hs-var">sourceBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch IO)
forall r. Absolute -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranchAt"><span class="hs-identifier hs-var">Cli.getBranchAt</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404196"><span class="hs-identifier hs-var">localPath</span></a></span><span>
</span><span id="line-1857"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404158"><span class="annot"><span class="annottext">opts :: PushGitBranchOpts
</span><a href="#local-6989586621679404158"><span class="hs-identifier hs-var hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1858"></span><span>            </span><span class="annot"><span class="annottext">PushGitBranchOpts :: GitPushBehavior -&gt; SyncMode -&gt; PushGitBranchOpts
</span><span class="hs-identifier hs-type">PushGitBranchOpts</span></span><span>
</span><span id="line-1859"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:behavior:PushGitBranchOpts :: GitPushBehavior
</span><span class="hs-identifier hs-var">behavior</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GitPushBehavior
</span><span class="hs-identifier hs-var">GitPushBehaviorGist</span></span><span class="hs-special">,</span><span>
</span><span id="line-1860"></span><span>                </span><span class="annot"><span class="annottext">SyncMode
$sel:syncMode:PushGitBranchOpts :: SyncMode
syncMode :: SyncMode
</span><span class="hs-identifier hs-var hs-var">syncMode</span></span><span>
</span><span id="line-1861"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-1862"></span><span>      </span><span id="local-6989586621679404156"><span class="annot"><span class="annottext">Either Output (Branch IO)
</span><a href="#local-6989586621679404156"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1863"></span><span>        </span><span class="annot"><span class="annottext">IO (Either GitError (Either Output (Branch IO)))
-&gt; (GitError -&gt; Cli r (Either Output (Branch IO)))
-&gt; Cli r (Either Output (Branch IO))
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; WriteGitRepo
-&gt; PushGitBranchOpts
-&gt; (Branch IO -&gt; IO (Either Output (Branch IO)))
-&gt; IO (Either GitError (Either Output (Branch IO)))
forall (m :: * -&gt; *) v a.
Codebase m v a
-&gt; forall e.
   WriteGitRepo
   -&gt; PushGitBranchOpts
   -&gt; (Branch m -&gt; m (Either e (Branch m)))
   -&gt; m (Either GitError (Either e (Branch m)))
</span><span class="hs-identifier hs-var hs-var">Codebase.pushGitBranch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404197"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">WriteGitRepo
</span><a href="#local-6989586621679404160"><span class="hs-identifier hs-var">repo</span></a></span><span> </span><span class="annot"><span class="annottext">PushGitBranchOpts
</span><a href="#local-6989586621679404158"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679404155"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404155"><span class="hs-identifier hs-var">_remoteRoot</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Output (Branch IO) -&gt; IO (Either Output (Branch IO))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Either Output (Branch IO)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404159"><span class="hs-identifier hs-var">sourceBranch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404154"><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679404154"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1864"></span><span>          </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Either Output (Branch IO))
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GitError -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#GitError"><span class="hs-identifier hs-var">Output.GitError</span></a></span><span> </span><span class="annot"><span class="annottext">GitError
</span><a href="#local-6989586621679404154"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1865"></span><span>      </span><span id="local-6989586621679404153"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404153"><span class="hs-identifier hs-var">_branch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either Output (Branch IO)
</span><a href="#local-6989586621679404156"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="annot"><span class="annottext">Either Output (Branch IO)
-&gt; (Either Output (Branch IO) -&gt; Cli r (Branch IO))
-&gt; Cli r (Branch IO)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r (Branch IO))
-&gt; Either Output (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m b) -&gt; Either a b -&gt; m b
</span><span class="hs-identifier hs-var">onLeft</span></span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Branch IO)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span>
</span><span id="line-1866"></span><span>      </span><span id="local-6989586621679404152"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404152"><span class="hs-identifier hs-var">sbhLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.branchHashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404197"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1867"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1868"></span><span>        </span><span class="annot"><span class="annottext">ReadRemoteNamespace -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#GistCreated"><span class="hs-identifier hs-var">GistCreated</span></a></span><span>
</span><span id="line-1869"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ReadGitRemoteNamespace -&gt; ReadRemoteNamespace
</span><span class="hs-identifier hs-var">ReadRemoteNamespaceGit</span></span><span>
</span><span id="line-1870"></span><span>              </span><span class="annot"><span class="annottext">ReadGitRemoteNamespace :: ReadGitRepo
-&gt; Maybe ShortBranchHash -&gt; Path -&gt; ReadGitRemoteNamespace
</span><span class="hs-identifier hs-type">ReadGitRemoteNamespace</span></span><span>
</span><span id="line-1871"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:repo:ReadGitRemoteNamespace :: ReadGitRepo
</span><span class="hs-identifier hs-var">repo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WriteGitRepo -&gt; ReadGitRepo
</span><span class="hs-identifier hs-var">writeToReadGit</span></span><span> </span><span class="annot"><span class="annottext">WriteGitRepo
</span><a href="#local-6989586621679404160"><span class="hs-identifier hs-var">repo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1872"></span><span>                  </span><span class="annot"><span class="annottext">$sel:sbh:ReadGitRemoteNamespace :: Maybe ShortBranchHash
</span><span class="hs-identifier hs-var">sbh</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortBranchHash -&gt; Maybe ShortBranchHash
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; CausalHash -&gt; ShortBranchHash
forall h. Coercible h Hash =&gt; Int -&gt; h -&gt; ShortBranchHash
</span><span class="hs-identifier hs-var">SBH.fromHash</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404152"><span class="hs-identifier hs-var">sbhLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; CausalHash
forall (m :: * -&gt; *). Branch m -&gt; CausalHash
</span><span class="hs-identifier hs-var">Branch.headHash</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404159"><span class="hs-identifier hs-var">sourceBranch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1873"></span><span>                  </span><span class="annot"><span class="annottext">$sel:path:ReadGitRemoteNamespace :: Path
</span><span class="hs-identifier hs-var">path</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path
</span><span class="hs-identifier hs-var">Path.empty</span></span><span>
</span><span id="line-1874"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-1875"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-1876"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1877"></span><span>    </span><span class="hs-comment">-- Per `pushBehavior`, we are either:</span><span>
</span><span id="line-1878"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1879"></span><span>    </span><span class="hs-comment">--   (1) force-pushing, in which case the remote branch state doesn't matter</span><span>
</span><span id="line-1880"></span><span>    </span><span class="hs-comment">--   (2) updating an empty branch, which fails if the branch isn't empty (`push.create`)</span><span>
</span><span id="line-1881"></span><span>    </span><span class="hs-comment">--   (3) updating a non-empty branch, which fails if the branch is empty (`push`)</span><span>
</span><span id="line-1882"></span><span>    </span><span id="local-6989586621679406465"><span class="annot"><a href="#local-6989586621679404182"><span class="hs-identifier hs-type">shouldPushTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PushBehavior</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679406465"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-1883"></span><span>    </span><span id="local-6989586621679404182"><span class="annot"><span class="annottext">shouldPushTo :: PushBehavior -&gt; Branch m -&gt; Bool
</span><a href="#local-6989586621679404182"><span class="hs-identifier hs-var hs-var">shouldPushTo</span></a></span></span><span> </span><span id="local-6989586621679404146"><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404146"><span class="hs-identifier hs-var">pushBehavior</span></a></span></span><span> </span><span id="local-6989586621679404145"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679404145"><span class="hs-identifier hs-var">remoteBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1884"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404146"><span class="hs-identifier hs-var">pushBehavior</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1885"></span><span>        </span><span class="annot"><span class="annottext">PushBehavior
</span><span class="hs-identifier hs-var">PushBehavior.ForcePush</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1886"></span><span>        </span><span class="annot"><span class="annottext">PushBehavior
</span><span class="hs-identifier hs-var">PushBehavior.RequireEmpty</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Branch0 m -&gt; Bool
forall (m :: * -&gt; *). Branch0 m -&gt; Bool
</span><span class="hs-identifier hs-var">Branch.isEmpty0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679404145"><span class="hs-identifier hs-var">remoteBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1887"></span><span>        </span><span class="annot"><span class="annottext">PushBehavior
</span><span class="hs-identifier hs-var">PushBehavior.RequireNonEmpty</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 m -&gt; Bool
forall (m :: * -&gt; *). Branch0 m -&gt; Bool
</span><span class="hs-identifier hs-var">Branch.isEmpty0</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679404145"><span class="hs-identifier hs-var">remoteBranch</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1888"></span><span>
</span><span id="line-1889"></span><span id="local-6989586621679406455"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#handlePushToUnisonShare"><span class="hs-identifier hs-type">handlePushToUnisonShare</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteShareRemotePath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PushBehavior</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406455"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1890"></span><span id="handlePushToUnisonShare"><span class="annot"><span class="annottext">handlePushToUnisonShare :: WriteShareRemotePath -&gt; Absolute -&gt; PushBehavior -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handlePushToUnisonShare"><span class="hs-identifier hs-var hs-var">handlePushToUnisonShare</span></a></span></span><span> </span><span id="local-6989586621679404144"><span class="annot"><span class="annottext">remote :: WriteShareRemotePath
</span><a href="#local-6989586621679404144"><span class="hs-identifier hs-var">remote</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">WriteShareRemotePath</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404142"><span class="annot"><span class="annottext">ShareCodeserver
$sel:server:WriteShareRemotePath :: WriteShareRemotePath -&gt; ShareCodeserver
server :: ShareCodeserver
</span><span class="hs-identifier hs-var hs-var">server</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404140"><span class="annot"><span class="annottext">Text
$sel:repo:WriteShareRemotePath :: WriteShareRemotePath -&gt; Text
repo :: Text
</span><span class="hs-identifier hs-var hs-var">repo</span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:path:WriteShareRemotePath :: WriteShareRemotePath -&gt; Path
</span><span class="hs-identifier hs-var">path</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679404137"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404137"><span class="hs-identifier hs-var">remotePath</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679404136"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404136"><span class="hs-identifier hs-var">localPath</span></a></span></span><span> </span><span id="local-6989586621679404135"><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404135"><span class="hs-identifier hs-var">behavior</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1891"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404134"><span class="annot"><span class="annottext">codeserver :: CodeserverURI
</span><a href="#local-6989586621679404134"><span class="hs-identifier hs-var hs-var">codeserver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShareCodeserver -&gt; CodeserverURI
</span><a href="Unison.Share.Codeserver.html#resolveCodeserver"><span class="hs-identifier hs-var">Codeserver.resolveCodeserver</span></a></span><span> </span><span class="annot"><span class="annottext">ShareCodeserver
</span><a href="#local-6989586621679404142"><span class="hs-identifier hs-var">server</span></a></span><span>
</span><span id="line-1892"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404133"><span class="annot"><span class="annottext">baseURL :: BaseUrl
</span><a href="#local-6989586621679404133"><span class="hs-identifier hs-var hs-var">baseURL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodeserverURI -&gt; BaseUrl
</span><span class="hs-identifier hs-var">codeserverBaseURL</span></span><span> </span><span class="annot"><span class="annottext">CodeserverURI
</span><a href="#local-6989586621679404134"><span class="hs-identifier hs-var">codeserver</span></a></span><span>
</span><span id="line-1893"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404132"><span class="annot"><span class="annottext">sharePath :: Path
</span><a href="#local-6989586621679404132"><span class="hs-identifier hs-var hs-var">sharePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Text -&gt; Path
</span><span class="hs-identifier hs-var">Share.Path</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404140"><span class="hs-identifier hs-var">repo</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; NonEmpty Text
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">Nel.:|</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; [Text]
</span><a href="#local-6989586621679404130"><span class="hs-identifier hs-var">pathToSegments</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404137"><span class="hs-identifier hs-var">remotePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1894"></span><span>  </span><span class="annot"><span class="annottext">CodeserverURI -&gt; Cli r ()
forall r. CodeserverURI -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.AuthLogin.html#ensureAuthenticatedWithCodeserver"><span class="hs-identifier hs-var">ensureAuthenticatedWithCodeserver</span></a></span><span> </span><span class="annot"><span class="annottext">CodeserverURI
</span><a href="#local-6989586621679404134"><span class="hs-identifier hs-var">codeserver</span></a></span><span>
</span><span id="line-1895"></span><span>
</span><span id="line-1896"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404129"><span class="annot"><span class="annottext">AuthenticatedHttpClient
$sel:authHTTPClient:Env :: Env -&gt; AuthenticatedHttpClient
authHTTPClient :: AuthenticatedHttpClient
</span><a href="Unison.Cli.Monad.html#%24sel%3AauthHTTPClient%3AEnv"><span class="hs-identifier hs-var hs-var">authHTTPClient</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404127"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404127"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1897"></span><span>
</span><span id="line-1898"></span><span>  </span><span class="hs-comment">-- doesn't handle the case where a non-existent path is supplied</span><span>
</span><span id="line-1899"></span><span>  </span><span id="local-6989586621679404126"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404126"><span class="hs-identifier hs-var">localCausalHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1900"></span><span>    </span><span class="annot"><span class="annottext">IO (Maybe CausalHash) -&gt; Cli r (Maybe CausalHash)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Transaction (Maybe CausalHash) -&gt; IO (Maybe CausalHash)
forall (m :: * -&gt; *) v a b.
MonadIO m =&gt;
Codebase m v a -&gt; Transaction b -&gt; m b
</span><span class="hs-identifier hs-var">Codebase.runTransaction</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404127"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Transaction (Maybe CausalHash)
</span><span class="hs-identifier hs-var">Ops.loadCausalHashAtPath</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; [Text]
</span><a href="#local-6989586621679404130"><span class="hs-identifier hs-var">pathToSegments</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404136"><span class="hs-identifier hs-var">localPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe CausalHash)
-&gt; (Cli r (Maybe CausalHash) -&gt; Cli r CausalHash)
-&gt; Cli r CausalHash
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r CausalHash -&gt; Cli r (Maybe CausalHash) -&gt; Cli r CausalHash
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><span class="hs-identifier hs-var">onNothingM</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1901"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r CausalHash
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path' -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#EmptyPush"><span class="hs-identifier hs-var">EmptyPush</span></a></span><span> </span><span class="annot"><span class="annottext">(Path' -&gt; Output) -&gt; (Absolute -&gt; Path') -&gt; Absolute -&gt; Output
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path'
</span><span class="hs-identifier hs-var">Path.absoluteToPath'</span></span><span> </span><span class="annot"><span class="annottext">(Absolute -&gt; Output) -&gt; Absolute -&gt; Output
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679404136"><span class="hs-identifier hs-var">localPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1902"></span><span>
</span><span id="line-1903"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679404123"><span class="hs-identifier hs-type">checkAndSetPush</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Hash32</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Share.Sync.Types.html#SyncError"><span class="hs-identifier hs-type">Share.SyncError</span></a></span><span> </span><span class="annot"><a href="Unison.Share.Sync.Types.html#CheckAndSetPushError"><span class="hs-identifier hs-type">Share.CheckAndSetPushError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1904"></span><span>      </span><span id="local-6989586621679404123"><span class="annot"><span class="annottext">checkAndSetPush :: Maybe Hash32 -&gt; IO (Either (SyncError CheckAndSetPushError) ())
</span><a href="#local-6989586621679404123"><span class="hs-identifier hs-var hs-var">checkAndSetPush</span></a></span></span><span> </span><span id="local-6989586621679404122"><span class="annot"><span class="annottext">Maybe Hash32
</span><a href="#local-6989586621679404122"><span class="hs-identifier hs-var">remoteHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1905"></span><span>        </span><span class="annot"><span class="annottext">((Int -&gt; IO ()) -&gt; IO (Either (SyncError CheckAndSetPushError) ()))
-&gt; IO (Either (SyncError CheckAndSetPushError) ())
forall a. ((Int -&gt; IO ()) -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621679404121"><span class="hs-identifier hs-var">withEntitiesUploadedProgressCallback</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404120"><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679404120"><span class="hs-identifier hs-var">uploadedCallback</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1906"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Hash32 -&gt; Maybe Hash32
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; Hash32
</span><span class="hs-identifier hs-var">Hash32.fromHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; Hash
</span><span class="hs-identifier hs-var hs-var">unCausalHash</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404126"><span class="hs-identifier hs-var">localCausalHash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Hash32 -&gt; Maybe Hash32 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Maybe Hash32
</span><a href="#local-6989586621679404122"><span class="hs-identifier hs-var">remoteHash</span></a></span><span>
</span><span id="line-1907"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Either (SyncError CheckAndSetPushError) ()
-&gt; IO (Either (SyncError CheckAndSetPushError) ())
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Either (SyncError CheckAndSetPushError) ()
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1908"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-1909"></span><span>              </span><span class="annot"><span class="annottext">AuthenticatedHttpClient
-&gt; BaseUrl
-&gt; (forall a. (Connection -&gt; IO a) -&gt; IO a)
-&gt; Path
-&gt; Maybe Hash32
-&gt; CausalHash
-&gt; (Int -&gt; IO ())
-&gt; IO (Either (SyncError CheckAndSetPushError) ())
</span><a href="Unison.Share.Sync.html#checkAndSetPush"><span class="hs-identifier hs-var">Share.checkAndSetPush</span></a></span><span>
</span><span id="line-1910"></span><span>                </span><span class="annot"><span class="annottext">AuthenticatedHttpClient
</span><a href="#local-6989586621679404129"><span class="hs-identifier hs-var">authHTTPClient</span></a></span><span>
</span><span id="line-1911"></span><span>                </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679404133"><span class="hs-identifier hs-var">baseURL</span></a></span><span>
</span><span id="line-1912"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; forall a. (Connection -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; forall a. (Connection -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var hs-var">Codebase.withConnectionIO</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404127"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1913"></span><span>                </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404132"><span class="hs-identifier hs-var">sharePath</span></a></span><span>
</span><span id="line-1914"></span><span>                </span><span class="annot"><span class="annottext">Maybe Hash32
</span><a href="#local-6989586621679404122"><span class="hs-identifier hs-var">remoteHash</span></a></span><span>
</span><span id="line-1915"></span><span>                </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404126"><span class="hs-identifier hs-var">localCausalHash</span></a></span><span>
</span><span id="line-1916"></span><span>                </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679404120"><span class="hs-identifier hs-var">uploadedCallback</span></a></span><span>
</span><span id="line-1917"></span><span>
</span><span id="line-1918"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PushBehavior
</span><a href="#local-6989586621679404135"><span class="hs-identifier hs-var">behavior</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1919"></span><span>    </span><span class="annot"><span class="annottext">PushBehavior
</span><span class="hs-identifier hs-var">PushBehavior.ForcePush</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1920"></span><span>      </span><span id="local-6989586621679404115"><span class="annot"><span class="annottext">Maybe HashJWT
</span><a href="#local-6989586621679404115"><span class="hs-identifier hs-var">maybeHashJwt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1921"></span><span>        </span><span class="annot"><span class="annottext">IO (Either GetCausalHashByPathError (Maybe HashJWT))
-&gt; (GetCausalHashByPathError -&gt; Cli r (Maybe HashJWT))
-&gt; Cli r (Maybe HashJWT)
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AuthenticatedHttpClient
-&gt; BaseUrl
-&gt; Path
-&gt; IO (Either GetCausalHashByPathError (Maybe HashJWT))
</span><a href="Unison.Share.Sync.html#getCausalHashByPath"><span class="hs-identifier hs-var">Share.getCausalHashByPath</span></a></span><span> </span><span class="annot"><span class="annottext">AuthenticatedHttpClient
</span><a href="#local-6989586621679404129"><span class="hs-identifier hs-var">authHTTPClient</span></a></span><span> </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679404133"><span class="hs-identifier hs-var">baseURL</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404132"><span class="hs-identifier hs-var">sharePath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404113"><span class="annot"><span class="annottext">GetCausalHashByPathError
</span><a href="#local-6989586621679404113"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1922"></span><span>          </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Maybe HashJWT)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShareError -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ShareError"><span class="hs-identifier hs-var">Output.ShareError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetCausalHashByPathError -&gt; ShareError
</span><a href="Unison.Codebase.Editor.Output.html#ShareErrorGetCausalHashByPath"><span class="hs-identifier hs-var">ShareErrorGetCausalHashByPath</span></a></span><span> </span><span class="annot"><span class="annottext">GetCausalHashByPathError
</span><a href="#local-6989586621679404113"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1923"></span><span>      </span><span class="annot"><span class="annottext">IO (Either (SyncError CheckAndSetPushError) ())
-&gt; (SyncError CheckAndSetPushError -&gt; Cli r ()) -&gt; Cli r ()
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Hash32 -&gt; IO (Either (SyncError CheckAndSetPushError) ())
</span><a href="#local-6989586621679404123"><span class="hs-identifier hs-var">checkAndSetPush</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashJWT -&gt; Hash32
</span><span class="hs-identifier hs-var">Share.hashJWTHash</span></span><span> </span><span class="annot"><span class="annottext">(HashJWT -&gt; Hash32) -&gt; Maybe HashJWT -&gt; Maybe Hash32
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe HashJWT
</span><a href="#local-6989586621679404115"><span class="hs-identifier hs-var">maybeHashJwt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CheckAndSetPushError -&gt; ShareError)
-&gt; SyncError CheckAndSetPushError -&gt; Cli r ()
forall a r b. (a -&gt; ShareError) -&gt; SyncError a -&gt; Cli r b
</span><a href="#local-6989586621679404110"><span class="hs-identifier hs-var">pushError</span></a></span><span> </span><span class="annot"><span class="annottext">CheckAndSetPushError -&gt; ShareError
</span><a href="Unison.Codebase.Editor.Output.html#ShareErrorCheckAndSetPush"><span class="hs-identifier hs-var">ShareErrorCheckAndSetPush</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1924"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteShareRemotePath -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ViewOnShare"><span class="hs-identifier hs-var">ViewOnShare</span></a></span><span> </span><span class="annot"><span class="annottext">WriteShareRemotePath
</span><a href="#local-6989586621679404144"><span class="hs-identifier hs-var">remote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1925"></span><span>    </span><span class="annot"><span class="annottext">PushBehavior
</span><span class="hs-identifier hs-var">PushBehavior.RequireEmpty</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1926"></span><span>      </span><span class="annot"><span class="annottext">IO (Either (SyncError CheckAndSetPushError) ())
-&gt; (SyncError CheckAndSetPushError -&gt; Cli r ()) -&gt; Cli r ()
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Hash32 -&gt; IO (Either (SyncError CheckAndSetPushError) ())
</span><a href="#local-6989586621679404123"><span class="hs-identifier hs-var">checkAndSetPush</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Hash32
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CheckAndSetPushError -&gt; ShareError)
-&gt; SyncError CheckAndSetPushError -&gt; Cli r ()
forall a r b. (a -&gt; ShareError) -&gt; SyncError a -&gt; Cli r b
</span><a href="#local-6989586621679404110"><span class="hs-identifier hs-var">pushError</span></a></span><span> </span><span class="annot"><span class="annottext">CheckAndSetPushError -&gt; ShareError
</span><a href="Unison.Codebase.Editor.Output.html#ShareErrorCheckAndSetPush"><span class="hs-identifier hs-var">ShareErrorCheckAndSetPush</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1927"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteShareRemotePath -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ViewOnShare"><span class="hs-identifier hs-var">ViewOnShare</span></a></span><span> </span><span class="annot"><span class="annottext">WriteShareRemotePath
</span><a href="#local-6989586621679404144"><span class="hs-identifier hs-var">remote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1928"></span><span>    </span><span class="annot"><span class="annottext">PushBehavior
</span><span class="hs-identifier hs-var">PushBehavior.RequireNonEmpty</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1929"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679404107"><span class="hs-identifier hs-type">push</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Share.Sync.Types.html#SyncError"><span class="hs-identifier hs-type">Share.SyncError</span></a></span><span> </span><span class="annot"><a href="Unison.Share.Sync.Types.html#FastForwardPushError"><span class="hs-identifier hs-type">Share.FastForwardPushError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1930"></span><span>          </span><span id="local-6989586621679404107"><span class="annot"><span class="annottext">push :: IO (Either (SyncError FastForwardPushError) ())
</span><a href="#local-6989586621679404107"><span class="hs-identifier hs-var hs-var">push</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1931"></span><span>            </span><span class="annot"><span class="annottext">((Int -&gt; IO ()) -&gt; IO (Either (SyncError FastForwardPushError) ()))
-&gt; IO (Either (SyncError FastForwardPushError) ())
forall a. ((Int -&gt; IO ()) -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621679404121"><span class="hs-identifier hs-var">withEntitiesUploadedProgressCallback</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404106"><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679404106"><span class="hs-identifier hs-var">uploadedCallback</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1932"></span><span>              </span><span class="annot"><span class="annottext">AuthenticatedHttpClient
-&gt; BaseUrl
-&gt; (forall a. (Connection -&gt; IO a) -&gt; IO a)
-&gt; Path
-&gt; CausalHash
-&gt; (Int -&gt; IO ())
-&gt; IO (Either (SyncError FastForwardPushError) ())
</span><a href="Unison.Share.Sync.html#fastForwardPush"><span class="hs-identifier hs-var">Share.fastForwardPush</span></a></span><span>
</span><span id="line-1933"></span><span>                </span><span class="annot"><span class="annottext">AuthenticatedHttpClient
</span><a href="#local-6989586621679404129"><span class="hs-identifier hs-var">authHTTPClient</span></a></span><span>
</span><span id="line-1934"></span><span>                </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679404133"><span class="hs-identifier hs-var">baseURL</span></a></span><span>
</span><span id="line-1935"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; forall a. (Connection -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; forall a. (Connection -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var hs-var">Codebase.withConnectionIO</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404127"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1936"></span><span>                </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404132"><span class="hs-identifier hs-var">sharePath</span></a></span><span>
</span><span id="line-1937"></span><span>                </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679404126"><span class="hs-identifier hs-var">localCausalHash</span></a></span><span>
</span><span id="line-1938"></span><span>                </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679404106"><span class="hs-identifier hs-var">uploadedCallback</span></a></span><span>
</span><span id="line-1939"></span><span>      </span><span class="annot"><span class="annottext">IO (Either (SyncError FastForwardPushError) ())
-&gt; (SyncError FastForwardPushError -&gt; Cli r ()) -&gt; Cli r ()
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either (SyncError FastForwardPushError) ())
</span><a href="#local-6989586621679404107"><span class="hs-identifier hs-var">push</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FastForwardPushError -&gt; ShareError)
-&gt; SyncError FastForwardPushError -&gt; Cli r ()
forall a r b. (a -&gt; ShareError) -&gt; SyncError a -&gt; Cli r b
</span><a href="#local-6989586621679404110"><span class="hs-identifier hs-var">pushError</span></a></span><span> </span><span class="annot"><span class="annottext">FastForwardPushError -&gt; ShareError
</span><a href="Unison.Codebase.Editor.Output.html#ShareErrorFastForwardPush"><span class="hs-identifier hs-var">ShareErrorFastForwardPush</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1940"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteShareRemotePath -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ViewOnShare"><span class="hs-identifier hs-var">ViewOnShare</span></a></span><span> </span><span class="annot"><span class="annottext">WriteShareRemotePath
</span><a href="#local-6989586621679404144"><span class="hs-identifier hs-var">remote</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1941"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1942"></span><span>    </span><span class="annot"><a href="#local-6989586621679404130"><span class="hs-identifier hs-type">pathToSegments</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-1943"></span><span>    </span><span id="local-6989586621679404130"><span class="annot"><span class="annottext">pathToSegments :: Path -&gt; [Text]
</span><a href="#local-6989586621679404130"><span class="hs-identifier hs-var hs-var">pathToSegments</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1944"></span><span>      </span><span class="annot"><span class="annottext">(Path -&gt; [NameSegment]) -&gt; Path -&gt; [Text]
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; [NameSegment]
</span><span class="hs-identifier hs-var">Path.toList</span></span><span>
</span><span id="line-1945"></span><span>
</span><span id="line-1946"></span><span>    </span><span class="hs-comment">-- Provide the given action a callback that displays to the terminal.</span><span>
</span><span id="line-1947"></span><span>    </span><span id="local-6989586621679406445"><span class="annot"><a href="#local-6989586621679404121"><span class="hs-identifier hs-type">withEntitiesUploadedProgressCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679406445"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679406445"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1948"></span><span>    </span><span id="local-6989586621679404121"><span class="annot"><span class="annottext">withEntitiesUploadedProgressCallback :: ((Int -&gt; IO ()) -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621679404121"><span class="hs-identifier hs-var hs-var">withEntitiesUploadedProgressCallback</span></a></span></span><span> </span><span id="local-6989586621679404102"><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; IO a
</span><a href="#local-6989586621679404102"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1949"></span><span>      </span><span id="local-6989586621679404101"><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679404101"><span class="hs-identifier hs-var">entitiesUploadedVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO (TVar Int)
forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1950"></span><span>      </span><span class="annot"><span class="annottext">IO a -&gt; IO a
forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">Console.Regions.displayConsoleRegions</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1951"></span><span>        </span><span class="annot"><span class="annottext">RegionLayout -&gt; (ConsoleRegion -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
RegionLayout -&gt; (ConsoleRegion -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">Console.Regions.withConsoleRegion</span></span><span> </span><span class="annot"><span class="annottext">RegionLayout
</span><span class="hs-identifier hs-var">Console.Regions.Linear</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679404097"><span class="annot"><span class="annottext">ConsoleRegion
</span><a href="#local-6989586621679404097"><span class="hs-identifier hs-var">region</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1952"></span><span>          </span><span class="annot"><span class="annottext">ConsoleRegion -&gt; STM Text -&gt; IO ()
forall v (m :: * -&gt; *).
(ToRegionContent v, LiftRegion m) =&gt;
ConsoleRegion -&gt; v -&gt; m ()
</span><span class="hs-identifier hs-var">Console.Regions.setConsoleRegion</span></span><span> </span><span class="annot"><span class="annottext">ConsoleRegion
</span><a href="#local-6989586621679404097"><span class="hs-identifier hs-var">region</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1953"></span><span>            </span><span id="local-6989586621679404095"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404095"><span class="hs-identifier hs-var">entitiesUploaded</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar Int -&gt; STM Int
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679404101"><span class="hs-identifier hs-var">entitiesUploadedVar</span></a></span><span>
</span><span id="line-1954"></span><span>            </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-1955"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n  Uploaded &quot;</span></span><span>
</span><span id="line-1956"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404095"><span class="hs-identifier hs-var">entitiesUploaded</span></a></span><span>
</span><span id="line-1957"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; entities...\n\n&quot;</span></span><span>
</span><span id="line-1958"></span><span>          </span><span id="local-6989586621679404094"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404094"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; IO a
</span><a href="#local-6989586621679404102"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679404093"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404093"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TVar Int -&gt; (Int -&gt; Int) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679404101"><span class="hs-identifier hs-var">entitiesUploadedVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404093"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1959"></span><span>          </span><span id="local-6989586621679404092"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404092"><span class="hs-identifier hs-var">entitiesUploaded</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar Int -&gt; IO Int
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679404101"><span class="hs-identifier hs-var">entitiesUploadedVar</span></a></span><span>
</span><span id="line-1960"></span><span>          </span><span class="annot"><span class="annottext">ConsoleRegion -&gt; Text -&gt; IO ()
forall v (m :: * -&gt; *).
(Outputable v, LiftRegion m) =&gt;
ConsoleRegion -&gt; v -&gt; m ()
</span><span class="hs-identifier hs-var">Console.Regions.finishConsoleRegion</span></span><span> </span><span class="annot"><span class="annottext">ConsoleRegion
</span><a href="#local-6989586621679404097"><span class="hs-identifier hs-var">region</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1961"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n  Uploaded &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404092"><span class="hs-identifier hs-var">entitiesUploaded</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; entities.&quot;</span></span><span>
</span><span id="line-1962"></span><span>          </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404094"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-1963"></span><span>
</span><span id="line-1964"></span><span>    </span><span id="local-6989586621679406433"><span id="local-6989586621679406434"><span id="local-6989586621679406435"><span class="annot"><a href="#local-6989586621679404110"><span class="hs-identifier hs-type">pushError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679406435"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#ShareError"><span class="hs-identifier hs-type">Output.ShareError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Share.Sync.Types.html#SyncError"><span class="hs-identifier hs-type">Share.SyncError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406435"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406434"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406433"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-1965"></span><span>    </span><span id="local-6989586621679404110"><span class="annot"><span class="annottext">pushError :: (a -&gt; ShareError) -&gt; SyncError a -&gt; Cli r b
</span><a href="#local-6989586621679404110"><span class="hs-identifier hs-var hs-var">pushError</span></a></span></span><span> </span><span id="local-6989586621679404090"><span class="annot"><span class="annottext">a -&gt; ShareError
</span><a href="#local-6989586621679404090"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679404089"><span class="annot"><span class="annottext">SyncError a
</span><a href="#local-6989586621679404089"><span class="hs-identifier hs-var">err0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1966"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r b
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SyncError a
</span><a href="#local-6989586621679404089"><span class="hs-identifier hs-var">err0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1967"></span><span>        </span><span class="annot"><a href="Unison.Share.Sync.Types.html#SyncError"><span class="hs-identifier hs-type">Share.SyncError</span></a></span><span> </span><span id="local-6989586621679404087"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404087"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShareError -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ShareError"><span class="hs-identifier hs-var">Output.ShareError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ShareError
</span><a href="#local-6989586621679404090"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404087"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1968"></span><span>        </span><span class="annot"><a href="Unison.Share.Sync.Types.html#TransportError"><span class="hs-identifier hs-type">Share.TransportError</span></a></span><span> </span><span id="local-6989586621679404085"><span class="annot"><span class="annottext">CodeserverTransportError
</span><a href="#local-6989586621679404085"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShareError -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ShareError"><span class="hs-identifier hs-var">Output.ShareError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodeserverTransportError -&gt; ShareError
</span><a href="Unison.Codebase.Editor.Output.html#ShareErrorTransport"><span class="hs-identifier hs-var">ShareErrorTransport</span></a></span><span> </span><span class="annot"><span class="annottext">CodeserverTransportError
</span><a href="#local-6989586621679404085"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1969"></span><span>
</span><span id="line-1970"></span><span class="hs-comment">-- | Handle a @ShowDefinitionI@ input command, i.e. `view` or `edit`.</span><span>
</span><span id="line-1971"></span><span id="local-6989586621679406821"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#handleShowDefinition"><span class="hs-identifier hs-type">handleShowDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#OutputLocation"><span class="hs-identifier hs-type">OutputLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#ShowDefinitionScope"><span class="hs-identifier hs-type">ShowDefinitionScope</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406821"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1972"></span><span id="handleShowDefinition"><span class="annot"><span class="annottext">handleShowDefinition :: OutputLocation
-&gt; ShowDefinitionScope -&gt; [HashQualified Name] -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleShowDefinition"><span class="hs-identifier hs-var hs-var">handleShowDefinition</span></a></span></span><span> </span><span id="local-6989586621679404083"><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679404083"><span class="hs-identifier hs-var">outputLoc</span></a></span></span><span> </span><span id="local-6989586621679404082"><span class="annot"><span class="annottext">ShowDefinitionScope
</span><a href="#local-6989586621679404082"><span class="hs-identifier hs-var">showDefinitionScope</span></a></span></span><span> </span><span id="local-6989586621679404081"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404081"><span class="hs-identifier hs-var">inputQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1973"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404080"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404080"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-1974"></span><span>  </span><span id="local-6989586621679404079"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404079"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404080"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1975"></span><span>  </span><span class="hs-comment">-- If the query is empty, run a fuzzy search.</span><span>
</span><span id="line-1976"></span><span>  </span><span id="local-6989586621679404078"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404078"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1977"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404081"><span class="hs-identifier hs-var">inputQuery</span></a></span><span>
</span><span id="line-1978"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1979"></span><span>        </span><span id="local-6989586621679404077"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404077"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-1980"></span><span>        </span><span class="annot"><span class="annottext">Position -&gt; Branch0 IO -&gt; Cli r (Maybe [HashQualified Name])
forall (m :: * -&gt; *) (m0 :: * -&gt; *).
MonadIO m =&gt;
Position -&gt; Branch0 m0 -&gt; m (Maybe [HashQualified Name])
</span><a href="Unison.Codebase.Editor.HandleInput.html#fuzzySelectDefinition"><span class="hs-identifier hs-var">fuzzySelectDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">Relative</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404077"><span class="hs-identifier hs-var">branch</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe [HashQualified Name])
-&gt; (Cli r (Maybe [HashQualified Name])
    -&gt; Cli r [HashQualified Name])
-&gt; Cli r [HashQualified Name]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r [HashQualified Name]
-&gt; Cli r (Maybe [HashQualified Name]) -&gt; Cli r [HashQualified Name]
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><span class="hs-identifier hs-var">onNothingM</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1981"></span><span>          </span><span class="annot"><span class="annottext">Output -&gt; Cli r [HashQualified Name]
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679404083"><span class="hs-identifier hs-var">outputLoc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1982"></span><span>            </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#ConsoleLocation"><span class="hs-identifier hs-var">ConsoleLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InputPattern -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#HelpMessage"><span class="hs-identifier hs-var">HelpMessage</span></a></span><span> </span><span class="annot"><span class="annottext">InputPattern
</span><a href="Unison.CommandLine.InputPatterns.html#view"><span class="hs-identifier hs-var">InputPatterns.view</span></a></span><span>
</span><span id="line-1983"></span><span>            </span><span class="annot"><span class="annottext">OutputLocation
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InputPattern -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#HelpMessage"><span class="hs-identifier hs-var">HelpMessage</span></a></span><span> </span><span class="annot"><span class="annottext">InputPattern
</span><a href="Unison.CommandLine.InputPatterns.html#edit"><span class="hs-identifier hs-var">InputPatterns.edit</span></a></span><span>
</span><span id="line-1984"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Cli r [HashQualified Name]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404081"><span class="hs-identifier hs-var">inputQuery</span></a></span><span>
</span><span id="line-1985"></span><span>  </span><span id="local-6989586621679404072"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404072"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-1986"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404071"><span class="annot"><span class="annottext">root0 :: Branch0 IO
</span><a href="#local-6989586621679404071"><span class="hs-identifier hs-var hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404072"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-1987"></span><span>  </span><span id="local-6989586621679404070"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404070"><span class="hs-identifier hs-var">currentPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">(Absolute -&gt; Path) -&gt; Cli r Absolute -&gt; Cli r Path
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-1988"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404069"><span class="annot"><span class="annottext">hasAbsoluteQuery :: Bool
</span><a href="#local-6989586621679404069"><span class="hs-identifier hs-var hs-var">hasAbsoluteQuery</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Bool) -&gt; [HashQualified Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; HashQualified Name -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><span class="hs-identifier hs-var">Name.isAbsolute</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404081"><span class="hs-identifier hs-var">inputQuery</span></a></span><span>
</span><span id="line-1989"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679404068"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404068"><span class="hs-identifier hs-var">names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404067"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404067"><span class="hs-identifier hs-var">unbiasedPPE</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404069"><span class="hs-identifier hs-var">hasAbsoluteQuery</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShowDefinitionScope
</span><a href="#local-6989586621679404082"><span class="hs-identifier hs-var">showDefinitionScope</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1990"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShowDefinitionScope
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1991"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404066"><span class="annot"><span class="annottext">namingScope :: NameScoping
</span><a href="#local-6989586621679404066"><span class="hs-identifier hs-var hs-var">namingScope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.AllNames</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404070"><span class="hs-identifier hs-var">currentPath'</span></a></span><span>
</span><span id="line-1992"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404065"><span class="annot"><span class="annottext">parseNames :: NamesWithHistory
</span><a href="#local-6989586621679404065"><span class="hs-identifier hs-var hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; NamesWithHistory) -&gt; Names -&gt; NamesWithHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; NameScoping -&gt; Names
forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><span class="hs-identifier hs-var">Backend.parseNamesForBranch</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404072"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="annot"><span class="annottext">NameScoping
</span><a href="#local-6989586621679404066"><span class="hs-identifier hs-var">namingScope</span></a></span><span>
</span><span id="line-1993"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404063"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679404063"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NameScoping -&gt; Branch IO -&gt; PrettyPrintEnvDecl
forall (m :: * -&gt; *).
Int -&gt; NameScoping -&gt; Branch m -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">Backend.getCurrentPrettyNames</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404079"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404070"><span class="hs-identifier hs-var">currentPath'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404072"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-1994"></span><span>      </span><span class="annot"><span class="annottext">(NamesWithHistory, PrettyPrintEnvDecl)
-&gt; Cli r (NamesWithHistory, PrettyPrintEnvDecl)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404065"><span class="hs-identifier hs-var">parseNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404063"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1995"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShowDefinitionScope
</span><a href="Unison.Codebase.Editor.Input.html#ShowDefinitionGlobal"><span class="hs-identifier hs-var">ShowDefinitionGlobal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1996"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404061"><span class="annot"><span class="annottext">names :: NamesWithHistory
</span><a href="#local-6989586621679404061"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; NamesWithHistory)
-&gt; (Names -&gt; Names) -&gt; Names -&gt; NamesWithHistory
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.makeAbsolute</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; NamesWithHistory) -&gt; Names -&gt; NamesWithHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404071"><span class="hs-identifier hs-var">root0</span></a></span><span>
</span><span id="line-1997"></span><span>      </span><span class="hs-comment">-- Use an absolutely qualified ppe for view.global</span><span>
</span><span id="line-1998"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404060"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679404060"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPE.fromNamesDecl</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404079"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404061"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-1999"></span><span>      </span><span class="annot"><span class="annottext">(NamesWithHistory, PrettyPrintEnvDecl)
-&gt; Cli r (NamesWithHistory, PrettyPrintEnvDecl)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404061"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404060"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2000"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShowDefinitionScope
</span><a href="Unison.Codebase.Editor.Input.html#ShowDefinitionLocal"><span class="hs-identifier hs-var">ShowDefinitionLocal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2001"></span><span>      </span><span id="local-6989586621679404058"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404058"><span class="hs-identifier hs-var">currentBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-2002"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404057"><span class="annot"><span class="annottext">currentNames :: NamesWithHistory
</span><a href="#local-6989586621679404057"><span class="hs-identifier hs-var hs-var">currentNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; NamesWithHistory) -&gt; Names -&gt; NamesWithHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404058"><span class="hs-identifier hs-var">currentBranch</span></a></span><span>
</span><span id="line-2003"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404056"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679404056"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NameScoping -&gt; Branch IO -&gt; PrettyPrintEnvDecl
forall (m :: * -&gt; *).
Int -&gt; NameScoping -&gt; Branch m -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">Backend.getCurrentPrettyNames</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404079"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679404070"><span class="hs-identifier hs-var">currentPath'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679404072"><span class="hs-identifier hs-var">root</span></a></span><span>
</span><span id="line-2004"></span><span>      </span><span class="annot"><span class="annottext">(NamesWithHistory, PrettyPrintEnvDecl)
-&gt; Cli r (NamesWithHistory, PrettyPrintEnvDecl)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404057"><span class="hs-identifier hs-var">currentNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404056"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2005"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Backend.DefinitionResults</span></span><span> </span><span id="local-6989586621679404054"><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679404054"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621679404053"><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679404053"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span id="local-6989586621679404052"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404052"><span class="hs-identifier hs-var">misses</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2006"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404051"><span class="annot"><span class="annottext">nameSearch :: NameSearch
</span><a href="#local-6989586621679404051"><span class="hs-identifier hs-var hs-var">nameSearch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; NameSearch
</span><span class="hs-identifier hs-var">Backend.makeNameSearch</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679404079"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679404068"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-2007"></span><span>    </span><span class="annot"><span class="annottext">IO (DefinitionResults Symbol) -&gt; Cli r (DefinitionResults Symbol)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; NameSearch
-&gt; IncludeCycles
-&gt; [HashQualified Name]
-&gt; IO (DefinitionResults Symbol)
forall (m :: * -&gt; *).
MonadIO m =&gt;
Codebase m Symbol Ann
-&gt; NameSearch
-&gt; IncludeCycles
-&gt; [HashQualified Name]
-&gt; m (DefinitionResults Symbol)
</span><span class="hs-identifier hs-var">Backend.definitionsBySuffixes</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404080"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch
</span><a href="#local-6989586621679404051"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeCycles
</span><a href="#local-6989586621679404048"><span class="hs-identifier hs-var">includeCycles</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404078"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2008"></span><span>  </span><span id="local-6989586621679404047"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679404047"><span class="hs-identifier hs-var">outputPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe String)
forall r. Cli r (Maybe String)
</span><a href="#local-6989586621679404046"><span class="hs-identifier hs-var">getOutputPath</span></a></span><span>
</span><span id="line-2009"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl Symbol Ann)) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679404053"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679404054"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2010"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404045"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnvDecl
</span><a href="#local-6989586621679404045"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnvDecl -&gt; PrettyPrintEnvDecl
</span><span class="hs-identifier hs-var">PPED.biasTo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Maybe Name)
-&gt; [HashQualified Name] -&gt; [Name]
forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe Name
forall n. HashQualified n -&gt; Maybe n
</span><span class="hs-identifier hs-var">HQ.toName</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404081"><span class="hs-identifier hs-var">inputQuery</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404067"><span class="hs-identifier hs-var">unbiasedPPE</span></a></span><span>
</span><span id="line-2011"></span><span>    </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
-&gt; PrettyPrintEnvDecl
-&gt; Map Reference (DisplayObject () (Decl Symbol Ann))
-&gt; Map
     Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DisplayDefinitions"><span class="hs-identifier hs-var">DisplayDefinitions</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679404047"><span class="hs-identifier hs-var">outputPath</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679404045"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject () (Decl Symbol Ann))
</span><a href="#local-6989586621679404053"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (DisplayObject (Type Symbol Ann) (Term Symbol Ann))
</span><a href="#local-6989586621679404054"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2012"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404052"><span class="hs-identifier hs-var">misses</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SearchTermsNotFound"><span class="hs-identifier hs-var">SearchTermsNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679404052"><span class="hs-identifier hs-var">misses</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2013"></span><span>  </span><span class="hs-comment">-- We set latestFile to be programmatically generated, if we</span><span>
</span><span id="line-2014"></span><span>  </span><span class="hs-comment">-- are viewing these definitions to a file - this will skip the</span><span>
</span><span id="line-2015"></span><span>  </span><span class="hs-comment">-- next update for that file (which will happen immediately)</span><span class="hs-cpp">
  #latestFile .= ((,True) &lt;$&gt; outputPath)
</span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2018"></span><span>    </span><span class="hs-comment">-- `view`: don't include cycles; `edit`: include cycles</span><span>
</span><span id="line-2019"></span><span>    </span><span id="local-6989586621679404048"><span class="annot"><span class="annottext">includeCycles :: IncludeCycles
</span><a href="#local-6989586621679404048"><span class="hs-identifier hs-var hs-var">includeCycles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2020"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679404083"><span class="hs-identifier hs-var">outputLoc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2021"></span><span>        </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#ConsoleLocation"><span class="hs-identifier hs-var">ConsoleLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IncludeCycles
</span><span class="hs-identifier hs-var">Backend.DontIncludeCycles</span></span><span>
</span><span id="line-2022"></span><span>        </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FileLocation"><span class="hs-identifier hs-type">FileLocation</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IncludeCycles
</span><span class="hs-identifier hs-var">Backend.IncludeCycles</span></span><span>
</span><span id="line-2023"></span><span>        </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#LatestFileLocation"><span class="hs-identifier hs-var">LatestFileLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IncludeCycles
</span><span class="hs-identifier hs-var">Backend.IncludeCycles</span></span><span>
</span><span id="line-2024"></span><span>
</span><span id="line-2025"></span><span>    </span><span class="hs-comment">-- Get the file path to send the definition(s) to. `Nothing` means the terminal.</span><span>
</span><span id="line-2026"></span><span>    </span><span id="local-6989586621679406396"><span class="annot"><a href="#local-6989586621679404046"><span class="hs-identifier hs-type">getOutputPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406396"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2027"></span><span>    </span><span id="local-6989586621679404046"><span class="annot"><span class="annottext">getOutputPath :: Cli r (Maybe String)
</span><a href="#local-6989586621679404046"><span class="hs-identifier hs-var hs-var">getOutputPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2028"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679404083"><span class="hs-identifier hs-var">outputLoc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2029"></span><span>        </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#ConsoleLocation"><span class="hs-identifier hs-var">ConsoleLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Cli r (Maybe String)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2030"></span><span>        </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FileLocation"><span class="hs-identifier hs-type">FileLocation</span></a></span><span> </span><span id="local-6989586621679404036"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404036"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Cli r (Maybe String)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404036"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2031"></span><span>        </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#LatestFileLocation"><span class="hs-identifier hs-var">LatestFileLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2032"></span><span>          </span><span id="local-6989586621679404035"><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679404035"><span class="hs-identifier hs-var">loopState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r LoopState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">State.get</span></span><span>
</span><span id="line-2033"></span><span>          </span><span class="hs-identifier">pure</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679404035"><span class="hs-identifier hs-var">loopState</span></a></span><span> </span><span class="annot"><span class="annottext">LoopState
-&gt; Getting (Maybe (String, Bool)) LoopState (Maybe (String, Bool))
-&gt; Maybe (String, Bool)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;latestFile&quot;
  (Getting (Maybe (String, Bool)) LoopState (Maybe (String, Bool)))
Getting (Maybe (String, Bool)) LoopState (Maybe (String, Bool))
</span><a href="#local-6989586621679404034"><span class="hs-var">#latestFile</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2034"></span><span>            </span><span class="annot"><span class="annottext">Maybe (String, Bool)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scratch.u&quot;</span></span><span>
</span><span id="line-2035"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404033"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404033"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679404033"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-2036"></span><span>
</span><span id="line-2037"></span><span class="hs-comment">-- | Handle a @test@ command.</span><span>
</span><span id="line-2038"></span><span id="local-6989586621679406753"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#handleTest"><span class="hs-identifier hs-type">handleTest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#TestInput"><span class="hs-identifier hs-type">TestInput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406753"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2039"></span><span id="handleTest"><span class="annot"><span class="annottext">handleTest :: TestInput -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleTest"><span class="hs-identifier hs-var hs-var">handleTest</span></a></span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#TestInput"><span class="hs-identifier hs-type">TestInput</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404031"><span class="annot"><span class="annottext">Bool
$sel:includeLibNamespace:TestInput :: TestInput -&gt; Bool
includeLibNamespace :: Bool
</span><a href="Unison.Codebase.Editor.Input.html#%24sel%3AincludeLibNamespace%3ATestInput"><span class="hs-identifier hs-var hs-var">includeLibNamespace</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404029"><span class="annot"><span class="annottext">Bool
$sel:showFailures:TestInput :: TestInput -&gt; Bool
showFailures :: Bool
</span><a href="Unison.Codebase.Editor.Input.html#%24sel%3AshowFailures%3ATestInput"><span class="hs-identifier hs-var hs-var">showFailures</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679404027"><span class="annot"><span class="annottext">Bool
$sel:showSuccesses:TestInput :: TestInput -&gt; Bool
showSuccesses :: Bool
</span><a href="Unison.Codebase.Editor.Input.html#%24sel%3AshowSuccesses%3ATestInput"><span class="hs-identifier hs-var hs-var">showSuccesses</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2040"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679404025"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679404025"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2041"></span><span>
</span><span id="line-2042"></span><span>  </span><span id="local-6989586621679404024"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679404024"><span class="hs-identifier hs-var">testTerms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2043"></span><span>    </span><span id="local-6989586621679404023"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404023"><span class="hs-identifier hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-2044"></span><span>    </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679404023"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-2045"></span><span>      </span><span class="annot"><span class="annottext">Branch0 IO -&gt; (Branch0 IO -&gt; R4 Referent Name) -&gt; R4 Referent Name
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; R4 Referent Name
forall (m :: * -&gt; *). Branch0 m -&gt; R4 Referent Name
</span><span class="hs-identifier hs-var hs-var">Branch.deepTermMetadata</span></span><span>
</span><span id="line-2046"></span><span>      </span><span class="annot"><span class="annottext">R4 Referent Name
-&gt; (R4 Referent Name -&gt; Relation Referent Name)
-&gt; Relation Referent Name
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Reference, Reference)
-&gt; R4 Referent Name -&gt; Relation Referent Name
forall a b c d.
(Ord a, Ord b, Ord c, Ord d) =&gt;
(c, d) -&gt; Relation4 a b c d -&gt; Relation a b
</span><span class="hs-identifier hs-var">R4.restrict34d12</span></span><span> </span><span class="annot"><span class="annottext">(Reference, Reference)
</span><span class="hs-identifier hs-var">isTest</span></span><span>
</span><span id="line-2047"></span><span>      </span><span class="annot"><span class="annottext">Relation Referent Name
-&gt; (Relation Referent Name -&gt; Relation Referent Name)
-&gt; Relation Referent Name
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404031"><span class="hs-identifier hs-var">includeLibNamespace</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Relation Referent Name -&gt; Relation Referent Name
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; Relation Referent Name -&gt; Relation Referent Name
forall a b.
(Ord a, Ord b) =&gt;
(b -&gt; Bool) -&gt; Relation a b -&gt; Relation a b
</span><span class="hs-identifier hs-var">R.filterRan</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Name -&gt; Bool) -&gt; Name -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="#local-6989586621679404019"><span class="hs-identifier hs-var">isInLibNamespace</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2048"></span><span>      </span><span class="annot"><span class="annottext">Relation Referent Name
-&gt; (Relation Referent Name -&gt; Set Referent) -&gt; Set Referent
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Relation Referent Name -&gt; Set Referent
forall a b. Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">R.dom</span></span><span>
</span><span id="line-2049"></span><span>      </span><span class="annot"><span class="annottext">Set Referent
-&gt; (Set Referent -&gt; Cli r (Set Referent)) -&gt; Cli r (Set Referent)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Cli r (Set Referent)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-2050"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679404017"><span class="annot"><span class="annottext">testRefs :: Set Reference
</span><a href="#local-6989586621679404017"><span class="hs-identifier hs-var hs-var">testRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; Maybe Reference) -&gt; Set Referent -&gt; Set Reference
forall b a. Ord b =&gt; (a -&gt; Maybe b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Maybe Reference
</span><span class="hs-identifier hs-var">Referent.toTermReference</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679404024"><span class="hs-identifier hs-var">testTerms</span></a></span><span>
</span><span id="line-2051"></span><span>      </span><span id="local-6989586621679404014"><span class="annot"><span class="annottext">oks :: Map a (Term (F typeVar typeAnn patternAnn) v a) -&gt; [(a, Text)]
</span><a href="#local-6989586621679404014"><span class="hs-identifier hs-var hs-var">oks</span></a></span></span><span> </span><span id="local-6989586621679404013"><span class="annot"><span class="annottext">Map a (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404013"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2052"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404012"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404011"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2053"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404012"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404012"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term.List'</span></span><span> </span><span id="local-6989586621679404010"><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404010"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map a (Term (F typeVar typeAnn patternAnn) v a)
-&gt; [(a, Term (F typeVar typeAnn patternAnn) v a)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map a (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404013"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2054"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Term.App'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Constructor'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span id="local-6989586621679404009"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404009"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679404008"><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404008"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Text'</span></span><span> </span><span id="local-6989586621679404011"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404011"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
-&gt; [Term (F typeVar typeAnn patternAnn) v a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404010"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2055"></span><span>            </span><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404008"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorId -&gt; ConstructorId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><span class="hs-identifier hs-var">DD.okConstructorId</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404009"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">DD.testResultRef</span></span><span>
</span><span id="line-2056"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2057"></span><span>      </span><span id="local-6989586621679404007"><span class="annot"><span class="annottext">fails :: Map a (Term (F typeVar typeAnn patternAnn) v a) -&gt; [(a, Text)]
</span><a href="#local-6989586621679404007"><span class="hs-identifier hs-var hs-var">fails</span></a></span></span><span> </span><span id="local-6989586621679404006"><span class="annot"><span class="annottext">Map a (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404006"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2058"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404005"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404004"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2059"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679404005"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679404005"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term.List'</span></span><span> </span><span id="local-6989586621679404003"><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404003"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map a (Term (F typeVar typeAnn patternAnn) v a)
-&gt; [(a, Term (F typeVar typeAnn patternAnn) v a)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map a (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404006"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2060"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Term.App'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Constructor'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span id="local-6989586621679404002"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404002"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621679404001"><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404001"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term.Text'</span></span><span> </span><span id="local-6989586621679404004"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679404004"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
-&gt; [Term (F typeVar typeAnn patternAnn) v a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq (Term (F typeVar typeAnn patternAnn) v a)
</span><a href="#local-6989586621679404003"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2061"></span><span>            </span><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679404001"><span class="hs-identifier hs-var">cid</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorId -&gt; ConstructorId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><span class="hs-identifier hs-var">DD.failConstructorId</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679404002"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">DD.testResultRef</span></span><span>
</span><span id="line-2062"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2063"></span><span>  </span><span id="local-6989586621679404000"><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann)
</span><a href="#local-6989586621679404000"><span class="hs-identifier hs-var">cachedTests</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2064"></span><span>    </span><span class="annot"><span class="annottext">([(Reference, Term Symbol Ann)] -&gt; Map Reference (Term Symbol Ann))
-&gt; Cli r [(Reference, Term Symbol Ann)]
-&gt; Cli r (Map Reference (Term Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[(Reference, Term Symbol Ann)] -&gt; Map Reference (Term Symbol Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2065"></span><span>      </span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679404017"><span class="hs-identifier hs-var">testRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
-&gt; ([Reference] -&gt; Cli r [(Reference, Term Symbol Ann)])
-&gt; Cli r [(Reference, Term Symbol Ann)]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Cli r (Maybe (Reference, Term Symbol Ann)))
-&gt; [Reference] -&gt; Cli r [(Reference, Term Symbol Ann)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Witherable t, Applicative f) =&gt;
(a -&gt; f (Maybe b)) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">wither</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2066"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Reference, Term Symbol Ann)
-&gt; Cli r (Maybe (Reference, Term Symbol Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Reference, Term Symbol Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2067"></span><span>        </span><span id="local-6989586621679403997"><span class="annot"><span class="annottext">r :: Reference
</span><a href="#local-6989586621679403997"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679403996"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403996"><span class="hs-identifier hs-var">rid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Reference, Term Symbol Ann))
-&gt; Cli r (Maybe (Reference, Term Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term Symbol Ann -&gt; (Reference, Term Symbol Ann))
-&gt; Maybe (Term Symbol Ann) -&gt; Maybe (Reference, Term Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403997"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Term Symbol Ann) -&gt; Maybe (Reference, Term Symbol Ann))
-&gt; IO (Maybe (Term Symbol Ann))
-&gt; IO (Maybe (Reference, Term Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; String -&gt; Id -&gt; IO (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; String -&gt; Id -&gt; m (Maybe (Term v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getWatch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404025"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
forall a. (Eq a, IsString a) =&gt; a
</span><span class="hs-identifier hs-var">WK.TestWatch</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403996"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2068"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403993"><span class="annot"><span class="annottext">stats :: TestReportStats
</span><a href="#local-6989586621679403993"><span class="hs-identifier hs-var hs-var">stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; TestReportStats
</span><a href="Unison.Codebase.Editor.Output.html#CachedTests"><span class="hs-identifier hs-var">Output.CachedTests</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679404017"><span class="hs-identifier hs-var">testRefs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann) -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">Map.size</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann)
</span><a href="#local-6989586621679404000"><span class="hs-identifier hs-var">cachedTests</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2069"></span><span>  </span><span id="local-6989586621679403989"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403989"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2070"></span><span>    </span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Cli r NamesWithHistory
forall r. Set LabeledDependency -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makePrintNamesFromLabeled%27"><span class="hs-identifier hs-var">makePrintNamesFromLabeled'</span></a></span><span> </span><span class="annot"><span class="annottext">(Set LabeledDependency -&gt; Cli r NamesWithHistory)
-&gt; Set LabeledDependency -&gt; Cli r NamesWithHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2071"></span><span>      </span><span class="annot"><span class="annottext">Set Referent -&gt; Set LabeledDependency
forall (f :: * -&gt; *).
Foldable f =&gt;
f Referent -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">LD.referents</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679404024"><span class="hs-identifier hs-var">testTerms</span></a></span><span>
</span><span id="line-2072"></span><span>        </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Referent] -&gt; Set LabeledDependency
forall (f :: * -&gt; *).
Foldable f =&gt;
f Referent -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">LD.referents</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Referent
</span><span class="hs-identifier hs-var">DD.okConstructorReferent</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Referent
</span><span class="hs-identifier hs-var">DD.failConstructorReferent</span></span><span class="hs-special">]</span><span>
</span><span id="line-2073"></span><span>  </span><span id="local-6989586621679403985"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403985"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#fqnPPE"><span class="hs-identifier hs-var">fqnPPE</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403989"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-2074"></span><span>  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2075"></span><span>    </span><span class="annot"><span class="annottext">TestReportStats
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Bool
-&gt; [(Reference, Text)]
-&gt; [(Reference, Text)]
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TestResults"><span class="hs-identifier hs-var">TestResults</span></a></span><span>
</span><span id="line-2076"></span><span>      </span><span class="annot"><span class="annottext">TestReportStats
</span><a href="#local-6989586621679403993"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-2077"></span><span>      </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403985"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-2078"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404027"><span class="hs-identifier hs-var">showSuccesses</span></a></span><span>
</span><span id="line-2079"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404029"><span class="hs-identifier hs-var">showFailures</span></a></span><span>
</span><span id="line-2080"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann) -&gt; [(Reference, Text)]
forall a typeVar typeAnn patternAnn v a.
Map a (Term (F typeVar typeAnn patternAnn) v a) -&gt; [(a, Text)]
</span><a href="#local-6989586621679404014"><span class="hs-identifier hs-var">oks</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann)
</span><a href="#local-6989586621679404000"><span class="hs-identifier hs-var">cachedTests</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2081"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann) -&gt; [(Reference, Text)]
forall a typeVar typeAnn patternAnn v a.
Map a (Term (F typeVar typeAnn patternAnn) v a) -&gt; [(a, Text)]
</span><a href="#local-6989586621679404007"><span class="hs-identifier hs-var">fails</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann)
</span><a href="#local-6989586621679404000"><span class="hs-identifier hs-var">cachedTests</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2082"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403983"><span class="annot"><span class="annottext">toCompute :: Set Reference
</span><a href="#local-6989586621679403983"><span class="hs-identifier hs-var hs-var">toCompute</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Set Reference -&gt; Set Reference
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.difference</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679404017"><span class="hs-identifier hs-var">testRefs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann) -&gt; Set Reference
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann)
</span><a href="#local-6989586621679404000"><span class="hs-identifier hs-var">cachedTests</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2083"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403983"><span class="hs-identifier hs-var">toCompute</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2084"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403981"><span class="annot"><span class="annottext">total :: Int
</span><a href="#local-6989586621679403981"><span class="hs-identifier hs-var hs-var">total</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403983"><span class="hs-identifier hs-var">toCompute</span></a></span><span>
</span><span id="line-2085"></span><span>    </span><span id="local-6989586621679403980"><span class="annot"><span class="annottext">[(Reference, Term Symbol Ann)]
</span><a href="#local-6989586621679403980"><span class="hs-identifier hs-var">computedTests</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([[(Reference, Term Symbol Ann)]]
 -&gt; [(Reference, Term Symbol Ann)])
-&gt; Cli r [[(Reference, Term Symbol Ann)]]
-&gt; Cli r [(Reference, Term Symbol Ann)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[(Reference, Term Symbol Ann)]] -&gt; [(Reference, Term Symbol Ann)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">(Cli r [[(Reference, Term Symbol Ann)]]
 -&gt; Cli r [(Reference, Term Symbol Ann)])
-&gt; (((Reference, Int) -&gt; Cli r [(Reference, Term Symbol Ann)])
    -&gt; Cli r [[(Reference, Term Symbol Ann)]])
-&gt; ((Reference, Int) -&gt; Cli r [(Reference, Term Symbol Ann)])
-&gt; Cli r [(Reference, Term Symbol Ann)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Reference, Int)]
-&gt; ((Reference, Int) -&gt; Cli r [(Reference, Term Symbol Ann)])
-&gt; Cli r [[(Reference, Term Symbol Ann)]]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403983"><span class="hs-identifier hs-var">toCompute</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; [Int] -&gt; [(Reference, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((Reference, Int) -&gt; Cli r [(Reference, Term Symbol Ann)])
 -&gt; Cli r [(Reference, Term Symbol Ann)])
-&gt; ((Reference, Int) -&gt; Cli r [(Reference, Term Symbol Ann)])
-&gt; Cli r [(Reference, Term Symbol Ann)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679403978"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403978"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403977"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403977"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2086"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403978"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2087"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679403976"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403976"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2088"></span><span>          </span><span class="annot"><span class="annottext">IO (Maybe (Term Symbol Ann)) -&gt; Cli r (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Id -&gt; IO (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Term v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404025"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403976"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Term Symbol Ann))
-&gt; (Maybe (Term Symbol Ann)
    -&gt; Cli r [(Reference, Term Symbol Ann)])
-&gt; Cli r [(Reference, Term Symbol Ann)]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2089"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Term Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2090"></span><span>              </span><span id="local-6989586621679403975"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403975"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404025"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2091"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TermNotFound%27"><span class="hs-identifier hs-var">TermNotFound'</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; Output)
-&gt; (Reference -&gt; ShortHash) -&gt; Reference -&gt; Output
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ShortHash -&gt; ShortHash
</span><span class="hs-identifier hs-var">SH.take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403975"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; ShortHash)
-&gt; (Reference -&gt; ShortHash) -&gt; Reference -&gt; ShortHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Output) -&gt; Reference -&gt; Output
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Reference
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403976"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2092"></span><span>              </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2093"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403974"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403974"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2094"></span><span>              </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; (Int, Int) -&gt; Reference -&gt; Term Symbol Ann -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TestIncrementalOutputStart"><span class="hs-identifier hs-var">TestIncrementalOutputStart</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403985"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403977"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403981"><span class="hs-identifier hs-var">total</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403978"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403974"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-2095"></span><span>              </span><span class="hs-comment">--                          v don't cache; test cache populated below</span><span>
</span><span id="line-2096"></span><span>              </span><span id="local-6989586621679403972"><span class="annot"><span class="annottext">Either (Pretty ColorText) (Term Symbol Ann)
</span><a href="#local-6989586621679403972"><span class="hs-identifier hs-var">tm'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
forall r.
Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTermE"><span class="hs-identifier hs-var">evalUnisonTermE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403985"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403974"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-2097"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (Pretty ColorText) (Term Symbol Ann)
</span><a href="#local-6989586621679403972"><span class="hs-identifier hs-var">tm'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2098"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679403970"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679403970"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2099"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#EvaluationFailure"><span class="hs-identifier hs-var">EvaluationFailure</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679403970"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2100"></span><span>                  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2101"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679403969"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403969"><span class="hs-identifier hs-var">tm'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2102"></span><span>                  </span><span class="hs-comment">-- After evaluation, cache the result of the test</span><span>
</span><span id="line-2103"></span><span>                  </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; String -&gt; Id -&gt; Term Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; String -&gt; Id -&gt; Term v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putWatch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679404025"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
forall a. (Eq a, IsString a) =&gt; a
</span><span class="hs-identifier hs-var">WK.TestWatch</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403976"><span class="hs-identifier hs-var">rid</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403969"><span class="hs-identifier hs-var">tm'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2104"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; (Int, Int) -&gt; Reference -&gt; Term Symbol Ann -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TestIncrementalOutputEnd"><span class="hs-identifier hs-var">TestIncrementalOutputEnd</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403985"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403977"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403981"><span class="hs-identifier hs-var">total</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403978"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403969"><span class="hs-identifier hs-var">tm'</span></a></span><span>
</span><span id="line-2105"></span><span>                  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403978"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403969"><span class="hs-identifier hs-var">tm'</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2106"></span><span>        </span><span id="local-6989586621679403966"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403966"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Cli r [(Reference, Term Symbol Ann)]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Cli r [(Reference, Term Symbol Ann)])
-&gt; String -&gt; Cli r [(Reference, Term Symbol Ann)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unpossible, tests can't be builtins: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403966"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2107"></span><span>
</span><span id="line-2108"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403965"><span class="annot"><span class="annottext">m :: Map Reference (Term Symbol Ann)
</span><a href="#local-6989586621679403965"><span class="hs-identifier hs-var hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Reference, Term Symbol Ann)] -&gt; Map Reference (Term Symbol Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">[(Reference, Term Symbol Ann)]
</span><a href="#local-6989586621679403980"><span class="hs-identifier hs-var">computedTests</span></a></span><span>
</span><span id="line-2109"></span><span>    </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TestReportStats
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Bool
-&gt; [(Reference, Text)]
-&gt; [(Reference, Text)]
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TestResults"><span class="hs-identifier hs-var">TestResults</span></a></span><span> </span><span class="annot"><span class="annottext">TestReportStats
</span><a href="Unison.Codebase.Editor.Output.html#NewlyComputed"><span class="hs-identifier hs-var">Output.NewlyComputed</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403985"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404027"><span class="hs-identifier hs-var">showSuccesses</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679404029"><span class="hs-identifier hs-var">showFailures</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann) -&gt; [(Reference, Text)]
forall a typeVar typeAnn patternAnn v a.
Map a (Term (F typeVar typeAnn patternAnn) v a) -&gt; [(a, Text)]
</span><a href="#local-6989586621679404014"><span class="hs-identifier hs-var">oks</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann)
</span><a href="#local-6989586621679403965"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann) -&gt; [(Reference, Text)]
forall a typeVar typeAnn patternAnn v a.
Map a (Term (F typeVar typeAnn patternAnn) v a) -&gt; [(a, Text)]
</span><a href="#local-6989586621679404007"><span class="hs-identifier hs-var">fails</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Term Symbol Ann)
</span><a href="#local-6989586621679403965"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2110"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2111"></span><span>    </span><span class="annot"><a href="#local-6989586621679404019"><span class="hs-identifier hs-type">isInLibNamespace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2112"></span><span>    </span><span id="local-6989586621679404019"><span class="annot"><span class="annottext">isInLibNamespace :: Name -&gt; Bool
</span><a href="#local-6989586621679404019"><span class="hs-identifier hs-var hs-var">isInLibNamespace</span></a></span></span><span> </span><span id="local-6989586621679403964"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403964"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2113"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NonEmpty NameSegment
</span><span class="hs-identifier hs-var">Name.segments</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403964"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2114"></span><span>        </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">Nel.:|</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2115"></span><span>        </span><span class="annot"><span class="annottext">NonEmpty NameSegment
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2116"></span><span>
</span><span id="line-2117"></span><span class="hs-comment">-- | Handle an @update@ command.</span><span>
</span><span id="line-2118"></span><span id="local-6989586621679406756"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#handleUpdate"><span class="hs-identifier hs-type">handleUpdate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#OptionalPatch"><span class="hs-identifier hs-type">OptionalPatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406756"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2119"></span><span id="handleUpdate"><span class="annot"><span class="annottext">handleUpdate :: Input -&gt; OptionalPatch -&gt; Set Name -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#handleUpdate"><span class="hs-identifier hs-var hs-var">handleUpdate</span></a></span></span><span> </span><span id="local-6989586621679403963"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679403963"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679403962"><span class="annot"><span class="annottext">OptionalPatch
</span><a href="#local-6989586621679403962"><span class="hs-identifier hs-var">optionalPatch</span></a></span></span><span> </span><span id="local-6989586621679403961"><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679403961"><span class="hs-identifier hs-var">requestedNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2120"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403960"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403960"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2121"></span><span>  </span><span id="local-6989586621679403959"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403959"><span class="hs-identifier hs-var">currentPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-2122"></span><span>  </span><span id="local-6989586621679403958"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403958"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (TypecheckedUnisonFile Symbol Ann)
forall r. Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.Cli.MonadUtils.html#expectLatestTypecheckedFile"><span class="hs-identifier hs-var">Cli.expectLatestTypecheckedFile</span></a></span><span>
</span><span id="line-2123"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403957"><span class="annot"><span class="annottext">patchPath :: Maybe PatchPath
</span><a href="#local-6989586621679403957"><span class="hs-identifier hs-var hs-var">patchPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2124"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OptionalPatch
</span><a href="#local-6989586621679403962"><span class="hs-identifier hs-var">optionalPatch</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2125"></span><span>          </span><span class="annot"><span class="annottext">OptionalPatch
</span><a href="Unison.Codebase.Editor.Input.html#NoPatch"><span class="hs-identifier hs-var">NoPatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2126"></span><span>          </span><span class="annot"><span class="annottext">OptionalPatch
</span><a href="Unison.Codebase.Editor.Input.html#DefaultPatch"><span class="hs-identifier hs-var">DefaultPatch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Maybe PatchPath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="Unison.Cli.MonadUtils.html#defaultPatchPath"><span class="hs-identifier hs-var">Cli.defaultPatchPath</span></a></span><span>
</span><span id="line-2127"></span><span>          </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#UsePatch"><span class="hs-identifier hs-type">UsePatch</span></a></span><span> </span><span id="local-6989586621679403956"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679403956"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Maybe PatchPath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679403956"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2128"></span><span>  </span><span id="local-6989586621679403955"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403955"><span class="hs-identifier hs-var">slurpCheckNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Names) -&gt; Cli r (Branch0 IO) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getCurrentBranch0"><span class="hs-identifier hs-var">Cli.getCurrentBranch0</span></a></span><span>
</span><span id="line-2129"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403954"><span class="annot"><span class="annottext">requestedVars :: Set Symbol
</span><a href="#local-6989586621679403954"><span class="hs-identifier hs-var hs-var">requestedVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Symbol) -&gt; Set Name -&gt; Set Symbol
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Symbol
forall v. Var v =&gt; Name -&gt; v
</span><span class="hs-identifier hs-var">Name.toVar</span></span><span> </span><span class="annot"><span class="annottext">Set Name
</span><a href="#local-6989586621679403961"><span class="hs-identifier hs-var">requestedNames</span></a></span><span>
</span><span id="line-2130"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403953"><span class="annot"><span class="annottext">sr :: SlurpResult Symbol
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Set Symbol -&gt; SlurpOp -&gt; Names -&gt; SlurpResult Symbol
forall v.
Var v =&gt;
TypecheckedUnisonFile v Ann
-&gt; Set v -&gt; SlurpOp -&gt; Names -&gt; SlurpResult v
</span><a href="Unison.Codebase.Editor.Slurp.html#slurpFile"><span class="hs-identifier hs-var">Slurp.slurpFile</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403958"><span class="hs-identifier hs-var">uf</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol
</span><a href="#local-6989586621679403954"><span class="hs-identifier hs-var">requestedVars</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpOp
</span><a href="Unison.Codebase.Editor.Slurp.html#UpdateOp"><span class="hs-identifier hs-var">Slurp.UpdateOp</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403955"><span class="hs-identifier hs-var">slurpCheckNames</span></a></span><span>
</span><span id="line-2131"></span><span>      </span><span class="annot"><a href="#local-6989586621679403952"><span class="hs-identifier hs-type">addsAndUpdates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpComponent.html#SlurpComponent"><span class="hs-identifier hs-type">SlurpComponent</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span>
</span><span id="line-2132"></span><span>      </span><span id="local-6989586621679403952"><span class="annot"><span class="annottext">addsAndUpdates :: SlurpComponent Symbol
</span><a href="#local-6989586621679403952"><span class="hs-identifier hs-var hs-var">addsAndUpdates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol -&gt; SlurpComponent Symbol
forall v. SlurpResult v -&gt; SlurpComponent v
</span><a href="Unison.Codebase.Editor.SlurpResult.html#%24sel%3Aupdates%3ASlurpResult"><span class="hs-identifier hs-var hs-var">Slurp.updates</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
-&gt; SlurpComponent Symbol -&gt; SlurpComponent Symbol
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol -&gt; SlurpComponent Symbol
forall v. SlurpResult v -&gt; SlurpComponent v
</span><a href="Unison.Codebase.Editor.SlurpResult.html#%24sel%3Aadds%3ASlurpResult"><span class="hs-identifier hs-var hs-var">Slurp.adds</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-2133"></span><span>      </span><span class="annot"><a href="#local-6989586621679403950"><span class="hs-identifier hs-type">fileNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-2134"></span><span>      </span><span id="local-6989586621679403950"><span class="annot"><span class="annottext">fileNames :: Names
</span><a href="#local-6989586621679403950"><span class="hs-identifier hs-var hs-var">fileNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Names
forall v a. Var v =&gt; TypecheckedUnisonFile v a -&gt; Names
</span><span class="hs-identifier hs-var">UF.typecheckedToNames</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403958"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-2135"></span><span>      </span><span class="hs-comment">-- todo: display some error if typeEdits or termEdits itself contains a loop</span><span>
</span><span id="line-2136"></span><span>      </span><span class="annot"><a href="#local-6989586621679403949"><span class="hs-identifier hs-type">typeEdits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2137"></span><span>      </span><span id="local-6989586621679403949"><span class="annot"><span class="annottext">typeEdits :: [(Name, Reference, Reference)]
</span><a href="#local-6989586621679403949"><span class="hs-identifier hs-var hs-var">typeEdits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2138"></span><span>        </span><span id="local-6989586621679403948"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403948"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set Symbol -&gt; [Symbol]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlurpComponent Symbol -&gt; Set Symbol
forall v. SlurpComponent v -&gt; Set v
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#%24sel%3Atypes%3ASlurpComponent"><span class="hs-identifier hs-var hs-var">SC.types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlurpResult Symbol -&gt; SlurpComponent Symbol
forall v. SlurpResult v -&gt; SlurpComponent v
</span><a href="Unison.Codebase.Editor.SlurpResult.html#%24sel%3Aupdates%3ASlurpResult"><span class="hs-identifier hs-var hs-var">updates</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2139"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403946"><span class="annot"><span class="annottext">n :: Name
</span><a href="#local-6989586621679403946"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403948"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2140"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403945"><span class="annot"><span class="annottext">oldRefs0 :: Set Reference
</span><a href="#local-6989586621679403945"><span class="hs-identifier hs-var hs-var">oldRefs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Set Reference
</span><span class="hs-identifier hs-var">Names.typesNamed</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403955"><span class="hs-identifier hs-var">slurpCheckNames</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403946"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2141"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403943"><span class="annot"><span class="annottext">newRefs :: Set Reference
</span><a href="#local-6989586621679403943"><span class="hs-identifier hs-var hs-var">newRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Set Reference
</span><span class="hs-identifier hs-var">Names.typesNamed</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403950"><span class="hs-identifier hs-var">fileNames</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403946"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2142"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NESet Reference -&gt; Reference -&gt; (NESet Reference, Reference))
-&gt; Maybe (NESet Reference)
-&gt; Maybe (Reference -&gt; (NESet Reference, Reference))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe (NESet Reference)
forall a. Set a -&gt; Maybe (NESet a)
</span><span class="hs-identifier hs-var">NESet.nonEmptySet</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403945"><span class="hs-identifier hs-var">oldRefs0</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Reference -&gt; (NESet Reference, Reference))
-&gt; Maybe Reference -&gt; Maybe (NESet Reference, Reference)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe Reference
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403943"><span class="hs-identifier hs-var">newRefs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2143"></span><span>          </span><span class="annot"><span class="annottext">Maybe (NESet Reference, Reference)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(Name, Reference, Reference)]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-identifier hs-var">reportBug</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;E722145&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bad (old,new) names: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference, Set Reference) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403945"><span class="hs-identifier hs-var">oldRefs0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403943"><span class="hs-identifier hs-var">newRefs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2144"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403940"><span class="annot"><span class="annottext">NESet Reference
</span><a href="#local-6989586621679403940"><span class="hs-identifier hs-var">oldRefs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403939"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403939"><span class="hs-identifier hs-var">newRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2145"></span><span>            </span><span id="local-6989586621679403938"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403938"><span class="hs-identifier hs-var">oldRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NESet Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Foldable.toList</span></span><span> </span><span class="annot"><span class="annottext">NESet Reference
</span><a href="#local-6989586621679403940"><span class="hs-identifier hs-var">oldRefs</span></a></span><span>
</span><span id="line-2146"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403946"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403938"><span class="hs-identifier hs-var">oldRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403939"><span class="hs-identifier hs-var">newRef</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2147"></span><span>      </span><span class="annot"><a href="#local-6989586621679403937"><span class="hs-identifier hs-type">hashTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-2148"></span><span>      </span><span id="local-6989586621679403937"><span class="annot"><span class="annottext">hashTerms :: Map Reference (Type Symbol Ann)
</span><a href="#local-6989586621679403937"><span class="hs-identifier hs-var hs-var">hashTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Reference, Type Symbol Ann)] -&gt; Map Reference (Type Symbol Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Symbol (Reference, Type Symbol Ann)
-&gt; [(Reference, Type Symbol Ann)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Reference, Type Symbol Ann)
</span><a href="#local-6989586621679403936"><span class="hs-identifier hs-var">hashTerms0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2149"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-2150"></span><span>          </span><span id="local-6989586621679403936"><span class="annot"><span class="annottext">hashTerms0 :: Map Symbol (Reference, Type Symbol Ann)
</span><a href="#local-6989586621679403936"><span class="hs-identifier hs-var hs-var">hashTerms0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679403935"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403935"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403934"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679403934"><span class="hs-identifier hs-var">_wk</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403933"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403933"><span class="hs-identifier hs-var">_tm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403932"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403932"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403935"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403932"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reference, Maybe String, Term Symbol Ann, Type Symbol Ann)
 -&gt; (Reference, Type Symbol Ann))
-&gt; Map
     Symbol (Reference, Maybe String, Term Symbol Ann, Type Symbol Ann)
-&gt; Map Symbol (Reference, Type Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Map
     Symbol (Reference, Maybe String, Term Symbol Ann, Type Symbol Ann)
forall v a.
TypecheckedUnisonFile v a
-&gt; Map v (Reference, Maybe String, Term v a, Type v a)
</span><span class="hs-identifier hs-var">UF.hashTerms</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403958"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-2151"></span><span>      </span><span class="annot"><a href="#local-6989586621679403930"><span class="hs-identifier hs-type">termEdits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2152"></span><span>      </span><span id="local-6989586621679403930"><span class="annot"><span class="annottext">termEdits :: [(Name, Reference, Reference)]
</span><a href="#local-6989586621679403930"><span class="hs-identifier hs-var hs-var">termEdits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2153"></span><span>        </span><span id="local-6989586621679403929"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403929"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set Symbol -&gt; [Symbol]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlurpComponent Symbol -&gt; Set Symbol
forall v. SlurpComponent v -&gt; Set v
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#%24sel%3Aterms%3ASlurpComponent"><span class="hs-identifier hs-var hs-var">SC.terms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlurpResult Symbol -&gt; SlurpComponent Symbol
forall v. SlurpResult v -&gt; SlurpComponent v
</span><a href="Unison.Codebase.Editor.SlurpResult.html#%24sel%3Aupdates%3ASlurpResult"><span class="hs-identifier hs-var hs-var">updates</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2154"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403927"><span class="annot"><span class="annottext">n :: Name
</span><a href="#local-6989586621679403927"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403929"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2155"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403926"><span class="annot"><span class="annottext">oldRefs0 :: Set Reference
</span><a href="#local-6989586621679403926"><span class="hs-identifier hs-var hs-var">oldRefs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Set Reference
</span><span class="hs-identifier hs-var">Names.refTermsNamed</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403955"><span class="hs-identifier hs-var">slurpCheckNames</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403927"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2156"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403924"><span class="annot"><span class="annottext">newRefs :: Set Reference
</span><a href="#local-6989586621679403924"><span class="hs-identifier hs-var hs-var">newRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Set Reference
</span><span class="hs-identifier hs-var">Names.refTermsNamed</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403950"><span class="hs-identifier hs-var">fileNames</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403927"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2157"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(NESet Reference -&gt; Reference -&gt; (NESet Reference, Reference))
-&gt; Maybe (NESet Reference)
-&gt; Maybe (Reference -&gt; (NESet Reference, Reference))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe (NESet Reference)
forall a. Set a -&gt; Maybe (NESet a)
</span><span class="hs-identifier hs-var">NESet.nonEmptySet</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403926"><span class="hs-identifier hs-var">oldRefs0</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Reference -&gt; (NESet Reference, Reference))
-&gt; Maybe Reference -&gt; Maybe (NESet Reference, Reference)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe Reference
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403924"><span class="hs-identifier hs-var">newRefs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2158"></span><span>          </span><span class="annot"><span class="annottext">Maybe (NESet Reference, Reference)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(Name, Reference, Reference)]
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-identifier hs-var">reportBug</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;E936103&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bad (old,new) names: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference, Set Reference) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403926"><span class="hs-identifier hs-var">oldRefs0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403924"><span class="hs-identifier hs-var">newRefs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2159"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403923"><span class="annot"><span class="annottext">NESet Reference
</span><a href="#local-6989586621679403923"><span class="hs-identifier hs-var">oldRefs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403922"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403922"><span class="hs-identifier hs-var">newRef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2160"></span><span>            </span><span id="local-6989586621679403921"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403921"><span class="hs-identifier hs-var">oldRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NESet Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">Foldable.toList</span></span><span> </span><span class="annot"><span class="annottext">NESet Reference
</span><a href="#local-6989586621679403923"><span class="hs-identifier hs-var">oldRefs</span></a></span><span>
</span><span id="line-2161"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403927"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403921"><span class="hs-identifier hs-var">oldRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403922"><span class="hs-identifier hs-var">newRef</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2162"></span><span>      </span><span class="annot"><a href="#local-6989586621679403920"><span class="hs-identifier hs-type">termDeprecations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2163"></span><span>      </span><span id="local-6989586621679403920"><span class="annot"><span class="annottext">termDeprecations :: [(Name, Referent)]
</span><a href="#local-6989586621679403920"><span class="hs-identifier hs-var hs-var">termDeprecations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2164"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403919"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403918"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2165"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403917"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403917"><span class="hs-identifier hs-var">oldTypeRef</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403949"><span class="hs-identifier hs-var">typeEdits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2166"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679403919"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403919"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403918"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403918"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Names -&gt; [(Name, Referent)]
</span><span class="hs-identifier hs-var">Names.constructorsForType</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403917"><span class="hs-identifier hs-var">oldTypeRef</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403955"><span class="hs-identifier hs-var">slurpCheckNames</span></a></span><span>
</span><span id="line-2167"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2168"></span><span>  </span><span id="local-6989586621679403915"><span class="annot"><span class="annottext">Maybe (Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute)
</span><a href="#local-6989586621679403915"><span class="hs-identifier hs-var">patchOps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
-&gt; (PatchPath
    -&gt; Cli r (Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute))
-&gt; Cli r (Maybe (Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679403957"><span class="hs-identifier hs-var">patchPath</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403914"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679403914"><span class="hs-identifier hs-var">patchPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2169"></span><span>    </span><span id="local-6989586621679403913"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403913"><span class="hs-identifier hs-var">ye'ol'Patch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Cli r Patch
forall r. PatchPath -&gt; Cli r Patch
</span><a href="Unison.Cli.MonadUtils.html#getPatchAt"><span class="hs-identifier hs-var">Cli.getPatchAt</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679403914"><span class="hs-identifier hs-var">patchPath</span></a></span><span>
</span><span id="line-2170"></span><span>    </span><span class="hs-comment">-- If `uf` updates a -&gt; a', we want to replace all (a0 -&gt; a) in patch</span><span>
</span><span id="line-2171"></span><span>    </span><span class="hs-comment">-- with (a0 -&gt; a') in patch'.</span><span>
</span><span id="line-2172"></span><span>    </span><span class="hs-comment">-- So for all (a0 -&gt; a) in patch, for all (a -&gt; a') in `uf`,</span><span>
</span><span id="line-2173"></span><span>    </span><span class="hs-comment">-- we must know the type of a0, a, a'.</span><span>
</span><span id="line-2174"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- we need:</span><span>
</span><span id="line-2175"></span><span>        </span><span class="hs-comment">-- all of the `old` references from the `new` edits,</span><span>
</span><span id="line-2176"></span><span>        </span><span class="hs-comment">-- plus all of the `old` references for edits from patch we're replacing</span><span>
</span><span id="line-2177"></span><span>        </span><span class="annot"><a href="#local-6989586621679403912"><span class="hs-identifier hs-type">collectOldForTyping</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Patch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span>
</span><span id="line-2178"></span><span>        </span><span id="local-6989586621679403912"><span class="annot"><span class="annottext">collectOldForTyping :: [(Reference, Reference)] -&gt; Patch -&gt; Set Reference
</span><a href="#local-6989586621679403912"><span class="hs-identifier hs-var hs-var">collectOldForTyping</span></a></span></span><span> </span><span id="local-6989586621679403911"><span class="annot"><span class="annottext">[(Reference, Reference)]
</span><a href="#local-6989586621679403911"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span id="local-6989586621679403910"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403910"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; (Reference, Reference) -&gt; Set Reference)
-&gt; Set Reference -&gt; [(Reference, Reference)] -&gt; Set Reference
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; (Reference, Reference) -&gt; Set Reference
forall a b. Ord a =&gt; Set a -&gt; (a, b) -&gt; Set a
</span><a href="#local-6989586621679403909"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Reference, Reference)]
</span><a href="#local-6989586621679403911"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">[(Reference, Reference)]
-&gt; [(Reference, Reference)] -&gt; [(Reference, Reference)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Reference, Reference)]
</span><a href="#local-6989586621679403908"><span class="hs-identifier hs-var">fromOld</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2179"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-2180"></span><span>            </span><span id="local-6989586621679403909"><span class="annot"><span class="annottext">f :: Set a -&gt; (a, b) -&gt; Set a
</span><a href="#local-6989586621679403909"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679403907"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679403907"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403906"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679403906"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403905"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679403905"><span class="hs-identifier hs-var">_r'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Set a
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679403906"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679403907"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-2181"></span><span>            </span><span id="local-6989586621679403904"><span class="annot"><span class="annottext">newLHS :: Set Reference
</span><a href="#local-6989586621679403904"><span class="hs-identifier hs-var hs-var">newLHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; Set Reference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Reference] -&gt; Set Reference)
-&gt; ([(Reference, Reference)] -&gt; [Reference])
-&gt; [(Reference, Reference)]
-&gt; Set Reference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Reference, Reference) -&gt; Reference)
-&gt; [(Reference, Reference)] -&gt; [Reference]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Reference, Reference) -&gt; Reference
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">([(Reference, Reference)] -&gt; Set Reference)
-&gt; [(Reference, Reference)] -&gt; Set Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Reference, Reference)]
</span><a href="#local-6989586621679403911"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-2182"></span><span>            </span><span class="annot"><a href="#local-6989586621679403908"><span class="hs-identifier hs-type">fromOld</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2183"></span><span>            </span><span id="local-6989586621679403908"><span class="annot"><span class="annottext">fromOld :: [(Reference, Reference)]
</span><a href="#local-6989586621679403908"><span class="hs-identifier hs-var hs-var">fromOld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2184"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403903"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403902"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403903"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403903"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermEdit.Replace</span></span><span> </span><span id="local-6989586621679403902"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403902"><span class="hs-identifier hs-var">r'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Typing
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Relation Reference TermEdit -&gt; [(Reference, TermEdit)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">R.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Reference TermEdit -&gt; [(Reference, TermEdit)])
-&gt; (Patch -&gt; Relation Reference TermEdit)
-&gt; Patch
-&gt; [(Reference, TermEdit)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Patch -&gt; Relation Reference TermEdit
</span><span class="hs-identifier hs-var hs-var">Patch._termEdits</span></span><span> </span><span class="annot"><span class="annottext">(Patch -&gt; [(Reference, TermEdit)])
-&gt; Patch -&gt; [(Reference, TermEdit)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403910"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Set Reference -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403902"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403904"><span class="hs-identifier hs-var">newLHS</span></a></span><span>
</span><span id="line-2185"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-2186"></span><span>        </span><span id="local-6989586621679403900"><span class="annot"><span class="annottext">neededTypes :: Set Reference
</span><a href="#local-6989586621679403900"><span class="hs-identifier hs-var hs-var">neededTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Reference, Reference)] -&gt; Patch -&gt; Set Reference
</span><a href="#local-6989586621679403912"><span class="hs-identifier hs-var">collectOldForTyping</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, Reference, Reference) -&gt; (Reference, Reference))
-&gt; [(Name, Reference, Reference)] -&gt; [(Reference, Reference)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403899"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403899"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403898"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403898"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403899"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403898"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403930"><span class="hs-identifier hs-var">termEdits</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403913"><span class="hs-identifier hs-var">ye'ol'Patch</span></a></span><span>
</span><span id="line-2187"></span><span>
</span><span id="line-2188"></span><span>    </span><span id="local-6989586621679403897"><span id="local-6989586621679403896"><span class="annot"><span class="annottext">Map Reference (Type Symbol Ann)
</span><a href="#local-6989586621679403896"><span class="hs-identifier hs-var">allTypes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><a href="#local-6989586621679403897"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2189"></span><span>      </span><span class="annot"><span class="annottext">([(Reference, Type Symbol Ann)] -&gt; Map Reference (Type Symbol Ann))
-&gt; Cli r [(Reference, Type Symbol Ann)]
-&gt; Cli r (Map Reference (Type Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[(Reference, Type Symbol Ann)] -&gt; Map Reference (Type Symbol Ann)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">(Cli r [(Reference, Type Symbol Ann)]
 -&gt; Cli r (Map Reference (Type Symbol Ann)))
-&gt; ((Reference -&gt; Cli r (Reference, Type Symbol Ann))
    -&gt; Cli r [(Reference, Type Symbol Ann)])
-&gt; (Reference -&gt; Cli r (Reference, Type Symbol Ann))
-&gt; Cli r (Map Reference (Type Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
-&gt; (Reference -&gt; Cli r (Reference, Type Symbol Ann))
-&gt; Cli r [(Reference, Type Symbol Ann)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403900"><span class="hs-identifier hs-var">neededTypes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Reference -&gt; Cli r (Reference, Type Symbol Ann))
 -&gt; Cli r (Map Reference (Type Symbol Ann)))
-&gt; (Reference -&gt; Cli r (Reference, Type Symbol Ann))
-&gt; Cli r (Map Reference (Type Symbol Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403895"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403895"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2190"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403895"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type Symbol Ann -&gt; (Reference, Type Symbol Ann))
-&gt; (Maybe (Type Symbol Ann) -&gt; Type Symbol Ann)
-&gt; Maybe (Type Symbol Ann)
-&gt; (Reference, Type Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Maybe (Type Symbol Ann) -&gt; Type Symbol Ann
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Text -&gt; Type Symbol Ann
forall v a. Ord v =&gt; a -&gt; Text -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.builtin</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">External</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;unknown type&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2191"></span><span>          </span><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann) -&gt; (Reference, Type Symbol Ann))
-&gt; Cli r (Maybe (Type Symbol Ann))
-&gt; Cli r (Reference, Type Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann)))
-&gt; (Reference -&gt; IO (Maybe (Type Symbol Ann)))
-&gt; Reference
-&gt; Cli r (Maybe (Type Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a.
(Applicative m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Reference -&gt; m (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403960"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403895"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2192"></span><span>
</span><span id="line-2193"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403893"><span class="annot"><span class="annottext">typing :: Reference -&gt; Reference -&gt; Typing
</span><a href="#local-6989586621679403893"><span class="hs-identifier hs-var hs-var">typing</span></a></span></span><span> </span><span id="local-6989586621679403892"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403892"><span class="hs-identifier hs-var">r1</span></a></span></span><span> </span><span id="local-6989586621679403891"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403891"><span class="hs-identifier hs-var">r2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
-&gt; Map Reference (Type Symbol Ann) -&gt; Maybe (Type Symbol Ann)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403892"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Type Symbol Ann)
</span><a href="#local-6989586621679403896"><span class="hs-identifier hs-var">allTypes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
-&gt; Map Reference (Type Symbol Ann) -&gt; Maybe (Type Symbol Ann)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403891"><span class="hs-identifier hs-var">r2</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference (Type Symbol Ann)
</span><a href="#local-6989586621679403937"><span class="hs-identifier hs-var">hashTerms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2194"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403889"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403889"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403888"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403888"><span class="hs-identifier hs-var">t2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2195"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Type Symbol Ann -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isEqual</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403889"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403888"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Typing
</span><span class="hs-identifier hs-var">TermEdit.Same</span></span><span>
</span><span id="line-2196"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Type Symbol Ann -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.isSubtype</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403889"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403888"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Typing
</span><span class="hs-identifier hs-var">TermEdit.Subtype</span></span><span>
</span><span id="line-2197"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Typing
</span><span class="hs-identifier hs-var">TermEdit.Different</span></span><span>
</span><span id="line-2198"></span><span>          </span><span id="local-6989586621679403883"><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann), Maybe (Type Symbol Ann))
</span><a href="#local-6989586621679403883"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2199"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Typing
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Typing) -&gt; String -&gt; Typing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2200"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compiler bug: typing map not constructed properly\n&quot;</span></span><span>
</span><span id="line-2201"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;typing &quot;</span></span><span>
</span><span id="line-2202"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403892"><span class="hs-identifier hs-var">r1</span></a></span><span>
</span><span id="line-2203"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span>
</span><span id="line-2204"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403891"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-2205"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; : &quot;</span></span><span>
</span><span id="line-2206"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann), Maybe (Type Symbol Ann)) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann), Maybe (Type Symbol Ann))
</span><a href="#local-6989586621679403883"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2207"></span><span>
</span><span id="line-2208"></span><span>        </span><span class="annot"><a href="#local-6989586621679403882"><span class="hs-identifier hs-type">updatePatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Patch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Patch</span></span><span>
</span><span id="line-2209"></span><span>        </span><span id="local-6989586621679403882"><span class="annot"><span class="annottext">updatePatch :: Patch -&gt; Patch
</span><a href="#local-6989586621679403882"><span class="hs-identifier hs-var hs-var">updatePatch</span></a></span></span><span> </span><span id="local-6989586621679403881"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403881"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Patch -&gt; (Name, Reference, Reference) -&gt; Patch)
-&gt; Patch -&gt; [(Name, Reference, Reference)] -&gt; Patch
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Patch -&gt; (Name, Reference, Reference) -&gt; Patch
</span><a href="#local-6989586621679403880"><span class="hs-identifier hs-var">step2</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403879"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403930"><span class="hs-identifier hs-var">termEdits</span></a></span><span>
</span><span id="line-2210"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-2211"></span><span>            </span><span id="local-6989586621679403879"><span class="annot"><span class="annottext">p' :: Patch
</span><a href="#local-6989586621679403879"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Patch -&gt; (Name, Reference, Reference) -&gt; Patch)
-&gt; Patch -&gt; [(Name, Reference, Reference)] -&gt; Patch
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Patch -&gt; (Name, Reference, Reference) -&gt; Patch
forall a. Patch -&gt; (a, Reference, Reference) -&gt; Patch
</span><a href="#local-6989586621679403878"><span class="hs-identifier hs-var">step1</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403881"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403949"><span class="hs-identifier hs-var">typeEdits</span></a></span><span>
</span><span id="line-2212"></span><span>            </span><span id="local-6989586621679403878"><span class="annot"><span class="annottext">step1 :: Patch -&gt; (a, Reference, Reference) -&gt; Patch
</span><a href="#local-6989586621679403878"><span class="hs-identifier hs-var hs-var">step1</span></a></span></span><span> </span><span id="local-6989586621679403877"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403877"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403876"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403876"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403875"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403875"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; TypeEdit -&gt; Patch -&gt; Patch
</span><span class="hs-identifier hs-var">Patch.updateType</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403876"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; TypeEdit
</span><span class="hs-identifier hs-var">TypeEdit.Replace</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403875"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403877"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2213"></span><span>            </span><span id="local-6989586621679403880"><span class="annot"><span class="annottext">step2 :: Patch -&gt; (Name, Reference, Reference) -&gt; Patch
</span><a href="#local-6989586621679403880"><span class="hs-identifier hs-var hs-var">step2</span></a></span></span><span> </span><span id="local-6989586621679403873"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403873"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403872"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403872"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403871"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403871"><span class="hs-identifier hs-var">r'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Reference -&gt; Typing)
-&gt; Reference -&gt; TermEdit -&gt; Patch -&gt; Patch
</span><span class="hs-identifier hs-var">Patch.updateTerm</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Typing
</span><a href="#local-6989586621679403893"><span class="hs-identifier hs-var">typing</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403872"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Typing -&gt; TermEdit
</span><span class="hs-identifier hs-var">TermEdit.Replace</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403871"><span class="hs-identifier hs-var">r'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Typing
</span><a href="#local-6989586621679403893"><span class="hs-identifier hs-var">typing</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403872"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403871"><span class="hs-identifier hs-var">r'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403873"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2214"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679403869"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403869"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403868"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679403868"><span class="hs-identifier hs-var">seg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; PatchPath -&gt; (Absolute, NameSegment)
forall a. Absolute -&gt; (Path', a) -&gt; (Absolute, a)
</span><span class="hs-identifier hs-var">Path.toAbsoluteSplit</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403959"><span class="hs-identifier hs-var">currentPath'</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679403914"><span class="hs-identifier hs-var">patchPath</span></a></span><span>
</span><span id="line-2215"></span><span>        </span><span id="local-6989586621679406325"><span class="annot"><a href="#local-6989586621679403866"><span class="hs-identifier hs-type">updatePatches</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679406325"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406325"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406325"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406325"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2216"></span><span>        </span><span id="local-6989586621679403866"><span class="annot"><span class="annottext">updatePatches :: Branch0 m -&gt; m (Branch0 m)
</span><a href="#local-6989586621679403866"><span class="hs-identifier hs-var hs-var">updatePatches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; (Patch -&gt; Patch) -&gt; Branch0 m -&gt; m (Branch0 m)
forall (m :: * -&gt; *).
Monad m =&gt;
NameSegment -&gt; (Patch -&gt; Patch) -&gt; Branch0 m -&gt; m (Branch0 m)
</span><span class="hs-identifier hs-var">Branch.modifyPatches</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679403868"><span class="hs-identifier hs-var">seg</span></a></span><span> </span><span class="annot"><span class="annottext">Patch -&gt; Patch
</span><a href="#local-6989586621679403882"><span class="hs-identifier hs-var">updatePatch</span></a></span><span>
</span><span id="line-2217"></span><span>    </span><span class="annot"><span class="annottext">(Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute)
-&gt; Cli r (Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Patch -&gt; Patch
</span><a href="#local-6989586621679403882"><span class="hs-identifier hs-var">updatePatch</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403913"><span class="hs-identifier hs-var">ye'ol'Patch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; IO (Branch0 IO)
forall (m :: * -&gt; *). Monad m =&gt; Branch0 m -&gt; m (Branch0 m)
</span><a href="#local-6989586621679403866"><span class="hs-identifier hs-var">updatePatches</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403869"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2218"></span><span>
</span><span id="line-2219"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlurpResult Symbol -&gt; Bool
forall v. Ord v =&gt; SlurpResult v -&gt; Bool
</span><a href="Unison.Codebase.Editor.SlurpResult.html#hasAddsOrUpdates"><span class="hs-identifier hs-var">Slurp.hasAddsOrUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cli r () -&gt; Cli r ()) -&gt; Cli r () -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2220"></span><span>    </span><span class="hs-comment">-- take a look at the `updates` from the SlurpResult</span><span>
</span><span id="line-2221"></span><span>    </span><span class="hs-comment">-- and make a patch diff to record a replacement from the old to new references</span><span>
</span><span id="line-2222"></span><span>    </span><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; IO (Branch0 IO))] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
f (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtMNoSync"><span class="hs-identifier hs-var">stepManyAtMNoSync</span></a></span><span>
</span><span id="line-2223"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403959"><span class="hs-identifier hs-var">currentPath'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2224"></span><span>            </span><span class="annot"><span class="annottext">Branch0 IO -&gt; IO (Branch0 IO)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; IO (Branch0 IO))
-&gt; (Branch0 IO -&gt; Branch0 IO) -&gt; Branch0 IO -&gt; IO (Branch0 IO)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
-&gt; [(Name, Reference, Reference)]
-&gt; [(Name, Referent)]
-&gt; Branch0 IO
-&gt; Branch0 IO
forall (m :: * -&gt; *).
Monad m =&gt;
[(Name, Reference, Reference)]
-&gt; [(Name, Reference, Reference)]
-&gt; [(Name, Referent)]
-&gt; Branch0 m
-&gt; Branch0 m
</span><a href="Unison.Codebase.Editor.HandleInput.html#doSlurpUpdates"><span class="hs-identifier hs-var">doSlurpUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403949"><span class="hs-identifier hs-var">typeEdits</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403930"><span class="hs-identifier hs-var">termEdits</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Referent)]
</span><a href="#local-6989586621679403920"><span class="hs-identifier hs-var">termDeprecations</span></a></span><span>
</span><span id="line-2225"></span><span>          </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-2226"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403959"><span class="hs-identifier hs-var">currentPath'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2227"></span><span>            </span><span class="annot"><span class="annottext">Branch0 IO -&gt; IO (Branch0 IO)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; IO (Branch0 IO))
-&gt; (Branch0 IO -&gt; Branch0 IO) -&gt; Branch0 IO -&gt; IO (Branch0 IO)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
-&gt; TypecheckedUnisonFile Symbol Ann -&gt; Branch0 IO -&gt; Branch0 IO
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
SlurpComponent v
-&gt; TypecheckedUnisonFile v Ann -&gt; Branch0 m -&gt; Branch0 m
</span><a href="Unison.Codebase.Editor.HandleInput.html#doSlurpAdds"><span class="hs-identifier hs-var">doSlurpAdds</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679403952"><span class="hs-identifier hs-var">addsAndUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403958"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-2228"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-2229"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-2230"></span><span>          </span><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; IO (Branch0 IO))]
-&gt; [(Path, Branch0 IO -&gt; IO (Branch0 IO))]
-&gt; [(Path, Branch0 IO -&gt; IO (Branch0 IO))]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute)
</span><a href="#local-6989586621679403915"><span class="hs-identifier hs-var">patchOps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2231"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2232"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Patch
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403862"><span class="annot"><span class="annottext">Branch0 IO -&gt; IO (Branch0 IO)
</span><a href="#local-6989586621679403862"><span class="hs-identifier hs-var">update</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403861"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403861"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403861"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; IO (Branch0 IO)
</span><a href="#local-6989586621679403862"><span class="hs-identifier hs-var">update</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2233"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-2234"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Cli r ())
-&gt; (TypecheckedUnisonFile Symbol Ann -&gt; IO ())
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; TypecheckedUnisonFile Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
(Monad m, Var v, Show a) =&gt;
Codebase m v a -&gt; TypecheckedUnisonFile v a -&gt; m ()
</span><span class="hs-identifier hs-var">Codebase.addDefsToCodebase</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403960"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile Symbol Ann -&gt; IO ())
-&gt; (TypecheckedUnisonFile Symbol Ann
    -&gt; TypecheckedUnisonFile Symbol Ann)
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; TypecheckedUnisonFile Symbol Ann
forall v.
Ord v =&gt;
SlurpResult v
-&gt; TypecheckedUnisonFile v Ann -&gt; TypecheckedUnisonFile v Ann
</span><a href="Unison.Codebase.Editor.HandleInput.html#filterBySlurpResult"><span class="hs-identifier hs-var">filterBySlurpResult</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile Symbol Ann -&gt; Cli r ())
-&gt; TypecheckedUnisonFile Symbol Ann -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403958"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-2235"></span><span>  </span><span id="local-6989586621679403860"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403860"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl)
-&gt; Cli r NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Cli r NamesWithHistory
forall v a r.
Var v =&gt;
TypecheckedUnisonFile v a -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayNames"><span class="hs-identifier hs-var">displayNames</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403958"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-2236"></span><span>  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Input -&gt; PrettyPrintEnv -&gt; SlurpResult Symbol -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SlurpOutput"><span class="hs-identifier hs-var">SlurpOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679403963"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403860"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SlurpResult Symbol
</span><a href="#local-6989586621679403953"><span class="hs-identifier hs-var">sr</span></a></span><span>
</span><span id="line-2237"></span><span>  </span><span class="annot"><span class="annottext">Maybe (Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute)
-&gt; ((Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute) -&gt; Cli r ())
-&gt; Cli r ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">whenJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Patch, Branch0 IO -&gt; IO (Branch0 IO), Absolute)
</span><a href="#local-6989586621679403915"><span class="hs-identifier hs-var">patchOps</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679403859"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403859"><span class="hs-identifier hs-var">updatedPatch</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; IO (Branch0 IO)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2238"></span><span>    </span><span class="annot"><span class="annottext">Cli r Bool -&gt; Cli r ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(Cli r Bool -&gt; Cli r ()) -&gt; Cli r Bool -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Patch -&gt; Absolute -&gt; Cli r Bool
forall r. Patch -&gt; Absolute -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#propagatePatchNoSync"><span class="hs-identifier hs-var">propagatePatchNoSync</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403859"><span class="hs-identifier hs-var">updatedPatch</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403959"><span class="hs-identifier hs-var">currentPath'</span></a></span><span>
</span><span id="line-2239"></span><span>  </span><span class="annot"><span class="annottext">SlurpComponent Symbol -&gt; Cli r ()
forall r. SlurpComponent Symbol -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#addDefaultMetadata"><span class="hs-identifier hs-var">addDefaultMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679403952"><span class="hs-identifier hs-var">addsAndUpdates</span></a></span><span>
</span><span id="line-2240"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Cli r ()
forall r. Text -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-var">syncRoot</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><a href="#local-6989586621679403957"><span class="hs-identifier hs-var">patchPath</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2241"></span><span>    </span><span class="annot"><span class="annottext">Maybe PatchPath
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;update.nopatch&quot;</span></span><span>
</span><span id="line-2242"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403857"><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679403857"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2243"></span><span>      </span><span class="annot"><span class="annottext">PatchPath
</span><a href="#local-6989586621679403857"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; (PatchPath -&gt; Path') -&gt; Path'
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">PatchPath -&gt; Path'
</span><span class="hs-identifier hs-var">Path.unsplit'</span></span><span>
</span><span id="line-2244"></span><span>        </span><span class="annot"><span class="annottext">Path' -&gt; (Path' -&gt; Absolute) -&gt; Absolute
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path' -&gt; Absolute
forall l r o. Resolve l r o =&gt; l -&gt; r -&gt; o
</span><span class="hs-identifier hs-var">Path.resolve</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403959"><span class="hs-identifier hs-var">currentPath'</span></a></span><span>
</span><span id="line-2245"></span><span>        </span><span class="annot"><span class="annottext">Absolute -&gt; (Absolute -&gt; Text) -&gt; Text
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span>
</span><span id="line-2246"></span><span>
</span><span id="line-2247"></span><span class="hs-comment">-- Add default metadata to all added types and terms in a slurp component.</span><span>
</span><span id="line-2248"></span><span class="hs-comment">--</span><span>
</span><span id="line-2249"></span><span class="hs-comment">-- No-op if the slurp component is empty.</span><span>
</span><span id="line-2250"></span><span id="local-6989586621679406761"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#addDefaultMetadata"><span class="hs-identifier hs-type">addDefaultMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpComponent.html#SlurpComponent"><span class="hs-identifier hs-type">SlurpComponent</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406761"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2251"></span><span id="addDefaultMetadata"><span class="annot"><span class="annottext">addDefaultMetadata :: SlurpComponent Symbol -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#addDefaultMetadata"><span class="hs-identifier hs-var hs-var">addDefaultMetadata</span></a></span></span><span> </span><span id="local-6989586621679403856"><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679403856"><span class="hs-identifier hs-var">adds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2252"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlurpComponent Symbol -&gt; Bool
forall v. SlurpComponent v -&gt; Bool
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#isEmpty"><span class="hs-identifier hs-var">SC.isEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679403856"><span class="hs-identifier hs-var">adds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2253"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Cli r () -&gt; Cli r ()
forall r a. String -&gt; Cli r a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#time"><span class="hs-identifier hs-var">Cli.time</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;add-default-metadata&quot;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2254"></span><span>      </span><span id="local-6989586621679403854"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403854"><span class="hs-identifier hs-var">currentPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-2255"></span><span>
</span><span id="line-2256"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403853"><span class="annot"><span class="annottext">addedVs :: [Symbol]
</span><a href="#local-6989586621679403853"><span class="hs-identifier hs-var hs-var">addedVs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Symbol -&gt; [Symbol]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Symbol -&gt; [Symbol]) -&gt; Set Symbol -&gt; [Symbol]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol -&gt; Set Symbol
forall v. SlurpComponent v -&gt; Set v
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#%24sel%3Atypes%3ASlurpComponent"><span class="hs-identifier hs-var hs-var">SC.types</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679403856"><span class="hs-identifier hs-var">adds</span></a></span><span> </span><span class="annot"><span class="annottext">Set Symbol -&gt; Set Symbol -&gt; Set Symbol
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol -&gt; Set Symbol
forall v. SlurpComponent v -&gt; Set v
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#%24sel%3Aterms%3ASlurpComponent"><span class="hs-identifier hs-var hs-var">SC.terms</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent Symbol
</span><a href="#local-6989586621679403856"><span class="hs-identifier hs-var">adds</span></a></span><span>
</span><span id="line-2257"></span><span>          </span><span id="local-6989586621679403852"><span class="annot"><span class="annottext">addedNs :: Maybe [HQSplit']
</span><a href="#local-6989586621679403852"><span class="hs-identifier hs-var hs-var">addedNs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Symbol -&gt; Maybe HQSplit') -&gt; [Symbol] -&gt; Maybe [HQSplit']
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe HQSplit'
</span><span class="hs-identifier hs-var">Path.hqSplitFromName'</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Maybe HQSplit')
-&gt; (Symbol -&gt; Name) -&gt; Symbol -&gt; Maybe HQSplit'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Symbol]
</span><a href="#local-6989586621679403853"><span class="hs-identifier hs-var">addedVs</span></a></span><span>
</span><span id="line-2258"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [HQSplit']
</span><a href="#local-6989586621679403852"><span class="hs-identifier hs-var">addedNs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2259"></span><span>        </span><span class="annot"><span class="annottext">Maybe [HQSplit']
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2260"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Cli r ()
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Cli r ()) -&gt; String -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2261"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;I couldn't parse a name I just added to the codebase! &quot;</span></span><span>
</span><span id="line-2262"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-- Added names: &quot;</span></span><span>
</span><span id="line-2263"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Symbol] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Symbol]
</span><a href="#local-6989586621679403853"><span class="hs-identifier hs-var">addedVs</span></a></span><span>
</span><span id="line-2264"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403850"><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679403850"><span class="hs-identifier hs-var">addedNames</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2265"></span><span>          </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r [String]
forall r. Absolute -&gt; Cli r [String]
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveDefaultMetadata"><span class="hs-identifier hs-var">resolveDefaultMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403854"><span class="hs-identifier hs-var">currentPath'</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r [String] -&gt; ([String] -&gt; Cli r ()) -&gt; Cli r ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2266"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Cli r ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2267"></span><span>            </span><span id="local-6989586621679403848"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679403848"><span class="hs-identifier hs-var">dm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2268"></span><span>              </span><span class="annot"><span class="annottext">(String -&gt; Either (Pretty ColorText) (HashQualified Name))
-&gt; [String] -&gt; Either (Pretty ColorText) [HashQualified Name]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Either (Pretty ColorText) (HashQualified Name)
</span><a href="Unison.CommandLine.InputPatterns.html#parseHashQualifiedName"><span class="hs-identifier hs-var">InputPatterns.parseHashQualifiedName</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679403848"><span class="hs-identifier hs-var">dm</span></a></span><span> </span><span class="annot"><span class="annottext">Either (Pretty ColorText) [HashQualified Name]
-&gt; (Either (Pretty ColorText) [HashQualified Name] -&gt; Cli r ())
-&gt; Cli r ()
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2269"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679403846"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679403846"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2270"></span><span>                  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2271"></span><span>                    </span><span class="annot"><span class="annottext">Path' -&gt; String -&gt; Pretty ColorText -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ConfiguredMetadataParseError"><span class="hs-identifier hs-var">ConfiguredMetadataParseError</span></a></span><span>
</span><span id="line-2272"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path'
</span><span class="hs-identifier hs-var">Path.absoluteToPath'</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403854"><span class="hs-identifier hs-var">currentPath'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2273"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679403848"><span class="hs-identifier hs-var">dm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2274"></span><span>                      </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679403846"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2275"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679403844"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403844"><span class="hs-identifier hs-var">defaultMeta</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2276"></span><span>                  </span><span class="annot"><span class="annottext">Bool
-&gt; [HQSplit']
-&gt; [HashQualified Name]
-&gt; (forall r.
    Ord r =&gt;
    (r, Reference, Reference)
    -&gt; Star r NameSegment -&gt; Star r NameSegment)
-&gt; Cli r ()
forall r.
Bool
-&gt; [HQSplit']
-&gt; [HashQualified Name]
-&gt; (forall r.
    Ord r =&gt;
    (r, Reference, Reference)
    -&gt; Star r NameSegment -&gt; Star r NameSegment)
-&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#manageLinks"><span class="hs-identifier hs-var">manageLinks</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679403850"><span class="hs-identifier hs-var">addedNames</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403844"><span class="hs-identifier hs-var">defaultMeta</span></a></span><span> </span><span class="annot"><span class="annottext">forall r.
Ord r =&gt;
(r, Reference, Reference)
-&gt; Star r NameSegment -&gt; Star r NameSegment
forall a n.
(Ord a, Ord n) =&gt;
(a, Reference, Reference) -&gt; Star a n -&gt; Star a n
</span><span class="hs-identifier hs-var">Metadata.insert</span></span><span>
</span><span id="line-2277"></span><span>
</span><span id="line-2278"></span><span id="local-6989586621679406317"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#resolveDefaultMetadata"><span class="hs-identifier hs-type">resolveDefaultMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406317"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-2279"></span><span id="resolveDefaultMetadata"><span class="annot"><span class="annottext">resolveDefaultMetadata :: Absolute -&gt; Cli r [String]
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveDefaultMetadata"><span class="hs-identifier hs-var hs-var">resolveDefaultMetadata</span></a></span></span><span> </span><span id="local-6989586621679403843"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403843"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2280"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403842"><span class="annot"><span class="annottext">superpaths :: Seq Absolute
</span><a href="#local-6989586621679403842"><span class="hs-identifier hs-var hs-var">superpaths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Seq Absolute
</span><span class="hs-identifier hs-var">Path.ancestors</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403843"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-2281"></span><span>  </span><span id="local-6989586621679403840"><span class="annot"><span class="annottext">Seq [String]
</span><a href="#local-6989586621679403840"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2282"></span><span>    </span><span class="annot"><span class="annottext">Seq Absolute
-&gt; (Absolute -&gt; Cli r [String]) -&gt; Cli r (Seq [String])
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span>
</span><span id="line-2283"></span><span>      </span><span class="annot"><span class="annottext">Seq Absolute
</span><a href="#local-6989586621679403842"><span class="hs-identifier hs-var">superpaths</span></a></span><span>
</span><span id="line-2284"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403839"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403839"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2285"></span><span>          </span><span id="local-6989586621679403838"><span class="annot"><span class="annottext">Maybe [String]
</span><a href="#local-6989586621679403838"><span class="hs-identifier hs-var">mayNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Cli r (Maybe [String])
forall a r. Configured a =&gt; Text -&gt; Cli r (Maybe a)
</span><a href="Unison.Cli.MonadUtils.html#getConfig"><span class="hs-identifier hs-var">Cli.getConfig</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#configKey"><span class="hs-identifier hs-var">configKey</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;DefaultMetadata&quot;</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403839"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2286"></span><span>          </span><span class="annot"><span class="annottext">[String] -&gt; Cli r [String]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; Cli r [String])
-&gt; ([[String]] -&gt; [String]) -&gt; [[String]] -&gt; Cli r [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[String]] -&gt; [String]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[String]] -&gt; Cli r [String]) -&gt; [[String]] -&gt; Cli r [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe [String] -&gt; [[String]]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Maybe [String]
</span><a href="#local-6989586621679403838"><span class="hs-identifier hs-var">mayNames</span></a></span><span>
</span><span id="line-2287"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-2288"></span><span>  </span><span class="annot"><span class="annottext">[String] -&gt; Cli r [String]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; Cli r [String])
-&gt; ([[String]] -&gt; [String]) -&gt; [[String]] -&gt; Cli r [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[[String]] -&gt; [String]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[String]] -&gt; Cli r [String]) -&gt; [[String]] -&gt; Cli r [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Seq [String] -&gt; [[String]]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq [String]
</span><a href="#local-6989586621679403840"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-2289"></span><span>
</span><span id="line-2290"></span><span class="hs-comment">-- Add/remove links between definitions and metadata.</span><span>
</span><span id="line-2291"></span><span class="hs-comment">-- `silent` controls whether this produces any output to the user.</span><span>
</span><span id="line-2292"></span><span class="hs-comment">-- `srcs` is (names of the) definitions to pass to `op`</span><span>
</span><span id="line-2293"></span><span class="hs-comment">-- `mdValues` is (names of the) metadata to pass to `op`</span><span>
</span><span id="line-2294"></span><span class="hs-comment">-- `op` is the operation to add/remove/alter metadata mappings.</span><span>
</span><span id="line-2295"></span><span class="hs-comment">--   e.g. `Metadata.insert` is passed to add metadata links.</span><span>
</span><span id="line-2296"></span><span id="local-6989586621679406865"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#manageLinks"><span class="hs-identifier hs-type">manageLinks</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2297"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2298"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit'</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2299"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2300"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679406867"><span class="annot"><a href="#local-6989586621679406867"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2301"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679406867"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-2302"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679406867"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Metadata.Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Metadata.Value</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2303"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Branch.Star</span></span><span> </span><span class="annot"><a href="#local-6989586621679406867"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2304"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Branch.Star</span></span><span> </span><span class="annot"><a href="#local-6989586621679406867"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span>
</span><span id="line-2305"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2306"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406865"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2307"></span><span id="manageLinks"><span class="annot"><span class="annottext">manageLinks :: Bool
-&gt; [HQSplit']
-&gt; [HashQualified Name]
-&gt; (forall r.
    Ord r =&gt;
    (r, Reference, Reference)
    -&gt; Star r NameSegment -&gt; Star r NameSegment)
-&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#manageLinks"><span class="hs-identifier hs-var hs-var">manageLinks</span></a></span></span><span> </span><span id="local-6989586621679403834"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679403834"><span class="hs-identifier hs-var">silent</span></a></span></span><span> </span><span id="local-6989586621679403833"><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679403833"><span class="hs-identifier hs-var">srcs'</span></a></span></span><span> </span><span id="local-6989586621679403832"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403832"><span class="hs-identifier hs-var">metadataNames</span></a></span></span><span> </span><span id="local-6989586621679403831"><span class="annot"><span class="annottext">forall r.
Ord r =&gt;
(r, Reference, Reference)
-&gt; Star r NameSegment -&gt; Star r NameSegment
</span><a href="#local-6989586621679403831"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2308"></span><span>  </span><span id="local-6989586621679403830"><span class="annot"><span class="annottext">[Either Output (Reference, Reference)]
</span><a href="#local-6989586621679403830"><span class="hs-identifier hs-var">metadatas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HashQualified Name
 -&gt; Cli r (Either Output (Reference, Reference)))
-&gt; [HashQualified Name]
-&gt; Cli r [Either Output (Reference, Reference)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Cli r (Either Output (Reference, Reference))
forall r.
HashQualified Name -&gt; Cli r (Either Output (Reference, Reference))
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveMetadata"><span class="hs-identifier hs-var">resolveMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403832"><span class="hs-identifier hs-var">metadataNames</span></a></span><span>
</span><span id="line-2309"></span><span>  </span><span id="local-6989586621679403828"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403828"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-2310"></span><span>  </span><span id="local-6989586621679403827"><span class="annot"><span class="annottext">[(Absolute, HQSegment)]
</span><a href="#local-6989586621679403827"><span class="hs-identifier hs-var">srcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HQSplit' -&gt; Cli r (Absolute, HQSegment))
-&gt; [HQSplit'] -&gt; Cli r [(Absolute, HQSegment)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r (Absolute, HQSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">[HQSplit']
</span><a href="#local-6989586621679403833"><span class="hs-identifier hs-var">srcs'</span></a></span><span>
</span><span id="line-2311"></span><span>  </span><span id="local-6989586621679403826"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403826"><span class="hs-identifier hs-var">srcle</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Absolute, HQSegment) -&gt; Cli r (Set Referent))
-&gt; [(Absolute, HQSegment)] -&gt; Cli r (Set Referent)
forall (m :: * -&gt; *) (f :: * -&gt; *) b a.
(Monad m, Foldable f, Monoid b) =&gt;
(a -&gt; m b) -&gt; f a -&gt; m b
</span><span class="hs-identifier hs-var">Monoid.foldMapM</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Referent)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Referent)
</span><a href="Unison.Cli.MonadUtils.html#getTermsAt"><span class="hs-identifier hs-var">Cli.getTermsAt</span></a></span><span> </span><span class="annot"><span class="annottext">[(Absolute, HQSegment)]
</span><a href="#local-6989586621679403827"><span class="hs-identifier hs-var">srcs</span></a></span><span>
</span><span id="line-2312"></span><span>  </span><span id="local-6989586621679403824"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403824"><span class="hs-identifier hs-var">srclt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Absolute, HQSegment) -&gt; Cli r (Set Reference))
-&gt; [(Absolute, HQSegment)] -&gt; Cli r (Set Reference)
forall (m :: * -&gt; *) (f :: * -&gt; *) b a.
(Monad m, Foldable f, Monoid b) =&gt;
(a -&gt; m b) -&gt; f a -&gt; m b
</span><span class="hs-identifier hs-var">Monoid.foldMapM</span></span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; Cli r (Set Reference)
forall r. (Absolute, HQSegment) -&gt; Cli r (Set Reference)
</span><a href="Unison.Cli.MonadUtils.html#getTypesAt"><span class="hs-identifier hs-var">Cli.getTypesAt</span></a></span><span> </span><span class="annot"><span class="annottext">[(Absolute, HQSegment)]
</span><a href="#local-6989586621679403827"><span class="hs-identifier hs-var">srcs</span></a></span><span>
</span><span id="line-2313"></span><span>  </span><span class="annot"><span class="annottext">[Either Output (Reference, Reference)]
-&gt; (Either Output (Reference, Reference) -&gt; Cli r ()) -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[Either Output (Reference, Reference)]
</span><a href="#local-6989586621679403830"><span class="hs-identifier hs-var">metadatas</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2314"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679403823"><span class="annot"><span class="annottext">Output
</span><a href="#local-6989586621679403823"><span class="hs-identifier hs-var">errOutput</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="#local-6989586621679403823"><span class="hs-identifier hs-var">errOutput</span></a></span><span>
</span><span id="line-2315"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403822"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403822"><span class="hs-identifier hs-var">mdType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403821"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403821"><span class="hs-identifier hs-var">mdValue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2316"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403820"><span class="annot"><span class="annottext">step :: Branch0 IO -&gt; Branch0 IO
</span><a href="#local-6989586621679403820"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2317"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403819"><span class="annot"><span class="annottext">tmUpdates :: Star Referent NameSegment -&gt; Star Referent NameSegment
</span><a href="#local-6989586621679403819"><span class="hs-identifier hs-var hs-var">tmUpdates</span></a></span></span><span> </span><span id="local-6989586621679403818"><span class="annot"><span class="annottext">Star Referent NameSegment
</span><a href="#local-6989586621679403818"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Star Referent NameSegment
 -&gt; Referent -&gt; Star Referent NameSegment)
-&gt; Star Referent NameSegment
-&gt; Set Referent
-&gt; Star Referent NameSegment
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Star Referent NameSegment -&gt; Referent -&gt; Star Referent NameSegment
</span><a href="#local-6989586621679403817"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Star Referent NameSegment
</span><a href="#local-6989586621679403818"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403826"><span class="hs-identifier hs-var">srcle</span></a></span><span>
</span><span id="line-2318"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2319"></span><span>                    </span><span id="local-6989586621679403817"><span class="annot"><span class="annottext">go :: Star Referent NameSegment -&gt; Referent -&gt; Star Referent NameSegment
</span><a href="#local-6989586621679403817"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679403816"><span class="annot"><span class="annottext">Star Referent NameSegment
</span><a href="#local-6989586621679403816"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621679403815"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403815"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Referent, Reference, Reference)
-&gt; Star Referent NameSegment -&gt; Star Referent NameSegment
forall r.
Ord r =&gt;
(r, Reference, Reference)
-&gt; Star r NameSegment -&gt; Star r NameSegment
</span><a href="#local-6989586621679403831"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403815"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403822"><span class="hs-identifier hs-var">mdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403821"><span class="hs-identifier hs-var">mdValue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Star Referent NameSegment
</span><a href="#local-6989586621679403816"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-2320"></span><span>                </span><span id="local-6989586621679403814"><span class="annot"><span class="annottext">tyUpdates :: Star Reference NameSegment -&gt; Star Reference NameSegment
</span><a href="#local-6989586621679403814"><span class="hs-identifier hs-var hs-var">tyUpdates</span></a></span></span><span> </span><span id="local-6989586621679403813"><span class="annot"><span class="annottext">Star Reference NameSegment
</span><a href="#local-6989586621679403813"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Star Reference NameSegment
 -&gt; Reference -&gt; Star Reference NameSegment)
-&gt; Star Reference NameSegment
-&gt; Set Reference
-&gt; Star Reference NameSegment
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">Star Reference NameSegment
-&gt; Reference -&gt; Star Reference NameSegment
</span><a href="#local-6989586621679403812"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Star Reference NameSegment
</span><a href="#local-6989586621679403813"><span class="hs-identifier hs-var">types</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403824"><span class="hs-identifier hs-var">srclt</span></a></span><span>
</span><span id="line-2321"></span><span>                  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2322"></span><span>                    </span><span id="local-6989586621679403812"><span class="annot"><span class="annottext">go :: Star Reference NameSegment
-&gt; Reference -&gt; Star Reference NameSegment
</span><a href="#local-6989586621679403812"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679403811"><span class="annot"><span class="annottext">Star Reference NameSegment
</span><a href="#local-6989586621679403811"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span id="local-6989586621679403810"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403810"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference, Reference, Reference)
-&gt; Star Reference NameSegment -&gt; Star Reference NameSegment
forall r.
Ord r =&gt;
(r, Reference, Reference)
-&gt; Star r NameSegment -&gt; Star r NameSegment
</span><a href="#local-6989586621679403831"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403810"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403822"><span class="hs-identifier hs-var">mdType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403821"><span class="hs-identifier hs-var">mdValue</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Star Reference NameSegment
</span><a href="#local-6989586621679403811"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-2323"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ASetter
  (Branch0 IO)
  (Branch0 IO)
  (Star Referent NameSegment)
  (Star Referent NameSegment)
-&gt; (Star Referent NameSegment -&gt; Star Referent NameSegment)
-&gt; Branch0 IO
-&gt; Branch0 IO
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Branch0 IO)
  (Branch0 IO)
  (Star Referent NameSegment)
  (Star Referent NameSegment)
forall (m :: * -&gt; *). Lens' (Branch0 m) (Star Referent NameSegment)
</span><span class="hs-identifier hs-var">Branch.terms</span></span><span> </span><span class="annot"><span class="annottext">Star Referent NameSegment -&gt; Star Referent NameSegment
</span><a href="#local-6989586621679403819"><span class="hs-identifier hs-var">tmUpdates</span></a></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Branch0 IO)
-&gt; (Branch0 IO -&gt; Branch0 IO) -&gt; Branch0 IO -&gt; Branch0 IO
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Branch0 IO)
  (Branch0 IO)
  (Star Reference NameSegment)
  (Star Reference NameSegment)
-&gt; (Star Reference NameSegment -&gt; Star Reference NameSegment)
-&gt; Branch0 IO
-&gt; Branch0 IO
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Branch0 IO)
  (Branch0 IO)
  (Star Reference NameSegment)
  (Star Reference NameSegment)
forall (m :: * -&gt; *).
Lens' (Branch0 m) (Star Reference NameSegment)
</span><span class="hs-identifier hs-var">Branch.types</span></span><span> </span><span class="annot"><span class="annottext">Star Reference NameSegment -&gt; Star Reference NameSegment
</span><a href="#local-6989586621679403814"><span class="hs-identifier hs-var">tyUpdates</span></a></span><span>
</span><span id="line-2324"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403807"><span class="annot"><span class="annottext">steps :: [(Path, Branch0 IO -&gt; Branch0 IO)]
</span><a href="#local-6989586621679403807"><span class="hs-identifier hs-var hs-var">steps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Absolute, HQSegment) -&gt; (Path, Branch0 IO -&gt; Branch0 IO))
-&gt; [(Absolute, HQSegment)] -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679403806"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403806"><span class="hs-identifier hs-var">path</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403805"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679403805"><span class="hs-identifier hs-var">_hq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403806"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Branch0 IO
</span><a href="#local-6989586621679403820"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Absolute, HQSegment)]
</span><a href="#local-6989586621679403827"><span class="hs-identifier hs-var">srcs</span></a></span><span>
</span><span id="line-2325"></span><span>      </span><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtNoSync"><span class="hs-identifier hs-var">stepManyAtNoSync</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 IO -&gt; Branch0 IO)]
</span><a href="#local-6989586621679403807"><span class="hs-identifier hs-var">steps</span></a></span><span>
</span><span id="line-2326"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679403834"><span class="hs-identifier hs-var">silent</span></a></span><span>
</span><span id="line-2327"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#DefaultMetadataNotification"><span class="hs-identifier hs-var">DefaultMetadataNotification</span></a></span><span>
</span><span id="line-2328"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2329"></span><span>      </span><span id="local-6989586621679403802"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403802"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-2330"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679403801"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403801"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403800"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679403800"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403828"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403802"><span class="hs-identifier hs-var">after</span></a></span><span>
</span><span id="line-2331"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann -&gt; Bool
forall v a. BranchDiffOutput v a -&gt; Bool
</span><a href="Unison.Codebase.Editor.Output.BranchDiff.html#isEmpty"><span class="hs-identifier hs-var">OBranchDiff.isEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679403800"><span class="hs-identifier hs-var">diff</span></a></span><span>
</span><span id="line-2332"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#NoOp"><span class="hs-identifier hs-var">NoOp</span></a></span><span>
</span><span id="line-2333"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-2334"></span><span>          </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="annot"><span class="annottext">(NumberedOutput -&gt; Cli r ()) -&gt; NumberedOutput -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2335"></span><span>            </span><span class="annot"><span class="annottext">AbsBranchId
-&gt; AbsBranchId
-&gt; PrettyPrintEnv
-&gt; BranchDiffOutput Symbol Ann
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffNamespace"><span class="hs-identifier hs-var">ShowDiffNamespace</span></a></span><span>
</span><span id="line-2336"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; AbsBranchId
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span class="hs-special">)</span><span>
</span><span id="line-2337"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; AbsBranchId
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span class="hs-special">)</span><span>
</span><span id="line-2338"></span><span>              </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403801"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-2339"></span><span>              </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679403800"><span class="hs-identifier hs-var">diff</span></a></span><span>
</span><span id="line-2340"></span><span>
</span><span id="line-2341"></span><span class="hs-comment">-- | Resolve a metadata name to its type/value, or return early if no such metadata is found.</span><span>
</span><span id="line-2342"></span><span id="local-6989586621679406311"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#resolveMetadata"><span class="hs-identifier hs-type">resolveMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406311"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Metadata.Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Metadata.Value</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-2343"></span><span id="resolveMetadata"><span class="annot"><span class="annottext">resolveMetadata :: HashQualified Name -&gt; Cli r (Either Output (Reference, Reference))
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveMetadata"><span class="hs-identifier hs-var hs-var">resolveMetadata</span></a></span></span><span> </span><span id="local-6989586621679403796"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403796"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2344"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403795"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403795"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2345"></span><span>  </span><span id="local-6989586621679403794"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403794"><span class="hs-identifier hs-var">root'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-2346"></span><span>  </span><span id="local-6989586621679403793"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403793"><span class="hs-identifier hs-var">currentPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-2347"></span><span>  </span><span id="local-6989586621679403792"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403792"><span class="hs-identifier hs-var">sbhLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.branchHashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403795"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2348"></span><span>
</span><span id="line-2349"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403791"><span class="hs-identifier hs-type">ppe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span>
</span><span id="line-2350"></span><span>      </span><span id="local-6989586621679403791"><span class="annot"><span class="annottext">ppe :: PrettyPrintEnv
</span><a href="#local-6989586621679403791"><span class="hs-identifier hs-var hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2351"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Branch IO -&gt; NameScoping -&gt; PrettyPrintEnv
forall (m :: * -&gt; *).
Int -&gt; Branch m -&gt; NameScoping -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">Backend.basicSuffixifiedNames</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403792"><span class="hs-identifier hs-var">sbhLength</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403794"><span class="hs-identifier hs-var">root'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Path -&gt; NameScoping
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403793"><span class="hs-identifier hs-var">currentPath'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2352"></span><span>
</span><span id="line-2353"></span><span>  </span><span id="local-6989586621679403790"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403790"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Cli r (Set Referent)
forall r. HashQualified Name -&gt; Cli r (Set Referent)
</span><a href="Unison.Codebase.Editor.HandleInput.html#getHQTerms"><span class="hs-identifier hs-var">getHQTerms</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403796"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2354"></span><span>  </span><span id="local-6989586621679403788"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403788"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2355"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Maybe Referent
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403790"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2356"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679403787"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403787"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Cli r Reference
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403787"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-2357"></span><span>      </span><span class="hs-comment">-- FIXME: we want a different error message if the given name is associated with a data constructor (`Con`).</span><span>
</span><span id="line-2358"></span><span>      </span><span class="annot"><span class="annottext">Maybe Referent
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r Reference
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; PrettyPrintEnv -&gt; [Referent] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MetadataAmbiguous"><span class="hs-identifier hs-var">MetadataAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403796"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403791"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403790"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2359"></span><span>  </span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a.
(Applicative m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Reference -&gt; m (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403795"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403788"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Type Symbol Ann))
-&gt; (Maybe (Type Symbol Ann)
    -&gt; Cli r (Either Output (Reference, Reference)))
-&gt; Cli r (Either Output (Reference, Reference))
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2360"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403785"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403785"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Output (Reference, Reference)
-&gt; Cli r (Either Output (Reference, Reference))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either Output (Reference, Reference)
 -&gt; Cli r (Either Output (Reference, Reference)))
-&gt; Either Output (Reference, Reference)
-&gt; Cli r (Either Output (Reference, Reference))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Reference, Reference) -&gt; Either Output (Reference, Reference)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Reference
forall v a. Var v =&gt; Type v a -&gt; Reference
</span><span class="hs-identifier hs-var">Hashing.typeToReference</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403785"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403788"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2361"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2362"></span><span>      </span><span class="annot"><span class="annottext">Either Output (Reference, Reference)
-&gt; Cli r (Either Output (Reference, Reference))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Either Output (Reference, Reference)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#MetadataMissingType"><span class="hs-identifier hs-var">MetadataMissingType</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403791"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403788"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2363"></span><span>
</span><span id="line-2364"></span><span class="hs-comment">-- Takes a maybe (namespace address triple); returns it as-is if `Just`;</span><span>
</span><span id="line-2365"></span><span class="hs-comment">-- otherwise, tries to load a value from .unisonConfig, and complains</span><span>
</span><span id="line-2366"></span><span class="hs-comment">-- if needed.</span><span>
</span><span id="line-2367"></span><span id="local-6989586621679406670"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#resolveConfiguredUrl"><span class="hs-identifier hs-type">resolveConfiguredUrl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.PushPull.html#PushPull"><span class="hs-identifier hs-type">PushPull</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406670"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteRemotePath</span></span></span><span>
</span><span id="line-2368"></span><span id="resolveConfiguredUrl"><span class="annot"><span class="annottext">resolveConfiguredUrl :: PushPull -&gt; Path' -&gt; Cli r WriteRemotePath
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveConfiguredUrl"><span class="hs-identifier hs-var hs-var">resolveConfiguredUrl</span></a></span></span><span> </span><span id="local-6989586621679403782"><span class="annot"><span class="annottext">PushPull
</span><a href="#local-6989586621679403782"><span class="hs-identifier hs-var">pushPull</span></a></span></span><span> </span><span id="local-6989586621679403781"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679403781"><span class="hs-identifier hs-var">destPath'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2369"></span><span>  </span><span id="local-6989586621679403780"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">destPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Cli r Absolute
forall r. Path' -&gt; Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#resolvePath%27"><span class="hs-identifier hs-var">Cli.resolvePath'</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679403781"><span class="hs-identifier hs-var">destPath'</span></a></span><span>
</span><span id="line-2370"></span><span>  </span><span class="annot"><span class="annottext">Cli r (Maybe WriteRemotePath)
-&gt; Cli r WriteRemotePath -&gt; Cli r WriteRemotePath
forall (m :: * -&gt; *) a. Monad m =&gt; m (Maybe a) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">whenNothingM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PushPull -&gt; Absolute -&gt; Cli r (Maybe WriteRemotePath)
forall r. PushPull -&gt; Absolute -&gt; Cli r (Maybe WriteRemotePath)
</span><a href="Unison.Codebase.Editor.HandleInput.html#remoteMappingForPath"><span class="hs-identifier hs-var">remoteMappingForPath</span></a></span><span> </span><span class="annot"><span class="annottext">PushPull
</span><a href="#local-6989586621679403782"><span class="hs-identifier hs-var">pushPull</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">destPath</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2371"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403777"><span class="annot"><span class="annottext">gitUrlConfigKey :: Text
</span><a href="#local-6989586621679403777"><span class="hs-identifier hs-var hs-var">gitUrlConfigKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Text
</span><a href="#local-6989586621679403776"><span class="hs-identifier hs-var">gitUrlKey</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">destPath</span></a></span><span>
</span><span id="line-2372"></span><span>    </span><span class="hs-comment">-- Fall back to deprecated GitUrl key</span><span>
</span><span id="line-2373"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Cli r (Maybe Text)
forall a r. Configured a =&gt; Text -&gt; Cli r (Maybe a)
</span><a href="Unison.Cli.MonadUtils.html#getConfig"><span class="hs-identifier hs-var">Cli.getConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403777"><span class="hs-identifier hs-var">gitUrlConfigKey</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe Text)
-&gt; (Maybe Text -&gt; Cli r WriteRemotePath) -&gt; Cli r WriteRemotePath
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2374"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403775"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403775"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2375"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WriteGitRemotePath -&gt; WriteRemotePath
</span><span class="hs-identifier hs-var">WriteRemotePathGit</span></span><span> </span><span class="annot"><span class="annottext">(WriteGitRemotePath -&gt; WriteRemotePath)
-&gt; Either (ParseErrorBundle Text Void) WriteGitRemotePath
-&gt; Either (ParseErrorBundle Text Void) WriteRemotePath
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parsec Void Text WriteGitRemotePath
-&gt; String
-&gt; Text
-&gt; Either (ParseErrorBundle Text Void) WriteGitRemotePath
forall e s a.
Parsec e s a -&gt; String -&gt; s -&gt; Either (ParseErrorBundle s e) a
</span><span class="hs-identifier hs-var">P.parse</span></span><span> </span><span class="annot"><span class="annottext">Parsec Void Text WriteGitRemotePath
</span><a href="Unison.Codebase.Editor.UriParser.html#deprecatedWriteGitRemotePath"><span class="hs-identifier hs-var">UriParser.deprecatedWriteGitRemotePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403777"><span class="hs-identifier hs-var">gitUrlConfigKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403775"><span class="hs-identifier hs-var">url</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either (ParseErrorBundle Text Void) WriteRemotePath
-&gt; (Either (ParseErrorBundle Text Void) WriteRemotePath
    -&gt; Cli r WriteRemotePath)
-&gt; Cli r WriteRemotePath
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ParseErrorBundle Text Void -&gt; Cli r WriteRemotePath)
-&gt; Either (ParseErrorBundle Text Void) WriteRemotePath
-&gt; Cli r WriteRemotePath
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m b) -&gt; Either a b -&gt; m b
</span><span class="hs-identifier hs-var">onLeft</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403772"><span class="annot"><span class="annottext">ParseErrorBundle Text Void
</span><a href="#local-6989586621679403772"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2376"></span><span>          </span><span class="annot"><span class="annottext">Output -&gt; Cli r WriteRemotePath
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PushPull -&gt; Absolute -&gt; Text -&gt; String -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ConfiguredRemoteMappingParseError"><span class="hs-identifier hs-var">ConfiguredRemoteMappingParseError</span></a></span><span> </span><span class="annot"><span class="annottext">PushPull
</span><a href="#local-6989586621679403782"><span class="hs-identifier hs-var">pushPull</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">destPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403775"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParseErrorBundle Text Void -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ParseErrorBundle Text Void
</span><a href="#local-6989586621679403772"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2377"></span><span>      </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r WriteRemotePath
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PushPull -&gt; Absolute -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#NoConfiguredRemoteMapping"><span class="hs-identifier hs-var">NoConfiguredRemoteMapping</span></a></span><span> </span><span class="annot"><span class="annottext">PushPull
</span><a href="#local-6989586621679403782"><span class="hs-identifier hs-var">pushPull</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">destPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2378"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2379"></span><span>    </span><span class="annot"><a href="#local-6989586621679403776"><span class="hs-identifier hs-type">gitUrlKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-2380"></span><span>    </span><span id="local-6989586621679403776"><span class="annot"><span class="annottext">gitUrlKey :: Absolute -&gt; Text
</span><a href="#local-6989586621679403776"><span class="hs-identifier hs-var hs-var">gitUrlKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#configKey"><span class="hs-identifier hs-var">configKey</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;GitUrl&quot;</span></span><span>
</span><span id="line-2381"></span><span>
</span><span id="line-2382"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#configKey"><span class="hs-identifier hs-type">configKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-2383"></span><span id="configKey"><span class="annot"><span class="annottext">configKey :: Text -&gt; Absolute -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#configKey"><span class="hs-identifier hs-var hs-var">configKey</span></a></span></span><span> </span><span id="local-6989586621679403769"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403769"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679403768"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403768"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2384"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; Text
</span><span class="hs-identifier hs-var">Text.intercalate</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; (Seq Text -&gt; [Text]) -&gt; Seq Text -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Seq Text -&gt; [Text]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Seq Text -&gt; Text) -&gt; Seq Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2385"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403769"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-2386"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Seq Text -&gt; Seq Text
forall a. a -&gt; Seq a -&gt; Seq a
</span><span class="hs-operator hs-var">:&lt;|</span></span><span> </span><span class="annot"><span class="annottext">(NameSegment -&gt; Text) -&gt; Seq NameSegment -&gt; Seq Text
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span>
</span><span id="line-2387"></span><span>        </span><span class="annot"><span class="annottext">NameSegment -&gt; Text
</span><span class="hs-identifier hs-var hs-var">NameSegment.toText</span></span><span>
</span><span id="line-2388"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Seq NameSegment
</span><span class="hs-identifier hs-var hs-var">Path.toSeq</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Seq NameSegment) -&gt; Path -&gt; Seq NameSegment
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403768"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2389"></span><span>
</span><span id="line-2390"></span><span class="hs-comment">-- | Tries to look up a remote mapping for a given path.</span><span>
</span><span id="line-2391"></span><span class="hs-comment">-- Will also resolve paths relative to any mapping which is configured for a parent of that</span><span>
</span><span id="line-2392"></span><span class="hs-comment">-- path.</span><span>
</span><span id="line-2393"></span><span class="hs-comment">--</span><span>
</span><span id="line-2394"></span><span class="hs-comment">-- E.g.</span><span>
</span><span id="line-2395"></span><span class="hs-comment">--</span><span>
</span><span id="line-2396"></span><span class="hs-comment">-- A config which maps:</span><span>
</span><span id="line-2397"></span><span class="hs-comment">--</span><span>
</span><span id="line-2398"></span><span class="hs-comment">-- .myshare.foo -&gt; .me.public.foo</span><span>
</span><span id="line-2399"></span><span class="hs-comment">--</span><span>
</span><span id="line-2400"></span><span class="hs-comment">-- Will resolve the following local paths into share paths like so:</span><span>
</span><span id="line-2401"></span><span class="hs-comment">--</span><span>
</span><span id="line-2402"></span><span class="hs-comment">-- .myshare.foo -&gt; .me.public.foo</span><span>
</span><span id="line-2403"></span><span class="hs-comment">-- .myshare.foo.bar -&gt; .me.public.foo.bar</span><span>
</span><span id="line-2404"></span><span class="hs-comment">-- .myshare.foo.bar.baz -&gt; .me.public.foo.bar.baz</span><span>
</span><span id="line-2405"></span><span class="hs-comment">-- .myshare -&gt; &lt;Nothing&gt;</span><span>
</span><span id="line-2406"></span><span id="local-6989586621679406293"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#remoteMappingForPath"><span class="hs-identifier hs-type">remoteMappingForPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.PushPull.html#PushPull"><span class="hs-identifier hs-type">PushPull</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406293"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">WriteRemotePath</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2407"></span><span id="remoteMappingForPath"><span class="annot"><span class="annottext">remoteMappingForPath :: PushPull -&gt; Absolute -&gt; Cli r (Maybe WriteRemotePath)
</span><a href="Unison.Codebase.Editor.HandleInput.html#remoteMappingForPath"><span class="hs-identifier hs-var hs-var">remoteMappingForPath</span></a></span></span><span> </span><span id="local-6989586621679403764"><span class="annot"><span class="annottext">PushPull
</span><a href="#local-6989586621679403764"><span class="hs-identifier hs-var">pushPull</span></a></span></span><span> </span><span id="local-6989586621679403763"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403763"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2408"></span><span>  </span><span class="annot"><span class="annottext">Absolute -&gt; Seq (Absolute, Path)
</span><a href="#local-6989586621679403762"><span class="hs-identifier hs-var">pathPrefixes</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403763"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (Absolute, Path)
-&gt; (Seq (Absolute, Path) -&gt; Cli r (Maybe WriteRemotePath))
-&gt; Cli r (Maybe WriteRemotePath)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">((Absolute, Path) -&gt; Cli r (Maybe WriteRemotePath))
-&gt; Seq (Absolute, Path) -&gt; Cli r (Maybe WriteRemotePath)
forall (f :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable f, Monad m) =&gt;
(a -&gt; m (Maybe b)) -&gt; f a -&gt; m (Maybe b)
</span><span class="hs-identifier hs-var">Foldable.firstJustM</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679403760"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403760"><span class="hs-identifier hs-var">prefix</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403759"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403759"><span class="hs-identifier hs-var">suffix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2409"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403758"><span class="annot"><span class="annottext">remoteMappingConfigKey :: Text
</span><a href="#local-6989586621679403758"><span class="hs-identifier hs-var hs-var">remoteMappingConfigKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Text
</span><a href="#local-6989586621679403757"><span class="hs-identifier hs-var">remoteMappingKey</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403760"><span class="hs-identifier hs-var">prefix</span></a></span><span>
</span><span id="line-2410"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Cli r (Maybe Text)
forall a r. Configured a =&gt; Text -&gt; Cli r (Maybe a)
</span><a href="Unison.Cli.MonadUtils.html#getConfig"><span class="hs-identifier hs-var">Cli.getConfig</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403758"><span class="hs-identifier hs-var">remoteMappingConfigKey</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe Text)
-&gt; (Maybe Text -&gt; Cli r (Maybe WriteRemotePath))
-&gt; Cli r (Maybe WriteRemotePath)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2411"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403756"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403756"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2412"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403755"><span class="annot"><span class="annottext">parseResult :: Either (ParseErrorBundle Text Void) WriteRemotePath
</span><a href="#local-6989586621679403755"><span class="hs-identifier hs-var hs-var">parseResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parsec Void Text WriteRemotePath
-&gt; String
-&gt; Text
-&gt; Either (ParseErrorBundle Text Void) WriteRemotePath
forall e s a.
Parsec e s a -&gt; String -&gt; s -&gt; Either (ParseErrorBundle s e) a
</span><span class="hs-identifier hs-var">P.parse</span></span><span> </span><span class="annot"><span class="annottext">Parsec Void Text WriteRemotePath
</span><a href="Unison.Codebase.Editor.UriParser.html#writeRemotePath"><span class="hs-identifier hs-var">UriParser.writeRemotePath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403758"><span class="hs-identifier hs-var">remoteMappingConfigKey</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403756"><span class="hs-identifier hs-var">url</span></a></span><span>
</span><span id="line-2413"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (ParseErrorBundle Text Void) WriteRemotePath
</span><a href="#local-6989586621679403755"><span class="hs-identifier hs-var">parseResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2414"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679403753"><span class="annot"><span class="annottext">ParseErrorBundle Text Void
</span><a href="#local-6989586621679403753"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Maybe WriteRemotePath)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PushPull -&gt; Absolute -&gt; Text -&gt; String -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ConfiguredRemoteMappingParseError"><span class="hs-identifier hs-var">ConfiguredRemoteMappingParseError</span></a></span><span> </span><span class="annot"><span class="annottext">PushPull
</span><a href="#local-6989586621679403764"><span class="hs-identifier hs-var">pushPull</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403763"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403756"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ParseErrorBundle Text Void -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ParseErrorBundle Text Void
</span><a href="#local-6989586621679403753"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2415"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679403752"><span class="annot"><span class="annottext">WriteRemotePath
</span><a href="#local-6989586621679403752"><span class="hs-identifier hs-var">wrp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2416"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403751"><span class="annot"><span class="annottext">remote :: WriteRemotePath
</span><a href="#local-6989586621679403751"><span class="hs-identifier hs-var hs-var">remote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WriteRemotePath
</span><a href="#local-6989586621679403752"><span class="hs-identifier hs-var">wrp</span></a></span><span> </span><span class="annot"><span class="annottext">WriteRemotePath
-&gt; (WriteRemotePath -&gt; WriteRemotePath) -&gt; WriteRemotePath
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Identity Path)
-&gt; WriteRemotePath -&gt; Identity WriteRemotePath
Lens' WriteRemotePath Path
</span><span class="hs-identifier hs-var">RemoteRepo.remotePath_</span></span><span> </span><span class="annot"><span class="annottext">((Path -&gt; Identity Path)
 -&gt; WriteRemotePath -&gt; Identity WriteRemotePath)
-&gt; (Path -&gt; Path) -&gt; WriteRemotePath -&gt; WriteRemotePath
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403749"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403749"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Path -&gt; Path
forall l r o. Resolve l r o =&gt; l -&gt; r -&gt; o
</span><span class="hs-identifier hs-var">Path.resolve</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403749"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403759"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-2417"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Maybe WriteRemotePath -&gt; Cli r (Maybe WriteRemotePath)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe WriteRemotePath -&gt; Cli r (Maybe WriteRemotePath))
-&gt; Maybe WriteRemotePath -&gt; Cli r (Maybe WriteRemotePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WriteRemotePath -&gt; Maybe WriteRemotePath
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">WriteRemotePath
</span><a href="#local-6989586621679403751"><span class="hs-identifier hs-var">remote</span></a></span><span>
</span><span id="line-2418"></span><span>      </span><span class="annot"><span class="annottext">Maybe Text
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe WriteRemotePath -&gt; Cli r (Maybe WriteRemotePath)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe WriteRemotePath
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2419"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2420"></span><span>    </span><span class="hs-comment">-- Produces a list of path prefixes and suffixes, from longest prefix to shortest</span><span>
</span><span id="line-2421"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2422"></span><span>    </span><span class="hs-comment">-- E.g.</span><span>
</span><span id="line-2423"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2424"></span><span>    </span><span class="hs-comment">-- &gt;&gt;&gt; pathPrefixes (&quot;a&quot; :&lt; &quot;b&quot; :&lt; Path.absoluteEmpty)</span><span>
</span><span id="line-2425"></span><span>    </span><span class="hs-comment">-- fromList [(.a.b,),(.a,b),(.,a.b)]</span><span>
</span><span id="line-2426"></span><span>    </span><span class="annot"><a href="#local-6989586621679403762"><span class="hs-identifier hs-type">pathPrefixes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Path</span></span><span class="hs-special">)</span><span>
</span><span id="line-2427"></span><span>    </span><span id="local-6989586621679403762"><span class="annot"><span class="annottext">pathPrefixes :: Absolute -&gt; Seq (Absolute, Path)
</span><a href="#local-6989586621679403762"><span class="hs-identifier hs-var hs-var">pathPrefixes</span></a></span></span><span> </span><span id="local-6989586621679403748"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403748"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2428"></span><span>      </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403748"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2429"></span><span>        </span><span class="annot"><span class="annottext">Path -&gt; (Path -&gt; Seq NameSegment) -&gt; Seq NameSegment
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Seq NameSegment
</span><span class="hs-identifier hs-var hs-var">Path.toSeq</span></span><span>
</span><span id="line-2430"></span><span>        </span><span class="annot"><span class="annottext">Seq NameSegment
-&gt; (Seq NameSegment -&gt; Seq (Absolute, Path))
-&gt; Seq (Absolute, Path)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403747"><span class="annot"><span class="annottext">Seq NameSegment
</span><a href="#local-6989586621679403747"><span class="hs-identifier hs-var">seq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2431"></span><span>          </span><span class="annot"><span class="annottext">Seq (Seq NameSegment)
-&gt; Seq (Seq NameSegment) -&gt; Seq (Seq NameSegment, Seq NameSegment)
forall a b. Seq a -&gt; Seq b -&gt; Seq (a, b)
</span><span class="hs-identifier hs-var">Seq.zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq NameSegment -&gt; Seq (Seq NameSegment)
forall a. Seq a -&gt; Seq (Seq a)
</span><span class="hs-identifier hs-var">Seq.inits</span></span><span> </span><span class="annot"><span class="annottext">Seq NameSegment
</span><a href="#local-6989586621679403747"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq NameSegment -&gt; Seq (Seq NameSegment)
forall a. Seq a -&gt; Seq (Seq a)
</span><span class="hs-identifier hs-var">Seq.tails</span></span><span> </span><span class="annot"><span class="annottext">Seq NameSegment
</span><a href="#local-6989586621679403747"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2432"></span><span>            </span><span class="annot"><span class="annottext">Seq (Seq NameSegment, Seq NameSegment)
-&gt; (Seq (Seq NameSegment, Seq NameSegment)
    -&gt; Seq (Seq NameSegment, Seq NameSegment))
-&gt; Seq (Seq NameSegment, Seq NameSegment)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Seq (Seq NameSegment, Seq NameSegment)
-&gt; Seq (Seq NameSegment, Seq NameSegment)
forall a. Seq a -&gt; Seq a
</span><span class="hs-identifier hs-var">Seq.reverse</span></span><span>
</span><span id="line-2433"></span><span>            </span><span class="annot"><span class="annottext">Seq (Seq NameSegment, Seq NameSegment)
-&gt; ((Seq NameSegment, Seq NameSegment) -&gt; (Absolute, Path))
-&gt; Seq (Absolute, Path)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Seq NameSegment -&gt; Absolute)
-&gt; (Seq NameSegment -&gt; Path)
-&gt; (Seq NameSegment, Seq NameSegment)
-&gt; (Absolute, Path)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Absolute
</span><span class="hs-identifier hs-var">Path.Absolute</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Absolute)
-&gt; (Seq NameSegment -&gt; Path) -&gt; Seq NameSegment -&gt; Absolute
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Seq NameSegment -&gt; Path
</span><span class="hs-identifier hs-var">Path.Path</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq NameSegment -&gt; Path
</span><span class="hs-identifier hs-var">Path.Path</span></span><span class="hs-special">)</span><span>
</span><span id="line-2434"></span><span>    </span><span class="annot"><a href="#local-6989586621679403757"><span class="hs-identifier hs-type">remoteMappingKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-2435"></span><span>    </span><span id="local-6989586621679403757"><span class="annot"><span class="annottext">remoteMappingKey :: Absolute -&gt; Text
</span><a href="#local-6989586621679403757"><span class="hs-identifier hs-var hs-var">remoteMappingKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; Text
</span><a href="Unison.Codebase.Editor.HandleInput.html#configKey"><span class="hs-identifier hs-var">configKey</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;RemoteMapping&quot;</span></span><span>
</span><span id="line-2436"></span><span>
</span><span id="line-2437"></span><span id="local-6989586621679406977"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#importRemoteShareBranch"><span class="hs-identifier hs-type">importRemoteShareBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReadShareRemoteNamespace</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406977"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2438"></span><span id="importRemoteShareBranch"><span class="annot"><span class="annottext">importRemoteShareBranch :: ReadShareRemoteNamespace -&gt; Cli r (Branch IO)
</span><a href="Unison.Codebase.Editor.HandleInput.html#importRemoteShareBranch"><span class="hs-identifier hs-var hs-var">importRemoteShareBranch</span></a></span></span><span> </span><span id="local-6989586621679403740"><span class="annot"><span class="annottext">rrn :: ReadShareRemoteNamespace
</span><a href="#local-6989586621679403740"><span class="hs-identifier hs-var">rrn</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReadShareRemoteNamespace</span></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403738"><span class="annot"><span class="annottext">ShareCodeserver
$sel:server:ReadShareRemoteNamespace :: ReadShareRemoteNamespace -&gt; ShareCodeserver
server :: ShareCodeserver
</span><span class="hs-identifier hs-var hs-var">server</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403736"><span class="annot"><span class="annottext">Text
$sel:repo:ReadShareRemoteNamespace :: ReadShareRemoteNamespace -&gt; Text
repo :: Text
</span><span class="hs-identifier hs-var hs-var">repo</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403734"><span class="annot"><span class="annottext">Path
$sel:path:ReadShareRemoteNamespace :: ReadShareRemoteNamespace -&gt; Path
path :: Path
</span><span class="hs-identifier hs-var hs-var">path</span></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2439"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403732"><span class="annot"><span class="annottext">codeserver :: CodeserverURI
</span><a href="#local-6989586621679403732"><span class="hs-identifier hs-var hs-var">codeserver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShareCodeserver -&gt; CodeserverURI
</span><a href="Unison.Share.Codeserver.html#resolveCodeserver"><span class="hs-identifier hs-var">Codeserver.resolveCodeserver</span></a></span><span> </span><span class="annot"><span class="annottext">ShareCodeserver
</span><a href="#local-6989586621679403738"><span class="hs-identifier hs-var">server</span></a></span><span>
</span><span id="line-2440"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403731"><span class="annot"><span class="annottext">baseURL :: BaseUrl
</span><a href="#local-6989586621679403731"><span class="hs-identifier hs-var hs-var">baseURL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CodeserverURI -&gt; BaseUrl
</span><span class="hs-identifier hs-var">codeserverBaseURL</span></span><span> </span><span class="annot"><span class="annottext">CodeserverURI
</span><a href="#local-6989586621679403732"><span class="hs-identifier hs-var">codeserver</span></a></span><span>
</span><span id="line-2441"></span><span>  </span><span class="hs-comment">-- Auto-login to share if pulling from a non-public path</span><span>
</span><span id="line-2442"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReadShareRemoteNamespace -&gt; Bool
</span><span class="hs-identifier hs-var">RemoteRepo.isPublic</span></span><span> </span><span class="annot"><span class="annottext">ReadShareRemoteNamespace
</span><a href="#local-6989586621679403740"><span class="hs-identifier hs-var">rrn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cli r () -&gt; Cli r ()) -&gt; Cli r () -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CodeserverURI -&gt; Cli r ()
forall r. CodeserverURI -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.AuthLogin.html#ensureAuthenticatedWithCodeserver"><span class="hs-identifier hs-var">ensureAuthenticatedWithCodeserver</span></a></span><span> </span><span class="annot"><span class="annottext">CodeserverURI
</span><a href="#local-6989586621679403732"><span class="hs-identifier hs-var">codeserver</span></a></span><span>
</span><span id="line-2443"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403729"><span class="annot"><span class="annottext">shareFlavoredPath :: Path
</span><a href="#local-6989586621679403729"><span class="hs-identifier hs-var hs-var">shareFlavoredPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty Text -&gt; Path
</span><span class="hs-identifier hs-var">Share.Path</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403736"><span class="hs-identifier hs-var">repo</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Text] -&gt; NonEmpty Text
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><span class="hs-operator hs-var">Nel.:|</span></span><span> </span><span class="annot"><span class="annottext">[NameSegment] -&gt; [Text]
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">NameSegment</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; [NameSegment]
</span><span class="hs-identifier hs-var">Path.toList</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403734"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2444"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403728"><span class="annot"><span class="annottext">AuthenticatedHttpClient
authHTTPClient :: AuthenticatedHttpClient
$sel:authHTTPClient:Env :: Env -&gt; AuthenticatedHttpClient
</span><a href="#local-6989586621679403728"><span class="hs-identifier hs-var hs-var">authHTTPClient</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403727"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403727"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2445"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403726"><span class="hs-identifier hs-type">pull</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Share.Sync.Types.html#SyncError"><span class="hs-identifier hs-type">Share.SyncError</span></a></span><span> </span><span class="annot"><a href="Unison.Share.Sync.Types.html#PullError"><span class="hs-identifier hs-type">Share.PullError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CausalHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-2446"></span><span>      </span><span id="local-6989586621679403726"><span class="annot"><span class="annottext">pull :: IO (Either (SyncError PullError) CausalHash)
</span><a href="#local-6989586621679403726"><span class="hs-identifier hs-var hs-var">pull</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2447"></span><span>        </span><span class="annot"><span class="annottext">((Int -&gt; IO ()) -&gt; IO (Either (SyncError PullError) CausalHash))
-&gt; IO (Either (SyncError PullError) CausalHash)
forall a. ((Int -&gt; IO ()) -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621679403725"><span class="hs-identifier hs-var">withEntitiesDownloadedProgressCallback</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403724"><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679403724"><span class="hs-identifier hs-var">downloadedCallback</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2448"></span><span>          </span><span class="annot"><span class="annottext">AuthenticatedHttpClient
-&gt; BaseUrl
-&gt; (forall a. (Connection -&gt; IO a) -&gt; IO a)
-&gt; Path
-&gt; (Int -&gt; IO ())
-&gt; IO (Either (SyncError PullError) CausalHash)
</span><a href="Unison.Share.Sync.html#pull"><span class="hs-identifier hs-var">Share.pull</span></a></span><span>
</span><span id="line-2449"></span><span>            </span><span class="annot"><span class="annottext">AuthenticatedHttpClient
</span><a href="#local-6989586621679403728"><span class="hs-identifier hs-var">authHTTPClient</span></a></span><span>
</span><span id="line-2450"></span><span>            </span><span class="annot"><span class="annottext">BaseUrl
</span><a href="#local-6989586621679403731"><span class="hs-identifier hs-var">baseURL</span></a></span><span>
</span><span id="line-2451"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; forall a. (Connection -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; forall a. (Connection -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var hs-var">Codebase.withConnectionIO</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403727"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2452"></span><span>            </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403729"><span class="hs-identifier hs-var">shareFlavoredPath</span></a></span><span>
</span><span id="line-2453"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="#local-6989586621679403724"><span class="hs-identifier hs-var">downloadedCallback</span></a></span><span>
</span><span id="line-2454"></span><span>  </span><span id="local-6989586621679403722"><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679403722"><span class="hs-identifier hs-var">causalHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2455"></span><span>    </span><span class="annot"><span class="annottext">IO (Either (SyncError PullError) CausalHash)
-&gt; (SyncError PullError -&gt; Cli r CausalHash) -&gt; Cli r CausalHash
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="annot"><span class="annottext">IO (Either (SyncError PullError) CausalHash)
</span><a href="#local-6989586621679403726"><span class="hs-identifier hs-var">pull</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403721"><span class="annot"><span class="annottext">SyncError PullError
</span><a href="#local-6989586621679403721"><span class="hs-identifier hs-var">err0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2456"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Output -&gt; Cli r CausalHash
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r CausalHash)
-&gt; (ShareError -&gt; Output) -&gt; ShareError -&gt; Cli r CausalHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShareError -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ShareError"><span class="hs-identifier hs-var">Output.ShareError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SyncError PullError
</span><a href="#local-6989586621679403721"><span class="hs-identifier hs-var">err0</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2457"></span><span>        </span><span class="annot"><a href="Unison.Share.Sync.Types.html#SyncError"><span class="hs-identifier hs-type">Share.SyncError</span></a></span><span> </span><span id="local-6989586621679403720"><span class="annot"><span class="annottext">PullError
</span><a href="#local-6989586621679403720"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PullError -&gt; ShareError
</span><a href="Unison.Codebase.Editor.Output.html#ShareErrorPull"><span class="hs-identifier hs-var">Output.ShareErrorPull</span></a></span><span> </span><span class="annot"><span class="annottext">PullError
</span><a href="#local-6989586621679403720"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2458"></span><span>        </span><span class="annot"><a href="Unison.Share.Sync.Types.html#TransportError"><span class="hs-identifier hs-type">Share.TransportError</span></a></span><span> </span><span id="local-6989586621679403718"><span class="annot"><span class="annottext">CodeserverTransportError
</span><a href="#local-6989586621679403718"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CodeserverTransportError -&gt; ShareError
</span><a href="Unison.Codebase.Editor.Output.html#ShareErrorTransport"><span class="hs-identifier hs-var">Output.ShareErrorTransport</span></a></span><span> </span><span class="annot"><span class="annottext">CodeserverTransportError
</span><a href="#local-6989586621679403718"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2459"></span><span>  </span><span class="annot"><span class="annottext">IO (Maybe (Branch IO)) -&gt; Cli r (Maybe (Branch IO))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; CausalHash -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; CausalHash -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.getBranchForHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403727"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CausalHash -&gt; CausalHash
</span><span class="hs-identifier hs-var">Cv.causalHash2to1</span></span><span> </span><span class="annot"><span class="annottext">CausalHash
</span><a href="#local-6989586621679403722"><span class="hs-identifier hs-var">causalHash</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (Branch IO))
-&gt; (Cli r (Maybe (Branch IO)) -&gt; Cli r (Branch IO))
-&gt; Cli r (Branch IO)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO) -&gt; Cli r (Maybe (Branch IO)) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. Monad m =&gt; m a -&gt; m (Maybe a) -&gt; m a
</span><span class="hs-identifier hs-var">onNothingM</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2460"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Cli r (Branch IO)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Cli r (Branch IO)) -&gt; String -&gt; Cli r (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-identifier hs-var">reportBug</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;E412939&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;`pull` \&quot;succeeded\&quot;, but I can't find the result in the codebase. (This is a bug.)&quot;</span></span><span>
</span><span id="line-2461"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2462"></span><span>    </span><span class="hs-comment">-- Provide the given action a callback that display to the terminal.</span><span>
</span><span id="line-2463"></span><span>    </span><span id="local-6989586621679403715"><span class="annot"><a href="#local-6989586621679403725"><span class="hs-identifier hs-type">withEntitiesDownloadedProgressCallback</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679403715"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679403715"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2464"></span><span>    </span><span id="local-6989586621679403725"><span class="annot"><span class="annottext">withEntitiesDownloadedProgressCallback :: ((Int -&gt; IO ()) -&gt; IO a) -&gt; IO a
</span><a href="#local-6989586621679403725"><span class="hs-identifier hs-var hs-var">withEntitiesDownloadedProgressCallback</span></a></span></span><span> </span><span id="local-6989586621679403714"><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; IO a
</span><a href="#local-6989586621679403714"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2465"></span><span>      </span><span id="local-6989586621679403713"><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679403713"><span class="hs-identifier hs-var">entitiesDownloadedVar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO (TVar Int)
forall a. a -&gt; IO (TVar a)
</span><span class="hs-identifier hs-var">newTVarIO</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-2466"></span><span>      </span><span class="annot"><span class="annottext">IO a -&gt; IO a
forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">Console.Regions.displayConsoleRegions</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2467"></span><span>        </span><span class="annot"><span class="annottext">RegionLayout -&gt; (ConsoleRegion -&gt; IO a) -&gt; IO a
forall (m :: * -&gt; *) a.
(MonadIO m, MonadMask m) =&gt;
RegionLayout -&gt; (ConsoleRegion -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">Console.Regions.withConsoleRegion</span></span><span> </span><span class="annot"><span class="annottext">RegionLayout
</span><span class="hs-identifier hs-var">Console.Regions.Linear</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403712"><span class="annot"><span class="annottext">ConsoleRegion
</span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">region</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2468"></span><span>          </span><span class="annot"><span class="annottext">ConsoleRegion -&gt; STM Text -&gt; IO ()
forall v (m :: * -&gt; *).
(ToRegionContent v, LiftRegion m) =&gt;
ConsoleRegion -&gt; v -&gt; m ()
</span><span class="hs-identifier hs-var">Console.Regions.setConsoleRegion</span></span><span> </span><span class="annot"><span class="annottext">ConsoleRegion
</span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">region</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2469"></span><span>            </span><span id="local-6989586621679403711"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403711"><span class="hs-identifier hs-var">entitiesDownloaded</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar Int -&gt; STM Int
forall a. TVar a -&gt; STM a
</span><span class="hs-identifier hs-var">readTVar</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679403713"><span class="hs-identifier hs-var">entitiesDownloadedVar</span></a></span><span>
</span><span id="line-2470"></span><span>            </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-2471"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n  Downloaded &quot;</span></span><span>
</span><span id="line-2472"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403711"><span class="hs-identifier hs-var">entitiesDownloaded</span></a></span><span>
</span><span id="line-2473"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; entities...\n\n&quot;</span></span><span>
</span><span id="line-2474"></span><span>          </span><span id="local-6989586621679403710"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679403710"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO ()) -&gt; IO a
</span><a href="#local-6989586621679403714"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679403709"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403709"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">STM () -&gt; IO ()
forall a. STM a -&gt; IO a
</span><span class="hs-identifier hs-var">atomically</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TVar Int -&gt; (Int -&gt; Int) -&gt; STM ()
forall a. TVar a -&gt; (a -&gt; a) -&gt; STM ()
</span><span class="hs-identifier hs-var">modifyTVar'</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679403713"><span class="hs-identifier hs-var">entitiesDownloadedVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403709"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2475"></span><span>          </span><span id="local-6989586621679403708"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403708"><span class="hs-identifier hs-var">entitiesDownloaded</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TVar Int -&gt; IO Int
forall a. TVar a -&gt; IO a
</span><span class="hs-identifier hs-var">readTVarIO</span></span><span> </span><span class="annot"><span class="annottext">TVar Int
</span><a href="#local-6989586621679403713"><span class="hs-identifier hs-var">entitiesDownloadedVar</span></a></span><span>
</span><span id="line-2476"></span><span>          </span><span class="annot"><span class="annottext">ConsoleRegion -&gt; Text -&gt; IO ()
forall v (m :: * -&gt; *).
(Outputable v, LiftRegion m) =&gt;
ConsoleRegion -&gt; v -&gt; m ()
</span><span class="hs-identifier hs-var">Console.Regions.finishConsoleRegion</span></span><span> </span><span class="annot"><span class="annottext">ConsoleRegion
</span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">region</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2477"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;\n  Downloaded &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403708"><span class="hs-identifier hs-var">entitiesDownloaded</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; entities.&quot;</span></span><span>
</span><span id="line-2478"></span><span>          </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679403710"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-2479"></span><span>
</span><span id="line-2480"></span><span class="hs-comment">-- todo: compare to `getHQTerms` / `getHQTypes`.  Is one universally better?</span><span>
</span><span id="line-2481"></span><span id="local-6989586621679406665"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#resolveHQToLabeledDependencies"><span class="hs-identifier hs-type">resolveHQToLabeledDependencies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406665"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2482"></span><span id="resolveHQToLabeledDependencies"><span class="annot"><span class="annottext">resolveHQToLabeledDependencies :: HashQualified Name -&gt; Cli r (Set LabeledDependency)
</span><a href="Unison.Codebase.Editor.HandleInput.html#resolveHQToLabeledDependencies"><span class="hs-identifier hs-var hs-var">resolveHQToLabeledDependencies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2483"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.NameOnly</span></span><span> </span><span id="local-6989586621679403706"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403706"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2484"></span><span>    </span><span id="local-6989586621679403705"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403705"><span class="hs-identifier hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicParseNames"><span class="hs-identifier hs-var">basicParseNames</span></a></span><span>
</span><span id="line-2485"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403704"><span class="hs-identifier hs-type">terms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679403703"><span class="hs-identifier hs-type">types</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span>
</span><span id="line-2486"></span><span>        </span><span id="local-6989586621679403704"><span class="annot"><span class="annottext">terms :: Set LabeledDependency
</span><a href="#local-6989586621679403704"><span class="hs-identifier hs-var hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; LabeledDependency)
-&gt; Set Referent -&gt; Set LabeledDependency
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.referent</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; Set LabeledDependency)
-&gt; (Relation Name Referent -&gt; Set Referent)
-&gt; Relation Name Referent
-&gt; Set LabeledDependency
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Relation Name Referent -&gt; Set Referent
forall r. Ord r =&gt; Name -&gt; Relation Name r -&gt; Set r
</span><span class="hs-identifier hs-var">Name.searchBySuffix</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403706"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Relation Name Referent -&gt; Set LabeledDependency)
-&gt; Relation Name Referent -&gt; Set LabeledDependency
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Relation Name Referent
</span><span class="hs-identifier hs-var hs-var">Names.terms</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403705"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-2487"></span><span>        </span><span id="local-6989586621679403703"><span class="annot"><span class="annottext">types :: Set LabeledDependency
</span><a href="#local-6989586621679403703"><span class="hs-identifier hs-var hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; LabeledDependency)
-&gt; Set Reference -&gt; Set LabeledDependency
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.typeRef</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Set LabeledDependency)
-&gt; (Relation Name Reference -&gt; Set Reference)
-&gt; Relation Name Reference
-&gt; Set LabeledDependency
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Relation Name Reference -&gt; Set Reference
forall r. Ord r =&gt; Name -&gt; Relation Name r -&gt; Set r
</span><span class="hs-identifier hs-var">Name.searchBySuffix</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403706"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Relation Name Reference -&gt; Set LabeledDependency)
-&gt; Relation Name Reference -&gt; Set LabeledDependency
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Relation Name Reference
</span><span class="hs-identifier hs-var hs-var">Names.types</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403705"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-2488"></span><span>    </span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Cli r (Set LabeledDependency)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Set LabeledDependency -&gt; Cli r (Set LabeledDependency))
-&gt; Set LabeledDependency -&gt; Cli r (Set LabeledDependency)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403704"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403703"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-2489"></span><span>  </span><span class="hs-comment">-- rationale: the hash should be unique enough that the name never helps</span><span>
</span><span id="line-2490"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span id="local-6989586621679403699"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403699"><span class="hs-identifier hs-var">_n</span></a></span></span><span> </span><span id="local-6989586621679403698"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403698"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Cli r (Set LabeledDependency)
forall (m :: * -&gt; *).
(MonadReader Env m, MonadIO m) =&gt;
ShortHash -&gt; m (Set LabeledDependency)
</span><a href="#local-6989586621679403697"><span class="hs-identifier hs-var">resolveHashOnly</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403698"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-2491"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashOnly</span></span><span> </span><span id="local-6989586621679403696"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403696"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Cli r (Set LabeledDependency)
forall (m :: * -&gt; *).
(MonadReader Env m, MonadIO m) =&gt;
ShortHash -&gt; m (Set LabeledDependency)
</span><a href="#local-6989586621679403697"><span class="hs-identifier hs-var">resolveHashOnly</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403696"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-2492"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2493"></span><span>    </span><span id="local-6989586621679403697"><span class="annot"><span class="annottext">resolveHashOnly :: ShortHash -&gt; m (Set LabeledDependency)
</span><a href="#local-6989586621679403697"><span class="hs-identifier hs-var hs-var">resolveHashOnly</span></a></span></span><span> </span><span id="local-6989586621679403695"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403695"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2494"></span><span>      </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403694"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403694"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2495"></span><span>      </span><span id="local-6989586621679403693"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403693"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set Referent) -&gt; m (Set Referent)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; ShortHash -&gt; IO (Set Referent)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Referent)
</span><span class="hs-identifier hs-var">Backend.termReferentsByShortHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403694"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403695"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2496"></span><span>      </span><span id="local-6989586621679403692"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403692"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; m (Set Reference)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; ShortHash -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Backend.typeReferencesByShortHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403694"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403695"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2497"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; LabeledDependency)
-&gt; Set Referent -&gt; Set LabeledDependency
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.referent</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403693"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; LabeledDependency)
-&gt; Set Reference -&gt; Set LabeledDependency
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.typeRef</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403692"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-2498"></span><span>
</span><span id="line-2499"></span><span id="local-6989586621679406149"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#doDisplay"><span class="hs-identifier hs-type">doDisplay</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#OutputLocation"><span class="hs-identifier hs-type">OutputLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406149"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2500"></span><span id="doDisplay"><span class="annot"><span class="annottext">doDisplay :: OutputLocation -&gt; NamesWithHistory -&gt; Term Symbol () -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#doDisplay"><span class="hs-identifier hs-var hs-var">doDisplay</span></a></span></span><span> </span><span id="local-6989586621679403690"><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679403690"><span class="hs-identifier hs-var">outputLoc</span></a></span></span><span> </span><span id="local-6989586621679403689"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403689"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621679403688"><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679403688"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2501"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403687"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403687"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2502"></span><span>  </span><span id="local-6989586621679403686"><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679403686"><span class="hs-identifier hs-var">loopState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r LoopState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">State.get</span></span><span>
</span><span id="line-2503"></span><span>
</span><span id="line-2504"></span><span>  </span><span id="local-6989586621679403685"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403685"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403689"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-2505"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403684"><span class="annot"><span class="annottext">Map Id (Term Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679403684"><span class="hs-identifier hs-var">tms</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403683"><span class="annot"><span class="annottext">Map Id (Decl Symbol Ann)
</span><a href="#local-6989586621679403683"><span class="hs-identifier hs-var">typs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map Id (Term Symbol Ann, Type Symbol Ann),
 Map Id (Decl Symbol Ann))
-&gt; (TypecheckedUnisonFile Symbol Ann
    -&gt; (Map Id (Term Symbol Ann, Type Symbol Ann),
        Map Id (Decl Symbol Ann)))
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; (Map Id (Term Symbol Ann, Type Symbol Ann),
    Map Id (Decl Symbol Ann))
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">(Map Id (Term Symbol Ann, Type Symbol Ann),
 Map Id (Decl Symbol Ann))
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; (Map Id (Term Symbol Ann, Type Symbol Ann),
    Map Id (Decl Symbol Ann))
forall v a.
TypecheckedUnisonFile v a
-&gt; (Map Id (Term v a, Type v a), Map Id (Decl v a))
</span><span class="hs-identifier hs-var">UF.indexByReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679403686"><span class="hs-identifier hs-var">loopState</span></a></span><span> </span><span class="annot"><span class="annottext">LoopState
-&gt; Getting
     (Maybe (TypecheckedUnisonFile Symbol Ann))
     LoopState
     (Maybe (TypecheckedUnisonFile Symbol Ann))
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;latestTypecheckedFile&quot;
  (Getting
     (Maybe (TypecheckedUnisonFile Symbol Ann))
     LoopState
     (Maybe (TypecheckedUnisonFile Symbol Ann)))
Getting
  (Maybe (TypecheckedUnisonFile Symbol Ann))
  LoopState
  (Maybe (TypecheckedUnisonFile Symbol Ann))
</span><a href="#local-6989586621679403681"><span class="hs-var">#latestTypecheckedFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2506"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403680"><span class="annot"><span class="annottext">loc :: Maybe String
</span><a href="#local-6989586621679403680"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679403690"><span class="hs-identifier hs-var">outputLoc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2507"></span><span>        </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#ConsoleLocation"><span class="hs-identifier hs-var">ConsoleLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2508"></span><span>        </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#FileLocation"><span class="hs-identifier hs-type">FileLocation</span></a></span><span> </span><span id="local-6989586621679403679"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403679"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403679"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-2509"></span><span>        </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#LatestFileLocation"><span class="hs-identifier hs-var">LatestFileLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((String, Bool) -&gt; String) -&gt; Maybe (String, Bool) -&gt; Maybe String
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(String, Bool) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679403686"><span class="hs-identifier hs-var">loopState</span></a></span><span> </span><span class="annot"><span class="annottext">LoopState
-&gt; Getting (Maybe (String, Bool)) LoopState (Maybe (String, Bool))
-&gt; Maybe (String, Bool)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;latestFile&quot;
  (Getting (Maybe (String, Bool)) LoopState (Maybe (String, Bool)))
Getting (Maybe (String, Bool)) LoopState (Maybe (String, Bool))
</span><a href="#local-6989586621679403678"><span class="hs-var">#latestFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Maybe String -&gt; Maybe String
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scratch.u&quot;</span></span><span>
</span><span id="line-2510"></span><span>      </span><span id="local-6989586621679403677"><span class="annot"><span class="annottext">useCache :: Bool
</span><a href="#local-6989586621679403677"><span class="hs-identifier hs-var hs-var">useCache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2511"></span><span>      </span><span id="local-6989586621679403676"><span class="annot"><span class="annottext">evalTerm :: Term Symbol () -&gt; Cli r (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679403676"><span class="hs-identifier hs-var hs-var">evalTerm</span></a></span></span><span> </span><span id="local-6989586621679403675"><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679403675"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2512"></span><span>        </span><span class="annot"><span class="annottext">(Either (Pretty ColorText) (Term Symbol ())
 -&gt; Maybe (Term Symbol ()))
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol ()))
-&gt; Cli r (Maybe (Term Symbol ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Either (Pretty ColorText) (Term Symbol ())
-&gt; Maybe (Term Symbol ())
forall a b. Either a b -&gt; Maybe b
</span><span class="hs-identifier hs-var">ErrorUtil.hush</span></span><span> </span><span class="annot"><span class="annottext">(Cli r (Either (Pretty ColorText) (Term Symbol ()))
 -&gt; Cli r (Maybe (Term Symbol ())))
-&gt; (Cli r (Either (Pretty ColorText) (Term Symbol Ann))
    -&gt; Cli r (Either (Pretty ColorText) (Term Symbol ())))
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
-&gt; Cli r (Maybe (Term Symbol ()))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Either (Pretty ColorText) (Term Symbol Ann)
 -&gt; Either (Pretty ColorText) (Term Symbol ()))
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term Symbol Ann -&gt; Term Symbol ())
-&gt; Either (Pretty ColorText) (Term Symbol Ann)
-&gt; Either (Pretty ColorText) (Term Symbol ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Term Symbol ()
forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cli r (Either (Pretty ColorText) (Term Symbol Ann))
 -&gt; Cli r (Maybe (Term Symbol ())))
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
-&gt; Cli r (Maybe (Term Symbol ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2513"></span><span>          </span><span class="annot"><span class="annottext">Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
forall r.
Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTermE"><span class="hs-identifier hs-var">evalUnisonTermE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403685"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679403677"><span class="hs-identifier hs-var">useCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term Symbol () -&gt; Term Symbol Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; () -&gt; Ann
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">External</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679403675"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2514"></span><span>      </span><span id="local-6989586621679403672"><span class="annot"><span class="annottext">loadTerm :: Reference -&gt; IO (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679403672"><span class="hs-identifier hs-var hs-var">loadTerm</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679403671"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403671"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; Map Id (Term Symbol Ann, Type Symbol Ann)
-&gt; Maybe (Term Symbol Ann, Type Symbol Ann)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403671"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id (Term Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679403684"><span class="hs-identifier hs-var">tms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2515"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Term Symbol Ann, Type Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe (Term Symbol Ann) -&gt; Maybe (Term Symbol ()))
-&gt; IO (Maybe (Term Symbol Ann)) -&gt; IO (Maybe (Term Symbol ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term Symbol Ann -&gt; Term Symbol ())
-&gt; Maybe (Term Symbol Ann) -&gt; Maybe (Term Symbol ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Term Symbol ()
forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Term Symbol Ann)) -&gt; IO (Maybe (Term Symbol ())))
-&gt; IO (Maybe (Term Symbol Ann)) -&gt; IO (Maybe (Term Symbol ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Term Symbol Ann)) -&gt; IO (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Id -&gt; IO (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Term v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403687"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403671"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2516"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403670"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403670"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Term Symbol ()) -&gt; IO (Maybe (Term Symbol ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term Symbol () -&gt; Maybe (Term Symbol ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Term Symbol () -&gt; Maybe (Term Symbol ()))
-&gt; Term Symbol () -&gt; Maybe (Term Symbol ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Term Symbol ()
forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403670"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2517"></span><span>      </span><span class="annot"><a href="#local-6989586621679403672"><span class="hs-identifier hs-var">loadTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Term Symbol ()) -&gt; IO (Maybe (Term Symbol ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Term Symbol ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2518"></span><span>      </span><span id="local-6989586621679403669"><span class="annot"><span class="annottext">loadDecl :: Reference -&gt; Cli r (Maybe (Decl Symbol ()))
</span><a href="#local-6989586621679403669"><span class="hs-identifier hs-var hs-var">loadDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679403668"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403668"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id (Decl Symbol Ann) -&gt; Maybe (Decl Symbol Ann)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403668"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id (Decl Symbol Ann)
</span><a href="#local-6989586621679403683"><span class="hs-identifier hs-var">typs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2519"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe (Decl Symbol Ann) -&gt; Maybe (Decl Symbol ()))
-&gt; Cli r (Maybe (Decl Symbol Ann))
-&gt; Cli r (Maybe (Decl Symbol ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Decl Symbol Ann -&gt; Decl Symbol ())
-&gt; Maybe (Decl Symbol Ann) -&gt; Maybe (Decl Symbol ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">((Decl Symbol Ann -&gt; Decl Symbol ())
 -&gt; Maybe (Decl Symbol Ann) -&gt; Maybe (Decl Symbol ()))
-&gt; (Decl Symbol Ann -&gt; Decl Symbol ())
-&gt; Maybe (Decl Symbol Ann)
-&gt; Maybe (Decl Symbol ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Ann -&gt; ()) -&gt; Decl Symbol Ann -&gt; Decl Symbol ()
forall a a2 v. (a -&gt; a2) -&gt; Decl v a -&gt; Decl v a2
</span><span class="hs-identifier hs-var">DD.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Ann -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Cli r (Maybe (Decl Symbol Ann)) -&gt; Cli r (Maybe (Decl Symbol ())))
-&gt; Cli r (Maybe (Decl Symbol Ann))
-&gt; Cli r (Maybe (Decl Symbol ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Decl Symbol Ann)) -&gt; Cli r (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Id -&gt; IO (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403687"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403668"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2520"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403666"><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679403666"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl Symbol ()) -&gt; Cli r (Maybe (Decl Symbol ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decl Symbol () -&gt; Maybe (Decl Symbol ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Decl Symbol () -&gt; Maybe (Decl Symbol ()))
-&gt; Decl Symbol () -&gt; Maybe (Decl Symbol ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Ann -&gt; ()) -&gt; Decl Symbol Ann -&gt; Decl Symbol ()
forall a a2 v. (a -&gt; a2) -&gt; Decl v a -&gt; Decl v a2
</span><span class="hs-identifier hs-var">DD.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Ann -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann
</span><a href="#local-6989586621679403666"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2521"></span><span>      </span><span class="annot"><a href="#local-6989586621679403669"><span class="hs-identifier hs-var">loadDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl Symbol ()) -&gt; Cli r (Maybe (Decl Symbol ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Decl Symbol ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2522"></span><span>      </span><span id="local-6989586621679403665"><span class="annot"><span class="annottext">loadTypeOfTerm' :: Referent -&gt; IO (Maybe (Term F Symbol ()))
</span><a href="#local-6989586621679403665"><span class="hs-identifier hs-var hs-var">loadTypeOfTerm'</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679403664"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403664"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2523"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403663"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403663"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id
-&gt; Map Id (Term Symbol Ann, Type Symbol Ann)
-&gt; Maybe (Term Symbol Ann, Type Symbol Ann)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403664"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id (Term Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679403684"><span class="hs-identifier hs-var">tms</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Term F Symbol ()) -&gt; IO (Maybe (Term F Symbol ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Term F Symbol ()) -&gt; IO (Maybe (Term F Symbol ())))
-&gt; Maybe (Term F Symbol ()) -&gt; IO (Maybe (Term F Symbol ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Term F Symbol () -&gt; Maybe (Term F Symbol ())
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Term F Symbol ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403663"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2524"></span><span>      </span><span class="annot"><a href="#local-6989586621679403665"><span class="hs-identifier hs-var">loadTypeOfTerm'</span></a></span><span> </span><span id="local-6989586621679403662"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403662"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann) -&gt; Maybe (Term F Symbol ()))
-&gt; IO (Maybe (Type Symbol Ann)) -&gt; IO (Maybe (Term F Symbol ()))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type Symbol Ann -&gt; Term F Symbol ())
-&gt; Maybe (Type Symbol Ann) -&gt; Maybe (Term F Symbol ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Term F Symbol ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Type Symbol Ann)) -&gt; IO (Maybe (Term F Symbol ())))
-&gt; (Referent -&gt; IO (Maybe (Type Symbol Ann)))
-&gt; Referent
-&gt; IO (Maybe (Term F Symbol ()))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Referent -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *).
Monad m =&gt;
Codebase m Symbol Ann -&gt; Referent -&gt; m (Maybe (Type Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeOfTerm"><span class="hs-identifier hs-var">loadTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403687"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; IO (Maybe (Term F Symbol ())))
-&gt; Referent -&gt; IO (Maybe (Term F Symbol ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403662"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2525"></span><span>  </span><span id="local-6989586621679403661"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679403661"><span class="hs-identifier hs-var">rendered</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
-&gt; (Reference -&gt; Cli r (Maybe (Term Symbol ())))
-&gt; (Referent -&gt; Cli r (Maybe (Term F Symbol ())))
-&gt; (Term Symbol () -&gt; Cli r (Maybe (Term Symbol ())))
-&gt; (Reference -&gt; Cli r (Maybe (Decl Symbol ())))
-&gt; Term Symbol ()
-&gt; Cli r (Pretty ColorText)
forall (m :: * -&gt; *).
Monad m =&gt;
PrettyPrintEnvDecl
-&gt; (Reference -&gt; m (Maybe (Term Symbol ())))
-&gt; (Referent -&gt; m (Maybe (Term F Symbol ())))
-&gt; (Term Symbol () -&gt; m (Maybe (Term Symbol ())))
-&gt; (Reference -&gt; m (Maybe (Decl Symbol ())))
-&gt; Term Symbol ()
-&gt; m (Pretty ColorText)
</span><a href="Unison.CommandLine.DisplayValues.html#displayTerm"><span class="hs-identifier hs-var">DisplayValues.displayTerm</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403685"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe (Term Symbol ())) -&gt; Cli r (Maybe (Term Symbol ()))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Term Symbol ())) -&gt; Cli r (Maybe (Term Symbol ())))
-&gt; (Reference -&gt; IO (Maybe (Term Symbol ())))
-&gt; Reference
-&gt; Cli r (Maybe (Term Symbol ()))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; IO (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679403672"><span class="hs-identifier hs-var">loadTerm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe (Term F Symbol ())) -&gt; Cli r (Maybe (Term F Symbol ()))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Term F Symbol ())) -&gt; Cli r (Maybe (Term F Symbol ())))
-&gt; (Referent -&gt; IO (Maybe (Term F Symbol ())))
-&gt; Referent
-&gt; Cli r (Maybe (Term F Symbol ()))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; IO (Maybe (Term F Symbol ()))
</span><a href="#local-6989586621679403665"><span class="hs-identifier hs-var">loadTypeOfTerm'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term Symbol () -&gt; Cli r (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679403676"><span class="hs-identifier hs-var">evalTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Cli r (Maybe (Decl Symbol ()))
</span><a href="#local-6989586621679403669"><span class="hs-identifier hs-var">loadDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679403688"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-2526"></span><span>  </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Pretty ColorText -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#DisplayRendered"><span class="hs-identifier hs-var">DisplayRendered</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621679403680"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679403661"><span class="hs-identifier hs-var">rendered</span></a></span><span>
</span><span id="line-2527"></span><span>
</span><span id="line-2528"></span><span id="local-6989586621679406860"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#getLinks"><span class="hs-identifier hs-type">getLinks</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2529"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#SrcLoc"><span class="hs-identifier hs-type">SrcLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2530"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2531"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2532"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span>
</span><span id="line-2533"></span><span>    </span><span class="annot"><a href="#local-6989586621679406860"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-2534"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span class="hs-special">,</span><span>
</span><span id="line-2535"></span><span>      </span><span class="hs-comment">--  e.g. (&quot;Foo.doc&quot;, #foodoc, Just (#builtin.Doc)</span><span>
</span><span id="line-2536"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2537"></span><span>    </span><span class="hs-special">)</span></span><span>
</span><span id="line-2538"></span><span id="getLinks"><span class="annot"><span class="annottext">getLinks :: String
-&gt; HQSplit'
-&gt; Either (Set Reference) (Maybe String)
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
</span><a href="Unison.Codebase.Editor.HandleInput.html#getLinks"><span class="hs-identifier hs-var hs-var">getLinks</span></a></span></span><span> </span><span id="local-6989586621679403657"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403657"><span class="hs-identifier hs-var">srcLoc</span></a></span></span><span> </span><span id="local-6989586621679403656"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679403656"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2539"></span><span>  </span><span class="annot"><span class="annottext">HQSplit'
-&gt; Maybe (Set Reference)
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
forall r.
HQSplit'
-&gt; Maybe (Set Reference)
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
</span><a href="Unison.Codebase.Editor.HandleInput.html#getLinks%27"><span class="hs-identifier hs-var">getLinks'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679403656"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Set Reference)
 -&gt; Cli
      r
      (PrettyPrintEnv,
       [(HashQualified Name, Reference, Maybe (Type Symbol Ann))]))
-&gt; (Either (Set Reference) (Maybe String)
    -&gt; Cli r (Maybe (Set Reference)))
-&gt; Either (Set Reference) (Maybe String)
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2540"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679403653"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403653"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Set Reference) -&gt; Cli r (Maybe (Set Reference))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe (Set Reference)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403653"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2541"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Set Reference) -&gt; Cli r (Maybe (Set Reference))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Set Reference)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-2542"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403652"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403652"><span class="hs-identifier hs-var">mdTypeStr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2543"></span><span>      </span><span id="local-6989586621679403651"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403651"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Cli r (Type Symbol Ann)
forall r. String -&gt; String -&gt; Cli r (Type Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#parseType"><span class="hs-identifier hs-var">parseType</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403657"><span class="hs-identifier hs-var">srcLoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403652"><span class="hs-identifier hs-var">mdTypeStr</span></a></span><span>
</span><span id="line-2544"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Maybe (Set Reference)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Set Reference
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Reference
forall v a. Var v =&gt; Type v a -&gt; Reference
</span><span class="hs-identifier hs-var">Hashing.typeToReference</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403651"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2545"></span><span>
</span><span id="line-2546"></span><span id="local-6989586621679406251"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#getLinks%27"><span class="hs-identifier hs-type">getLinks'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2547"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- definition to print metadata of</span><span>
</span><span id="line-2548"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- return all metadata if empty</span><span>
</span><span id="line-2549"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span>
</span><span id="line-2550"></span><span>    </span><span class="annot"><a href="#local-6989586621679406251"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-2551"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span class="hs-special">,</span><span>
</span><span id="line-2552"></span><span>      </span><span class="hs-comment">--  e.g. (&quot;Foo.doc&quot;, #foodoc, Just (#builtin.Doc)</span><span>
</span><span id="line-2553"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2554"></span><span>    </span><span class="hs-special">)</span></span><span>
</span><span id="line-2555"></span><span id="getLinks%27"><span class="annot"><span class="annottext">getLinks' :: HQSplit'
-&gt; Maybe (Set Reference)
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
</span><a href="Unison.Codebase.Editor.HandleInput.html#getLinks%27"><span class="hs-identifier hs-var hs-var">getLinks'</span></a></span></span><span> </span><span id="local-6989586621679403649"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679403649"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621679403648"><span class="annot"><span class="annottext">Maybe (Set Reference)
</span><a href="#local-6989586621679403648"><span class="hs-identifier hs-var">selection0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2556"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403647"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403647"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2557"></span><span>  </span><span id="local-6989586621679403646"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403646"><span class="hs-identifier hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-2558"></span><span>  </span><span id="local-6989586621679403645"><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679403645"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Absolute, HQSegment) -&gt; HQSplit
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Path.convert</span></span><span> </span><span class="annot"><span class="annottext">((Absolute, HQSegment) -&gt; HQSplit)
-&gt; Cli r (Absolute, HQSegment) -&gt; Cli r HQSplit
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; Cli r (Absolute, HQSegment)
forall a r. (Path', a) -&gt; Cli r (Absolute, a)
</span><a href="Unison.Cli.MonadUtils.html#resolveSplit%27"><span class="hs-identifier hs-var">Cli.resolveSplit'</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679403649"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-comment">-- ex: the (parent,hqsegment) of `List.map` - `List`</span><span>
</span><span id="line-2559"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- all metadata (type+value) associated with name `src`</span><span>
</span><span id="line-2560"></span><span>      </span><span id="local-6989586621679403644"><span class="annot"><span class="annottext">allMd :: Relation Reference Reference
</span><a href="#local-6989586621679403644"><span class="hs-identifier hs-var hs-var">allMd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2561"></span><span>        </span><span class="annot"><span class="annottext">Relation4 Referent NameSegment Reference Reference
-&gt; Relation Reference Reference
forall c d a b. (Ord c, Ord d) =&gt; Relation4 a b c d -&gt; Relation c d
</span><span class="hs-identifier hs-var">R4.d34</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit
-&gt; Branch0 IO -&gt; Relation4 Referent NameSegment Reference Reference
forall (m :: * -&gt; *).
HQSplit
-&gt; Branch0 m -&gt; Relation4 Referent NameSegment Reference Reference
</span><span class="hs-identifier hs-var">BranchUtil.getTermMetadataHQNamed</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679403645"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403646"><span class="hs-identifier hs-var">root0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2562"></span><span>          </span><span class="annot"><span class="annottext">Relation Reference Reference
-&gt; Relation Reference Reference -&gt; Relation Reference Reference
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Relation4 Reference NameSegment Reference Reference
-&gt; Relation Reference Reference
forall c d a b. (Ord c, Ord d) =&gt; Relation4 a b c d -&gt; Relation c d
</span><span class="hs-identifier hs-var">R4.d34</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HQSplit
-&gt; Branch0 IO
-&gt; Relation4 Reference NameSegment Reference Reference
forall (m :: * -&gt; *).
HQSplit
-&gt; Branch0 m -&gt; Relation4 Reference NameSegment Reference Reference
</span><span class="hs-identifier hs-var">BranchUtil.getTypeMetadataHQNamed</span></span><span> </span><span class="annot"><span class="annottext">HQSplit
</span><a href="#local-6989586621679403645"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403646"><span class="hs-identifier hs-var">root0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2563"></span><span>      </span><span id="local-6989586621679403640"><span class="annot"><span class="annottext">allMd' :: Relation Reference Reference
</span><a href="#local-6989586621679403640"><span class="hs-identifier hs-var hs-var">allMd'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Relation Reference Reference
-&gt; (Set Reference -&gt; Relation Reference Reference)
-&gt; Maybe (Set Reference)
-&gt; Relation Reference Reference
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Relation Reference Reference
</span><a href="#local-6989586621679403644"><span class="hs-identifier hs-var">allMd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference
-&gt; Relation Reference Reference -&gt; Relation Reference Reference
forall a b. (Ord a, Ord b) =&gt; Set a -&gt; Relation a b -&gt; Relation a b
</span><span class="hs-operator hs-var">`R.restrictDom`</span></span><span> </span><span class="annot"><span class="annottext">Relation Reference Reference
</span><a href="#local-6989586621679403644"><span class="hs-identifier hs-var">allMd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Set Reference)
</span><a href="#local-6989586621679403648"><span class="hs-identifier hs-var">selection0</span></a></span><span>
</span><span id="line-2564"></span><span>      </span><span class="hs-comment">-- then list the values after filtering by type</span><span>
</span><span id="line-2565"></span><span>      </span><span id="local-6989586621679403638"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403638"><span class="hs-identifier hs-var">allRefs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Relation Reference Reference -&gt; Set Reference
forall a b. Relation a b -&gt; Set b
</span><span class="hs-identifier hs-var">R.ran</span></span><span> </span><span class="annot"><span class="annottext">Relation Reference Reference
</span><a href="#local-6989586621679403640"><span class="hs-identifier hs-var">allMd'</span></a></span><span>
</span><span id="line-2566"></span><span>  </span><span id="local-6989586621679403636"><span class="annot"><span class="annottext">[Maybe (Type Symbol Ann)]
</span><a href="#local-6989586621679403636"><span class="hs-identifier hs-var">sigs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Reference]
-&gt; (Reference -&gt; Cli r (Maybe (Type Symbol Ann)))
-&gt; Cli r [Maybe (Type Symbol Ann)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403638"><span class="hs-identifier hs-var">allRefs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann)))
-&gt; (Reference -&gt; IO (Maybe (Type Symbol Ann)))
-&gt; Reference
-&gt; Cli r (Maybe (Type Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Referent -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *).
Monad m =&gt;
Codebase m Symbol Ann -&gt; Referent -&gt; m (Maybe (Type Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeOfTerm"><span class="hs-identifier hs-var">loadTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403647"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">(Referent -&gt; IO (Maybe (Type Symbol Ann)))
-&gt; (Reference -&gt; Referent)
-&gt; Reference
-&gt; IO (Maybe (Type Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span class="hs-special">)</span><span>
</span><span id="line-2567"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403635"><span class="annot"><span class="annottext">deps :: Set LabeledDependency
</span><a href="#local-6989586621679403635"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2568"></span><span>        </span><span class="annot"><span class="annottext">(Reference -&gt; LabeledDependency)
-&gt; Set Reference -&gt; Set LabeledDependency
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.termRef</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403638"><span class="hs-identifier hs-var">allRefs</span></a></span><span>
</span><span id="line-2569"></span><span>          </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Set LabeledDependency] -&gt; Set LabeledDependency
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">Set.unions</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Reference -&gt; LabeledDependency)
-&gt; Set Reference -&gt; Set LabeledDependency
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.typeRef</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Set LabeledDependency)
-&gt; (Type Symbol Ann -&gt; Set Reference)
-&gt; Type Symbol Ann
-&gt; Set LabeledDependency
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Set Reference
forall v a. Ord v =&gt; Type v a -&gt; Set Reference
</span><span class="hs-identifier hs-var">Type.dependencies</span></span><span> </span><span class="annot"><span class="annottext">(Type Symbol Ann -&gt; Set LabeledDependency)
-&gt; Type Symbol Ann -&gt; Set LabeledDependency
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403632"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403632"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403632"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Maybe (Type Symbol Ann)]
</span><a href="#local-6989586621679403636"><span class="hs-identifier hs-var">sigs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2570"></span><span>  </span><span id="local-6989586621679403631"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403631"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl)
-&gt; Cli r NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Cli r NamesWithHistory
forall r. Set LabeledDependency -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makePrintNamesFromLabeled%27"><span class="hs-identifier hs-var">makePrintNamesFromLabeled'</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403635"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-2571"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403630"><span class="annot"><span class="annottext">ppeDecl :: PrettyPrintEnv
</span><a href="#local-6989586621679403630"><span class="hs-identifier hs-var hs-var">ppeDecl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.unsuffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403631"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-2572"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403629"><span class="annot"><span class="annottext">sortedSigs :: [(Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403629"><span class="hs-identifier hs-var hs-var">sortedSigs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Reference, Maybe (Type Symbol Ann)) -&gt; Maybe (Type Symbol Ann))
-&gt; [(Reference, Maybe (Type Symbol Ann))]
-&gt; [(Reference, Maybe (Type Symbol Ann))]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="annot"><span class="annottext">(Reference, Maybe (Type Symbol Ann)) -&gt; Maybe (Type Symbol Ann)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403638"><span class="hs-identifier hs-var">allRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[Reference]
-&gt; [Maybe (Type Symbol Ann)]
-&gt; [(Reference, Maybe (Type Symbol Ann))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-operator hs-var">`zip`</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Type Symbol Ann)]
</span><a href="#local-6989586621679403636"><span class="hs-identifier hs-var">sigs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2573"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403628"><span class="annot"><span class="annottext">out :: [(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403628"><span class="hs-identifier hs-var hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv -&gt; Referent -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">PPE.termName</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403630"><span class="hs-identifier hs-var">ppeDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403626"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403626"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679403625"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403626"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403626"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403625"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679403625"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403629"><span class="hs-identifier hs-var">sortedSigs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2574"></span><span>  </span><span class="annot"><span class="annottext">(PrettyPrintEnv,
 [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403631"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403628"><span class="hs-identifier hs-var">out</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2575"></span><span>
</span><span id="line-2576"></span><span class="hs-comment">-- Returns True if the operation changed the namespace, False otherwise.</span><span>
</span><span id="line-2577"></span><span id="local-6989586621679406320"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#propagatePatchNoSync"><span class="hs-identifier hs-type">propagatePatchNoSync</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2578"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Patch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2579"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2580"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406320"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2581"></span><span id="propagatePatchNoSync"><span class="annot"><span class="annottext">propagatePatchNoSync :: Patch -&gt; Absolute -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#propagatePatchNoSync"><span class="hs-identifier hs-var hs-var">propagatePatchNoSync</span></a></span></span><span> </span><span id="local-6989586621679403624"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403624"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span id="local-6989586621679403623"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403623"><span class="hs-identifier hs-var">scopePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2582"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Cli r Bool -&gt; Cli r Bool
forall r a. String -&gt; Cli r a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#time"><span class="hs-identifier hs-var">Cli.time</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;propagatePatch&quot;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2583"></span><span>    </span><span class="annot"><span class="annottext">(Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
forall r. (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAtNoSync%27"><span class="hs-identifier hs-var">stepAtNoSync'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403623"><span class="hs-identifier hs-var">scopePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Patch -&gt; Branch0 IO -&gt; Cli r (Branch0 IO)
forall r. Patch -&gt; Branch0 IO -&gt; Cli r (Branch0 IO)
</span><a href="Unison.Codebase.Editor.Propagate.html#propagateAndApply"><span class="hs-identifier hs-var">Propagate.propagateAndApply</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403624"><span class="hs-identifier hs-var">patch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2584"></span><span>
</span><span id="line-2585"></span><span class="hs-comment">-- Returns True if the operation changed the namespace, False otherwise.</span><span>
</span><span id="line-2586"></span><span id="local-6989586621679407090"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#propagatePatch"><span class="hs-identifier hs-type">propagatePatch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2587"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2588"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Patch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2589"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2590"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407090"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2591"></span><span id="propagatePatch"><span class="annot"><span class="annottext">propagatePatch :: Text -&gt; Patch -&gt; Absolute -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#propagatePatch"><span class="hs-identifier hs-var hs-var">propagatePatch</span></a></span></span><span> </span><span id="local-6989586621679403620"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403620"><span class="hs-identifier hs-var">inputDescription</span></a></span></span><span> </span><span id="local-6989586621679403619"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403619"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span id="local-6989586621679403618"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403618"><span class="hs-identifier hs-var">scopePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2592"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Cli r Bool -&gt; Cli r Bool
forall r a. String -&gt; Cli r a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#time"><span class="hs-identifier hs-var">Cli.time</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;propagatePatch&quot;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2593"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
forall r.
Text -&gt; (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt%27"><span class="hs-identifier hs-var">stepAt'</span></a></span><span>
</span><span id="line-2594"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403620"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; (applying patch)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2595"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403618"><span class="hs-identifier hs-var">scopePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Patch -&gt; Branch0 IO -&gt; Cli r (Branch0 IO)
forall r. Patch -&gt; Branch0 IO -&gt; Cli r (Branch0 IO)
</span><a href="Unison.Codebase.Editor.Propagate.html#propagateAndApply"><span class="hs-identifier hs-var">Propagate.propagateAndApply</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403619"><span class="hs-identifier hs-var">patch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2596"></span><span>
</span><span id="line-2597"></span><span class="hs-comment">-- | Create the args needed for showTodoOutput and call it</span><span>
</span><span id="line-2598"></span><span id="local-6989586621679406755"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#doShowTodoOutput"><span class="hs-identifier hs-type">doShowTodoOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Patch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406755"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2599"></span><span id="doShowTodoOutput"><span class="annot"><span class="annottext">doShowTodoOutput :: Patch -&gt; Absolute -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#doShowTodoOutput"><span class="hs-identifier hs-var hs-var">doShowTodoOutput</span></a></span></span><span> </span><span id="local-6989586621679403616"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403616"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span id="local-6989586621679403615"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403615"><span class="hs-identifier hs-var">scopePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2600"></span><span>  </span><span id="local-6989586621679403614"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403614"><span class="hs-identifier hs-var">names0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 IO -&gt; Names) -&gt; Cli r (Branch0 IO) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch0 IO)
forall r. Absolute -&gt; Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranch0At"><span class="hs-identifier hs-var">Cli.getBranch0At</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403615"><span class="hs-identifier hs-var">scopePath</span></a></span><span>
</span><span id="line-2601"></span><span>  </span><span class="hs-comment">-- only needs the local references to check for obsolete defs</span><span>
</span><span id="line-2602"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403613"><span class="annot"><span class="annottext">getPpe :: Cli r PrettyPrintEnvDecl
</span><a href="#local-6989586621679403613"><span class="hs-identifier hs-var hs-var">getPpe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2603"></span><span>        </span><span id="local-6989586621679403612"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403612"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Cli r NamesWithHistory
forall r. Set LabeledDependency -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makePrintNamesFromLabeled%27"><span class="hs-identifier hs-var">makePrintNamesFromLabeled'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Patch -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Patch.labeledDependencies</span></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403616"><span class="hs-identifier hs-var">patch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2604"></span><span>        </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403612"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-2605"></span><span>  </span><span class="annot"><span class="annottext">Cli r PrettyPrintEnvDecl -&gt; Patch -&gt; Names -&gt; Cli r ()
forall r. Cli r PrettyPrintEnvDecl -&gt; Patch -&gt; Names -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#showTodoOutput"><span class="hs-identifier hs-var">showTodoOutput</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r PrettyPrintEnvDecl
</span><a href="#local-6989586621679403613"><span class="hs-identifier hs-var">getPpe</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403616"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403614"><span class="hs-identifier hs-var">names0</span></a></span><span>
</span><span id="line-2606"></span><span>
</span><span id="line-2607"></span><span class="hs-comment">-- | Show todo output if there are any conflicts or edits.</span><span>
</span><span id="line-2608"></span><span id="local-6989586621679406227"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#showTodoOutput"><span class="hs-identifier hs-type">showTodoOutput</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2609"></span><span>  </span><span class="hs-comment">-- | Action that fetches the pretty print env. It's expensive because it</span><span>
</span><span id="line-2610"></span><span>  </span><span class="hs-comment">-- involves looking up historical names, so only call it if necessary.</span><span>
</span><span id="line-2611"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406227"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnvDecl</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2612"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Patch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2613"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2614"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406227"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2615"></span><span id="showTodoOutput"><span class="annot"><span class="annottext">showTodoOutput :: Cli r PrettyPrintEnvDecl -&gt; Patch -&gt; Names -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#showTodoOutput"><span class="hs-identifier hs-var hs-var">showTodoOutput</span></a></span></span><span> </span><span id="local-6989586621679403610"><span class="annot"><span class="annottext">Cli r PrettyPrintEnvDecl
</span><a href="#local-6989586621679403610"><span class="hs-identifier hs-var">getPpe</span></a></span></span><span> </span><span id="local-6989586621679403609"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403609"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span id="local-6989586621679403608"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403608"><span class="hs-identifier hs-var">names0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2616"></span><span>  </span><span id="local-6989586621679403607"><span class="annot"><span class="annottext">TodoOutput Symbol Ann
</span><a href="#local-6989586621679403607"><span class="hs-identifier hs-var">todo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Patch -&gt; Names -&gt; Cli r (TodoOutput Symbol Ann)
forall r. Patch -&gt; Names -&gt; Cli r (TodoOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#checkTodo"><span class="hs-identifier hs-var">checkTodo</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403609"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403608"><span class="hs-identifier hs-var">names0</span></a></span><span>
</span><span id="line-2617"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TodoOutput Symbol Ann -&gt; Bool
forall v a. TodoOutput v a -&gt; Bool
</span><a href="Unison.Codebase.Editor.TodoOutput.html#noConflicts"><span class="hs-identifier hs-var">TO.noConflicts</span></a></span><span> </span><span class="annot"><span class="annottext">TodoOutput Symbol Ann
</span><a href="#local-6989586621679403607"><span class="hs-identifier hs-var">todo</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TodoOutput Symbol Ann -&gt; Bool
forall v a. TodoOutput v a -&gt; Bool
</span><a href="Unison.Codebase.Editor.TodoOutput.html#noEdits"><span class="hs-identifier hs-var">TO.noEdits</span></a></span><span> </span><span class="annot"><span class="annottext">TodoOutput Symbol Ann
</span><a href="#local-6989586621679403607"><span class="hs-identifier hs-var">todo</span></a></span><span>
</span><span id="line-2618"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#NoConflictsOrEdits"><span class="hs-identifier hs-var">NoConflictsOrEdits</span></a></span><span>
</span><span id="line-2619"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
      #numberedArgs
</span><span>        </span><span class="hs-operator">.=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">Text.unpack</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">Reference.toText</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">view</span><span> </span><span class="hs-identifier">_2</span><span>
</span><span id="line-2622"></span><span>               </span><span class="hs-operator">&lt;$&gt;</span><span> </span><span class="hs-identifier">fst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">TO.todoFrontierDependents</span><span> </span><span class="hs-identifier">todo</span><span class="hs-special">)</span><span>
</span><span id="line-2623"></span><span>           </span><span class="hs-special">)</span><span>
</span><span id="line-2624"></span><span>      </span><span class="hs-identifier">ppe</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">getPpe</span><span>
</span><span id="line-2625"></span><span>      </span><span class="hs-identifier">Cli.respondNumbered</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">TodoOutput</span><span> </span><span class="hs-identifier">ppe</span><span> </span><span class="hs-identifier">todo</span><span>
</span><span id="line-2626"></span><span>
</span><span id="line-2627"></span><span id="local-6989586621679406224"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#checkTodo"><span class="hs-identifier hs-type">checkTodo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Patch</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406224"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Unison.Codebase.Editor.TodoOutput.html#TodoOutput"><span class="hs-identifier hs-type">TO.TodoOutput</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2628"></span><span id="checkTodo"><span class="annot"><span class="annottext">checkTodo :: Patch -&gt; Names -&gt; Cli r (TodoOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#checkTodo"><span class="hs-identifier hs-var hs-var">checkTodo</span></a></span></span><span> </span><span id="local-6989586621679403598"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403598"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span id="local-6989586621679403597"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403597"><span class="hs-identifier hs-var">names0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2629"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403596"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403596"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2630"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403595"><span class="annot"><span class="annottext">shouldUpdate :: Reference -&gt; Bool
</span><a href="#local-6989586621679403595"><span class="hs-identifier hs-var hs-var">shouldUpdate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Reference -&gt; Bool
</span><span class="hs-identifier hs-var">Names.contains</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403597"><span class="hs-identifier hs-var">names0</span></a></span><span>
</span><span id="line-2631"></span><span>  </span><span id="local-6989586621679403593"><span class="annot"><span class="annottext">Relation Reference Reference
</span><a href="#local-6989586621679403593"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Cli r (Set Reference))
-&gt; Patch
-&gt; (Reference -&gt; Bool)
-&gt; Cli r (Relation Reference Reference)
forall (m :: * -&gt; *).
Monad m =&gt;
(Reference -&gt; m (Set Reference))
-&gt; Patch -&gt; (Reference -&gt; Bool) -&gt; m (Relation Reference Reference)
</span><a href="Unison.Codebase.Editor.Propagate.html#computeFrontier"><span class="hs-identifier hs-var">Propagate.computeFrontier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; Cli r (Set Reference)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Reference) -&gt; Cli r (Set Reference))
-&gt; (Reference -&gt; IO (Set Reference))
-&gt; Reference
-&gt; Cli r (Set Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Functor m =&gt;
Codebase m v a -&gt; Reference -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Codebase.dependents</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403596"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403598"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Bool
</span><a href="#local-6989586621679403595"><span class="hs-identifier hs-var">shouldUpdate</span></a></span><span>
</span><span id="line-2632"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403591"><span class="annot"><span class="annottext">dirty :: Set Reference
</span><a href="#local-6989586621679403591"><span class="hs-identifier hs-var hs-var">dirty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Relation Reference Reference -&gt; Set Reference
forall a b. Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">R.dom</span></span><span> </span><span class="annot"><span class="annottext">Relation Reference Reference
</span><a href="#local-6989586621679403593"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-2633"></span><span>      </span><span id="local-6989586621679403590"><span class="annot"><span class="annottext">frontier :: Set Reference
</span><a href="#local-6989586621679403590"><span class="hs-identifier hs-var hs-var">frontier</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Relation Reference Reference -&gt; Set Reference
forall a b. Relation a b -&gt; Set b
</span><span class="hs-identifier hs-var">R.ran</span></span><span> </span><span class="annot"><span class="annottext">Relation Reference Reference
</span><a href="#local-6989586621679403593"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-2634"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679403589"><span class="annot"><span class="annottext">[(Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403589"><span class="hs-identifier hs-var">frontierTerms</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403588"><span class="annot"><span class="annottext">[(Reference, DisplayObject () (Decl Symbol Ann))]
</span><a href="#local-6989586621679403588"><span class="hs-identifier hs-var">frontierTypes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set Reference
-&gt; Cli
     r
     ([(Reference, Maybe (Type Symbol Ann))],
      [(Reference, DisplayObject () (Decl Symbol Ann))])
forall r.
Set Reference
-&gt; Cli
     r
     ([(Reference, Maybe (Type Symbol Ann))],
      [(Reference, DisplayObject () (Decl Symbol Ann))])
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadDisplayInfo"><span class="hs-identifier hs-var">loadDisplayInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403590"><span class="hs-identifier hs-var">frontier</span></a></span><span>
</span><span id="line-2635"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679403586"><span class="annot"><span class="annottext">[(Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403586"><span class="hs-identifier hs-var">dirtyTerms</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403585"><span class="annot"><span class="annottext">[(Reference, DisplayObject () (Decl Symbol Ann))]
</span><a href="#local-6989586621679403585"><span class="hs-identifier hs-var">dirtyTypes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set Reference
-&gt; Cli
     r
     ([(Reference, Maybe (Type Symbol Ann))],
      [(Reference, DisplayObject () (Decl Symbol Ann))])
forall r.
Set Reference
-&gt; Cli
     r
     ([(Reference, Maybe (Type Symbol Ann))],
      [(Reference, DisplayObject () (Decl Symbol Ann))])
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadDisplayInfo"><span class="hs-identifier hs-var">loadDisplayInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403591"><span class="hs-identifier hs-var">dirty</span></a></span><span>
</span><span id="line-2636"></span><span>  </span><span class="hs-comment">-- todo: something more intelligent here?</span><span>
</span><span id="line-2637"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403584"><span class="annot"><span class="annottext">scoreFn :: b -&gt; Int
</span><a href="#local-6989586621679403584"><span class="hs-identifier hs-var hs-var">scoreFn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; b -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-2638"></span><span>  </span><span id="local-6989586621679403583"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403583"><span class="hs-identifier hs-var">remainingTransitive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2639"></span><span>    </span><span class="annot"><span class="annottext">(Reference -&gt; Cli r (Set Reference))
-&gt; Names -&gt; Set Reference -&gt; Cli r (Set Reference)
forall (m :: * -&gt; *).
Monad m =&gt;
(Reference -&gt; m (Set Reference))
-&gt; Names -&gt; Set Reference -&gt; m (Set Reference)
</span><a href="#local-6989586621679403582"><span class="hs-identifier hs-var">frontierTransitiveDependents</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Set Reference) -&gt; Cli r (Set Reference)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set Reference) -&gt; Cli r (Set Reference))
-&gt; (Reference -&gt; IO (Set Reference))
-&gt; Reference
-&gt; Cli r (Set Reference)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Functor m =&gt;
Codebase m v a -&gt; Reference -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Codebase.dependents</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403596"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403597"><span class="hs-identifier hs-var">names0</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403590"><span class="hs-identifier hs-var">frontier</span></a></span><span>
</span><span id="line-2640"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403581"><span class="annot"><span class="annottext">scoredDirtyTerms :: [(Int, Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403581"><span class="hs-identifier hs-var hs-var">scoredDirtyTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2641"></span><span>        </span><span class="annot"><span class="annottext">((Int, Reference, Maybe (Type Symbol Ann)) -&gt; Int)
-&gt; [(Int, Reference, Maybe (Type Symbol Ann))]
-&gt; [(Int, Reference, Maybe (Type Symbol Ann))]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting Int (Int, Reference, Maybe (Type Symbol Ann)) Int
-&gt; (Int, Reference, Maybe (Type Symbol Ann)) -&gt; Int
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Int (Int, Reference, Maybe (Type Symbol Ann)) Int
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Int
forall b. b -&gt; Int
</span><a href="#local-6989586621679403584"><span class="hs-identifier hs-var">scoreFn</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403580"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403580"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679403579"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403580"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403580"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403579"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679403579"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403586"><span class="hs-identifier hs-var">dirtyTerms</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2642"></span><span>      </span><span id="local-6989586621679403578"><span class="annot"><span class="annottext">scoredDirtyTypes :: [(Int, Reference, DisplayObject () (Decl Symbol Ann))]
</span><a href="#local-6989586621679403578"><span class="hs-identifier hs-var hs-var">scoredDirtyTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2643"></span><span>        </span><span class="annot"><span class="annottext">((Int, Reference, DisplayObject () (Decl Symbol Ann)) -&gt; Int)
-&gt; [(Int, Reference, DisplayObject () (Decl Symbol Ann))]
-&gt; [(Int, Reference, DisplayObject () (Decl Symbol Ann))]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.sortOn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  Int (Int, Reference, DisplayObject () (Decl Symbol Ann)) Int
-&gt; (Int, Reference, DisplayObject () (Decl Symbol Ann)) -&gt; Int
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  Int (Int, Reference, DisplayObject () (Decl Symbol Ann)) Int
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Int
forall b. b -&gt; Int
</span><a href="#local-6989586621679403584"><span class="hs-identifier hs-var">scoreFn</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403577"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403577"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679403576"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403577"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403577"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403576"><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
</span><a href="#local-6989586621679403576"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Reference, DisplayObject () (Decl Symbol Ann))]
</span><a href="#local-6989586621679403585"><span class="hs-identifier hs-var">dirtyTypes</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2644"></span><span>  </span><span class="annot"><span class="annottext">TodoOutput Symbol Ann -&gt; Cli r (TodoOutput Symbol Ann)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TodoOutput Symbol Ann -&gt; Cli r (TodoOutput Symbol Ann))
-&gt; TodoOutput Symbol Ann -&gt; Cli r (TodoOutput Symbol Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2645"></span><span>    </span><span class="annot"><span class="annottext">Int
-&gt; ([(Reference, Maybe (Type Symbol Ann))],
    [(Reference, DisplayObject () (Decl Symbol Ann))])
-&gt; ([(Int, Reference, Maybe (Type Symbol Ann))],
    [(Int, Reference, DisplayObject () (Decl Symbol Ann))])
-&gt; Names
-&gt; Patch
-&gt; TodoOutput Symbol Ann
forall v a.
Int
-&gt; ([(Reference, Maybe (Type v a))],
    [(Reference, DisplayObject () (Decl v a))])
-&gt; ([(Int, Reference, Maybe (Type v a))],
    [(Int, Reference, DisplayObject () (Decl v a))])
-&gt; Names
-&gt; Patch
-&gt; TodoOutput v a
</span><a href="Unison.Codebase.Editor.TodoOutput.html#TodoOutput"><span class="hs-identifier hs-var">TO.TodoOutput</span></a></span><span>
</span><span id="line-2646"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403583"><span class="hs-identifier hs-var">remainingTransitive</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2647"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403589"><span class="hs-identifier hs-var">frontierTerms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Reference, DisplayObject () (Decl Symbol Ann))]
</span><a href="#local-6989586621679403588"><span class="hs-identifier hs-var">frontierTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2648"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Int, Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403581"><span class="hs-identifier hs-var">scoredDirtyTerms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Int, Reference, DisplayObject () (Decl Symbol Ann))]
</span><a href="#local-6989586621679403578"><span class="hs-identifier hs-var">scoredDirtyTypes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2649"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.conflicts</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403597"><span class="hs-identifier hs-var">names0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2650"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Patch -&gt; Patch
</span><span class="hs-identifier hs-var">Patch.conflicts</span></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403598"><span class="hs-identifier hs-var">patch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2651"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2652"></span><span>    </span><span id="local-6989586621679406215"><span class="annot"><a href="#local-6989586621679403582"><span class="hs-identifier hs-type">frontierTransitiveDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2653"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679406215"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406215"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406215"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2654"></span><span>    </span><span id="local-6989586621679403582"><span class="annot"><span class="annottext">frontierTransitiveDependents :: (Reference -&gt; m (Set Reference))
-&gt; Names -&gt; Set Reference -&gt; m (Set Reference)
</span><a href="#local-6989586621679403582"><span class="hs-identifier hs-var hs-var">frontierTransitiveDependents</span></a></span></span><span> </span><span id="local-6989586621679403572"><span class="annot"><span class="annottext">Reference -&gt; m (Set Reference)
</span><a href="#local-6989586621679403572"><span class="hs-identifier hs-var">dependents</span></a></span></span><span> </span><span id="local-6989586621679403571"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403571"><span class="hs-identifier hs-var">names0</span></a></span></span><span> </span><span id="local-6989586621679403570"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403570"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2655"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403569"><span class="annot"><span class="annottext">branchDependents :: Reference -&gt; m (Set Reference)
</span><a href="#local-6989586621679403569"><span class="hs-identifier hs-var hs-var">branchDependents</span></a></span></span><span> </span><span id="local-6989586621679403568"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403568"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Bool) -&gt; Set Reference -&gt; Set Reference
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Reference -&gt; Bool
</span><span class="hs-identifier hs-var">Names.contains</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403571"><span class="hs-identifier hs-var">names0</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Set Reference)
-&gt; m (Set Reference) -&gt; m (Set Reference)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m (Set Reference)
</span><a href="#local-6989586621679403572"><span class="hs-identifier hs-var">dependents</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403568"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2656"></span><span>      </span><span id="local-6989586621679403566"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403566"><span class="hs-identifier hs-var">tdeps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; m (Set Reference))
-&gt; Set Reference -&gt; m (Set Reference)
forall (m :: * -&gt; *) a.
(Monad m, Ord a) =&gt;
(a -&gt; m (Set a)) -&gt; Set a -&gt; m (Set a)
</span><span class="hs-identifier hs-var">transitiveClosure</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; m (Set Reference)
</span><a href="#local-6989586621679403569"><span class="hs-identifier hs-var">branchDependents</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403570"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-2657"></span><span>      </span><span class="hs-comment">-- we don't want the frontier in the result</span><span>
</span><span id="line-2658"></span><span>      </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403566"><span class="hs-identifier hs-var">tdeps</span></a></span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; Set Reference -&gt; Set Reference
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403570"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-2659"></span><span>
</span><span id="line-2660"></span><span id="local-6989586621679406961"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#confirmedCommand"><span class="hs-identifier hs-type">confirmedCommand</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406961"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2661"></span><span id="confirmedCommand"><span class="annot"><span class="annottext">confirmedCommand :: Input -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#confirmedCommand"><span class="hs-identifier hs-var hs-var">confirmedCommand</span></a></span></span><span> </span><span id="local-6989586621679403565"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679403565"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2662"></span><span>  </span><span id="local-6989586621679403564"><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679403564"><span class="hs-identifier hs-var">loopState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r LoopState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">State.get</span></span><span>
</span><span id="line-2663"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Input -&gt; Maybe Input
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621679403565"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Input -&gt; Maybe Input -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679403564"><span class="hs-identifier hs-var">loopState</span></a></span><span> </span><span class="annot"><span class="annottext">LoopState
-&gt; Getting (Maybe Input) LoopState (Maybe Input) -&gt; Maybe Input
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;lastInput&quot; (Getting (Maybe Input) LoopState (Maybe Input))
Getting (Maybe Input) LoopState (Maybe Input)
</span><a href="#local-6989586621679403563"><span class="hs-var">#lastInput</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2664"></span><span>
</span><span id="line-2665"></span><span class="hs-comment">-- | restores the full hash to these search results, for _numberedArgs purposes</span><span>
</span><span id="line-2666"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#searchResultToHQString"><span class="hs-identifier hs-type">searchResultToHQString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-2667"></span><span id="searchResultToHQString"><span class="annot"><span class="annottext">searchResultToHQString :: SearchResult -&gt; String
</span><a href="Unison.Codebase.Editor.HandleInput.html#searchResultToHQString"><span class="hs-identifier hs-var hs-var">searchResultToHQString</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2668"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SR.Tm'</span></span><span> </span><span id="local-6989586621679403561"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403561"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679403560"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403560"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ.toString</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; String) -&gt; HashQualified Name -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Referent -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">HQ.requalify</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403561"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403560"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-2669"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">SR.Tp'</span></span><span> </span><span id="local-6989586621679403557"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403557"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679403556"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403556"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ.toString</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; String) -&gt; HashQualified Name -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Referent -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">HQ.requalify</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403557"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403556"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2670"></span><span>  </span><span class="annot"><span class="annottext">SearchResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;impossible match failure&quot;</span></span><span>
</span><span id="line-2671"></span><span>
</span><span id="line-2672"></span><span class="hs-comment">-- Return a list of definitions whose names fuzzy match the given queries.</span><span>
</span><span id="line-2673"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#fuzzyNameDistance"><span class="hs-identifier hs-type">fuzzyNameDistance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2674"></span><span id="fuzzyNameDistance"><span class="annot"><span class="annottext">fuzzyNameDistance :: Name -&gt; Name -&gt; Maybe Int
</span><a href="Unison.Codebase.Editor.HandleInput.html#fuzzyNameDistance"><span class="hs-identifier hs-var hs-var">fuzzyNameDistance</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">Name.toString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679403555"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403555"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">Name.toString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679403554"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403554"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2675"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Maybe Int
</span><span class="hs-identifier hs-var">Find.simpleFuzzyScore</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403555"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403554"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2676"></span><span>
</span><span id="line-2677"></span><span class="hs-comment">-- return `name` and `name.&lt;everything&gt;...`</span><span>
</span><span id="line-2678"></span><span id="local-6989586621679403552"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#_searchBranchPrefix"><span class="hs-identifier hs-type">_searchBranchPrefix</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><a href="#local-6989586621679403552"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">]</span></span><span>
</span><span id="line-2679"></span><span id="_searchBranchPrefix"><span class="annot"><span class="annottext">_searchBranchPrefix :: Branch m -&gt; Name -&gt; [SearchResult]
</span><a href="Unison.Codebase.Editor.HandleInput.html#_searchBranchPrefix"><span class="hs-identifier hs-var hs-var">_searchBranchPrefix</span></a></span></span><span> </span><span id="local-6989586621679403550"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679403550"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679403549"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403549"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Split
</span><span class="hs-identifier hs-var">Path.unsnoc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Path
</span><span class="hs-identifier hs-var">Path.fromName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403549"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2680"></span><span>  </span><span class="annot"><span class="annottext">Maybe Split
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2681"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403546"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403546"><span class="hs-identifier hs-var">init</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403545"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679403545"><span class="hs-identifier hs-var">last</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Branch m -&gt; Maybe (Branch m)
forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; Maybe (Branch m)
</span><span class="hs-identifier hs-var">Branch.getAt</span></span><span> </span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403546"><span class="hs-identifier hs-var">init</span></a></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679403550"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2682"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Branch m)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2683"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403543"><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679403543"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Names -&gt; [SearchResult]
</span><span class="hs-identifier hs-var">SR.fromNames</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; [SearchResult])
-&gt; (Names -&gt; Names) -&gt; Names -&gt; [SearchResult]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.prefix0</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403549"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; [SearchResult]) -&gt; Names -&gt; [SearchResult]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403542"><span class="hs-identifier hs-var">names0</span></a></span><span>
</span><span id="line-2684"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2685"></span><span>        </span><span id="local-6989586621679403541"><span class="annot"><span class="annottext">lastName :: Name
</span><a href="#local-6989586621679403541"><span class="hs-identifier hs-var hs-var">lastName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromSegment</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679403545"><span class="hs-identifier hs-var">last</span></a></span><span>
</span><span id="line-2686"></span><span>        </span><span id="local-6989586621679403539"><span class="annot"><span class="annottext">subnames :: Names
</span><a href="#local-6989586621679403539"><span class="hs-identifier hs-var hs-var">subnames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2687"></span><span>          </span><span class="annot"><span class="annottext">Branch0 m -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">(Branch0 m -&gt; Names)
-&gt; (Branch m -&gt; Branch0 m) -&gt; Branch m -&gt; Names
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">(Branch m -&gt; Names) -&gt; Branch m -&gt; Names
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-2688"></span><span>            </span><span class="annot"><span class="annottext">Path -&gt; Branch m -&gt; Branch m
forall (m :: * -&gt; *). Path -&gt; Branch m -&gt; Branch m
</span><span class="hs-identifier hs-var">Branch.getAt'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Path
</span><span class="hs-identifier hs-var">Path.singleton</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679403545"><span class="hs-identifier hs-var">last</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679403543"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-2689"></span><span>        </span><span id="local-6989586621679403536"><span class="annot"><span class="annottext">rootnames :: Names
</span><a href="#local-6989586621679403536"><span class="hs-identifier hs-var hs-var">rootnames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2690"></span><span>          </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403541"><span class="hs-identifier hs-var">lastName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2691"></span><span>            </span><span class="annot"><span class="annottext">(Names -&gt; Names) -&gt; (Branch0 m -&gt; Names) -&gt; Branch0 m -&gt; Names
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span>
</span><span id="line-2692"></span><span>            </span><span class="annot"><span class="annottext">(Branch0 m -&gt; Names)
-&gt; (Branch0 m -&gt; Branch0 m) -&gt; Branch0 m -&gt; Names
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Branch0 m)
  (Branch0 m)
  (Map NameSegment (Branch m))
  (Map NameSegment (Branch m))
-&gt; Map NameSegment (Branch m) -&gt; Branch0 m -&gt; Branch0 m
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  (Branch0 m)
  (Branch0 m)
  (Map NameSegment (Branch m))
  (Map NameSegment (Branch m))
forall (m :: * -&gt; *).
Lens' (Branch0 m) (Map NameSegment (Branch m))
</span><span class="hs-identifier hs-var">Branch.children</span></span><span> </span><span class="annot"><span class="annottext">Map NameSegment (Branch m)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2693"></span><span>            </span><span class="annot"><span class="annottext">(Branch0 m -&gt; Names) -&gt; Branch0 m -&gt; Names
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch m -&gt; Branch0 m
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch m
</span><a href="#local-6989586621679403543"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-2694"></span><span>        </span><span id="local-6989586621679403542"><span class="annot"><span class="annottext">names0 :: Names
</span><a href="#local-6989586621679403542"><span class="hs-identifier hs-var hs-var">names0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403536"><span class="hs-identifier hs-var">rootnames</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.prefix0</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403541"><span class="hs-identifier hs-var">lastName</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403539"><span class="hs-identifier hs-var">subnames</span></a></span><span>
</span><span id="line-2695"></span><span>
</span><span id="line-2696"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#searchResultsFor"><span class="hs-identifier hs-type">searchResultsFor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">]</span><span>
</span><span id="line-2697"></span><span id="searchResultsFor"><span class="annot"><span class="annottext">searchResultsFor :: Names -&gt; [Referent] -&gt; [Reference] -&gt; [SearchResult]
</span><a href="Unison.Codebase.Editor.HandleInput.html#searchResultsFor"><span class="hs-identifier hs-var hs-var">searchResultsFor</span></a></span></span><span> </span><span id="local-6989586621679403534"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403534"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span id="local-6989586621679403533"><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679403533"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span id="local-6989586621679403532"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679403532"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2698"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Referent -&gt; SearchResult
</span><span class="hs-identifier hs-var">SR.termSearchResult</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403534"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403530"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403529"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-2699"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679403529"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403529"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679403533"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2700"></span><span>      </span><span id="local-6989586621679403530"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403530"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; [Name]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Referent -&gt; Set Name
</span><span class="hs-identifier hs-var">Names.namesForReferent</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403534"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403529"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2701"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-2702"></span><span>    </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [SearchResult] -&gt; [SearchResult]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Reference -&gt; SearchResult
</span><span class="hs-identifier hs-var">SR.typeSearchResult</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403534"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403526"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403525"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-2703"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679403525"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403525"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679403532"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2704"></span><span>           </span><span id="local-6989586621679403526"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403526"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set Name -&gt; [Name]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Reference -&gt; Set Name
</span><span class="hs-identifier hs-var">Names.namesForReference</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403534"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403525"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2705"></span><span>       </span><span class="hs-special">]</span><span>
</span><span id="line-2706"></span><span>
</span><span id="line-2707"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#searchBranchScored"><span class="hs-identifier hs-type">searchBranchScored</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2708"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679406488"><span class="annot"><a href="#local-6989586621679406488"><span class="hs-identifier hs-type">score</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-2709"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679406488"><span class="hs-identifier hs-type">score</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-2710"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2711"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679406488"><span class="hs-identifier hs-type">score</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2712"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2713"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">]</span><span>
</span><span id="line-2714"></span><span id="searchBranchScored"><span class="annot"><span class="annottext">searchBranchScored :: Names
-&gt; (Name -&gt; Name -&gt; Maybe score)
-&gt; [HashQualified Name]
-&gt; [SearchResult]
</span><a href="Unison.Codebase.Editor.HandleInput.html#searchBranchScored"><span class="hs-identifier hs-var hs-var">searchBranchScored</span></a></span></span><span> </span><span id="local-6989586621679403523"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403523"><span class="hs-identifier hs-var">names0</span></a></span></span><span> </span><span id="local-6989586621679403522"><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Maybe score
</span><a href="#local-6989586621679403522"><span class="hs-identifier hs-var">score</span></a></span></span><span> </span><span id="local-6989586621679403521"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403521"><span class="hs-identifier hs-var">queries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2715"></span><span>  </span><span class="annot"><span class="annottext">[SearchResult] -&gt; [SearchResult]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">nubOrd</span></span><span> </span><span class="annot"><span class="annottext">([SearchResult] -&gt; [SearchResult])
-&gt; (Set (Maybe score, SearchResult) -&gt; [SearchResult])
-&gt; Set (Maybe score, SearchResult)
-&gt; [SearchResult]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Maybe score, SearchResult) -&gt; SearchResult)
-&gt; [(Maybe score, SearchResult)] -&gt; [SearchResult]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">(Maybe score, SearchResult) -&gt; SearchResult
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">([(Maybe score, SearchResult)] -&gt; [SearchResult])
-&gt; (Set (Maybe score, SearchResult)
    -&gt; [(Maybe score, SearchResult)])
-&gt; Set (Maybe score, SearchResult)
-&gt; [SearchResult]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set (Maybe score, SearchResult) -&gt; [(Maybe score, SearchResult)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Set (Maybe score, SearchResult) -&gt; [SearchResult])
-&gt; Set (Maybe score, SearchResult) -&gt; [SearchResult]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403520"><span class="hs-identifier hs-var">searchTermNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Maybe score, SearchResult)
-&gt; Set (Maybe score, SearchResult)
-&gt; Set (Maybe score, SearchResult)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403519"><span class="hs-identifier hs-var">searchTypeNamespace</span></a></span><span>
</span><span id="line-2716"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2717"></span><span>    </span><span id="local-6989586621679403520"><span class="annot"><span class="annottext">searchTermNamespace :: Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403520"><span class="hs-identifier hs-var hs-var">searchTermNamespace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Set (Maybe score, SearchResult))
-&gt; [HashQualified Name] -&gt; Set (Maybe score, SearchResult)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403518"><span class="hs-identifier hs-var">do1query</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403521"><span class="hs-identifier hs-var">queries</span></a></span><span>
</span><span id="line-2718"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2719"></span><span>        </span><span class="annot"><a href="#local-6989586621679403518"><span class="hs-identifier hs-type">do1query</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679406488"><span class="hs-identifier hs-type">score</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">)</span><span>
</span><span id="line-2720"></span><span>        </span><span id="local-6989586621679403518"><span class="annot"><span class="annottext">do1query :: HashQualified Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403518"><span class="hs-identifier hs-var hs-var">do1query</span></a></span></span><span> </span><span id="local-6989586621679403517"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403517"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, Referent) -&gt; Set (Maybe score, SearchResult))
-&gt; [(Name, Referent)] -&gt; Set (Maybe score, SearchResult)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name
-&gt; (Name, Referent) -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403516"><span class="hs-identifier hs-var">score1hq</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403517"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Name Referent -&gt; [(Name, Referent)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">R.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Name Referent -&gt; [(Name, Referent)])
-&gt; (Names -&gt; Relation Name Referent) -&gt; Names -&gt; [(Name, Referent)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Relation Name Referent
</span><span class="hs-identifier hs-var hs-var">Names.terms</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; [(Name, Referent)]) -&gt; Names -&gt; [(Name, Referent)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403523"><span class="hs-identifier hs-var">names0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2721"></span><span>        </span><span class="annot"><a href="#local-6989586621679403516"><span class="hs-identifier hs-type">score1hq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679406488"><span class="hs-identifier hs-type">score</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">)</span><span>
</span><span id="line-2722"></span><span>        </span><span id="local-6989586621679403516"><span class="annot"><span class="annottext">score1hq :: HashQualified Name
-&gt; (Name, Referent) -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403516"><span class="hs-identifier hs-var hs-var">score1hq</span></a></span></span><span> </span><span id="local-6989586621679403515"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403515"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403514"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403514"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403513"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403513"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403515"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2723"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">HQ.NameOnly</span></span><span> </span><span id="local-6989586621679403512"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403512"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2724"></span><span>            </span><span class="annot"><span class="annottext">Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403511"><span class="hs-identifier hs-var">pair</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403512"><span class="hs-identifier hs-var">qn</span></a></span><span>
</span><span id="line-2725"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span id="local-6989586621679403510"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403510"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span id="local-6989586621679403509"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403509"><span class="hs-identifier hs-var">h</span></a></span></span><span>
</span><span id="line-2726"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403509"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; ShortHash -&gt; Bool
</span><span class="hs-operator hs-var">`SH.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; ShortHash
</span><span class="hs-identifier hs-var">Referent.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403513"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2727"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403511"><span class="hs-identifier hs-var">pair</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403510"><span class="hs-identifier hs-var">qn</span></a></span><span>
</span><span id="line-2728"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashOnly</span></span><span> </span><span id="local-6989586621679403506"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403506"><span class="hs-identifier hs-var">h</span></a></span></span><span>
</span><span id="line-2729"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403506"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; ShortHash -&gt; Bool
</span><span class="hs-operator hs-var">`SH.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; ShortHash
</span><span class="hs-identifier hs-var">Referent.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403513"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2730"></span><span>                </span><span class="annot"><span class="annottext">(Maybe score, SearchResult) -&gt; Set (Maybe score, SearchResult)
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe score
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SearchResult
</span><a href="#local-6989586621679403505"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2731"></span><span>          </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set (Maybe score, SearchResult)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2732"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-2733"></span><span>            </span><span id="local-6989586621679403505"><span class="annot"><span class="annottext">result :: SearchResult
</span><a href="#local-6989586621679403505"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Referent -&gt; SearchResult
</span><span class="hs-identifier hs-var">SR.termSearchResult</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403523"><span class="hs-identifier hs-var">names0</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403514"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403513"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-2734"></span><span>            </span><span id="local-6989586621679403511"><span class="annot"><span class="annottext">pair :: Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403511"><span class="hs-identifier hs-var hs-var">pair</span></a></span></span><span> </span><span id="local-6989586621679403504"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403504"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Maybe score
</span><a href="#local-6989586621679403522"><span class="hs-identifier hs-var">score</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403504"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403514"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2735"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403503"><span class="annot"><span class="annottext">score
</span><a href="#local-6989586621679403503"><span class="hs-identifier hs-var">score</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe score, SearchResult) -&gt; Set (Maybe score, SearchResult)
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">score -&gt; Maybe score
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">score
</span><a href="#local-6989586621679403503"><span class="hs-identifier hs-var">score</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SearchResult
</span><a href="#local-6989586621679403505"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2736"></span><span>              </span><span class="annot"><span class="annottext">Maybe score
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set (Maybe score, SearchResult)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2737"></span><span>    </span><span id="local-6989586621679403519"><span class="annot"><span class="annottext">searchTypeNamespace :: Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403519"><span class="hs-identifier hs-var hs-var">searchTypeNamespace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Set (Maybe score, SearchResult))
-&gt; [HashQualified Name] -&gt; Set (Maybe score, SearchResult)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403502"><span class="hs-identifier hs-var">do1query</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403521"><span class="hs-identifier hs-var">queries</span></a></span><span>
</span><span id="line-2738"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2739"></span><span>        </span><span class="annot"><a href="#local-6989586621679403502"><span class="hs-identifier hs-type">do1query</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679406488"><span class="hs-identifier hs-type">score</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">)</span><span>
</span><span id="line-2740"></span><span>        </span><span id="local-6989586621679403502"><span class="annot"><span class="annottext">do1query :: HashQualified Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403502"><span class="hs-identifier hs-var hs-var">do1query</span></a></span></span><span> </span><span id="local-6989586621679403501"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403501"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, Reference) -&gt; Set (Maybe score, SearchResult))
-&gt; [(Name, Reference)] -&gt; Set (Maybe score, SearchResult)
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name
-&gt; (Name, Reference) -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403500"><span class="hs-identifier hs-var">score1hq</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403501"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Name Reference -&gt; [(Name, Reference)]
forall a b. Relation a b -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">R.toList</span></span><span> </span><span class="annot"><span class="annottext">(Relation Name Reference -&gt; [(Name, Reference)])
-&gt; (Names -&gt; Relation Name Reference)
-&gt; Names
-&gt; [(Name, Reference)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Relation Name Reference
</span><span class="hs-identifier hs-var hs-var">Names.types</span></span><span> </span><span class="annot"><span class="annottext">(Names -&gt; [(Name, Reference)]) -&gt; Names -&gt; [(Name, Reference)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403523"><span class="hs-identifier hs-var">names0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2741"></span><span>        </span><span class="annot"><a href="#local-6989586621679403500"><span class="hs-identifier hs-type">score1hq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="#local-6989586621679406488"><span class="hs-identifier hs-type">score</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SearchResult</span></span><span class="hs-special">)</span><span>
</span><span id="line-2742"></span><span>        </span><span id="local-6989586621679403500"><span class="annot"><span class="annottext">score1hq :: HashQualified Name
-&gt; (Name, Reference) -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403500"><span class="hs-identifier hs-var hs-var">score1hq</span></a></span></span><span> </span><span id="local-6989586621679403499"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403499"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403498"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403498"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403497"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403497"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403499"><span class="hs-identifier hs-var">query</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2743"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">HQ.NameOnly</span></span><span> </span><span id="local-6989586621679403496"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403496"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2744"></span><span>            </span><span class="annot"><span class="annottext">Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403495"><span class="hs-identifier hs-var">pair</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403496"><span class="hs-identifier hs-var">qn</span></a></span><span>
</span><span id="line-2745"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span id="local-6989586621679403494"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403494"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span id="local-6989586621679403493"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403493"><span class="hs-identifier hs-var">h</span></a></span></span><span>
</span><span id="line-2746"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403493"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; ShortHash -&gt; Bool
</span><span class="hs-operator hs-var">`SH.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403497"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2747"></span><span>                </span><span class="annot"><span class="annottext">Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403495"><span class="hs-identifier hs-var">pair</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403494"><span class="hs-identifier hs-var">qn</span></a></span><span>
</span><span id="line-2748"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashOnly</span></span><span> </span><span id="local-6989586621679403492"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403492"><span class="hs-identifier hs-var">h</span></a></span></span><span>
</span><span id="line-2749"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403492"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; ShortHash -&gt; Bool
</span><span class="hs-operator hs-var">`SH.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.toShortHash</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403497"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2750"></span><span>                </span><span class="annot"><span class="annottext">(Maybe score, SearchResult) -&gt; Set (Maybe score, SearchResult)
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe score
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SearchResult
</span><a href="#local-6989586621679403491"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2751"></span><span>          </span><span class="annot"><span class="annottext">HashQualified Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set (Maybe score, SearchResult)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2752"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-2753"></span><span>            </span><span id="local-6989586621679403491"><span class="annot"><span class="annottext">result :: SearchResult
</span><a href="#local-6989586621679403491"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Reference -&gt; SearchResult
</span><span class="hs-identifier hs-var">SR.typeSearchResult</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403523"><span class="hs-identifier hs-var">names0</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403498"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403497"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-2754"></span><span>            </span><span id="local-6989586621679403495"><span class="annot"><span class="annottext">pair :: Name -&gt; Set (Maybe score, SearchResult)
</span><a href="#local-6989586621679403495"><span class="hs-identifier hs-var hs-var">pair</span></a></span></span><span> </span><span id="local-6989586621679403490"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403490"><span class="hs-identifier hs-var">qn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Maybe score
</span><a href="#local-6989586621679403522"><span class="hs-identifier hs-var">score</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403490"><span class="hs-identifier hs-var">qn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403498"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2755"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403489"><span class="annot"><span class="annottext">score
</span><a href="#local-6989586621679403489"><span class="hs-identifier hs-var">score</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe score, SearchResult) -&gt; Set (Maybe score, SearchResult)
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">score -&gt; Maybe score
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">score
</span><a href="#local-6989586621679403489"><span class="hs-identifier hs-var">score</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SearchResult
</span><a href="#local-6989586621679403491"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2756"></span><span>              </span><span class="annot"><span class="annottext">Maybe score
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set (Maybe score, SearchResult)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-2757"></span><span>
</span><span id="line-2758"></span><span class="hs-comment">-- | supply `dest0` if you want to print diff messages</span><span>
</span><span id="line-2759"></span><span class="hs-comment">--   supply unchangedMessage if you want to display it if merge had no effect</span><span>
</span><span id="line-2760"></span><span id="local-6989586621679407013"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#mergeBranchAndPropagateDefaultPatch"><span class="hs-identifier hs-type">mergeBranchAndPropagateDefaultPatch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2761"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Branch.MergeMode</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2762"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2763"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.html#Output"><span class="hs-identifier hs-type">Output</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2764"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Branch</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2765"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Path'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2766"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2767"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407013"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2768"></span><span id="mergeBranchAndPropagateDefaultPatch"><span class="annot"><span class="annottext">mergeBranchAndPropagateDefaultPatch :: MergeMode
-&gt; Text
-&gt; Maybe Output
-&gt; Branch IO
-&gt; Maybe Path'
-&gt; Absolute
-&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#mergeBranchAndPropagateDefaultPatch"><span class="hs-identifier hs-var hs-var">mergeBranchAndPropagateDefaultPatch</span></a></span></span><span> </span><span id="local-6989586621679403488"><span class="annot"><span class="annottext">MergeMode
</span><a href="#local-6989586621679403488"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621679403487"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403487"><span class="hs-identifier hs-var">inputDescription</span></a></span></span><span> </span><span id="local-6989586621679403486"><span class="annot"><span class="annottext">Maybe Output
</span><a href="#local-6989586621679403486"><span class="hs-identifier hs-var">unchangedMessage</span></a></span></span><span> </span><span id="local-6989586621679403485"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403485"><span class="hs-identifier hs-var">srcb</span></a></span></span><span> </span><span id="local-6989586621679403484"><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679403484"><span class="hs-identifier hs-var">maybeDest0</span></a></span></span><span> </span><span id="local-6989586621679403483"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403483"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2769"></span><span>  </span><span class="annot"><span class="annottext">Cli r Bool -&gt; Cli r () -&gt; Cli r () -&gt; Cli r ()
forall (m :: * -&gt; *) a. Monad m =&gt; m Bool -&gt; m a -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">ifM</span></span><span>
</span><span id="line-2770"></span><span>    </span><span class="annot"><span class="annottext">Cli r Bool
forall r. Cli r Bool
</span><a href="#local-6989586621679403482"><span class="hs-identifier hs-var">mergeBranch</span></a></span><span>
</span><span id="line-2771"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Maybe Path' -&gt; Absolute -&gt; Cli r ()
forall r. Text -&gt; Maybe Path' -&gt; Absolute -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadPropagateDiffDefaultPatch"><span class="hs-identifier hs-var">loadPropagateDiffDefaultPatch</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403487"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679403484"><span class="hs-identifier hs-var">maybeDest0</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403483"><span class="hs-identifier hs-var">dest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2772"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Output -&gt; (Output -&gt; Cli r ()) -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Output
</span><a href="#local-6989586621679403486"><span class="hs-identifier hs-var">unchangedMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2773"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2774"></span><span>    </span><span id="local-6989586621679406203"><span class="annot"><a href="#local-6989586621679403482"><span class="hs-identifier hs-type">mergeBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406203"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2775"></span><span>    </span><span id="local-6989586621679403482"><span class="annot"><span class="annottext">mergeBranch :: Cli r Bool
</span><a href="#local-6989586621679403482"><span class="hs-identifier hs-var hs-var">mergeBranch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2776"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Cli r Bool -&gt; Cli r Bool
forall r a. String -&gt; Cli r a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#time"><span class="hs-identifier hs-var">Cli.time</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mergeBranch&quot;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2777"></span><span>        </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403481"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403481"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2778"></span><span>        </span><span id="local-6989586621679403480"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403480"><span class="hs-identifier hs-var">destb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch IO)
forall r. Absolute -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranchAt"><span class="hs-identifier hs-var">Cli.getBranchAt</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403483"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-2779"></span><span>        </span><span id="local-6989586621679403479"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403479"><span class="hs-identifier hs-var">merged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO)))
-&gt; MergeMode -&gt; Branch IO -&gt; Branch IO -&gt; IO (Branch IO)
forall (m :: * -&gt; *).
Monad m =&gt;
(Branch m -&gt; Branch m -&gt; m (Maybe (Branch m)))
-&gt; MergeMode -&gt; Branch m -&gt; Branch m -&gt; m (Branch m)
</span><span class="hs-identifier hs-var">Branch.merge''</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Branch IO -&gt; Branch IO -&gt; IO (Maybe (Branch IO))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Branch m -&gt; Branch m -&gt; m (Maybe (Branch m))
</span><span class="hs-identifier hs-var">Codebase.lca</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403481"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MergeMode
</span><a href="#local-6989586621679403488"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403485"><span class="hs-identifier hs-var">srcb</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403480"><span class="hs-identifier hs-var">destb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2780"></span><span>        </span><span id="local-6989586621679403478"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679403478"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
forall r.
Text -&gt; Absolute -&gt; (Branch IO -&gt; Cli r (Branch IO)) -&gt; Cli r Bool
</span><a href="Unison.Cli.MonadUtils.html#updateAtM"><span class="hs-identifier hs-var">Cli.updateAtM</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403487"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403483"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Cli r (Branch IO) -&gt; Branch IO -&gt; Cli r (Branch IO)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(Cli r (Branch IO) -&gt; Branch IO -&gt; Cli r (Branch IO))
-&gt; Cli r (Branch IO) -&gt; Branch IO -&gt; Cli r (Branch IO)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Cli r (Branch IO)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403479"><span class="hs-identifier hs-var">merged</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2781"></span><span>        </span><span class="annot"><span class="annottext">Maybe Path' -&gt; (Path' -&gt; Cli r ()) -&gt; Cli r ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679403484"><span class="hs-identifier hs-var">maybeDest0</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403477"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679403477"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2782"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679403476"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403476"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403475"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679403475"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403480"><span class="hs-identifier hs-var">destb</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403479"><span class="hs-identifier hs-var">merged</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2783"></span><span>          </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path'
-&gt; Absolute
-&gt; PrettyPrintEnv
-&gt; BranchDiffOutput Symbol Ann
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffAfterMerge"><span class="hs-identifier hs-var">ShowDiffAfterMerge</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679403477"><span class="hs-identifier hs-var">dest0</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403483"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403476"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679403475"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2784"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679403478"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-2785"></span><span>
</span><span id="line-2786"></span><span id="local-6989586621679406962"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#loadPropagateDiffDefaultPatch"><span class="hs-identifier hs-type">loadPropagateDiffDefaultPatch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2787"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2788"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Path'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2789"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2790"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406962"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2791"></span><span id="loadPropagateDiffDefaultPatch"><span class="annot"><span class="annottext">loadPropagateDiffDefaultPatch :: Text -&gt; Maybe Path' -&gt; Absolute -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadPropagateDiffDefaultPatch"><span class="hs-identifier hs-var hs-var">loadPropagateDiffDefaultPatch</span></a></span></span><span> </span><span id="local-6989586621679403473"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403473"><span class="hs-identifier hs-var">inputDescription</span></a></span></span><span> </span><span id="local-6989586621679403472"><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679403472"><span class="hs-identifier hs-var">maybeDest0</span></a></span></span><span> </span><span id="local-6989586621679403471"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403471"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2792"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Cli r () -&gt; Cli r ()
forall r a. String -&gt; Cli r a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#time"><span class="hs-identifier hs-var">Cli.time</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;loadPropagateDiffDefaultPatch&quot;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2793"></span><span>    </span><span id="local-6989586621679403470"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403470"><span class="hs-identifier hs-var">original</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch0 IO)
forall r. Absolute -&gt; Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranch0At"><span class="hs-identifier hs-var">Cli.getBranch0At</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403471"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-2794"></span><span>    </span><span id="local-6989586621679403469"><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403469"><span class="hs-identifier hs-var">patch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Patch -&gt; Cli r Patch
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Patch -&gt; Cli r Patch) -&gt; IO Patch -&gt; Cli r Patch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NameSegment -&gt; Branch0 IO -&gt; IO Patch
forall (m :: * -&gt; *).
Applicative m =&gt;
NameSegment -&gt; Branch0 m -&gt; m Patch
</span><span class="hs-identifier hs-var">Branch.getPatch</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="Unison.Cli.MonadUtils.html#defaultPatchNameSegment"><span class="hs-identifier hs-var">Cli.defaultPatchNameSegment</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403470"><span class="hs-identifier hs-var">original</span></a></span><span>
</span><span id="line-2795"></span><span>    </span><span id="local-6989586621679403466"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679403466"><span class="hs-identifier hs-var">patchDidChange</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Patch -&gt; Absolute -&gt; Cli r Bool
forall r. Text -&gt; Patch -&gt; Absolute -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#propagatePatch"><span class="hs-identifier hs-var">propagatePatch</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403473"><span class="hs-identifier hs-var">inputDescription</span></a></span><span> </span><span class="annot"><span class="annottext">Patch
</span><a href="#local-6989586621679403469"><span class="hs-identifier hs-var">patch</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403471"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-2796"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679403466"><span class="hs-identifier hs-var">patchDidChange</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2797"></span><span>      </span><span class="annot"><span class="annottext">Maybe Path' -&gt; (Path' -&gt; Cli r ()) -&gt; Cli r ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><span class="hs-identifier hs-var">whenJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Path'
</span><a href="#local-6989586621679403472"><span class="hs-identifier hs-var">maybeDest0</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403465"><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679403465"><span class="hs-identifier hs-var">dest0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2798"></span><span>        </span><span id="local-6989586621679403464"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403464"><span class="hs-identifier hs-var">patched</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Cli r (Branch IO)
forall r. Absolute -&gt; Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getBranchAt"><span class="hs-identifier hs-var">Cli.getBranchAt</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403471"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-2799"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403463"><span class="annot"><span class="annottext">patchPath :: Path'
</span><a href="#local-6989586621679403463"><span class="hs-identifier hs-var hs-var">patchPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; NameSegment -&gt; Path'
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-identifier hs-var">snoc</span></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679403465"><span class="hs-identifier hs-var">dest0</span></a></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="Unison.Cli.MonadUtils.html#defaultPatchNameSegment"><span class="hs-identifier hs-var">Cli.defaultPatchNameSegment</span></a></span><span>
</span><span id="line-2800"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679403462"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403462"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403461"><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679403461"><span class="hs-identifier hs-var">diff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r.
Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var">diffHelper</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403470"><span class="hs-identifier hs-var">original</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; Branch0 IO
forall (m :: * -&gt; *). Branch m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.head</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403464"><span class="hs-identifier hs-var">patched</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2801"></span><span>        </span><span class="annot"><span class="annottext">NumberedOutput -&gt; Cli r ()
forall r. NumberedOutput -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respondNumbered"><span class="hs-identifier hs-var">Cli.respondNumbered</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path'
-&gt; Absolute
-&gt; Path'
-&gt; PrettyPrintEnv
-&gt; BranchDiffOutput Symbol Ann
-&gt; NumberedOutput
</span><a href="Unison.Codebase.Editor.Output.html#ShowDiffAfterMergePropagate"><span class="hs-identifier hs-var">ShowDiffAfterMergePropagate</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679403465"><span class="hs-identifier hs-var">dest0</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403471"><span class="hs-identifier hs-var">dest</span></a></span><span> </span><span class="annot"><span class="annottext">Path'
</span><a href="#local-6989586621679403463"><span class="hs-identifier hs-var">patchPath</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403462"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">BranchDiffOutput Symbol Ann
</span><a href="#local-6989586621679403461"><span class="hs-identifier hs-var">diff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2802"></span><span>
</span><span id="line-2803"></span><span class="hs-comment">-- | Get the set of terms related to a hash-qualified name.</span><span>
</span><span id="line-2804"></span><span id="local-6989586621679406299"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#getHQTerms"><span class="hs-identifier hs-type">getHQTerms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406299"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-2805"></span><span id="getHQTerms"><span class="annot"><span class="annottext">getHQTerms :: HashQualified Name -&gt; Cli r (Set Referent)
</span><a href="Unison.Codebase.Editor.HandleInput.html#getHQTerms"><span class="hs-identifier hs-var hs-var">getHQTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-2806"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.NameOnly</span></span><span> </span><span id="local-6989586621679403459"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403459"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2807"></span><span>    </span><span id="local-6989586621679403458"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403458"><span class="hs-identifier hs-var">root0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch0 IO)
forall r. Cli r (Branch0 IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch0"><span class="hs-identifier hs-var">Cli.getRootBranch0</span></a></span><span>
</span><span id="line-2808"></span><span>    </span><span id="local-6989586621679403457"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403457"><span class="hs-identifier hs-var">currentPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-2809"></span><span>    </span><span class="hs-comment">-- absolute-ify the name, then lookup in deepTerms of root</span><span>
</span><span id="line-2810"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403456"><span class="annot"><span class="annottext">path :: Name
</span><a href="#local-6989586621679403456"><span class="hs-identifier hs-var hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2811"></span><span>          </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403459"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2812"></span><span>            </span><span class="annot"><span class="annottext">Name -&gt; (Name -&gt; Path') -&gt; Path'
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Path'
</span><span class="hs-identifier hs-var">Path.fromName'</span></span><span>
</span><span id="line-2813"></span><span>            </span><span class="annot"><span class="annottext">Path' -&gt; (Path' -&gt; Absolute) -&gt; Absolute
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path' -&gt; Absolute
forall l r o. Resolve l r o =&gt; l -&gt; r -&gt; o
</span><span class="hs-identifier hs-var">Path.resolve</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403457"><span class="hs-identifier hs-var">currentPath'</span></a></span><span>
</span><span id="line-2814"></span><span>            </span><span class="annot"><span class="annottext">Absolute -&gt; (Absolute -&gt; Path) -&gt; Path
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span>
</span><span id="line-2815"></span><span>            </span><span class="annot"><span class="annottext">Path -&gt; (Path -&gt; Name) -&gt; Name
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Name
</span><span class="hs-identifier hs-var">Path.unsafeToName</span></span><span>
</span><span id="line-2816"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Relation Referent Name -&gt; Set Referent
forall b a. Ord b =&gt; b -&gt; Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">R.lookupRan</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403456"><span class="hs-identifier hs-var">path</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO -&gt; Relation Referent Name
forall (m :: * -&gt; *). Branch0 m -&gt; Relation Referent Name
</span><span class="hs-identifier hs-var hs-var">Branch.deepTerms</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403458"><span class="hs-identifier hs-var">root0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2817"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashOnly</span></span><span> </span><span id="local-6989586621679403453"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403453"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Cli r (Set Referent)
forall (m :: * -&gt; *).
(MonadReader Env m, MonadIO m) =&gt;
ShortHash -&gt; m (Set Referent)
</span><a href="#local-6989586621679403452"><span class="hs-identifier hs-var">hashOnly</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403453"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-2818"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679403451"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403451"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShortHash -&gt; Cli r (Set Referent)
forall (m :: * -&gt; *).
(MonadReader Env m, MonadIO m) =&gt;
ShortHash -&gt; m (Set Referent)
</span><a href="#local-6989586621679403452"><span class="hs-identifier hs-var">hashOnly</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403451"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-2819"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2820"></span><span>    </span><span id="local-6989586621679403452"><span class="annot"><span class="annottext">hashOnly :: ShortHash -&gt; m (Set Referent)
</span><a href="#local-6989586621679403452"><span class="hs-identifier hs-var hs-var">hashOnly</span></a></span></span><span> </span><span id="local-6989586621679403450"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403450"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2821"></span><span>      </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403449"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403449"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2822"></span><span>      </span><span class="annot"><span class="annottext">IO (Set Referent) -&gt; m (Set Referent)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; ShortHash -&gt; IO (Set Referent)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; ShortHash -&gt; m (Set Referent)
</span><span class="hs-identifier hs-var">Backend.termReferentsByShortHash</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403449"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403450"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2823"></span><span>
</span><span id="line-2824"></span><span id="local-6989586621679406956"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepAt"><span class="hs-identifier hs-type">stepAt</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2825"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2826"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2827"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406956"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2828"></span><span id="stepAt"><span class="annot"><span class="annottext">stepAt :: Text -&gt; (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt"><span class="hs-identifier hs-var hs-var">stepAt</span></a></span></span><span> </span><span id="local-6989586621679403448"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403448"><span class="hs-identifier hs-var">cause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-var">stepManyAt</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403448"><span class="hs-identifier hs-var">cause</span></a></span><span> </span><span class="annot"><span class="annottext">([(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ())
-&gt; ((Path, Branch0 IO -&gt; Branch0 IO)
    -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)])
-&gt; (Path, Branch0 IO -&gt; Branch0 IO)
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Path, Branch0 IO -&gt; Branch0 IO)
-&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-2829"></span><span>
</span><span id="line-2830"></span><span id="local-6989586621679406229"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepAt%27"><span class="hs-identifier hs-type">stepAt'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2831"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2832"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406229"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2833"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406229"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2834"></span><span id="stepAt%27"><span class="annot"><span class="annottext">stepAt' :: Text -&gt; (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAt%27"><span class="hs-identifier hs-var hs-var">stepAt'</span></a></span></span><span> </span><span id="local-6989586621679403447"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403447"><span class="hs-identifier hs-var">cause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; Cli r (Branch0 IO))] -&gt; Cli r Bool
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt%27"><span class="hs-identifier hs-var">stepManyAt'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403447"><span class="hs-identifier hs-var">cause</span></a></span><span> </span><span class="annot"><span class="annottext">([(Path, Branch0 IO -&gt; Cli r (Branch0 IO))] -&gt; Cli r Bool)
-&gt; ((Path, Branch0 IO -&gt; Cli r (Branch0 IO))
    -&gt; [(Path, Branch0 IO -&gt; Cli r (Branch0 IO))])
-&gt; (Path, Branch0 IO -&gt; Cli r (Branch0 IO))
-&gt; Cli r Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Path, Branch0 IO -&gt; Cli r (Branch0 IO))
-&gt; [(Path, Branch0 IO -&gt; Cli r (Branch0 IO))]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-2835"></span><span>
</span><span id="line-2836"></span><span id="local-6989586621679406232"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepAtNoSync%27"><span class="hs-identifier hs-type">stepAtNoSync'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2837"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406232"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2838"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406232"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-2839"></span><span id="stepAtNoSync%27"><span class="annot"><span class="annottext">stepAtNoSync' :: (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAtNoSync%27"><span class="hs-identifier hs-var hs-var">stepAtNoSync'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r.
Foldable [] =&gt;
[(Path, Branch0 IO -&gt; Cli r (Branch0 IO))] -&gt; Cli r Bool
forall (f :: * -&gt; *) r.
Foldable f =&gt;
f (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtNoSync%27"><span class="hs-identifier hs-var">stepManyAtNoSync'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([(Path, Branch0 IO -&gt; Cli r (Branch0 IO))] -&gt; Cli r Bool)
-&gt; ((Path, Branch0 IO -&gt; Cli r (Branch0 IO))
    -&gt; [(Path, Branch0 IO -&gt; Cli r (Branch0 IO))])
-&gt; (Path, Branch0 IO -&gt; Cli r (Branch0 IO))
-&gt; Cli r Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Path, Branch0 IO -&gt; Cli r (Branch0 IO))
-&gt; [(Path, Branch0 IO -&gt; Cli r (Branch0 IO))]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-2840"></span><span>
</span><span id="line-2841"></span><span id="local-6989586621679406768"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepAtNoSync"><span class="hs-identifier hs-type">stepAtNoSync</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2842"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2843"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406768"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2844"></span><span id="stepAtNoSync"><span class="annot"><span class="annottext">stepAtNoSync :: (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAtNoSync"><span class="hs-identifier hs-var hs-var">stepAtNoSync</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall r.
Foldable [] =&gt;
[(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtNoSync"><span class="hs-identifier hs-var">stepManyAtNoSync</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([(Path, Branch0 IO -&gt; Branch0 IO)] -&gt; Cli r ())
-&gt; ((Path, Branch0 IO -&gt; Branch0 IO)
    -&gt; [(Path, Branch0 IO -&gt; Branch0 IO)])
-&gt; (Path, Branch0 IO -&gt; Branch0 IO)
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Path, Branch0 IO -&gt; Branch0 IO)
-&gt; [(Path, Branch0 IO -&gt; Branch0 IO)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-2845"></span><span>
</span><span id="line-2846"></span><span id="local-6989586621679407105"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepAtM"><span class="hs-identifier hs-type">stepAtM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2847"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2848"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2849"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407105"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2850"></span><span id="stepAtM"><span class="annot"><span class="annottext">stepAtM :: Text -&gt; (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepAtM"><span class="hs-identifier hs-var hs-var">stepAtM</span></a></span></span><span> </span><span id="local-6989586621679403444"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403444"><span class="hs-identifier hs-var">cause</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [(Path, Branch0 IO -&gt; IO (Branch0 IO))] -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
Text -&gt; f (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtM"><span class="hs-identifier hs-var">stepManyAtM</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403444"><span class="hs-identifier hs-var">cause</span></a></span><span> </span><span class="annot"><span class="annottext">([(Path, Branch0 IO -&gt; IO (Branch0 IO))] -&gt; Cli r ())
-&gt; ((Path, Branch0 IO -&gt; IO (Branch0 IO))
    -&gt; [(Path, Branch0 IO -&gt; IO (Branch0 IO))])
-&gt; (Path, Branch0 IO -&gt; IO (Branch0 IO))
-&gt; Cli r ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Path, Branch0 IO -&gt; IO (Branch0 IO))
-&gt; [(Path, Branch0 IO -&gt; IO (Branch0 IO))]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-2851"></span><span>
</span><span id="line-2852"></span><span id="local-6989586621679407065"><span id="local-6989586621679407066"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-type">stepManyAt</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2853"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679407066"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-2854"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2855"></span><span>  </span><span class="annot"><a href="#local-6989586621679407066"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2856"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407065"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-2857"></span><span id="stepManyAt"><span class="annot"><span class="annottext">stepManyAt :: Text -&gt; f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt"><span class="hs-identifier hs-var hs-var">stepManyAt</span></a></span></span><span> </span><span id="local-6989586621679403442"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403442"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621679403441"><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Branch0 IO)
</span><a href="#local-6989586621679403441"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2858"></span><span>  </span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtNoSync"><span class="hs-identifier hs-var">stepManyAtNoSync</span></a></span><span> </span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Branch0 IO)
</span><a href="#local-6989586621679403441"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-2859"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Cli r ()
forall r. Text -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-var">syncRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403442"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-2860"></span><span>
</span><span id="line-2861"></span><span id="local-6989586621679406192"><span id="local-6989586621679406193"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt%27"><span class="hs-identifier hs-type">stepManyAt'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2862"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679406193"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-2863"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2864"></span><span>  </span><span class="annot"><a href="#local-6989586621679406193"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406192"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2865"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406192"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-2866"></span><span id="stepManyAt%27"><span class="annot"><span class="annottext">stepManyAt' :: Text -&gt; f (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAt%27"><span class="hs-identifier hs-var hs-var">stepManyAt'</span></a></span></span><span> </span><span id="local-6989586621679403440"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403440"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621679403439"><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Cli r (Branch0 IO))
</span><a href="#local-6989586621679403439"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2867"></span><span>  </span><span id="local-6989586621679403438"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679403438"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
forall (f :: * -&gt; *) r.
Foldable f =&gt;
f (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtNoSync%27"><span class="hs-identifier hs-var">stepManyAtNoSync'</span></a></span><span> </span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Cli r (Branch0 IO))
</span><a href="#local-6989586621679403439"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-2868"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Cli r ()
forall r. Text -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-var">syncRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403440"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-2869"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679403438"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-2870"></span><span>
</span><span id="line-2871"></span><span id="local-6989586621679406189"><span id="local-6989586621679406190"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtNoSync%27"><span class="hs-identifier hs-type">stepManyAtNoSync'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2872"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679406189"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-2873"></span><span>  </span><span class="annot"><a href="#local-6989586621679406189"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406190"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2874"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406190"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-2875"></span><span id="stepManyAtNoSync%27"><span class="annot"><span class="annottext">stepManyAtNoSync' :: f (Path, Branch0 IO -&gt; Cli r (Branch0 IO)) -&gt; Cli r Bool
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtNoSync%27"><span class="hs-identifier hs-var hs-var">stepManyAtNoSync'</span></a></span></span><span> </span><span id="local-6989586621679403437"><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Cli r (Branch0 IO))
</span><a href="#local-6989586621679403437"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2876"></span><span>  </span><span id="local-6989586621679403436"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403436"><span class="hs-identifier hs-var">origRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-2877"></span><span>  </span><span id="local-6989586621679403435"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403435"><span class="hs-identifier hs-var">newRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Cli r (Branch0 IO))
-&gt; Branch IO -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) (n :: * -&gt; *) (f :: * -&gt; *).
(Monad m, Monad n, Foldable f) =&gt;
f (Path, Branch0 m -&gt; n (Branch0 m)) -&gt; Branch m -&gt; n (Branch m)
</span><span class="hs-identifier hs-var">Branch.stepManyAtM</span></span><span> </span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Cli r (Branch0 IO))
</span><a href="#local-6989586621679403437"><span class="hs-identifier hs-var">actions</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403436"><span class="hs-identifier hs-var">origRoot</span></a></span><span class="hs-cpp">
  #root .= newRoot
</span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403436"><span class="hs-identifier hs-var">origRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; Branch IO -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403435"><span class="hs-identifier hs-var">newRoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2880"></span><span>
</span><span id="line-2881"></span><span class="hs-comment">-- Like stepManyAt, but doesn't update the last saved root</span><span>
</span><span id="line-2882"></span><span id="local-6989586621679406303"><span id="local-6989586621679406304"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtNoSync"><span class="hs-identifier hs-type">stepManyAtNoSync</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2883"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679406304"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-2884"></span><span>  </span><span class="annot"><a href="#local-6989586621679406304"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2885"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406303"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-2886"></span><span id="stepManyAtNoSync"><span class="annot"><span class="annottext">stepManyAtNoSync :: f (Path, Branch0 IO -&gt; Branch0 IO) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtNoSync"><span class="hs-identifier hs-var hs-var">stepManyAtNoSync</span></a></span></span><span> </span><span id="local-6989586621679403431"><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; Branch0 IO)
</span><a href="#local-6989586621679403431"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span class="hs-cpp">
  #root %= Branch.stepManyAt actions
</span><span>
</span><span id="line-2889"></span><span id="local-6989586621679406185"><span id="local-6989586621679406186"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtM"><span class="hs-identifier hs-type">stepManyAtM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2890"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679406186"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-2891"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2892"></span><span>  </span><span class="annot"><a href="#local-6989586621679406186"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2893"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406185"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-2894"></span><span id="stepManyAtM"><span class="annot"><span class="annottext">stepManyAtM :: Text -&gt; f (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtM"><span class="hs-identifier hs-var hs-var">stepManyAtM</span></a></span></span><span> </span><span id="local-6989586621679403428"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403428"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621679403427"><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; IO (Branch0 IO))
</span><a href="#local-6989586621679403427"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2895"></span><span>  </span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
forall (f :: * -&gt; *) r.
Foldable f =&gt;
f (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtMNoSync"><span class="hs-identifier hs-var">stepManyAtMNoSync</span></a></span><span> </span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; IO (Branch0 IO))
</span><a href="#local-6989586621679403427"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-2896"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; Cli r ()
forall r. Text -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-var">syncRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403428"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-2897"></span><span>
</span><span id="line-2898"></span><span id="local-6989586621679406322"><span id="local-6989586621679406323"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtMNoSync"><span class="hs-identifier hs-type">stepManyAtMNoSync</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2899"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679406323"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-2900"></span><span>  </span><span class="annot"><a href="#local-6989586621679406323"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2901"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406322"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-2902"></span><span id="stepManyAtMNoSync"><span class="annot"><span class="annottext">stepManyAtMNoSync :: f (Path, Branch0 IO -&gt; IO (Branch0 IO)) -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stepManyAtMNoSync"><span class="hs-identifier hs-var hs-var">stepManyAtMNoSync</span></a></span></span><span> </span><span id="local-6989586621679403426"><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; IO (Branch0 IO))
</span><a href="#local-6989586621679403426"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2903"></span><span>  </span><span id="local-6989586621679403425"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403425"><span class="hs-identifier hs-var">oldRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-2904"></span><span>  </span><span id="local-6989586621679403424"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403424"><span class="hs-identifier hs-var">newRoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Branch IO) -&gt; Cli r (Branch IO)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; IO (Branch0 IO))
-&gt; Branch IO -&gt; IO (Branch IO)
forall (m :: * -&gt; *) (n :: * -&gt; *) (f :: * -&gt; *).
(Monad m, Monad n, Foldable f) =&gt;
f (Path, Branch0 m -&gt; n (Branch0 m)) -&gt; Branch m -&gt; n (Branch m)
</span><span class="hs-identifier hs-var">Branch.stepManyAtM</span></span><span> </span><span class="annot"><span class="annottext">f (Path, Branch0 IO -&gt; IO (Branch0 IO))
</span><a href="#local-6989586621679403426"><span class="hs-identifier hs-var">actions</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403425"><span class="hs-identifier hs-var">oldRoot</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
  #root .= newRoot
</span><span>
</span><span id="line-2907"></span><span class="hs-comment">-- | Sync the in-memory root branch.</span><span>
</span><span id="line-2908"></span><span id="local-6989586621679406861"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-type">syncRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406861"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2909"></span><span id="syncRoot"><span class="annot"><span class="annottext">syncRoot :: Text -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#syncRoot"><span class="hs-identifier hs-var hs-var">syncRoot</span></a></span></span><span> </span><span id="local-6989586621679403422"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403422"><span class="hs-identifier hs-var">description</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2910"></span><span>  </span><span id="local-6989586621679403421"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403421"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-2911"></span><span>  </span><span class="annot"><span class="annottext">Branch IO -&gt; Text -&gt; Cli r ()
forall r. Branch IO -&gt; Text -&gt; Cli r ()
</span><a href="Unison.Cli.MonadUtils.html#updateRoot"><span class="hs-identifier hs-var">Cli.updateRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403421"><span class="hs-identifier hs-var">rootBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403422"><span class="hs-identifier hs-var">description</span></a></span><span>
</span><span id="line-2912"></span><span>
</span><span id="line-2913"></span><span class="hs-comment">-- | Goal: When deleting, we might be removing the last name of a given definition (i.e. the</span><span>
</span><span id="line-2914"></span><span class="hs-comment">-- definition is going &quot;extinct&quot;). In this case we may wish to take some action or warn the</span><span>
</span><span id="line-2915"></span><span class="hs-comment">-- user about these &quot;endangered&quot; definitions which would now contain unnamed references.</span><span>
</span><span id="line-2916"></span><span id="local-6989586621679407071"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#getEndangeredDependents"><span class="hs-identifier hs-type">getEndangeredDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2917"></span><span>  </span><span class="hs-comment">-- | Which names we want to delete</span><span>
</span><span id="line-2918"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2919"></span><span>  </span><span class="hs-comment">-- | All names from the root branch</span><span>
</span><span id="line-2920"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2921"></span><span>  </span><span class="hs-comment">-- | map from references going extinct to the set of endangered dependents</span><span>
</span><span id="line-2922"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407071"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-2923"></span><span id="getEndangeredDependents"><span class="annot"><span class="annottext">getEndangeredDependents :: Names
-&gt; Names -&gt; Cli r (Map LabeledDependency (NESet LabeledDependency))
</span><a href="Unison.Codebase.Editor.HandleInput.html#getEndangeredDependents"><span class="hs-identifier hs-var hs-var">getEndangeredDependents</span></a></span></span><span> </span><span id="local-6989586621679403420"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403420"><span class="hs-identifier hs-var">namesToDelete</span></a></span></span><span> </span><span id="local-6989586621679403419"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403419"><span class="hs-identifier hs-var">rootNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2924"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403418"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403418"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-2925"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403417"><span class="hs-identifier hs-type">remainingNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-2926"></span><span>      </span><span id="local-6989586621679403417"><span class="annot"><span class="annottext">remainingNames :: Names
</span><a href="#local-6989586621679403417"><span class="hs-identifier hs-var hs-var">remainingNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403419"><span class="hs-identifier hs-var">rootNames</span></a></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
</span><span class="hs-operator hs-var">`Names.difference`</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403420"><span class="hs-identifier hs-var">namesToDelete</span></a></span><span>
</span><span id="line-2927"></span><span>      </span><span class="annot"><a href="#local-6989586621679403415"><span class="hs-identifier hs-type">refsToDelete</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679403414"><span class="hs-identifier hs-type">remainingRefs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679403413"><span class="hs-identifier hs-type">extinct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span>
</span><span id="line-2928"></span><span>      </span><span id="local-6989586621679403415"><span class="annot"><span class="annottext">refsToDelete :: Set LabeledDependency
</span><a href="#local-6989586621679403415"><span class="hs-identifier hs-var hs-var">refsToDelete</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Names.labeledReferences</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403420"><span class="hs-identifier hs-var">namesToDelete</span></a></span><span>
</span><span id="line-2929"></span><span>      </span><span id="local-6989586621679403414"><span class="annot"><span class="annottext">remainingRefs :: Set LabeledDependency
</span><a href="#local-6989586621679403414"><span class="hs-identifier hs-var hs-var">remainingRefs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">Names.labeledReferences</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403417"><span class="hs-identifier hs-var">remainingNames</span></a></span><span> </span><span class="hs-comment">-- left over after delete</span><span>
</span><span id="line-2930"></span><span>      </span><span id="local-6989586621679403413"><span class="annot"><span class="annottext">extinct :: Set LabeledDependency
</span><a href="#local-6989586621679403413"><span class="hs-identifier hs-var hs-var">extinct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403415"><span class="hs-identifier hs-var">refsToDelete</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.difference`</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403414"><span class="hs-identifier hs-var">remainingRefs</span></a></span><span> </span><span class="hs-comment">-- deleting and not left over</span><span>
</span><span id="line-2931"></span><span>      </span><span class="annot"><a href="#local-6989586621679403411"><span class="hs-identifier hs-type">accumulateDependents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2932"></span><span>      </span><span id="local-6989586621679403411"><span class="annot"><span class="annottext">accumulateDependents :: LabeledDependency
-&gt; IO (Map LabeledDependency (Set LabeledDependency))
</span><a href="#local-6989586621679403411"><span class="hs-identifier hs-var hs-var">accumulateDependents</span></a></span></span><span> </span><span id="local-6989586621679403410"><span class="annot"><span class="annottext">LabeledDependency
</span><a href="#local-6989586621679403410"><span class="hs-identifier hs-var">ld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2933"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403409"><span class="annot"><span class="annottext">ref :: Reference
</span><a href="#local-6989586621679403409"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Reference)
-&gt; (Referent -&gt; Reference) -&gt; LabeledDependency -&gt; Reference
forall a.
(Reference -&gt; a) -&gt; (Referent -&gt; a) -&gt; LabeledDependency -&gt; a
</span><span class="hs-identifier hs-var">LD.fold</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Referent -&gt; Reference
</span><span class="hs-identifier hs-var">Referent.toReference</span></span><span> </span><span class="annot"><span class="annottext">LabeledDependency
</span><a href="#local-6989586621679403410"><span class="hs-identifier hs-var">ld</span></a></span><span>
</span><span id="line-2934"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">LabeledDependency
-&gt; Set LabeledDependency
-&gt; Map LabeledDependency (Set LabeledDependency)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">LabeledDependency
</span><a href="#local-6989586621679403410"><span class="hs-identifier hs-var">ld</span></a></span><span> </span><span class="annot"><span class="annottext">(Set LabeledDependency
 -&gt; Map LabeledDependency (Set LabeledDependency))
-&gt; (Set Reference -&gt; Set LabeledDependency)
-&gt; Set Reference
-&gt; Map LabeledDependency (Set LabeledDependency)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; LabeledDependency)
-&gt; Set Reference -&gt; Set LabeledDependency
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; LabeledDependency
</span><span class="hs-identifier hs-var">LD.termRef</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Map LabeledDependency (Set LabeledDependency))
-&gt; IO (Set Reference)
-&gt; IO (Map LabeledDependency (Set LabeledDependency))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Set Reference)
forall (m :: * -&gt; *) v a.
Functor m =&gt;
Codebase m v a -&gt; Reference -&gt; m (Set Reference)
</span><span class="hs-identifier hs-var">Codebase.dependents</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403418"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403409"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-2935"></span><span>  </span><span class="hs-comment">-- All dependents of extinct, including terms which might themselves be in the process of being deleted.</span><span>
</span><span id="line-2936"></span><span>  </span><span id="local-6989586621679403407"><span class="annot"><span class="annottext">Map LabeledDependency (Set LabeledDependency)
</span><a href="#local-6989586621679403407"><span class="hs-identifier hs-var">allDependentsOfExtinct</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2937"></span><span>    </span><span class="annot"><span class="annottext">IO (Map LabeledDependency (Set LabeledDependency))
-&gt; Cli r (Map LabeledDependency (Set LabeledDependency))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set LabeledDependency
 -&gt; Set LabeledDependency -&gt; Set LabeledDependency)
-&gt; [Map LabeledDependency (Set LabeledDependency)]
-&gt; Map LabeledDependency (Set LabeledDependency)
forall (f :: * -&gt; *) k a.
(Foldable f, Ord k) =&gt;
(a -&gt; a -&gt; a) -&gt; f (Map k a) -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionsWith</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">([Map LabeledDependency (Set LabeledDependency)]
 -&gt; Map LabeledDependency (Set LabeledDependency))
-&gt; IO [Map LabeledDependency (Set LabeledDependency)]
-&gt; IO (Map LabeledDependency (Set LabeledDependency))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[LabeledDependency]
-&gt; (LabeledDependency
    -&gt; IO (Map LabeledDependency (Set LabeledDependency)))
-&gt; IO [Map LabeledDependency (Set LabeledDependency)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f (t b)
</span><span class="hs-identifier hs-var">for</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; [LabeledDependency]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403413"><span class="hs-identifier hs-var">extinct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LabeledDependency
-&gt; IO (Map LabeledDependency (Set LabeledDependency))
</span><a href="#local-6989586621679403411"><span class="hs-identifier hs-var">accumulateDependents</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2938"></span><span>
</span><span id="line-2939"></span><span>  </span><span class="hs-comment">-- Filtered to only include dependencies which are not being deleted, but depend one which</span><span>
</span><span id="line-2940"></span><span>  </span><span class="hs-comment">-- is going extinct.</span><span>
</span><span id="line-2941"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403405"><span class="hs-identifier hs-type">extinctToEndangered</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NESet</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span class="hs-special">)</span><span>
</span><span id="line-2942"></span><span>      </span><span id="local-6989586621679403405"><span class="annot"><span class="annottext">extinctToEndangered :: Map LabeledDependency (NESet LabeledDependency)
</span><a href="#local-6989586621679403405"><span class="hs-identifier hs-var hs-var">extinctToEndangered</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2943"></span><span>        </span><span class="annot"><span class="annottext">Map LabeledDependency (Set LabeledDependency)
</span><a href="#local-6989586621679403407"><span class="hs-identifier hs-var">allDependentsOfExtinct</span></a></span><span> </span><span class="annot"><span class="annottext">Map LabeledDependency (Set LabeledDependency)
-&gt; (Map LabeledDependency (Set LabeledDependency)
    -&gt; Map LabeledDependency (NESet LabeledDependency))
-&gt; Map LabeledDependency (NESet LabeledDependency)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Set LabeledDependency -&gt; Maybe (NESet LabeledDependency))
-&gt; Map LabeledDependency (Set LabeledDependency)
-&gt; Map LabeledDependency (NESet LabeledDependency)
forall a b k. (a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapMaybe</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403403"><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403403"><span class="hs-identifier hs-var">endangeredDeps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2944"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403402"><span class="annot"><span class="annottext">remainingEndangered :: Set LabeledDependency
</span><a href="#local-6989586621679403402"><span class="hs-identifier hs-var hs-var">remainingEndangered</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403403"><span class="hs-identifier hs-var">endangeredDeps</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Set LabeledDependency -&gt; Set LabeledDependency
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.intersection`</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403414"><span class="hs-identifier hs-var">remainingRefs</span></a></span><span>
</span><span id="line-2945"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Maybe (NESet LabeledDependency)
forall a. Set a -&gt; Maybe (NESet a)
</span><span class="hs-identifier hs-var">NESet.nonEmptySet</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403402"><span class="hs-identifier hs-var">remainingEndangered</span></a></span><span>
</span><span id="line-2946"></span><span>  </span><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency)
-&gt; Cli r (Map LabeledDependency (NESet LabeledDependency))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Map LabeledDependency (NESet LabeledDependency)
</span><a href="#local-6989586621679403405"><span class="hs-identifier hs-var">extinctToEndangered</span></a></span><span>
</span><span id="line-2947"></span><span>
</span><span id="line-2948"></span><span id="local-6989586621679406823"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#displayI"><span class="hs-identifier hs-type">displayI</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2949"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2950"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.Input.html#OutputLocation"><span class="hs-identifier hs-type">OutputLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2951"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2952"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406823"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2953"></span><span id="displayI"><span class="annot"><span class="annottext">displayI :: Names -&gt; OutputLocation -&gt; HashQualified Name -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayI"><span class="hs-identifier hs-var hs-var">displayI</span></a></span></span><span> </span><span id="local-6989586621679403400"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403400"><span class="hs-identifier hs-var">prettyPrintNames</span></a></span></span><span> </span><span id="local-6989586621679403399"><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679403399"><span class="hs-identifier hs-var">outputLoc</span></a></span></span><span> </span><span id="local-6989586621679403398"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403398"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2954"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403397"><span class="annot"><span class="annottext">bias :: [Name]
</span><a href="#local-6989586621679403397"><span class="hs-identifier hs-var hs-var">bias</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; [Name]
forall a. Maybe a -&gt; [a]
</span><span class="hs-identifier hs-var">maybeToList</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Name -&gt; [Name]) -&gt; Maybe Name -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe Name
forall n. HashQualified n -&gt; Maybe n
</span><span class="hs-identifier hs-var">HQ.toName</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403398"><span class="hs-identifier hs-var">hq</span></a></span><span>
</span><span id="line-2955"></span><span>  </span><span id="local-6989586621679403396"><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621679403396"><span class="hs-identifier hs-var">latestTypecheckedFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (TypecheckedUnisonFile Symbol Ann))
forall r. Cli r (Maybe (TypecheckedUnisonFile Symbol Ann))
</span><a href="Unison.Cli.MonadUtils.html#getLatestTypecheckedFile"><span class="hs-identifier hs-var">Cli.getLatestTypecheckedFile</span></a></span><span>
</span><span id="line-2956"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; Maybe (Symbol, TypecheckedUnisonFile Symbol Ann)
forall v.
Var v =&gt;
String
-&gt; Maybe (TypecheckedUnisonFile v Ann)
-&gt; Maybe (v, TypecheckedUnisonFile v Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#addWatch"><span class="hs-identifier hs-var">addWatch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ.toString</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403398"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621679403396"><span class="hs-identifier hs-var">latestTypecheckedFile</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2957"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Symbol, TypecheckedUnisonFile Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2958"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403393"><span class="annot"><span class="annottext">parseNames :: NamesWithHistory
</span><a href="#local-6989586621679403393"><span class="hs-identifier hs-var hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-operator hs-var">`NamesWithHistory.NamesWithHistory`</span></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403400"><span class="hs-identifier hs-var">prettyPrintNames</span></a></span><span>
</span><span id="line-2959"></span><span>          </span><span id="local-6989586621679403392"><span class="annot"><span class="annottext">results :: Set Referent
</span><a href="#local-6989586621679403392"><span class="hs-identifier hs-var hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Referent
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupHQTerm</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403398"><span class="hs-identifier hs-var">hq</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403393"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-2960"></span><span>      </span><span id="local-6989586621679403391"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403391"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2961"></span><span>        </span><span class="annot"><span class="annottext">Set Referent -&gt; Maybe Referent
forall a. Set a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Set.asSingleton</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403392"><span class="hs-identifier hs-var">results</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Referent
-&gt; (Maybe Referent -&gt; Cli r Referent) -&gt; Cli r Referent
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r Referent -&gt; Maybe Referent -&gt; Cli r Referent
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2962"></span><span>          </span><span class="annot"><span class="annottext">Output -&gt; Cli r Referent
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span>
</span><span id="line-2963"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Bool
forall a. Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.null</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403392"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-2964"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SearchTermsNotFound"><span class="hs-identifier hs-var">SearchTermsNotFound</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403398"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2965"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Set Referent -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TermAmbiguous"><span class="hs-identifier hs-var">TermAmbiguous</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403398"><span class="hs-identifier hs-var">hq</span></a></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403392"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-2966"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403389"><span class="annot"><span class="annottext">tm :: Term Symbol Ann
</span><a href="#local-6989586621679403389"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Referent -&gt; Term Symbol Ann
forall v a vt at ap. Ord v =&gt; a -&gt; Referent -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.fromReferent</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">External</span></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403391"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-2967"></span><span>      </span><span id="local-6989586621679403387"><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403387"><span class="hs-identifier hs-var">pped</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403393"><span class="hs-identifier hs-var">parseNames</span></a></span><span>
</span><span id="line-2968"></span><span>      </span><span id="local-6989586621679403386"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403386"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Term Symbol Ann)
forall r.
Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Term Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTerm"><span class="hs-identifier hs-var">evalUnisonTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnv -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.biasTo</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679403397"><span class="hs-identifier hs-var">bias</span></a></span><span> </span><span class="annot"><span class="annottext">(PrettyPrintEnv -&gt; PrettyPrintEnv)
-&gt; PrettyPrintEnv -&gt; PrettyPrintEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl
</span><a href="#local-6989586621679403387"><span class="hs-identifier hs-var">pped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403389"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-2969"></span><span>      </span><span class="annot"><span class="annottext">OutputLocation -&gt; NamesWithHistory -&gt; Term Symbol () -&gt; Cli r ()
forall r.
OutputLocation -&gt; NamesWithHistory -&gt; Term Symbol () -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#doDisplay"><span class="hs-identifier hs-var">doDisplay</span></a></span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679403399"><span class="hs-identifier hs-var">outputLoc</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403393"><span class="hs-identifier hs-var">parseNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Term Symbol ()
forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403386"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2970"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403385"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403385"><span class="hs-identifier hs-var">toDisplay</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403384"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403384"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2971"></span><span>      </span><span id="local-6989586621679403383"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403383"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; PrettyPrintEnv -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.biasTo</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621679403397"><span class="hs-identifier hs-var">bias</span></a></span><span> </span><span class="annot"><span class="annottext">(PrettyPrintEnv -&gt; PrettyPrintEnv)
-&gt; Cli r PrettyPrintEnv -&gt; Cli r PrettyPrintEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Cli r PrettyPrintEnv
forall v a r.
Var v =&gt;
TypecheckedUnisonFile v a -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#executePPE"><span class="hs-identifier hs-var">executePPE</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403384"><span class="hs-identifier hs-var">unisonFile</span></a></span><span>
</span><span id="line-2972"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Symbol, Term Symbol ())]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403382"><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
</span><a href="#local-6989586621679403382"><span class="hs-identifier hs-var">watches</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; PrettyPrintEnv
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; [String]
-&gt; Cli
     r
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
forall r.
Bool
-&gt; PrettyPrintEnv
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; [String]
-&gt; Cli
     r
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonFile"><span class="hs-identifier hs-var">evalUnisonFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403383"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403384"><span class="hs-identifier hs-var">unisonFile</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2973"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol ()
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403381"><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679403381"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2974"></span><span>        </span><span class="annot"><span class="annottext">Symbol
-&gt; Map
     Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
-&gt; Maybe (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403385"><span class="hs-identifier hs-var">toDisplay</span></a></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
</span><a href="#local-6989586621679403382"><span class="hs-identifier hs-var">watches</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
-&gt; (Maybe (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
    -&gt; Cli r (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
-&gt; Cli r (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Cli r (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
-&gt; Maybe (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
-&gt; Cli r (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
forall (m :: * -&gt; *) a. Applicative m =&gt; m a -&gt; Maybe a -&gt; m a
</span><span class="hs-identifier hs-var">onNothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
-&gt; Cli r (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; Cli r (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
-&gt; String
-&gt; Cli r (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Evaluation dropped a watch expression: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; String
forall n. Show n =&gt; HashQualified n -&gt; String
</span><span class="hs-identifier hs-var">HQ.toString</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403398"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2975"></span><span>      </span><span id="local-6989586621679403380"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403380"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Cli r NamesWithHistory
forall v a r.
Var v =&gt;
TypecheckedUnisonFile v a -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayNames"><span class="hs-identifier hs-var">displayNames</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403384"><span class="hs-identifier hs-var">unisonFile</span></a></span><span>
</span><span id="line-2976"></span><span>      </span><span class="annot"><span class="annottext">OutputLocation -&gt; NamesWithHistory -&gt; Term Symbol () -&gt; Cli r ()
forall r.
OutputLocation -&gt; NamesWithHistory -&gt; Term Symbol () -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#doDisplay"><span class="hs-identifier hs-var">doDisplay</span></a></span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="#local-6989586621679403399"><span class="hs-identifier hs-var">outputLoc</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403380"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679403381"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-2977"></span><span>
</span><span id="line-2978"></span><span id="local-6989586621679406837"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#docsI"><span class="hs-identifier hs-type">docsI</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#SrcLoc"><span class="hs-identifier hs-type">SrcLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit'</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406837"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2979"></span><span id="docsI"><span class="annot"><span class="annottext">docsI :: String -&gt; Names -&gt; HQSplit' -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#docsI"><span class="hs-identifier hs-var hs-var">docsI</span></a></span></span><span> </span><span id="local-6989586621679403379"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403379"><span class="hs-identifier hs-var">srcLoc</span></a></span></span><span> </span><span id="local-6989586621679403378"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403378"><span class="hs-identifier hs-var">prettyPrintNames</span></a></span></span><span> </span><span id="local-6989586621679403377"><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679403377"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2980"></span><span>  </span><span class="annot"><span class="annottext">Cli r ()
forall r. Cli r ()
</span><a href="#local-6989586621679403376"><span class="hs-identifier hs-var">fileByName</span></a></span><span>
</span><span id="line-2981"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2982"></span><span>    </span><span class="hs-comment">{- Given `docs foo`, we look for docs in 3 places, in this order:
       (fileByName) First check the file for `foo.doc`, and if found do `display foo.doc`
       (codebaseByMetadata) Next check for doc metadata linked to `foo` in the codebase
       (codebaseByName) Lastly check for `foo.doc` in the codebase and if found do `display foo.doc`
    -}</span><span>
</span><span id="line-2987"></span><span>    </span><span class="annot"><a href="#local-6989586621679403375"><span class="hs-identifier hs-type">hq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2988"></span><span>    </span><span id="local-6989586621679403375"><span class="annot"><span class="annottext">hq :: HashQualified Name
</span><a href="#local-6989586621679403375"><span class="hs-identifier hs-var hs-var">hq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2989"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403374"><span class="hs-identifier hs-type">hq'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2990"></span><span>          </span><span id="local-6989586621679403374"><span class="annot"><span class="annottext">hq' :: HashQualified Name
</span><a href="#local-6989586621679403374"><span class="hs-identifier hs-var hs-var">hq'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Path' -&gt; Name
</span><span class="hs-identifier hs-var">Path.unsafeToName'</span></span><span> </span><span class="annot"><span class="annottext">(Path' -&gt; Name) -&gt; HashQualified Path' -&gt; HashQualified Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">HQSplit' -&gt; HashQualified Path'
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Name.convert</span></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679403377"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-2991"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; HashQualified Name
forall a b. Convert a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">Name.convert</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403374"><span class="hs-identifier hs-var">hq'</span></a></span><span>
</span><span id="line-2992"></span><span>
</span><span id="line-2993"></span><span>    </span><span class="annot"><a href="#local-6989586621679403372"><span class="hs-identifier hs-type">dotDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span>
</span><span id="line-2994"></span><span>    </span><span id="local-6989586621679403372"><span class="annot"><span class="annottext">dotDoc :: HashQualified Name
</span><a href="#local-6989586621679403372"><span class="hs-identifier hs-var hs-var">dotDoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403375"><span class="hs-identifier hs-var">hq</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; (Name -&gt; Name) -&gt; HashQualified Name
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403371"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403371"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Name -&gt; Name -&gt; Name
Name -&gt; Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.joinDot</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403371"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-string">&quot;doc&quot;</span></span><span>
</span><span id="line-2995"></span><span>
</span><span id="line-2996"></span><span>    </span><span id="local-6989586621679406147"><span class="annot"><a href="#local-6989586621679403376"><span class="hs-identifier hs-type">fileByName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406147"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2997"></span><span>    </span><span id="local-6989586621679403376"><span class="annot"><span class="annottext">fileByName :: Cli r ()
</span><a href="#local-6989586621679403376"><span class="hs-identifier hs-var hs-var">fileByName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2998"></span><span>      </span><span id="local-6989586621679403369"><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679403369"><span class="hs-identifier hs-var">loopState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r LoopState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">State.get</span></span><span>
</span><span id="line-2999"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403368"><span class="annot"><span class="annottext">ns :: Names
</span><a href="#local-6989586621679403368"><span class="hs-identifier hs-var hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names
-&gt; (TypecheckedUnisonFile Symbol Ann -&gt; Names)
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
-&gt; Names
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Names
forall v a. Var v =&gt; TypecheckedUnisonFile v a -&gt; Names
</span><span class="hs-identifier hs-var">UF.typecheckedToNames</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LoopState
</span><a href="#local-6989586621679403369"><span class="hs-identifier hs-var">loopState</span></a></span><span> </span><span class="annot"><span class="annottext">LoopState
-&gt; Getting
     (Maybe (TypecheckedUnisonFile Symbol Ann))
     LoopState
     (Maybe (TypecheckedUnisonFile Symbol Ann))
-&gt; Maybe (TypecheckedUnisonFile Symbol Ann)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;latestTypecheckedFile&quot;
  (Getting
     (Maybe (TypecheckedUnisonFile Symbol Ann))
     LoopState
     (Maybe (TypecheckedUnisonFile Symbol Ann)))
Getting
  (Maybe (TypecheckedUnisonFile Symbol Ann))
  LoopState
  (Maybe (TypecheckedUnisonFile Symbol Ann))
</span><a href="#local-6989586621679403367"><span class="hs-var">#latestTypecheckedFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3000"></span><span>      </span><span id="local-6989586621679403366"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403366"><span class="hs-identifier hs-var">fnames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r NamesWithHistory
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(NamesWithHistory -&gt; Cli r NamesWithHistory)
-&gt; NamesWithHistory -&gt; Cli r NamesWithHistory
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403368"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-3001"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Referent
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupHQTerm</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403372"><span class="hs-identifier hs-var">dotDoc</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403366"><span class="hs-identifier hs-var">fnames</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3002"></span><span>        </span><span id="local-6989586621679403365"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403365"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403365"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3003"></span><span>          </span><span class="hs-comment">-- the displayI command expects full term names, so we resolve</span><span>
</span><span id="line-3004"></span><span>          </span><span class="hs-comment">-- the hash back to its full name in the file</span><span>
</span><span id="line-3005"></span><span>          </span><span id="local-6989586621679403364"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403364"><span class="hs-identifier hs-var">fname'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Cli r (HashQualified Name)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Cli r (HashQualified Name))
-&gt; HashQualified Name -&gt; Cli r (HashQualified Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Referent -&gt; NamesWithHistory -&gt; HashQualified Name
</span><span class="hs-identifier hs-var">NamesWithHistory.longestTermName</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Referent -&gt; Referent
forall a. Set a -&gt; a
</span><span class="hs-identifier hs-var">Set.findMin</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403365"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403366"><span class="hs-identifier hs-var">fnames</span></a></span><span>
</span><span id="line-3006"></span><span>          </span><span class="annot"><span class="annottext">Names -&gt; OutputLocation -&gt; HashQualified Name -&gt; Cli r ()
forall r. Names -&gt; OutputLocation -&gt; HashQualified Name -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayI"><span class="hs-identifier hs-var">displayI</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403378"><span class="hs-identifier hs-var">prettyPrintNames</span></a></span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#ConsoleLocation"><span class="hs-identifier hs-var">ConsoleLocation</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403364"><span class="hs-identifier hs-var">fname'</span></a></span><span>
</span><span id="line-3007"></span><span>        </span><span class="annot"><span class="annottext">Set Referent
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r ()
forall r. Cli r ()
</span><a href="#local-6989586621679403361"><span class="hs-identifier hs-var">codebaseByMetadata</span></a></span><span>
</span><span id="line-3008"></span><span>
</span><span id="line-3009"></span><span>    </span><span id="local-6989586621679403360"><span class="annot"><a href="#local-6989586621679403361"><span class="hs-identifier hs-type">codebaseByMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679403360"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-3010"></span><span>    </span><span id="local-6989586621679403361"><span class="annot"><span class="annottext">codebaseByMetadata :: Cli r ()
</span><a href="#local-6989586621679403361"><span class="hs-identifier hs-var hs-var">codebaseByMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3011"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679403359"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403359"><span class="hs-identifier hs-var">ppe</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403358"><span class="annot"><span class="annottext">[(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403358"><span class="hs-identifier hs-var">out</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; HQSplit'
-&gt; Either (Set Reference) (Maybe String)
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
forall r.
String
-&gt; HQSplit'
-&gt; Either (Set Reference) (Maybe String)
-&gt; Cli
     r
     (PrettyPrintEnv,
      [(HashQualified Name, Reference, Maybe (Type Symbol Ann))])
</span><a href="Unison.Codebase.Editor.HandleInput.html#getLinks"><span class="hs-identifier hs-var">getLinks</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403379"><span class="hs-identifier hs-var">srcLoc</span></a></span><span> </span><span class="annot"><span class="annottext">HQSplit'
</span><a href="#local-6989586621679403377"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; Either (Set Reference) (Maybe String)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Set Reference -&gt; Either (Set Reference) (Maybe String))
-&gt; Set Reference -&gt; Either (Set Reference) (Maybe String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; Set Reference
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">DD.docRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Reference
</span><span class="hs-identifier hs-var">DD.doc2Ref</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3012"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403358"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3013"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r ()
forall r. Cli r ()
</span><a href="#local-6989586621679403355"><span class="hs-identifier hs-var">codebaseByName</span></a></span><span>
</span><span id="line-3014"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679403354"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403354"><span class="hs-identifier hs-var">_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403353"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403353"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403352"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679403352"><span class="hs-identifier hs-var">_tm</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3015"></span><span>          </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403351"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403351"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3016"></span><span>          </span><span id="local-6989586621679403350"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403350"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.branchHashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403351"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3017"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403349"><span class="annot"><span class="annottext">names :: NamesWithHistory
</span><a href="#local-6989586621679403349"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403378"><span class="hs-identifier hs-var">prettyPrintNames</span></a></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-3018"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403348"><span class="annot"><span class="annottext">tm :: Term Symbol Ann
</span><a href="#local-6989586621679403348"><span class="hs-identifier hs-var hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Reference -&gt; Term Symbol Ann
forall v a vt at ap. Ord v =&gt; a -&gt; Reference -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ref</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">External</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403353"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-3019"></span><span>          </span><span id="local-6989586621679403347"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403347"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Term Symbol Ann)
forall r.
Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Term Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTerm"><span class="hs-identifier hs-var">evalUnisonTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.fromNames</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403350"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403349"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403348"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-3020"></span><span>          </span><span class="annot"><span class="annottext">OutputLocation -&gt; NamesWithHistory -&gt; Term Symbol () -&gt; Cli r ()
forall r.
OutputLocation -&gt; NamesWithHistory -&gt; Term Symbol () -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#doDisplay"><span class="hs-identifier hs-var">doDisplay</span></a></span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#ConsoleLocation"><span class="hs-identifier hs-var">ConsoleLocation</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403349"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Term Symbol ()
forall vt at ap v a. Ord v =&gt; Term2 vt at ap v a -&gt; Term0' vt v
</span><span class="hs-identifier hs-var">Term.unannotate</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403347"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3021"></span><span>        </span><span id="local-6989586621679403345"><span class="annot"><span class="annottext">[(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403345"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
          #numberedArgs .= fmap (HQ.toString . view _1) out
</span><span>          </span><span class="hs-identifier">Cli.respond</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">ListOfLinks</span><span> </span><span class="hs-identifier">ppe</span><span> </span><span class="hs-identifier">out</span><span>
</span><span id="line-3024"></span><span>
</span><span id="line-3025"></span><span>    </span><span id="local-6989586621679403343"><span class="annot"><a href="#local-6989586621679403355"><span class="hs-identifier hs-type">codebaseByName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679403343"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-3026"></span><span>    </span><span id="local-6989586621679403355"><span class="annot"><span class="annottext">codebaseByName :: Cli r ()
</span><a href="#local-6989586621679403355"><span class="hs-identifier hs-var hs-var">codebaseByName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3027"></span><span>      </span><span id="local-6989586621679403342"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403342"><span class="hs-identifier hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicParseNames"><span class="hs-identifier hs-var">basicParseNames</span></a></span><span>
</span><span id="line-3028"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; NamesWithHistory -&gt; Set Referent
</span><span class="hs-identifier hs-var">NamesWithHistory.lookupHQTerm</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403372"><span class="hs-identifier hs-var">dotDoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403342"><span class="hs-identifier hs-var">parseNames</span></a></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3029"></span><span>        </span><span id="local-6989586621679403341"><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403341"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-3030"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403341"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Names -&gt; OutputLocation -&gt; HashQualified Name -&gt; Cli r ()
forall r. Names -&gt; OutputLocation -&gt; HashQualified Name -&gt; Cli r ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayI"><span class="hs-identifier hs-var">displayI</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403378"><span class="hs-identifier hs-var">prettyPrintNames</span></a></span><span> </span><span class="annot"><span class="annottext">OutputLocation
</span><a href="Unison.Codebase.Editor.Input.html#ConsoleLocation"><span class="hs-identifier hs-var">ConsoleLocation</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403372"><span class="hs-identifier hs-var">dotDoc</span></a></span><span>
</span><span id="line-3031"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403341"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; [(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ListOfLinks"><span class="hs-identifier hs-var">ListOfLinks</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.empty</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3032"></span><span>          </span><span class="hs-comment">-- todo: return a list of links here too</span><span>
</span><span id="line-3033"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r. Output -&gt; Cli r ()
</span><a href="Unison.Cli.Monad.html#respond"><span class="hs-identifier hs-var">Cli.respond</span></a></span><span> </span><span class="annot"><span class="annottext">(Output -&gt; Cli r ()) -&gt; Output -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
-&gt; [(HashQualified Name, Reference, Maybe (Type Symbol Ann))]
-&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ListOfLinks"><span class="hs-identifier hs-var">ListOfLinks</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><span class="hs-identifier hs-var">PPE.empty</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3034"></span><span>
</span><span id="line-3035"></span><span id="local-6989586621679406762"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#filterBySlurpResult"><span class="hs-identifier hs-type">filterBySlurpResult</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3036"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679406762"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-3037"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpResult.html#SlurpResult"><span class="hs-identifier hs-type">SlurpResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406762"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3038"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UF.TypecheckedUnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621679406762"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3039"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UF.TypecheckedUnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621679406762"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span></span><span>
</span><span id="line-3040"></span><span id="filterBySlurpResult"><span class="annot"><span class="annottext">filterBySlurpResult :: SlurpResult v
-&gt; TypecheckedUnisonFile v Ann -&gt; TypecheckedUnisonFile v Ann
</span><a href="Unison.Codebase.Editor.HandleInput.html#filterBySlurpResult"><span class="hs-identifier hs-var hs-var">filterBySlurpResult</span></a></span></span><span>
</span><span id="line-3041"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpResult.html#SlurpResult"><span class="hs-identifier hs-type">SlurpResult</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403338"><span class="annot"><span class="annottext">SlurpComponent v
adds :: SlurpComponent v
$sel:adds:SlurpResult :: forall v. SlurpResult v -&gt; SlurpComponent v
</span><a href="#local-6989586621679403338"><span class="hs-identifier hs-var hs-var">adds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403337"><span class="annot"><span class="annottext">SlurpComponent v
updates :: SlurpComponent v
$sel:updates:SlurpResult :: forall v. SlurpResult v -&gt; SlurpComponent v
</span><a href="#local-6989586621679403337"><span class="hs-identifier hs-var hs-var">updates</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-3042"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UF.TypecheckedUnisonFileId</span></span><span>
</span><span id="line-3043"></span><span>      </span><span id="local-6989586621679403335"><span class="annot"><span class="annottext">Map v (Id, DataDeclaration v Ann)
</span><a href="#local-6989586621679403335"><span class="hs-identifier hs-var">dataDeclarations'</span></a></span></span><span>
</span><span id="line-3044"></span><span>      </span><span id="local-6989586621679403334"><span class="annot"><span class="annottext">Map v (Id, EffectDeclaration v Ann)
</span><a href="#local-6989586621679403334"><span class="hs-identifier hs-var">effectDeclarations'</span></a></span></span><span>
</span><span id="line-3045"></span><span>      </span><span id="local-6989586621679403333"><span class="annot"><span class="annottext">[[(v, Term v Ann, Type v Ann)]]
</span><a href="#local-6989586621679403333"><span class="hs-identifier hs-var">topLevelComponents'</span></a></span></span><span>
</span><span id="line-3046"></span><span>      </span><span id="local-6989586621679403332"><span class="annot"><span class="annottext">[(String, [(v, Term v Ann, Type v Ann)])]
</span><a href="#local-6989586621679403332"><span class="hs-identifier hs-var">watchComponents</span></a></span></span><span>
</span><span id="line-3047"></span><span>      </span><span id="local-6989586621679403331"><span class="annot"><span class="annottext">Map v (Id, Maybe String, Term v Ann, Type v Ann)
</span><a href="#local-6989586621679403331"><span class="hs-identifier hs-var">hashTerms</span></a></span></span><span>
</span><span id="line-3048"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3049"></span><span>    </span><span class="annot"><span class="annottext">Map v (Id, DataDeclaration v Ann)
-&gt; Map v (Id, EffectDeclaration v Ann)
-&gt; [[(v, Term v Ann, Type v Ann)]]
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
-&gt; Map v (Id, Maybe String, Term v Ann, Type v Ann)
-&gt; TypecheckedUnisonFile v Ann
forall v a.
Map v (Id, DataDeclaration v a)
-&gt; Map v (Id, EffectDeclaration v a)
-&gt; [[(v, Term v a, Type v a)]]
-&gt; [(String, [(v, Term v a, Type v a)])]
-&gt; Map v (Id, Maybe String, Term v a, Type v a)
-&gt; TypecheckedUnisonFile v a
</span><span class="hs-identifier hs-var">UF.TypecheckedUnisonFileId</span></span><span> </span><span class="annot"><span class="annottext">Map v (Id, DataDeclaration v Ann)
</span><a href="#local-6989586621679403330"><span class="hs-identifier hs-var">datas</span></a></span><span> </span><span class="annot"><span class="annottext">Map v (Id, EffectDeclaration v Ann)
</span><a href="#local-6989586621679403329"><span class="hs-identifier hs-var">effects</span></a></span><span> </span><span class="annot"><span class="annottext">[[(v, Term v Ann, Type v Ann)]]
</span><a href="#local-6989586621679403328"><span class="hs-identifier hs-var">tlcs</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(v, Term v Ann, Type v Ann)])]
</span><a href="#local-6989586621679403327"><span class="hs-identifier hs-var">watches</span></a></span><span> </span><span class="annot"><span class="annottext">Map v (Id, Maybe String, Term v Ann, Type v Ann)
</span><a href="#local-6989586621679403326"><span class="hs-identifier hs-var">hashTerms'</span></a></span><span>
</span><span id="line-3050"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-3051"></span><span>      </span><span id="local-6989586621679403325"><span class="annot"><span class="annottext">keep :: SlurpComponent v
</span><a href="#local-6989586621679403325"><span class="hs-identifier hs-var hs-var">keep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlurpComponent v
</span><a href="#local-6989586621679403337"><span class="hs-identifier hs-var">updates</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent v -&gt; SlurpComponent v -&gt; SlurpComponent v
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SlurpComponent v
</span><a href="#local-6989586621679403338"><span class="hs-identifier hs-var">adds</span></a></span><span>
</span><span id="line-3052"></span><span>      </span><span id="local-6989586621679403324"><span class="annot"><span class="annottext">keepTerms :: Set v
</span><a href="#local-6989586621679403324"><span class="hs-identifier hs-var hs-var">keepTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlurpComponent v -&gt; Set v
forall v. SlurpComponent v -&gt; Set v
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#%24sel%3Aterms%3ASlurpComponent"><span class="hs-identifier hs-var hs-var">SC.terms</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent v
</span><a href="#local-6989586621679403325"><span class="hs-identifier hs-var">keep</span></a></span><span>
</span><span id="line-3053"></span><span>      </span><span id="local-6989586621679403323"><span class="annot"><span class="annottext">keepTypes :: Set v
</span><a href="#local-6989586621679403323"><span class="hs-identifier hs-var hs-var">keepTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlurpComponent v -&gt; Set v
forall v. SlurpComponent v -&gt; Set v
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#%24sel%3Atypes%3ASlurpComponent"><span class="hs-identifier hs-var hs-var">SC.types</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent v
</span><a href="#local-6989586621679403325"><span class="hs-identifier hs-var">keep</span></a></span><span>
</span><span id="line-3054"></span><span>      </span><span id="local-6989586621679403326"><span class="annot"><span class="annottext">hashTerms' :: Map v (Id, Maybe String, Term v Ann, Type v Ann)
</span><a href="#local-6989586621679403326"><span class="hs-identifier hs-var hs-var">hashTerms'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map v (Id, Maybe String, Term v Ann, Type v Ann)
-&gt; Set v -&gt; Map v (Id, Maybe String, Term v Ann, Type v Ann)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map v (Id, Maybe String, Term v Ann, Type v Ann)
</span><a href="#local-6989586621679403331"><span class="hs-identifier hs-var">hashTerms</span></a></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621679403324"><span class="hs-identifier hs-var">keepTerms</span></a></span><span>
</span><span id="line-3055"></span><span>      </span><span id="local-6989586621679403330"><span class="annot"><span class="annottext">datas :: Map v (Id, DataDeclaration v Ann)
</span><a href="#local-6989586621679403330"><span class="hs-identifier hs-var hs-var">datas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map v (Id, DataDeclaration v Ann)
-&gt; Set v -&gt; Map v (Id, DataDeclaration v Ann)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map v (Id, DataDeclaration v Ann)
</span><a href="#local-6989586621679403335"><span class="hs-identifier hs-var">dataDeclarations'</span></a></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621679403323"><span class="hs-identifier hs-var">keepTypes</span></a></span><span>
</span><span id="line-3056"></span><span>      </span><span id="local-6989586621679403329"><span class="annot"><span class="annottext">effects :: Map v (Id, EffectDeclaration v Ann)
</span><a href="#local-6989586621679403329"><span class="hs-identifier hs-var hs-var">effects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map v (Id, EffectDeclaration v Ann)
-&gt; Set v -&gt; Map v (Id, EffectDeclaration v Ann)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="annot"><span class="annottext">Map v (Id, EffectDeclaration v Ann)
</span><a href="#local-6989586621679403334"><span class="hs-identifier hs-var">effectDeclarations'</span></a></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621679403323"><span class="hs-identifier hs-var">keepTypes</span></a></span><span>
</span><span id="line-3057"></span><span>      </span><span id="local-6989586621679403328"><span class="annot"><span class="annottext">tlcs :: [[(v, Term v Ann, Type v Ann)]]
</span><a href="#local-6989586621679403328"><span class="hs-identifier hs-var hs-var">tlcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(v, Term v Ann, Type v Ann)] -&gt; Bool)
-&gt; [[(v, Term v Ann, Type v Ann)]]
-&gt; [[(v, Term v Ann, Type v Ann)]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ([(v, Term v Ann, Type v Ann)] -&gt; Bool)
-&gt; [(v, Term v Ann, Type v Ann)]
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(v, Term v Ann, Type v Ann)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[(v, Term v Ann, Type v Ann)]]
 -&gt; [[(v, Term v Ann, Type v Ann)]])
-&gt; [[(v, Term v Ann, Type v Ann)]]
-&gt; [[(v, Term v Ann, Type v Ann)]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([(v, Term v Ann, Type v Ann)] -&gt; [(v, Term v Ann, Type v Ann)])
-&gt; [[(v, Term v Ann, Type v Ann)]]
-&gt; [[(v, Term v Ann, Type v Ann)]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((v, Term v Ann, Type v Ann) -&gt; Bool)
-&gt; [(v, Term v Ann, Type v Ann)] -&gt; [(v, Term v Ann, Type v Ann)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.filter</span></span><span> </span><span class="annot"><span class="annottext">(v, Term v Ann, Type v Ann) -&gt; Bool
</span><a href="#local-6989586621679403321"><span class="hs-identifier hs-var">filterTLC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[(v, Term v Ann, Type v Ann)]]
</span><a href="#local-6989586621679403333"><span class="hs-identifier hs-var">topLevelComponents'</span></a></span><span>
</span><span id="line-3058"></span><span>      </span><span id="local-6989586621679403327"><span class="annot"><span class="annottext">watches :: [(String, [(v, Term v Ann, Type v Ann)])]
</span><a href="#local-6989586621679403327"><span class="hs-identifier hs-var hs-var">watches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, [(v, Term v Ann, Type v Ann)]) -&gt; Bool)
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((String, [(v, Term v Ann, Type v Ann)]) -&gt; Bool)
-&gt; (String, [(v, Term v Ann, Type v Ann)])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[(v, Term v Ann, Type v Ann)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([(v, Term v Ann, Type v Ann)] -&gt; Bool)
-&gt; ((String, [(v, Term v Ann, Type v Ann)])
    -&gt; [(v, Term v Ann, Type v Ann)])
-&gt; (String, [(v, Term v Ann, Type v Ann)])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, [(v, Term v Ann, Type v Ann)])
-&gt; [(v, Term v Ann, Type v Ann)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(String, [(v, Term v Ann, Type v Ann)])]
 -&gt; [(String, [(v, Term v Ann, Type v Ann)])])
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((String, [(v, Term v Ann, Type v Ann)])
 -&gt; (String, [(v, Term v Ann, Type v Ann)]))
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(v, Term v Ann, Type v Ann)] -&gt; [(v, Term v Ann, Type v Ann)])
-&gt; (String, [(v, Term v Ann, Type v Ann)])
-&gt; (String, [(v, Term v Ann, Type v Ann)])
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((v, Term v Ann, Type v Ann) -&gt; Bool)
-&gt; [(v, Term v Ann, Type v Ann)] -&gt; [(v, Term v Ann, Type v Ann)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">List.filter</span></span><span> </span><span class="annot"><span class="annottext">(v, Term v Ann, Type v Ann) -&gt; Bool
</span><a href="#local-6989586621679403321"><span class="hs-identifier hs-var">filterTLC</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, [(v, Term v Ann, Type v Ann)])]
</span><a href="#local-6989586621679403332"><span class="hs-identifier hs-var">watchComponents</span></a></span><span>
</span><span id="line-3059"></span><span>      </span><span id="local-6989586621679403321"><span class="annot"><span class="annottext">filterTLC :: (v, Term v Ann, Type v Ann) -&gt; Bool
</span><a href="#local-6989586621679403321"><span class="hs-identifier hs-var hs-var">filterTLC</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403320"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403320"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">v -&gt; Set v -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403320"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621679403324"><span class="hs-identifier hs-var">keepTerms</span></a></span><span>
</span><span id="line-3060"></span><span>
</span><span id="line-3061"></span><span class="hs-comment">-- updates the namespace for adding `slurp`</span><span>
</span><span id="line-3062"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#doSlurpAdds"><span class="hs-identifier hs-type">doSlurpAdds</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3063"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679406767"><span class="annot"><a href="#local-6989586621679406767"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679406766"><span class="annot"><a href="#local-6989586621679406766"><span class="hs-identifier hs-type">v</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-3064"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679406767"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679406766"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-3065"></span><span>  </span><span class="annot"><a href="Unison.Codebase.Editor.SlurpComponent.html#SlurpComponent"><span class="hs-identifier hs-type">SlurpComponent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406766"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3066"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UF.TypecheckedUnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621679406766"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3067"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406767"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3068"></span><span id="doSlurpAdds"><span class="annot"><span class="annottext">doSlurpAdds :: SlurpComponent v
-&gt; TypecheckedUnisonFile v Ann -&gt; Branch0 m -&gt; Branch0 m
</span><a href="Unison.Codebase.Editor.HandleInput.html#doSlurpAdds"><span class="hs-identifier hs-var hs-var">doSlurpAdds</span></a></span></span><span> </span><span id="local-6989586621679403319"><span class="annot"><span class="annottext">SlurpComponent v
</span><a href="#local-6989586621679403319"><span class="hs-identifier hs-var">slurp</span></a></span></span><span> </span><span id="local-6989586621679403318"><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403318"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)] -&gt; Branch0 m -&gt; Branch0 m
forall (f :: * -&gt; *) (m :: * -&gt; *).
(Monad m, Foldable f) =&gt;
f (Path, Branch0 m -&gt; Branch0 m) -&gt; Branch0 m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.batchUpdates</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403316"><span class="hs-identifier hs-var">typeActions</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403315"><span class="hs-identifier hs-var">termActions</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3069"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3070"></span><span>    </span><span id="local-6989586621679403316"><span class="annot"><span class="annottext">typeActions :: [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403316"><span class="hs-identifier hs-var hs-var">typeActions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(v -&gt; (Path, Branch0 m -&gt; Branch0 m))
-&gt; [v] -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679403314"><span class="hs-identifier hs-var">doType</span></a></span><span> </span><span class="annot"><span class="annottext">([v] -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; (Set v -&gt; [v]) -&gt; Set v -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; [v]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; Set v -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlurpComponent v -&gt; Set v
forall v. SlurpComponent v -&gt; Set v
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#%24sel%3Atypes%3ASlurpComponent"><span class="hs-identifier hs-var hs-var">SC.types</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent v
</span><a href="#local-6989586621679403319"><span class="hs-identifier hs-var">slurp</span></a></span><span>
</span><span id="line-3071"></span><span>    </span><span id="local-6989586621679403315"><span class="annot"><span class="annottext">termActions :: [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403315"><span class="hs-identifier hs-var hs-var">termActions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3072"></span><span>      </span><span class="annot"><span class="annottext">(v -&gt; (Path, Branch0 m -&gt; Branch0 m))
-&gt; [v] -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679403313"><span class="hs-identifier hs-var">doTerm</span></a></span><span> </span><span class="annot"><span class="annottext">([v] -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; (Set v -&gt; [v]) -&gt; Set v -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; [v]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">(Set v -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; Set v -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3073"></span><span>        </span><span class="annot"><span class="annottext">SlurpComponent v -&gt; Set v
forall v. SlurpComponent v -&gt; Set v
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#%24sel%3Aterms%3ASlurpComponent"><span class="hs-identifier hs-var hs-var">SC.terms</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent v
</span><a href="#local-6989586621679403319"><span class="hs-identifier hs-var">slurp</span></a></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; Set v -&gt; Set v
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set v -&gt; TypecheckedUnisonFile v Ann -&gt; Set v
forall v a. Ord v =&gt; Set v -&gt; TypecheckedUnisonFile v a -&gt; Set v
</span><span class="hs-identifier hs-var">UF.constructorsForDecls</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlurpComponent v -&gt; Set v
forall v. SlurpComponent v -&gt; Set v
</span><a href="Unison.Codebase.Editor.SlurpComponent.html#%24sel%3Atypes%3ASlurpComponent"><span class="hs-identifier hs-var hs-var">SC.types</span></a></span><span> </span><span class="annot"><span class="annottext">SlurpComponent v
</span><a href="#local-6989586621679403319"><span class="hs-identifier hs-var">slurp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403318"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-3074"></span><span>    </span><span id="local-6989586621679403311"><span class="annot"><span class="annottext">names :: Names
</span><a href="#local-6989586621679403311"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann -&gt; Names
forall v a. Var v =&gt; TypecheckedUnisonFile v a -&gt; Names
</span><span class="hs-identifier hs-var">UF.typecheckedToNames</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403318"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-3075"></span><span>    </span><span id="local-6989586621679403310"><span class="annot"><span class="annottext">tests :: Set v
</span><a href="#local-6989586621679403310"><span class="hs-identifier hs-var hs-var">tests</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[v] -&gt; Set v
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([v] -&gt; Set v) -&gt; [v] -&gt; Set v
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(v, Term v Ann) -&gt; v
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((v, Term v Ann) -&gt; v) -&gt; [(v, Term v Ann)] -&gt; [v]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; UnisonFile v Ann -&gt; [(v, Term v Ann)]
forall v a. String -&gt; UnisonFile v a -&gt; [(v, Term v a)]
</span><span class="hs-identifier hs-var">UF.watchesOfKind</span></span><span> </span><span class="annot"><span class="annottext">String
forall a. (Eq a, IsString a) =&gt; a
</span><span class="hs-identifier hs-var">WK.TestWatch</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann -&gt; UnisonFile v Ann
forall v a. TypecheckedUnisonFile v a -&gt; UnisonFile v a
</span><span class="hs-identifier hs-var">UF.discardTypes</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403318"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3076"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679403307"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403307"><span class="hs-identifier hs-var">isTestType</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403306"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403306"><span class="hs-identifier hs-var">isTestValue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Reference, Reference)
</span><span class="hs-identifier hs-var">isTest</span></span><span>
</span><span id="line-3077"></span><span>    </span><span id="local-6989586621679403305"><span class="annot"><span class="annottext">md :: v -&gt; Metadata
</span><a href="#local-6989586621679403305"><span class="hs-identifier hs-var hs-var">md</span></a></span></span><span> </span><span id="local-6989586621679403304"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403304"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3078"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">v -&gt; Set v -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">Set.member</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403304"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Set v
</span><a href="#local-6989586621679403310"><span class="hs-identifier hs-var">tests</span></a></span><span>
</span><span id="line-3079"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Reference -&gt; Metadata
</span><span class="hs-identifier hs-var">Metadata.singleton</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403307"><span class="hs-identifier hs-var">isTestType</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403306"><span class="hs-identifier hs-var">isTestValue</span></a></span><span>
</span><span id="line-3080"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><span class="hs-identifier hs-var">Metadata.empty</span></span><span>
</span><span id="line-3081"></span><span>    </span><span class="annot"><a href="#local-6989586621679403313"><span class="hs-identifier hs-type">doTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679406766"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406767"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3082"></span><span>    </span><span id="local-6989586621679403313"><span class="annot"><span class="annottext">doTerm :: v -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679403313"><span class="hs-identifier hs-var hs-var">doTerm</span></a></span></span><span> </span><span id="local-6989586621679403302"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403302"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Set Referent
</span><span class="hs-identifier hs-var">Names.termsNamed</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403311"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403302"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3083"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">v -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679403300"><span class="hs-identifier hs-var">errorMissingVar</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403302"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-3084"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621679403299"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403299"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Split
</span><span class="hs-identifier hs-var">Path.splitFromName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403302"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3085"></span><span>        </span><span class="annot"><span class="annottext">Maybe Split
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Path, Branch0 m -&gt; Branch0 m)
forall a. a
</span><a href="#local-6989586621679403297"><span class="hs-identifier hs-var">errorEmptyVar</span></a></span><span>
</span><span id="line-3086"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403296"><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403296"><span class="hs-identifier hs-var">split</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTermName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403296"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403299"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Metadata
</span><a href="#local-6989586621679403305"><span class="hs-identifier hs-var">md</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403302"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3087"></span><span>      </span><span id="local-6989586621679403295"><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679403295"><span class="hs-identifier hs-var">wha</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3088"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; (Path, Branch0 m -&gt; Branch0 m))
-&gt; String -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3089"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unison bug, typechecked file w/ multiple terms named &quot;</span></span><span>
</span><span id="line-3090"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; String
forall v. Var v =&gt; v -&gt; String
</span><span class="hs-identifier hs-var">Var.nameStr</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403302"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-3091"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span>
</span><span id="line-3092"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Referent] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Referent]
</span><a href="#local-6989586621679403295"><span class="hs-identifier hs-var">wha</span></a></span><span>
</span><span id="line-3093"></span><span>    </span><span class="annot"><a href="#local-6989586621679403314"><span class="hs-identifier hs-type">doType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679406766"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406767"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406767"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3094"></span><span>    </span><span id="local-6989586621679403314"><span class="annot"><span class="annottext">doType :: v -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679403314"><span class="hs-identifier hs-var hs-var">doType</span></a></span></span><span> </span><span id="local-6989586621679403293"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403293"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Name -&gt; Set Reference
</span><span class="hs-identifier hs-var">Names.typesNamed</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403311"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403293"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3095"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">v -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679403300"><span class="hs-identifier hs-var">errorMissingVar</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403293"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-3096"></span><span>      </span><span class="hs-special">[</span><span id="local-6989586621679403292"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403292"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Split
</span><span class="hs-identifier hs-var">Path.splitFromName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">v -&gt; Name
forall v. Var v =&gt; v -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromVar</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403293"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3097"></span><span>        </span><span class="annot"><span class="annottext">Maybe Split
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Path, Branch0 m -&gt; Branch0 m)
forall a. a
</span><a href="#local-6989586621679403297"><span class="hs-identifier hs-var">errorEmptyVar</span></a></span><span>
</span><span id="line-3098"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403291"><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403291"><span class="hs-identifier hs-var">split</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall (m :: * -&gt; *).
Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTypeName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403291"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403292"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><span class="hs-identifier hs-var">Metadata.empty</span></span><span>
</span><span id="line-3099"></span><span>      </span><span id="local-6989586621679403290"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679403290"><span class="hs-identifier hs-var">wha</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3100"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; (Path, Branch0 m -&gt; Branch0 m))
-&gt; String -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3101"></span><span>          </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unison bug, typechecked file w/ multiple types named &quot;</span></span><span>
</span><span id="line-3102"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; String
forall v. Var v =&gt; v -&gt; String
</span><span class="hs-identifier hs-var">Var.nameStr</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403293"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-3103"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: &quot;</span></span><span>
</span><span id="line-3104"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Reference] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679403290"><span class="hs-identifier hs-var">wha</span></a></span><span>
</span><span id="line-3105"></span><span>    </span><span id="local-6989586621679403297"><span class="annot"><span class="annottext">errorEmptyVar :: a
</span><a href="#local-6989586621679403297"><span class="hs-identifier hs-var hs-var">errorEmptyVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;encountered an empty var name&quot;</span></span><span>
</span><span id="line-3106"></span><span>    </span><span id="local-6989586621679403300"><span class="annot"><span class="annottext">errorMissingVar :: v -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><a href="#local-6989586621679403300"><span class="hs-identifier hs-var hs-var">errorMissingVar</span></a></span></span><span> </span><span id="local-6989586621679403289"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403289"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; (Path, Branch0 m -&gt; Branch0 m))
-&gt; String -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;expected to find &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">v -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403289"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; in &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403318"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-3107"></span><span>
</span><span id="line-3108"></span><span id="local-6989586621679406321"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#doSlurpUpdates"><span class="hs-identifier hs-type">doSlurpUpdates</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3109"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679406321"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-3110"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3111"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3112"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3113"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406321"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406321"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-3114"></span><span id="doSlurpUpdates"><span class="annot"><span class="annottext">doSlurpUpdates :: [(Name, Reference, Reference)]
-&gt; [(Name, Reference, Reference)]
-&gt; [(Name, Referent)]
-&gt; Branch0 m
-&gt; Branch0 m
</span><a href="Unison.Codebase.Editor.HandleInput.html#doSlurpUpdates"><span class="hs-identifier hs-var hs-var">doSlurpUpdates</span></a></span></span><span> </span><span id="local-6989586621679403288"><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403288"><span class="hs-identifier hs-var">typeEdits</span></a></span></span><span> </span><span id="local-6989586621679403287"><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403287"><span class="hs-identifier hs-var">termEdits</span></a></span></span><span> </span><span id="local-6989586621679403286"><span class="annot"><span class="annottext">[(Name, Referent)]
</span><a href="#local-6989586621679403286"><span class="hs-identifier hs-var">deprecated</span></a></span></span><span> </span><span id="local-6989586621679403285"><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679403285"><span class="hs-identifier hs-var">b0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3115"></span><span>  </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)] -&gt; Branch0 m -&gt; Branch0 m
forall (f :: * -&gt; *) (m :: * -&gt; *).
(Monad m, Foldable f) =&gt;
f (Path, Branch0 m -&gt; Branch0 m) -&gt; Branch0 m -&gt; Branch0 m
</span><span class="hs-identifier hs-var">Branch.batchUpdates</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403284"><span class="hs-identifier hs-var">typeActions</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403283"><span class="hs-identifier hs-var">termActions</span></a></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403282"><span class="hs-identifier hs-var">deprecateActions</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679403285"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-3116"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3117"></span><span>    </span><span id="local-6989586621679403284"><span class="annot"><span class="annottext">typeActions :: [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403284"><span class="hs-identifier hs-var hs-var">typeActions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Path, Branch0 m -&gt; Branch0 m)]]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[(Path, Branch0 m -&gt; Branch0 m)]]
 -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; ([(Name, Reference, Reference)]
    -&gt; [[(Path, Branch0 m -&gt; Branch0 m)]])
-&gt; [(Name, Reference, Reference)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, Reference, Reference) -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; [(Name, Reference, Reference)]
-&gt; [[(Path, Branch0 m -&gt; Branch0 m)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, Reference, Reference) -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall (m :: * -&gt; *).
(Name, Reference, Reference) -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403281"><span class="hs-identifier hs-var">doType</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, Reference, Reference)]
 -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; [(Name, Reference, Reference)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403288"><span class="hs-identifier hs-var">typeEdits</span></a></span><span>
</span><span id="line-3118"></span><span>    </span><span id="local-6989586621679403283"><span class="annot"><span class="annottext">termActions :: [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403283"><span class="hs-identifier hs-var hs-var">termActions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Path, Branch0 m -&gt; Branch0 m)]]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[(Path, Branch0 m -&gt; Branch0 m)]]
 -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; ([(Name, Reference, Reference)]
    -&gt; [[(Path, Branch0 m -&gt; Branch0 m)]])
-&gt; [(Name, Reference, Reference)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, Reference, Reference) -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; [(Name, Reference, Reference)]
-&gt; [[(Path, Branch0 m -&gt; Branch0 m)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, Reference, Reference) -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall (m :: * -&gt; *).
(Name, Reference, Reference) -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403280"><span class="hs-identifier hs-var">doTerm</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, Reference, Reference)]
 -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; [(Name, Reference, Reference)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Reference, Reference)]
</span><a href="#local-6989586621679403287"><span class="hs-identifier hs-var">termEdits</span></a></span><span>
</span><span id="line-3119"></span><span>    </span><span id="local-6989586621679403282"><span class="annot"><span class="annottext">deprecateActions :: [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403282"><span class="hs-identifier hs-var hs-var">deprecateActions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Path, Branch0 m -&gt; Branch0 m)]]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[(Path, Branch0 m -&gt; Branch0 m)]]
 -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; ([(Name, Referent)] -&gt; [[(Path, Branch0 m -&gt; Branch0 m)]])
-&gt; [(Name, Referent)]
-&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Name, Referent) -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; [(Name, Referent)] -&gt; [[(Path, Branch0 m -&gt; Branch0 m)]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Name, Referent) -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall (m :: * -&gt; *).
(Name, Referent) -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403279"><span class="hs-identifier hs-var">doDeprecate</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, Referent)] -&gt; [(Path, Branch0 m -&gt; Branch0 m)])
-&gt; [(Name, Referent)] -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Name, Referent)]
</span><a href="#local-6989586621679403286"><span class="hs-identifier hs-var">deprecated</span></a></span><span>
</span><span id="line-3120"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3121"></span><span>        </span><span id="local-6989586621679403279"><span class="annot"><span class="annottext">doDeprecate :: (Name, Referent) -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403279"><span class="hs-identifier hs-var hs-var">doDeprecate</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403278"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403278"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403277"><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403277"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Split
</span><span class="hs-identifier hs-var">Path.splitFromName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403278"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3122"></span><span>          </span><span class="annot"><span class="annottext">Maybe Split
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
forall a. a
</span><a href="#local-6989586621679403276"><span class="hs-identifier hs-var">errorEmptyVar</span></a></span><span>
</span><span id="line-3123"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403275"><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403275"><span class="hs-identifier hs-var">split</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteTermName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403275"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Referent
</span><a href="#local-6989586621679403277"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3124"></span><span>
</span><span id="line-3125"></span><span>    </span><span class="hs-comment">-- we copy over the metadata on the old thing</span><span>
</span><span id="line-3126"></span><span>    </span><span class="hs-comment">-- todo: if the thing being updated, m, is metadata for something x in b0</span><span>
</span><span id="line-3127"></span><span>    </span><span class="hs-comment">-- update x's md to reference `m`</span><span>
</span><span id="line-3128"></span><span>    </span><span id="local-6989586621679406124"><span class="annot"><a href="#local-6989586621679403281"><span class="hs-identifier hs-type">doType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypeReference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406124"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406124"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-3129"></span><span>    </span><span id="local-6989586621679403281"><span class="annot"><span class="annottext">doType :: (Name, Reference, Reference) -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403281"><span class="hs-identifier hs-var hs-var">doType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403274"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403274"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403273"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403273"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403272"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403272"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Split
</span><span class="hs-identifier hs-var">Path.splitFromName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403274"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3130"></span><span>      </span><span class="annot"><span class="annottext">Maybe Split
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
forall a. a
</span><a href="#local-6989586621679403276"><span class="hs-identifier hs-var">errorEmptyVar</span></a></span><span>
</span><span id="line-3131"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403271"><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403271"><span class="hs-identifier hs-var">split</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3132"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall (m :: * -&gt; *).
Split -&gt; Reference -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteTypeName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403271"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403273"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3133"></span><span>          </span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall (m :: * -&gt; *).
Split -&gt; Reference -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTypeName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403271"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403272"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679403270"><span class="hs-identifier hs-var">oldMd</span></a></span><span>
</span><span id="line-3134"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-3135"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-3136"></span><span>          </span><span id="local-6989586621679403270"><span class="annot"><span class="annottext">oldMd :: Metadata
</span><a href="#local-6989586621679403270"><span class="hs-identifier hs-var hs-var">oldMd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Reference -&gt; Branch0 m -&gt; Metadata
forall a (m :: * -&gt; *).
(Path, a) -&gt; Reference -&gt; Branch0 m -&gt; Metadata
</span><span class="hs-identifier hs-var">BranchUtil.getTypeMetadataAt</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403271"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403273"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679403285"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-3137"></span><span>    </span><span id="local-6989586621679403269"><span class="annot"><a href="#local-6989586621679403280"><span class="hs-identifier hs-type">doTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TermReference</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679403269"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679403269"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span></span><span>
</span><span id="line-3138"></span><span>    </span><span id="local-6989586621679403280"><span class="annot"><span class="annottext">doTerm :: (Name, Reference, Reference) -&gt; [(Path, Branch0 m -&gt; Branch0 m)]
</span><a href="#local-6989586621679403280"><span class="hs-identifier hs-var hs-var">doTerm</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403268"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403268"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403267"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403267"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403266"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403266"><span class="hs-identifier hs-var">new</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Split
</span><span class="hs-identifier hs-var">Path.splitFromName</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403268"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3139"></span><span>      </span><span class="annot"><span class="annottext">Maybe Split
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[(Path, Branch0 m -&gt; Branch0 m)]
forall a. a
</span><a href="#local-6989586621679403276"><span class="hs-identifier hs-var">errorEmptyVar</span></a></span><span>
</span><span id="line-3140"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403265"><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403265"><span class="hs-identifier hs-var">split</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3141"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeDeleteTermName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403265"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403267"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-3142"></span><span>          </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
forall (m :: * -&gt; *).
Split -&gt; Referent -&gt; Metadata -&gt; (Path, Branch0 m -&gt; Branch0 m)
</span><span class="hs-identifier hs-var">BranchUtil.makeAddTermName</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403265"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403266"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621679403264"><span class="hs-identifier hs-var">oldMd</span></a></span><span>
</span><span id="line-3143"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-3144"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-3145"></span><span>          </span><span class="hs-comment">-- oldMd is the metadata linked to the old definition</span><span>
</span><span id="line-3146"></span><span>          </span><span class="hs-comment">-- we relink it to the new definition</span><span>
</span><span id="line-3147"></span><span>          </span><span id="local-6989586621679403264"><span class="annot"><span class="annottext">oldMd :: Metadata
</span><a href="#local-6989586621679403264"><span class="hs-identifier hs-var hs-var">oldMd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Split -&gt; Referent -&gt; Branch0 m -&gt; Metadata
forall a (m :: * -&gt; *).
(Path, a) -&gt; Referent -&gt; Branch0 m -&gt; Metadata
</span><span class="hs-identifier hs-var">BranchUtil.getTermMetadataAt</span></span><span> </span><span class="annot"><span class="annottext">Split
</span><a href="#local-6989586621679403265"><span class="hs-identifier hs-var">split</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference -&gt; Referent
</span><span class="hs-identifier hs-var">Referent.Ref</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403267"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679403285"><span class="hs-identifier hs-var">b0</span></a></span><span>
</span><span id="line-3148"></span><span>    </span><span id="local-6989586621679403276"><span class="annot"><span class="annottext">errorEmptyVar :: a
</span><a href="#local-6989586621679403276"><span class="hs-identifier hs-var hs-var">errorEmptyVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;encountered an empty var name&quot;</span></span><span>
</span><span id="line-3149"></span><span>
</span><span id="line-3150"></span><span id="local-6989586621679406217"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#loadDisplayInfo"><span class="hs-identifier hs-type">loadDisplayInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3151"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3152"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span>
</span><span id="line-3153"></span><span>    </span><span class="annot"><a href="#local-6989586621679406217"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-3154"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-3155"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3156"></span><span>    </span><span class="hs-special">)</span></span><span>
</span><span id="line-3157"></span><span id="loadDisplayInfo"><span class="annot"><span class="annottext">loadDisplayInfo :: Set Reference
-&gt; Cli
     r
     ([(Reference, Maybe (Type Symbol Ann))],
      [(Reference, DisplayObject () (Decl Symbol Ann))])
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadDisplayInfo"><span class="hs-identifier hs-var hs-var">loadDisplayInfo</span></a></span></span><span> </span><span id="local-6989586621679403263"><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403263"><span class="hs-identifier hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3158"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403262"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403262"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3159"></span><span>  </span><span id="local-6989586621679403261"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679403261"><span class="hs-identifier hs-var">termRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Cli r Bool) -&gt; [Reference] -&gt; Cli r [Reference]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Bool -&gt; Cli r Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; Cli r Bool)
-&gt; (Reference -&gt; IO Bool) -&gt; Reference -&gt; Cli r Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO Bool
forall (m :: * -&gt; *) a.
(Applicative m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Reference -&gt; m Bool
</span><span class="hs-identifier hs-var">Codebase.isTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403262"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403263"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3160"></span><span>  </span><span id="local-6989586621679403258"><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679403258"><span class="hs-identifier hs-var">typeRefs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Cli r Bool) -&gt; [Reference] -&gt; Cli r [Reference]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><span class="hs-identifier hs-var">filterM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Bool -&gt; Cli r Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; Cli r Bool)
-&gt; (Reference -&gt; IO Bool) -&gt; Reference -&gt; Cli r Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO Bool
forall (m :: * -&gt; *) v a.
Applicative m =&gt;
Codebase m v a -&gt; Reference -&gt; m Bool
</span><span class="hs-identifier hs-var">Codebase.isType</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403262"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Reference -&gt; [Reference]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set Reference
</span><a href="#local-6989586621679403263"><span class="hs-identifier hs-var">refs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3161"></span><span>  </span><span id="local-6989586621679403256"><span class="annot"><span class="annottext">[(Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403256"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Reference]
-&gt; (Reference -&gt; Cli r (Reference, Maybe (Type Symbol Ann)))
-&gt; Cli r [(Reference, Maybe (Type Symbol Ann))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679403261"><span class="hs-identifier hs-var">termRefs</span></a></span><span> </span><span class="annot"><span class="annottext">((Reference -&gt; Cli r (Reference, Maybe (Type Symbol Ann)))
 -&gt; Cli r [(Reference, Maybe (Type Symbol Ann))])
-&gt; (Reference -&gt; Cli r (Reference, Maybe (Type Symbol Ann)))
-&gt; Cli r [(Reference, Maybe (Type Symbol Ann))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403254"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403254"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403254"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann) -&gt; (Reference, Maybe (Type Symbol Ann)))
-&gt; Cli r (Maybe (Type Symbol Ann))
-&gt; Cli r (Reference, Maybe (Type Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a.
(Applicative m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Reference -&gt; m (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403262"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403254"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3162"></span><span>  </span><span id="local-6989586621679403253"><span class="annot"><span class="annottext">[(Reference, DisplayObject () (Decl Symbol Ann))]
</span><a href="#local-6989586621679403253"><span class="hs-identifier hs-var">types</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Reference]
-&gt; (Reference
    -&gt; Cli r (Reference, DisplayObject () (Decl Symbol Ann)))
-&gt; Cli r [(Reference, DisplayObject () (Decl Symbol Ann))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[Reference]
</span><a href="#local-6989586621679403258"><span class="hs-identifier hs-var">typeRefs</span></a></span><span> </span><span class="annot"><span class="annottext">((Reference
  -&gt; Cli r (Reference, DisplayObject () (Decl Symbol Ann)))
 -&gt; Cli r [(Reference, DisplayObject () (Decl Symbol Ann))])
-&gt; (Reference
    -&gt; Cli r (Reference, DisplayObject () (Decl Symbol Ann)))
-&gt; Cli r [(Reference, DisplayObject () (Decl Symbol Ann))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403252"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403252"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403252"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(DisplayObject () (Decl Symbol Ann)
 -&gt; (Reference, DisplayObject () (Decl Symbol Ann)))
-&gt; Cli r (DisplayObject () (Decl Symbol Ann))
-&gt; Cli r (Reference, DisplayObject () (Decl Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Cli r (DisplayObject () (Decl Symbol Ann))
forall r. Reference -&gt; Cli r (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeDisplayObject"><span class="hs-identifier hs-var">loadTypeDisplayObject</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403252"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-3163"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Reference, Maybe (Type Symbol Ann))]
</span><a href="#local-6989586621679403256"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Reference, DisplayObject () (Decl Symbol Ann))]
</span><a href="#local-6989586621679403253"><span class="hs-identifier hs-var">types</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3164"></span><span>
</span><span id="line-3165"></span><span class="hs-comment">-- Any absolute names in the input which have `currentPath` as a prefix</span><span>
</span><span id="line-3166"></span><span class="hs-comment">-- are converted to names relative to current path. all other names are</span><span>
</span><span id="line-3167"></span><span class="hs-comment">-- converted to absolute names. For example:</span><span>
</span><span id="line-3168"></span><span class="hs-comment">--</span><span>
</span><span id="line-3169"></span><span class="hs-comment">-- e.g. if Command.currentPath = .foo.bar</span><span>
</span><span id="line-3170"></span><span class="hs-comment">--      then name foo.bar.baz becomes baz</span><span>
</span><span id="line-3171"></span><span class="hs-comment">--           name cat.dog     becomes .cat.dog</span><span>
</span><span id="line-3172"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#fixupNamesRelative"><span class="hs-identifier hs-type">fixupNamesRelative</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span>
</span><span id="line-3173"></span><span id="fixupNamesRelative"><span class="annot"><span class="annottext">fixupNamesRelative :: Absolute -&gt; Names -&gt; Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#fixupNamesRelative"><span class="hs-identifier hs-var hs-var">fixupNamesRelative</span></a></span></span><span> </span><span id="local-6989586621679403249"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403249"><span class="hs-identifier hs-var">currentPath'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.map</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="#local-6989586621679403247"><span class="hs-identifier hs-var">fixName</span></a></span><span>
</span><span id="line-3174"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3175"></span><span>    </span><span id="local-6989586621679403247"><span class="annot"><span class="annottext">fixName :: Name -&gt; Name
</span><a href="#local-6989586621679403247"><span class="hs-identifier hs-var hs-var">fixName</span></a></span></span><span> </span><span id="local-6989586621679403246"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403246"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3176"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403249"><span class="hs-identifier hs-var">currentPath'</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Absolute -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier hs-var">Path.absoluteEmpty</span></span><span>
</span><span id="line-3177"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403246"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-3178"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe Name -&gt; Name
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.makeAbsolute</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403246"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3179"></span><span>          </span><span id="local-6989586621679403244"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403244"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Path -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Path.toName</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403249"><span class="hs-identifier hs-var">currentPath'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3180"></span><span>          </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Maybe Name
</span><span class="hs-identifier hs-var">Name.stripNamePrefix</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403244"><span class="hs-identifier hs-var">prefix</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403246"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-3181"></span><span>
</span><span id="line-3182"></span><span id="local-6989586621679406100"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#makeHistoricalParsingNames"><span class="hs-identifier hs-type">makeHistoricalParsingNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406100"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span></span><span>
</span><span id="line-3183"></span><span id="makeHistoricalParsingNames"><span class="annot"><span class="annottext">makeHistoricalParsingNames :: Set (HashQualified Name) -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makeHistoricalParsingNames"><span class="hs-identifier hs-var hs-var">makeHistoricalParsingNames</span></a></span></span><span> </span><span id="local-6989586621679403240"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403240"><span class="hs-identifier hs-var">lexedHQs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3184"></span><span>  </span><span id="local-6989586621679403239"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403239"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-3185"></span><span>
</span><span id="line-3186"></span><span>  </span><span id="local-6989586621679403238"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403238"><span class="hs-identifier hs-var">rawHistoricalNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; Cli r Names
forall r. Set (HashQualified Name) -&gt; Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#findHistoricalHQs"><span class="hs-identifier hs-var">findHistoricalHQs</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403240"><span class="hs-identifier hs-var">lexedHQs</span></a></span><span>
</span><span id="line-3187"></span><span>  </span><span id="local-6989586621679403236"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403236"><span class="hs-identifier hs-var">basicNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicParseNames"><span class="hs-identifier hs-var">basicParseNames</span></a></span><span>
</span><span id="line-3188"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-3189"></span><span>    </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span>
</span><span id="line-3190"></span><span>      </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403236"><span class="hs-identifier hs-var">basicNames</span></a></span><span>
</span><span id="line-3191"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names
</span><span class="hs-identifier hs-var">Names.makeAbsolute</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403238"><span class="hs-identifier hs-var">rawHistoricalNames</span></a></span><span>
</span><span id="line-3192"></span><span>          </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; Names
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Names -&gt; Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#fixupNamesRelative"><span class="hs-identifier hs-var">fixupNamesRelative</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403239"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403238"><span class="hs-identifier hs-var">rawHistoricalNames</span></a></span><span>
</span><span id="line-3193"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-3194"></span><span>
</span><span id="line-3195"></span><span id="local-6989586621679406107"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeDisplayObject"><span class="hs-identifier hs-type">loadTypeDisplayObject</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406107"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DisplayObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.Decl</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-3196"></span><span id="loadTypeDisplayObject"><span class="annot"><span class="annottext">loadTypeDisplayObject :: Reference -&gt; Cli r (DisplayObject () (Decl Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeDisplayObject"><span class="hs-identifier hs-var hs-var">loadTypeDisplayObject</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3197"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
-&gt; Cli r (DisplayObject () (Decl Symbol Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; DisplayObject () (Decl Symbol Ann)
forall b a. b -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">BuiltinObject</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3198"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679403234"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403234"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3199"></span><span>    </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403233"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403233"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3200"></span><span>    </span><span class="annot"><span class="annottext">DisplayObject () (Decl Symbol Ann)
-&gt; (Decl Symbol Ann -&gt; DisplayObject () (Decl Symbol Ann))
-&gt; Maybe (Decl Symbol Ann)
-&gt; DisplayObject () (Decl Symbol Ann)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; DisplayObject () (Decl Symbol Ann)
forall b a. ShortHash -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">MissingObject</span></span><span> </span><span class="annot"><span class="annottext">(ShortHash -&gt; DisplayObject () (Decl Symbol Ann))
-&gt; ShortHash -&gt; DisplayObject () (Decl Symbol Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; ShortHash
</span><span class="hs-identifier hs-var">Reference.idToShortHash</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403234"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; DisplayObject () (Decl Symbol Ann)
forall b a. a -&gt; DisplayObject b a
</span><span class="hs-identifier hs-var">UserObject</span></span><span>
</span><span id="line-3201"></span><span>      </span><span class="annot"><span class="annottext">(Maybe (Decl Symbol Ann) -&gt; DisplayObject () (Decl Symbol Ann))
-&gt; Cli r (Maybe (Decl Symbol Ann))
-&gt; Cli r (DisplayObject () (Decl Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Decl Symbol Ann)) -&gt; Cli r (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Id -&gt; IO (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403233"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403234"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3202"></span><span>
</span><span id="line-3203"></span><span id="local-6989586621679406092"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#lexedSource"><span class="hs-identifier hs-type">lexedSource</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406092"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.Token</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.Lexeme</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-3204"></span><span id="lexedSource"><span class="annot"><span class="annottext">lexedSource :: Text -&gt; Text -&gt; Cli r (NamesWithHistory, (Text, [Token Lexeme]))
</span><a href="Unison.Codebase.Editor.HandleInput.html#lexedSource"><span class="hs-identifier hs-var hs-var">lexedSource</span></a></span></span><span> </span><span id="local-6989586621679403228"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403228"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679403227"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403227"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3205"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403226"><span class="annot"><span class="annottext">tokens :: [Token Lexeme]
</span><a href="#local-6989586621679403226"><span class="hs-identifier hs-var hs-var">tokens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; [Token Lexeme]
</span><span class="hs-identifier hs-var">L.lexer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403228"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403227"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3206"></span><span>      </span><span id="local-6989586621679403225"><span class="annot"><span class="annottext">getHQ :: Lexeme -&gt; Maybe (HashQualified Name)
</span><a href="#local-6989586621679403225"><span class="hs-identifier hs-var hs-var">getHQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3207"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">L.WordyId</span></span><span> </span><span id="local-6989586621679403224"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403224"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403223"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403223"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe (HashQualified Name)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ShortHash -&gt; HashQualified Name
forall n. n -&gt; ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashQualified</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403224"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403223"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3208"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">L.SymbolyId</span></span><span> </span><span id="local-6989586621679403222"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403222"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403221"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403221"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe (HashQualified Name)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; ShortHash -&gt; HashQualified Name
forall n. n -&gt; ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashQualified</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403222"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403221"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3209"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">L.Hash</span></span><span> </span><span id="local-6989586621679403220"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403220"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Maybe (HashQualified Name)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortHash -&gt; HashQualified Name
forall n. ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashOnly</span></span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403220"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3210"></span><span>        </span><span class="annot"><span class="annottext">Lexeme
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (HashQualified Name)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-3211"></span><span>      </span><span id="local-6989586621679403219"><span class="annot"><span class="annottext">hqs :: Set (HashQualified Name)
</span><a href="#local-6989586621679403219"><span class="hs-identifier hs-var hs-var">hqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Set (HashQualified Name)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([HashQualified Name] -&gt; Set (HashQualified Name))
-&gt; ([Token Lexeme] -&gt; [HashQualified Name])
-&gt; [Token Lexeme]
-&gt; Set (HashQualified Name)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Token Lexeme -&gt; Maybe (HashQualified Name))
-&gt; [Token Lexeme] -&gt; [HashQualified Name]
forall (f :: * -&gt; *) a b.
Filterable f =&gt;
(a -&gt; Maybe b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lexeme -&gt; Maybe (HashQualified Name)
</span><a href="#local-6989586621679403225"><span class="hs-identifier hs-var">getHQ</span></a></span><span> </span><span class="annot"><span class="annottext">(Lexeme -&gt; Maybe (HashQualified Name))
-&gt; (Token Lexeme -&gt; Lexeme)
-&gt; Token Lexeme
-&gt; Maybe (HashQualified Name)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Token Lexeme -&gt; Lexeme
forall a. Token a -&gt; a
</span><span class="hs-identifier hs-var hs-var">L.payload</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Token Lexeme] -&gt; Set (HashQualified Name))
-&gt; [Token Lexeme] -&gt; Set (HashQualified Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Token Lexeme]
</span><a href="#local-6989586621679403226"><span class="hs-identifier hs-var">tokens</span></a></span><span>
</span><span id="line-3212"></span><span>  </span><span id="local-6989586621679403218"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403218"><span class="hs-identifier hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; Cli r NamesWithHistory
forall r. Set (HashQualified Name) -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makeHistoricalParsingNames"><span class="hs-identifier hs-var">makeHistoricalParsingNames</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403219"><span class="hs-identifier hs-var">hqs</span></a></span><span>
</span><span id="line-3213"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403218"><span class="hs-identifier hs-var">parseNames</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679403227"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Token Lexeme]
</span><a href="#local-6989586621679403226"><span class="hs-identifier hs-var">tokens</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3214"></span><span>
</span><span id="line-3215"></span><span id="local-6989586621679407196"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#suffixifiedPPE"><span class="hs-identifier hs-type">suffixifiedPPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407196"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span></span><span>
</span><span id="line-3216"></span><span id="suffixifiedPPE"><span class="annot"><span class="annottext">suffixifiedPPE :: NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#suffixifiedPPE"><span class="hs-identifier hs-var hs-var">suffixifiedPPE</span></a></span></span><span> </span><span id="local-6989586621679403217"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403217"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3217"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403216"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403216"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3218"></span><span>  </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403216"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r Int -&gt; (Int -&gt; PrettyPrintEnv) -&gt; Cli r PrettyPrintEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnv
</span><span class="hs-operator hs-var">`PPE.fromSuffixNames`</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403217"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3219"></span><span>
</span><span id="line-3220"></span><span id="local-6989586621679403214"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#fqnPPE"><span class="hs-identifier hs-type">fqnPPE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679403214"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span></span><span>
</span><span id="line-3221"></span><span id="fqnPPE"><span class="annot"><span class="annottext">fqnPPE :: NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#fqnPPE"><span class="hs-identifier hs-var hs-var">fqnPPE</span></a></span></span><span> </span><span id="local-6989586621679403213"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403213"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3222"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403212"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403212"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3223"></span><span>  </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403212"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Cli r Int -&gt; (Int -&gt; PrettyPrintEnv) -&gt; Cli r PrettyPrintEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; PrettyPrintEnv
</span><span class="hs-operator hs-var">`PPE.fromNames`</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403213"><span class="hs-identifier hs-var">ns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3224"></span><span>
</span><span id="line-3225"></span><span id="local-6989586621679406497"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#parseSearchType"><span class="hs-identifier hs-type">parseSearchType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#SrcLoc"><span class="hs-identifier hs-type">SrcLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406497"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-3226"></span><span id="parseSearchType"><span class="annot"><span class="annottext">parseSearchType :: String -&gt; String -&gt; Cli r (Type Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#parseSearchType"><span class="hs-identifier hs-var hs-var">parseSearchType</span></a></span></span><span> </span><span id="local-6989586621679403211"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403211"><span class="hs-identifier hs-var">srcLoc</span></a></span></span><span> </span><span id="local-6989586621679403210"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403210"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Type Symbol Ann
forall v a. Var v =&gt; Type v a -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.removeAllEffectVars</span></span><span> </span><span class="annot"><span class="annottext">(Type Symbol Ann -&gt; Type Symbol Ann)
-&gt; Cli r (Type Symbol Ann) -&gt; Cli r (Type Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Cli r (Type Symbol Ann)
forall r. String -&gt; String -&gt; Cli r (Type Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#parseType"><span class="hs-identifier hs-var">parseType</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403211"><span class="hs-identifier hs-var">srcLoc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403210"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-3227"></span><span>
</span><span id="line-3228"></span><span class="hs-comment">-- | A description of where the given parse was triggered from, for error messaging purposes.</span><span>
</span><span id="line-3229"></span><span class="hs-keyword">type</span><span> </span><span id="SrcLoc"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#SrcLoc"><span class="hs-identifier hs-var">SrcLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-3230"></span><span>
</span><span id="line-3231"></span><span id="local-6989586621679403208"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#parseType"><span class="hs-identifier hs-type">parseType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#SrcLoc"><span class="hs-identifier hs-type">SrcLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679403208"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-3232"></span><span id="parseType"><span class="annot"><span class="annottext">parseType :: String -&gt; String -&gt; Cli r (Type Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#parseType"><span class="hs-identifier hs-var hs-var">parseType</span></a></span></span><span> </span><span id="local-6989586621679403207"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403207"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621679403206"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403206"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3233"></span><span>  </span><span class="hs-comment">-- `show Input` is the name of the &quot;file&quot; being lexed</span><span>
</span><span id="line-3234"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679403205"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403205"><span class="hs-identifier hs-var">names0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403204"><span class="annot"><span class="annottext">(Text, [Token Lexeme])
</span><a href="#local-6989586621679403204"><span class="hs-identifier hs-var">lexed</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Cli r (NamesWithHistory, (Text, [Token Lexeme]))
forall r.
Text -&gt; Text -&gt; Cli r (NamesWithHistory, (Text, [Token Lexeme]))
</span><a href="Unison.Codebase.Editor.HandleInput.html#lexedSource"><span class="hs-identifier hs-var">lexedSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403207"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403206"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3235"></span><span>  </span><span id="local-6989586621679403203"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403203"><span class="hs-identifier hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicParseNames"><span class="hs-identifier hs-var">basicParseNames</span></a></span><span>
</span><span id="line-3236"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403202"><span class="annot"><span class="annottext">names :: NamesWithHistory
</span><a href="#local-6989586621679403202"><span class="hs-identifier hs-var hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3237"></span><span>        </span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.push</span></span><span>
</span><span id="line-3238"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Names
</span><span class="hs-identifier hs-var hs-var">NamesWithHistory.currentNames</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403205"><span class="hs-identifier hs-var">names0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3239"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403203"><span class="hs-identifier hs-var">parseNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Names
</span><span class="hs-identifier hs-var hs-var">NamesWithHistory.oldNames</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403205"><span class="hs-identifier hs-var">names0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3240"></span><span>  </span><span id="local-6989586621679403198"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403198"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3241"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; ParsingEnv -&gt; Either (Err Symbol) (Type Symbol Ann)
forall v.
Var v =&gt;
String -&gt; ParsingEnv -&gt; Either (Err v) (Type v Ann)
</span><span class="hs-identifier hs-var">Parsers.parseType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text, [Token Lexeme]) -&gt; Text
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Text, [Token Lexeme])
</span><a href="#local-6989586621679403204"><span class="hs-identifier hs-var">lexed</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqueName -&gt; NamesWithHistory -&gt; ParsingEnv
</span><span class="hs-identifier hs-var">Parser.ParsingEnv</span></span><span> </span><span class="annot"><span class="annottext">UniqueName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403202"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either (Err Symbol) (Type Symbol Ann)
-&gt; (Either (Err Symbol) (Type Symbol Ann)
    -&gt; Cli r (Type Symbol Ann))
-&gt; Cli r (Type Symbol Ann)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Err Symbol -&gt; Cli r (Type Symbol Ann))
-&gt; Either (Err Symbol) (Type Symbol Ann) -&gt; Cli r (Type Symbol Ann)
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m b) -&gt; Either a b -&gt; m b
</span><span class="hs-identifier hs-var">onLeft</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403195"><span class="annot"><span class="annottext">Err Symbol
</span><a href="#local-6989586621679403195"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3242"></span><span>      </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Type Symbol Ann)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Err Symbol -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#TypeParseError"><span class="hs-identifier hs-var">TypeParseError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403206"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">Err Symbol
</span><a href="#local-6989586621679403195"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3243"></span><span>
</span><span id="line-3244"></span><span>  </span><span class="annot"><span class="annottext">Set Symbol
-&gt; Names
-&gt; Type Symbol Ann
-&gt; ResolutionResult Symbol Ann (Type Symbol Ann)
forall v a.
Var v =&gt;
Set v -&gt; Names -&gt; Type v a -&gt; ResolutionResult v a (Type v a)
</span><span class="hs-identifier hs-var">Type.bindNames</span></span><span> </span><span class="annot"><span class="annottext">Set Symbol
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Names
</span><span class="hs-identifier hs-var hs-var">NamesWithHistory.currentNames</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679403202"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set Symbol -&gt; Type Symbol Ann -&gt; Type Symbol Ann
forall v a. Var v =&gt; Set v -&gt; Type v a -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.generalizeLowercase</span></span><span> </span><span class="annot"><span class="annottext">Set Symbol
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403198"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ResolutionResult Symbol Ann (Type Symbol Ann)
-&gt; (ResolutionResult Symbol Ann (Type Symbol Ann)
    -&gt; Cli r (Type Symbol Ann))
-&gt; Cli r (Type Symbol Ann)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Seq (ResolutionFailure Symbol Ann) -&gt; Cli r (Type Symbol Ann))
-&gt; ResolutionResult Symbol Ann (Type Symbol Ann)
-&gt; Cli r (Type Symbol Ann)
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m b) -&gt; Either a b -&gt; m b
</span><span class="hs-identifier hs-var">onLeft</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403191"><span class="annot"><span class="annottext">Seq (ResolutionFailure Symbol Ann)
</span><a href="#local-6989586621679403191"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3245"></span><span>    </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Type Symbol Ann)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [ResolutionFailure Symbol Ann] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#ParseResolutionFailures"><span class="hs-identifier hs-var">ParseResolutionFailures</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403206"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (ResolutionFailure Symbol Ann)
-&gt; [ResolutionFailure Symbol Ann]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Seq (ResolutionFailure Symbol Ann)
</span><a href="#local-6989586621679403191"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3246"></span><span>
</span><span id="line-3247"></span><span id="local-6989586621679406039"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#makeShadowedPrintNamesFromLabeled"><span class="hs-identifier hs-type">makeShadowedPrintNamesFromLabeled</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406039"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span></span><span>
</span><span id="line-3248"></span><span id="makeShadowedPrintNamesFromLabeled"><span class="annot"><span class="annottext">makeShadowedPrintNamesFromLabeled :: Set LabeledDependency -&gt; Names -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makeShadowedPrintNamesFromLabeled"><span class="hs-identifier hs-var hs-var">makeShadowedPrintNamesFromLabeled</span></a></span></span><span> </span><span id="local-6989586621679403188"><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403188"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span id="local-6989586621679403187"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403187"><span class="hs-identifier hs-var">shadowing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3249"></span><span>  </span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.shadowing</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403187"><span class="hs-identifier hs-var">shadowing</span></a></span><span> </span><span class="annot"><span class="annottext">(NamesWithHistory -&gt; NamesWithHistory)
-&gt; Cli r NamesWithHistory -&gt; Cli r NamesWithHistory
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Cli r NamesWithHistory
forall r. Set LabeledDependency -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makePrintNamesFromLabeled%27"><span class="hs-identifier hs-var">makePrintNamesFromLabeled'</span></a></span><span> </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403188"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-3250"></span><span>
</span><span id="line-3251"></span><span id="local-6989586621679406676"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#makePrintNamesFromLabeled%27"><span class="hs-identifier hs-type">makePrintNamesFromLabeled'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">LabeledDependency</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406676"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span></span><span>
</span><span id="line-3252"></span><span id="makePrintNamesFromLabeled%27"><span class="annot"><span class="annottext">makePrintNamesFromLabeled' :: Set LabeledDependency -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makePrintNamesFromLabeled%27"><span class="hs-identifier hs-var hs-var">makePrintNamesFromLabeled'</span></a></span></span><span> </span><span id="local-6989586621679403185"><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403185"><span class="hs-identifier hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3253"></span><span>  </span><span id="local-6989586621679403184"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403184"><span class="hs-identifier hs-var">root'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-3254"></span><span>  </span><span id="local-6989586621679403183"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403183"><span class="hs-identifier hs-var">curPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-3255"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679403182"><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403182"><span class="hs-identifier hs-var">_missing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403181"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403181"><span class="hs-identifier hs-var">rawHistoricalNames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3256"></span><span>    </span><span class="annot"><span class="annottext">IO (Set LabeledDependency, Names)
-&gt; Cli r (Set LabeledDependency, Names)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set LabeledDependency, Names)
 -&gt; Cli r (Set LabeledDependency, Names))
-&gt; IO (Set LabeledDependency, Names)
-&gt; Cli r (Set LabeledDependency, Names)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3257"></span><span>      </span><span class="annot"><span class="annottext">Set LabeledDependency
-&gt; Branch IO -&gt; IO (Set LabeledDependency, Names)
forall (m :: * -&gt; *).
Monad m =&gt;
Set LabeledDependency
-&gt; Branch m -&gt; m (Set LabeledDependency, Names)
</span><span class="hs-identifier hs-var">Branch.findHistoricalRefs</span></span><span>
</span><span id="line-3258"></span><span>        </span><span class="annot"><span class="annottext">Set LabeledDependency
</span><a href="#local-6989586621679403185"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-3259"></span><span>        </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403184"><span class="hs-identifier hs-var">root'</span></a></span><span>
</span><span id="line-3260"></span><span>  </span><span id="local-6989586621679403179"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403179"><span class="hs-identifier hs-var">basicNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicPrettyPrintNamesA"><span class="hs-identifier hs-var">basicPrettyPrintNamesA</span></a></span><span>
</span><span id="line-3261"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403179"><span class="hs-identifier hs-var">basicNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Names -&gt; Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#fixupNamesRelative"><span class="hs-identifier hs-var">fixupNamesRelative</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403183"><span class="hs-identifier hs-var">curPath</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403181"><span class="hs-identifier hs-var">rawHistoricalNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3262"></span><span>
</span><span id="line-3263"></span><span id="local-6989586621679406800"><span id="local-6989586621679406801"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#getTermsIncludingHistorical"><span class="hs-identifier hs-type">getTermsIncludingHistorical</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679406801"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path.HQSplit</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406801"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406800"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3264"></span><span id="getTermsIncludingHistorical"><span class="annot"><span class="annottext">getTermsIncludingHistorical :: HQSplit -&gt; Branch0 m -&gt; Cli r (Set Referent)
</span><a href="Unison.Codebase.Editor.HandleInput.html#getTermsIncludingHistorical"><span class="hs-identifier hs-var hs-var">getTermsIncludingHistorical</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403178"><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403178"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403177"><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679403177"><span class="hs-identifier hs-var">hq</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679403176"><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679403176"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; [Referent]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403175"><span class="hs-identifier hs-var">refs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3265"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679403177"><span class="hs-identifier hs-var">hq</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3266"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HQ'.HashQualified</span></span><span> </span><span id="local-6989586621679403173"><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679403173"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679403172"><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403172"><span class="hs-identifier hs-var">hs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3267"></span><span>      </span><span id="local-6989586621679403171"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403171"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; Cli r Names
forall r. Set (HashQualified Name) -&gt; Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#findHistoricalHQs"><span class="hs-identifier hs-var">findHistoricalHQs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[HashQualified Name] -&gt; Set (HashQualified Name)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; ShortHash -&gt; HashQualified Name
forall n. n -&gt; ShortHash -&gt; HashQualified n
</span><span class="hs-identifier hs-var">HQ.HashQualified</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSegment -&gt; Name
</span><span class="hs-identifier hs-var">Name.fromSegment</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><a href="#local-6989586621679403173"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShortHash
</span><a href="#local-6989586621679403172"><span class="hs-identifier hs-var">hs</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3268"></span><span>      </span><span class="annot"><span class="annottext">Set Referent -&gt; Cli r (Set Referent)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Set Referent -&gt; Cli r (Set Referent))
-&gt; (Relation Name Referent -&gt; Set Referent)
-&gt; Relation Name Referent
-&gt; Cli r (Set Referent)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Relation Name Referent -&gt; Set Referent
forall a b. Relation a b -&gt; Set b
</span><span class="hs-identifier hs-var">R.ran</span></span><span> </span><span class="annot"><span class="annottext">(Relation Name Referent -&gt; Cli r (Set Referent))
-&gt; Relation Name Referent -&gt; Cli r (Set Referent)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Names -&gt; Relation Name Referent
</span><span class="hs-identifier hs-var hs-var">Names.terms</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403171"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-3269"></span><span>    </span><span class="annot"><span class="annottext">HQSegment
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Cli r (Set Referent)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-3270"></span><span>  </span><span class="annot"><span class="annottext">[Referent]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set Referent -&gt; Cli r (Set Referent)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Set Referent
</span><a href="#local-6989586621679403175"><span class="hs-identifier hs-var">refs</span></a></span><span>
</span><span id="line-3271"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3272"></span><span>    </span><span id="local-6989586621679403175"><span class="annot"><span class="annottext">refs :: Set Referent
</span><a href="#local-6989586621679403175"><span class="hs-identifier hs-var hs-var">refs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HQSplit -&gt; Branch0 m -&gt; Set Referent
forall (m :: * -&gt; *). HQSplit -&gt; Branch0 m -&gt; Set Referent
</span><span class="hs-identifier hs-var">BranchUtil.getTerm</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path
</span><a href="#local-6989586621679403178"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HQSegment
</span><a href="#local-6989586621679403177"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Branch0 m
</span><a href="#local-6989586621679403176"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-3273"></span><span>
</span><span id="line-3274"></span><span class="hs-comment">-- discards inputs that aren't hashqualified;</span><span>
</span><span id="line-3275"></span><span class="hs-comment">-- I'd enforce it with finer-grained types if we had them.</span><span>
</span><span id="line-3276"></span><span id="local-6989586621679406105"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#findHistoricalHQs"><span class="hs-identifier hs-type">findHistoricalHQs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406105"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span></span><span>
</span><span id="line-3277"></span><span id="findHistoricalHQs"><span class="annot"><span class="annottext">findHistoricalHQs :: Set (HashQualified Name) -&gt; Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#findHistoricalHQs"><span class="hs-identifier hs-var hs-var">findHistoricalHQs</span></a></span></span><span> </span><span id="local-6989586621679403170"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403170"><span class="hs-identifier hs-var">lexedHQs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3278"></span><span>  </span><span id="local-6989586621679403169"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403169"><span class="hs-identifier hs-var">root'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-3279"></span><span>  </span><span id="local-6989586621679403168"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403168"><span class="hs-identifier hs-var">curPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-3280"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- omg this nightmare name-to-path parsing code is littered everywhere.</span><span>
</span><span id="line-3281"></span><span>      </span><span class="hs-comment">-- We need to refactor so that the absolute-ness of a name isn't represented</span><span>
</span><span id="line-3282"></span><span>      </span><span class="hs-comment">-- by magical text combinations.</span><span>
</span><span id="line-3283"></span><span>      </span><span class="hs-comment">-- Anyway, this function takes a name, tries to determine whether it is</span><span>
</span><span id="line-3284"></span><span>      </span><span class="hs-comment">-- relative or absolute, and tries to return the corresponding name that is</span><span>
</span><span id="line-3285"></span><span>      </span><span class="hs-comment">-- /relative/ to the Command.root.</span><span>
</span><span id="line-3286"></span><span>      </span><span id="local-6989586621679403167"><span class="annot"><span class="annottext">preprocess :: Name -&gt; Name
</span><a href="#local-6989586621679403167"><span class="hs-identifier hs-var hs-var">preprocess</span></a></span></span><span> </span><span id="local-6989586621679403166"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403166"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; String
</span><span class="hs-identifier hs-var">Name.toString</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403166"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3287"></span><span>        </span><span class="hs-comment">-- some absolute name that isn't just &quot;.&quot;</span><span>
</span><span id="line-3288"></span><span>        </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'.'</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679403165"><span class="annot"><span class="annottext">t :: String
</span><a href="#local-6989586621679403165"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><span class="hs-identifier hs-var">Name.unsafeFromString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403165"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-3289"></span><span>        </span><span class="hs-comment">-- something in current path</span><span>
</span><span id="line-3290"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3291"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403168"><span class="hs-identifier hs-var">curPath</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3292"></span><span>            </span><span id="local-6989586621679403164"><span class="annot"><span class="annottext">p :: Absolute
</span><a href="#local-6989586621679403164"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&gt;</span></span><span> </span><span class="annot"><span class="annottext">NameSegment
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Name -&gt; Name -&gt; Name
Name -&gt; Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.joinDot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; Name
</span><span class="hs-identifier hs-var">Path.unsafeToName</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Name) -&gt; (Absolute -&gt; Path) -&gt; Absolute -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">(Absolute -&gt; Name) -&gt; Absolute -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403164"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403166"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-3293"></span><span>            </span><span class="annot"><span class="annottext">Absolute
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403166"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-3294"></span><span>
</span><span id="line-3295"></span><span>      </span><span id="local-6989586621679403163"><span class="annot"><span class="annottext">lexedHQs :: Set (HashQualified Name)
</span><a href="#local-6989586621679403163"><span class="hs-identifier hs-var hs-var">lexedHQs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; HashQualified Name)
-&gt; Set (HashQualified Name) -&gt; Set (HashQualified Name)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; HashQualified Name -&gt; HashQualified Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
</span><a href="#local-6989586621679403167"><span class="hs-identifier hs-var">preprocess</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set (HashQualified Name) -&gt; Set (HashQualified Name))
-&gt; (Set (HashQualified Name) -&gt; Set (HashQualified Name))
-&gt; Set (HashQualified Name)
-&gt; Set (HashQualified Name)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; Bool)
-&gt; Set (HashQualified Name) -&gt; Set (HashQualified Name)
forall a. (a -&gt; Bool) -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.filter</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Bool
</span><span class="hs-identifier hs-var">HQ.hasHash</span></span><span> </span><span class="annot"><span class="annottext">(Set (HashQualified Name) -&gt; Set (HashQualified Name))
-&gt; Set (HashQualified Name) -&gt; Set (HashQualified Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403170"><span class="hs-identifier hs-var">lexedHQs0</span></a></span><span>
</span><span id="line-3296"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679403161"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403161"><span class="hs-identifier hs-var">_missing</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403160"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403160"><span class="hs-identifier hs-var">rawHistoricalNames</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set (HashQualified Name), Names)
-&gt; Cli r (Set (HashQualified Name), Names)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set (HashQualified Name), Names)
 -&gt; Cli r (Set (HashQualified Name), Names))
-&gt; IO (Set (HashQualified Name), Names)
-&gt; Cli r (Set (HashQualified Name), Names)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
-&gt; Branch IO -&gt; IO (Set (HashQualified Name), Names)
forall (m :: * -&gt; *).
Monad m =&gt;
Set (HashQualified Name)
-&gt; Branch m -&gt; m (Set (HashQualified Name), Names)
</span><span class="hs-identifier hs-var">Branch.findHistoricalHQs</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403163"><span class="hs-identifier hs-var">lexedHQs</span></a></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403169"><span class="hs-identifier hs-var">root'</span></a></span><span>
</span><span id="line-3297"></span><span>  </span><span class="annot"><span class="annottext">Names -&gt; Cli r Names
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403160"><span class="hs-identifier hs-var">rawHistoricalNames</span></a></span><span>
</span><span id="line-3298"></span><span>
</span><span id="line-3299"></span><span id="local-6989586621679403158"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#basicPrettyPrintNamesA"><span class="hs-identifier hs-type">basicPrettyPrintNamesA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679403158"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span></span><span>
</span><span id="line-3300"></span><span id="basicPrettyPrintNamesA"><span class="annot"><span class="annottext">basicPrettyPrintNamesA :: Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicPrettyPrintNamesA"><span class="hs-identifier hs-var hs-var">basicPrettyPrintNamesA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Names, Names) -&gt; Names
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Names, Names) -&gt; Names) -&gt; Cli r (Names, Names) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Cli r (Names, Names)
forall r. (Path -&gt; NameScoping) -&gt; Cli r (Names, Names)
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicNames%27"><span class="hs-identifier hs-var">basicNames'</span></a></span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.AllNames</span></span><span>
</span><span id="line-3301"></span><span>
</span><span id="line-3302"></span><span id="local-6989586621679407201"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#makeShadowedPrintNamesFromHQ"><span class="hs-identifier hs-type">makeShadowedPrintNamesFromHQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407201"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span></span><span>
</span><span id="line-3303"></span><span id="makeShadowedPrintNamesFromHQ"><span class="annot"><span class="annottext">makeShadowedPrintNamesFromHQ :: Set (HashQualified Name) -&gt; Names -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makeShadowedPrintNamesFromHQ"><span class="hs-identifier hs-var hs-var">makeShadowedPrintNamesFromHQ</span></a></span></span><span> </span><span id="local-6989586621679403156"><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403156"><span class="hs-identifier hs-var">lexedHQs</span></a></span></span><span> </span><span id="local-6989586621679403155"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403155"><span class="hs-identifier hs-var">shadowing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3304"></span><span>  </span><span id="local-6989586621679403154"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403154"><span class="hs-identifier hs-var">rawHistoricalNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; Cli r Names
forall r. Set (HashQualified Name) -&gt; Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#findHistoricalHQs"><span class="hs-identifier hs-var">findHistoricalHQs</span></a></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403156"><span class="hs-identifier hs-var">lexedHQs</span></a></span><span>
</span><span id="line-3305"></span><span>  </span><span id="local-6989586621679403153"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403153"><span class="hs-identifier hs-var">basicNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicPrettyPrintNamesA"><span class="hs-identifier hs-var">basicPrettyPrintNamesA</span></a></span><span>
</span><span id="line-3306"></span><span>  </span><span id="local-6989586621679403152"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403152"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-3307"></span><span>  </span><span class="hs-comment">-- The basic names go into &quot;current&quot;, but are shadowed by &quot;shadowing&quot;.</span><span>
</span><span id="line-3308"></span><span>  </span><span class="hs-comment">-- They go again into &quot;historical&quot; as a hack that makes them available HQ-ed.</span><span>
</span><span id="line-3309"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-3310"></span><span>    </span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.shadowing</span></span><span>
</span><span id="line-3311"></span><span>      </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403155"><span class="hs-identifier hs-var">shadowing</span></a></span><span>
</span><span id="line-3312"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403153"><span class="hs-identifier hs-var">basicNames</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Names -&gt; Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#fixupNamesRelative"><span class="hs-identifier hs-var">fixupNamesRelative</span></a></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403152"><span class="hs-identifier hs-var">currentPath</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403154"><span class="hs-identifier hs-var">rawHistoricalNames</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3313"></span><span>
</span><span id="line-3314"></span><span id="local-6989586621679403151"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#basicParseNames"><span class="hs-identifier hs-type">basicParseNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679403151"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span></span><span>
</span><span id="line-3315"></span><span id="basicParseNames"><span class="annot"><span class="annottext">basicParseNames :: Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicParseNames"><span class="hs-identifier hs-var hs-var">basicParseNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3316"></span><span>  </span><span class="annot"><span class="annottext">(Names, Names) -&gt; Names
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Names, Names) -&gt; Names) -&gt; Cli r (Names, Names) -&gt; Cli r Names
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Cli r (Names, Names)
forall r. (Path -&gt; NameScoping) -&gt; Cli r (Names, Names)
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicNames%27"><span class="hs-identifier hs-var">basicNames'</span></a></span><span> </span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.Within</span></span><span>
</span><span id="line-3317"></span><span>
</span><span id="line-3318"></span><span class="hs-comment">-- implementation detail of basicParseNames and basicPrettyPrintNames</span><span>
</span><span id="line-3319"></span><span id="local-6989586621679406074"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#basicNames%27"><span class="hs-identifier hs-type">basicNames'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Backend.NameScoping</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406074"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-3320"></span><span id="basicNames%27"><span class="annot"><span class="annottext">basicNames' :: (Path -&gt; NameScoping) -&gt; Cli r (Names, Names)
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicNames%27"><span class="hs-identifier hs-var hs-var">basicNames'</span></a></span></span><span> </span><span id="local-6989586621679403150"><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="#local-6989586621679403150"><span class="hs-identifier hs-var">nameScoping</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3321"></span><span>  </span><span id="local-6989586621679403149"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403149"><span class="hs-identifier hs-var">root'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-3322"></span><span>  </span><span id="local-6989586621679403148"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403148"><span class="hs-identifier hs-var">currentPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-3323"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403147"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403147"><span class="hs-identifier hs-var">parse</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403146"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403146"><span class="hs-identifier hs-var">pretty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403145"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403145"><span class="hs-identifier hs-var">_local</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; NameScoping -&gt; (Names, Names, Names)
forall (m :: * -&gt; *).
Branch m -&gt; NameScoping -&gt; (Names, Names, Names)
</span><span class="hs-identifier hs-var">Backend.namesForBranch</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403149"><span class="hs-identifier hs-var">root'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><a href="#local-6989586621679403150"><span class="hs-identifier hs-var">nameScoping</span></a></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Path -&gt; NameScoping
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403148"><span class="hs-identifier hs-var">currentPath'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3324"></span><span>  </span><span class="annot"><span class="annottext">(Names, Names) -&gt; Cli r (Names, Names)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403147"><span class="hs-identifier hs-var">parse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403146"><span class="hs-identifier hs-var">pretty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3325"></span><span>
</span><span id="line-3326"></span><span class="hs-keyword">data</span><span> </span><span id="GetTermResult"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#GetTermResult"><span class="hs-identifier hs-var">GetTermResult</span></a></span></span><span>
</span><span id="line-3327"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="NoTermWithThatName"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#NoTermWithThatName"><span class="hs-identifier hs-var">NoTermWithThatName</span></a></span></span><span>
</span><span id="line-3328"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="TermHasBadType"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#TermHasBadType"><span class="hs-identifier hs-var">TermHasBadType</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-3329"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="GetTermSuccess"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#GetTermSuccess"><span class="hs-identifier hs-var">GetTermSuccess</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span>
</span><span id="line-3330"></span><span>
</span><span id="line-3331"></span><span class="hs-comment">-- Adds a watch expression of the given name to the file, if</span><span>
</span><span id="line-3332"></span><span class="hs-comment">-- it would resolve to a TLD in the file. Returns the freshened</span><span>
</span><span id="line-3333"></span><span class="hs-comment">-- variable name and the new typechecked file.</span><span>
</span><span id="line-3334"></span><span class="hs-comment">--</span><span>
</span><span id="line-3335"></span><span class="hs-comment">-- Otherwise, returns `Nothing`.</span><span>
</span><span id="line-3336"></span><span id="local-6989586621679406155"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#addWatch"><span class="hs-identifier hs-type">addWatch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3337"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679406155"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-3338"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3339"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621679406155"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3340"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679406155"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621679406155"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-3341"></span><span id="addWatch"><span class="annot"><span class="annottext">addWatch :: String
-&gt; Maybe (TypecheckedUnisonFile v Ann)
-&gt; Maybe (v, TypecheckedUnisonFile v Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#addWatch"><span class="hs-identifier hs-var hs-var">addWatch</span></a></span></span><span> </span><span id="local-6989586621679403140"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403140"><span class="hs-identifier hs-var">_watchName</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile v Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (v, TypecheckedUnisonFile v Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-3342"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#addWatch"><span class="hs-identifier hs-var">addWatch</span></a></span><span> </span><span id="local-6989586621679403139"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403139"><span class="hs-identifier hs-var">watchName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403138"><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403138"><span class="hs-identifier hs-var">uf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3343"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403137"><span class="annot"><span class="annottext">components :: [(v, Term v Ann, Type v Ann)]
</span><a href="#local-6989586621679403137"><span class="hs-identifier hs-var hs-var">components</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(v, Term v Ann, Type v Ann)]] -&gt; [(v, Term v Ann, Type v Ann)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[(v, Term v Ann, Type v Ann)]] -&gt; [(v, Term v Ann, Type v Ann)])
-&gt; [[(v, Term v Ann, Type v Ann)]] -&gt; [(v, Term v Ann, Type v Ann)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann -&gt; [[(v, Term v Ann, Type v Ann)]]
forall v a.
TypecheckedUnisonFile v a -&gt; [[(v, Term v a, Type v a)]]
</span><span class="hs-identifier hs-var">UF.topLevelComponents</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403138"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-3344"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403135"><span class="annot"><span class="annottext">mainComponent :: [(v, Term v Ann, Type v Ann)]
</span><a href="#local-6989586621679403135"><span class="hs-identifier hs-var hs-var">mainComponent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((v, Term v Ann, Type v Ann) -&gt; Bool)
-&gt; [(v, Term v Ann, Type v Ann)] -&gt; [(v, Term v Ann, Type v Ann)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679403134"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403134"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">v -&gt; String
forall v. Var v =&gt; v -&gt; String
</span><span class="hs-identifier hs-var">Var.nameStr</span></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403134"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403139"><span class="hs-identifier hs-var">watchName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(v -&gt; Bool)
-&gt; ((v, Term v Ann, Type v Ann) -&gt; v)
-&gt; (v, Term v Ann, Type v Ann)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting v (v, Term v Ann, Type v Ann) v
-&gt; (v, Term v Ann, Type v Ann) -&gt; v
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting v (v, Term v Ann, Type v Ann) v
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(v, Term v Ann, Type v Ann)]
</span><a href="#local-6989586621679403137"><span class="hs-identifier hs-var">components</span></a></span><span>
</span><span id="line-3345"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(v, Term v Ann, Type v Ann)]
</span><a href="#local-6989586621679403135"><span class="hs-identifier hs-var">mainComponent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3346"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679403133"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403133"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403132"><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679403132"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403131"><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679403131"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3347"></span><span>      </span><span class="annot"><span class="annottext">(v, TypecheckedUnisonFile v Ann)
-&gt; Maybe (v, TypecheckedUnisonFile v Ann)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">((v, TypecheckedUnisonFile v Ann)
 -&gt; Maybe (v, TypecheckedUnisonFile v Ann))
-&gt; (v, TypecheckedUnisonFile v Ann)
-&gt; Maybe (v, TypecheckedUnisonFile v Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3348"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403130"><span class="annot"><span class="annottext">v2 :: v
</span><a href="#local-6989586621679403130"><span class="hs-identifier hs-var hs-var">v2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set v -&gt; v -&gt; v
forall v. Var v =&gt; Set v -&gt; v -&gt; v
</span><span class="hs-identifier hs-var">Var.freshIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[v] -&gt; Set v
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403133"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403133"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-3349"></span><span>            </span><span id="local-6989586621679403128"><span class="annot"><span class="annottext">a :: Ann
</span><a href="#local-6989586621679403128"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term v Ann -&gt; Ann
forall (f :: * -&gt; *) v a. Term f v a -&gt; a
</span><span class="hs-identifier hs-var hs-var">ABT.annotation</span></span><span> </span><span class="annot"><span class="annottext">Term v Ann
</span><a href="#local-6989586621679403132"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-3350"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403130"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3351"></span><span>              </span><span class="annot"><span class="annottext">Map v (Id, DataDeclaration v Ann)
-&gt; Map v (Id, EffectDeclaration v Ann)
-&gt; [[(v, Term v Ann, Type v Ann)]]
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
-&gt; TypecheckedUnisonFile v Ann
forall v a.
Var v =&gt;
Map v (Id, DataDeclaration v a)
-&gt; Map v (Id, EffectDeclaration v a)
-&gt; [[(v, Term v a, Type v a)]]
-&gt; [(String, [(v, Term v a, Type v a)])]
-&gt; TypecheckedUnisonFile v a
</span><span class="hs-identifier hs-var">UF.typecheckedUnisonFile</span></span><span>
</span><span id="line-3352"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann -&gt; Map v (Id, DataDeclaration v Ann)
forall v a.
TypecheckedUnisonFile v a -&gt; Map v (Id, DataDeclaration v a)
</span><span class="hs-identifier hs-var hs-var">UF.dataDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403138"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3353"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann -&gt; Map v (Id, EffectDeclaration v Ann)
forall v a.
TypecheckedUnisonFile v a -&gt; Map v (Id, EffectDeclaration v a)
</span><span class="hs-identifier hs-var hs-var">UF.effectDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403138"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3354"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann -&gt; [[(v, Term v Ann, Type v Ann)]]
forall v a.
TypecheckedUnisonFile v a -&gt; [[(v, Term v a, Type v a)]]
</span><span class="hs-identifier hs-var hs-var">UF.topLevelComponents'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403138"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3355"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
forall v a.
TypecheckedUnisonFile v a -&gt; [(String, [(v, Term v a, Type v a)])]
</span><span class="hs-identifier hs-var hs-var">UF.watchComponents</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v Ann
</span><a href="#local-6989586621679403138"><span class="hs-identifier hs-var">uf</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, [(v, Term v Ann, Type v Ann)])]
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
-&gt; [(String, [(v, Term v Ann, Type v Ann)])]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
forall a. (Eq a, IsString a) =&gt; a
</span><span class="hs-identifier hs-var">WK.RegularWatch</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403130"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; v -&gt; Term v Ann
forall a v vt at ap. a -&gt; v -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.var</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621679403128"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679403133"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type v Ann
</span><a href="#local-6989586621679403131"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3356"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-3357"></span><span>    </span><span class="annot"><span class="annottext">[(v, Term v Ann, Type v Ann)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Maybe (TypecheckedUnisonFile v Ann)
-&gt; Maybe (v, TypecheckedUnisonFile v Ann)
forall v.
Var v =&gt;
String
-&gt; Maybe (TypecheckedUnisonFile v Ann)
-&gt; Maybe (v, TypecheckedUnisonFile v Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#addWatch"><span class="hs-identifier hs-var">addWatch</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403139"><span class="hs-identifier hs-var">watchName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile v Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-3358"></span><span>
</span><span id="line-3359"></span><span id="local-6989586621679406760"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#addSavedTermToUnisonFile"><span class="hs-identifier hs-type">addSavedTermToUnisonFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406760"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-3360"></span><span id="addSavedTermToUnisonFile"><span class="annot"><span class="annottext">addSavedTermToUnisonFile :: Name -&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#addSavedTermToUnisonFile"><span class="hs-identifier hs-var hs-var">addSavedTermToUnisonFile</span></a></span></span><span> </span><span id="local-6989586621679403123"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403123"><span class="hs-identifier hs-var">resultName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3361"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403122"><span class="annot"><span class="annottext">resultSymbol :: Symbol
</span><a href="#local-6989586621679403122"><span class="hs-identifier hs-var hs-var">resultSymbol</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Symbol
forall v. Var v =&gt; Name -&gt; v
</span><span class="hs-identifier hs-var">Name.toVar</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403123"><span class="hs-identifier hs-var">resultName</span></a></span><span>
</span><span id="line-3362"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679403121"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403121"><span class="hs-identifier hs-var">trm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403120"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403120"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403119"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403119"><span class="hs-identifier hs-var">uf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3363"></span><span>    </span><span class="annot"><span class="annottext">Getting
  (Maybe
     (Term Symbol Ann, Type Symbol Ann,
      TypecheckedUnisonFile Symbol Ann))
  LoopState
  (Maybe
     (Term Symbol Ann, Type Symbol Ann,
      TypecheckedUnisonFile Symbol Ann))
-&gt; Cli
     r
     (Maybe
        (Term Symbol Ann, Type Symbol Ann,
         TypecheckedUnisonFile Symbol Ann))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">IsLabel
  &quot;lastRunResult&quot;
  (Getting
     (Maybe
        (Term Symbol Ann, Type Symbol Ann,
         TypecheckedUnisonFile Symbol Ann))
     LoopState
     (Maybe
        (Term Symbol Ann, Type Symbol Ann,
         TypecheckedUnisonFile Symbol Ann)))
Getting
  (Maybe
     (Term Symbol Ann, Type Symbol Ann,
      TypecheckedUnisonFile Symbol Ann))
  LoopState
  (Maybe
     (Term Symbol Ann, Type Symbol Ann,
      TypecheckedUnisonFile Symbol Ann))
</span><a href="#local-6989586621679403118"><span class="hs-var">#lastRunResult</span></a></span><span> </span><span class="annot"><span class="annottext">Cli
  r
  (Maybe
     (Term Symbol Ann, Type Symbol Ann,
      TypecheckedUnisonFile Symbol Ann))
-&gt; (Maybe
      (Term Symbol Ann, Type Symbol Ann,
       TypecheckedUnisonFile Symbol Ann)
    -&gt; Cli
         r
         (Term Symbol Ann, Type Symbol Ann,
          TypecheckedUnisonFile Symbol Ann))
-&gt; Cli
     r
     (Term Symbol Ann, Type Symbol Ann,
      TypecheckedUnisonFile Symbol Ann)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3364"></span><span>      </span><span class="annot"><span class="annottext">Maybe
  (Term Symbol Ann, Type Symbol Ann,
   TypecheckedUnisonFile Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output
-&gt; Cli
     r
     (Term Symbol Ann, Type Symbol Ann,
      TypecheckedUnisonFile Symbol Ann)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">Output
</span><a href="Unison.Codebase.Editor.Output.html#NoLastRunResult"><span class="hs-identifier hs-var">NoLastRunResult</span></a></span><span>
</span><span id="line-3365"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403116"><span class="annot"><span class="annottext">(Term Symbol Ann, Type Symbol Ann,
 TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621679403116"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Term Symbol Ann, Type Symbol Ann,
 TypecheckedUnisonFile Symbol Ann)
-&gt; Cli
     r
     (Term Symbol Ann, Type Symbol Ann,
      TypecheckedUnisonFile Symbol Ann)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Term Symbol Ann, Type Symbol Ann,
 TypecheckedUnisonFile Symbol Ann)
</span><a href="#local-6989586621679403116"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3366"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Symbol
-&gt; Map Symbol (Id, Maybe String, Term Symbol Ann, Type Symbol Ann)
-&gt; Maybe (Id, Maybe String, Term Symbol Ann, Type Symbol Ann)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403122"><span class="hs-identifier hs-var">resultSymbol</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Map Symbol (Id, Maybe String, Term Symbol Ann, Type Symbol Ann)
forall v a.
TypecheckedUnisonFile v a
-&gt; Map v (Id, Maybe String, Term v a, Type v a)
</span><span class="hs-identifier hs-var hs-var">UF.hashTermsId</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403119"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3367"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">(Id, Maybe String, Term Symbol Ann, Type Symbol Ann)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Output -&gt; Cli r ()
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#SaveTermNameConflict"><span class="hs-identifier hs-var">SaveTermNameConflict</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621679403123"><span class="hs-identifier hs-var">resultName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3368"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Id, Maybe String, Term Symbol Ann, Type Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Cli r ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3369"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-3370"></span><span>    </span><span class="annot"><span class="annottext">Map Symbol (Id, DataDeclaration Symbol Ann)
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
-&gt; [(String, [(Symbol, Term Symbol Ann, Type Symbol Ann)])]
-&gt; TypecheckedUnisonFile Symbol Ann
forall v a.
Var v =&gt;
Map v (Id, DataDeclaration v a)
-&gt; Map v (Id, EffectDeclaration v a)
-&gt; [[(v, Term v a, Type v a)]]
-&gt; [(String, [(v, Term v a, Type v a)])]
-&gt; TypecheckedUnisonFile v a
</span><span class="hs-identifier hs-var">UF.typecheckedUnisonFile</span></span><span>
</span><span id="line-3371"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Map Symbol (Id, DataDeclaration Symbol Ann)
forall v a.
TypecheckedUnisonFile v a -&gt; Map v (Id, DataDeclaration v a)
</span><span class="hs-identifier hs-var hs-var">UF.dataDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403119"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3372"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
forall v a.
TypecheckedUnisonFile v a -&gt; Map v (Id, EffectDeclaration v a)
</span><span class="hs-identifier hs-var hs-var">UF.effectDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403119"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3373"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403122"><span class="hs-identifier hs-var">resultSymbol</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403121"><span class="hs-identifier hs-var">trm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403120"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Symbol, Term Symbol Ann, Type Symbol Ann)]
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
forall v a.
TypecheckedUnisonFile v a -&gt; [[(v, Term v a, Type v a)]]
</span><span class="hs-identifier hs-var hs-var">UF.topLevelComponents'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403119"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3374"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; [(String, [(Symbol, Term Symbol Ann, Type Symbol Ann)])]
forall v a.
TypecheckedUnisonFile v a -&gt; [(String, [(v, Term v a, Type v a)])]
</span><span class="hs-identifier hs-var hs-var">UF.watchComponents</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403119"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3375"></span><span>
</span><span id="line-3376"></span><span class="hs-comment">-- | Look up runnable term with the given name in the codebase or</span><span>
</span><span id="line-3377"></span><span class="hs-comment">-- latest typechecked unison file. Return its symbol, term, type, and</span><span>
</span><span id="line-3378"></span><span class="hs-comment">-- the type of the evaluated term.</span><span>
</span><span id="line-3379"></span><span id="local-6989586621679406752"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#getTerm"><span class="hs-identifier hs-type">getTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406752"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-3380"></span><span id="getTerm"><span class="annot"><span class="annottext">getTerm :: String
-&gt; Cli
     r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#getTerm"><span class="hs-identifier hs-var hs-var">getTerm</span></a></span></span><span> </span><span id="local-6989586621679403114"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403114"><span class="hs-identifier hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3381"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; Cli r GetTermResult
forall r. String -&gt; Cli r GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#getTerm%27"><span class="hs-identifier hs-var">getTerm'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403114"><span class="hs-identifier hs-var">main</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r GetTermResult
-&gt; (GetTermResult
    -&gt; Cli
         r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann))
-&gt; Cli
     r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3382"></span><span>    </span><span class="annot"><span class="annottext">GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#NoTermWithThatName"><span class="hs-identifier hs-var">NoTermWithThatName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3383"></span><span>      </span><span id="local-6989586621679403112"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403112"><span class="hs-identifier hs-var">mainType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol -&gt; Type Symbol Ann
forall v. Runtime v -&gt; Type v Ann
</span><span class="hs-identifier hs-var hs-var">Runtime.mainType</span></span><span> </span><span class="annot"><span class="annottext">(Runtime Symbol -&gt; Type Symbol Ann)
-&gt; Cli r (Runtime Symbol) -&gt; Cli r (Type Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Getting (Runtime Symbol) Env (Runtime Symbol)
-&gt; Cli r (Runtime Symbol)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;runtime&quot; (Getting (Runtime Symbol) Env (Runtime Symbol))
Getting (Runtime Symbol) Env (Runtime Symbol)
</span><a href="#local-6989586621679403111"><span class="hs-var">#runtime</span></a></span><span>
</span><span id="line-3384"></span><span>      </span><span id="local-6989586621679403110"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403110"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#getBasicPrettyPrintNames"><span class="hs-identifier hs-var">getBasicPrettyPrintNames</span></a></span><span>
</span><span id="line-3385"></span><span>      </span><span id="local-6989586621679403109"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403109"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#suffixifiedPPE"><span class="hs-identifier hs-var">suffixifiedPPE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403110"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-3386"></span><span>      </span><span class="annot"><span class="annottext">Output
-&gt; Cli
     r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output
 -&gt; Cli
      r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann))
-&gt; Output
-&gt; Cli
     r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; PrettyPrintEnv -&gt; [Type Symbol Ann] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#NoMainFunction"><span class="hs-identifier hs-var">NoMainFunction</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403114"><span class="hs-identifier hs-var">main</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403109"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403112"><span class="hs-identifier hs-var">mainType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3387"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#TermHasBadType"><span class="hs-identifier hs-type">TermHasBadType</span></a></span><span> </span><span id="local-6989586621679403108"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403108"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3388"></span><span>      </span><span id="local-6989586621679403107"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403107"><span class="hs-identifier hs-var">mainType</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol -&gt; Type Symbol Ann
forall v. Runtime v -&gt; Type v Ann
</span><span class="hs-identifier hs-var hs-var">Runtime.mainType</span></span><span> </span><span class="annot"><span class="annottext">(Runtime Symbol -&gt; Type Symbol Ann)
-&gt; Cli r (Runtime Symbol) -&gt; Cli r (Type Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Getting (Runtime Symbol) Env (Runtime Symbol)
-&gt; Cli r (Runtime Symbol)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">IsLabel &quot;runtime&quot; (Getting (Runtime Symbol) Env (Runtime Symbol))
Getting (Runtime Symbol) Env (Runtime Symbol)
</span><a href="#local-6989586621679403106"><span class="hs-var">#runtime</span></a></span><span>
</span><span id="line-3389"></span><span>      </span><span id="local-6989586621679403105"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403105"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#getBasicPrettyPrintNames"><span class="hs-identifier hs-var">getBasicPrettyPrintNames</span></a></span><span>
</span><span id="line-3390"></span><span>      </span><span id="local-6989586621679403104"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403104"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#suffixifiedPPE"><span class="hs-identifier hs-var">suffixifiedPPE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403105"><span class="hs-identifier hs-var">basicPrettyPrintNames</span></a></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-3391"></span><span>      </span><span class="annot"><span class="annottext">Output
-&gt; Cli
     r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="annot"><span class="annottext">(Output
 -&gt; Cli
      r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann))
-&gt; Output
-&gt; Cli
     r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
-&gt; Type Symbol Ann -&gt; PrettyPrintEnv -&gt; [Type Symbol Ann] -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#BadMainFunction"><span class="hs-identifier hs-var">BadMainFunction</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403114"><span class="hs-identifier hs-var">main</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403108"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403104"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403107"><span class="hs-identifier hs-var">mainType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3392"></span><span>    </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#GetTermSuccess"><span class="hs-identifier hs-type">GetTermSuccess</span></a></span><span> </span><span id="local-6989586621679403103"><span class="annot"><span class="annottext">(Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679403103"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
-&gt; Cli
     r (Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
</span><a href="#local-6989586621679403103"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3393"></span><span>
</span><span id="line-3394"></span><span id="local-6989586621679406055"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#getTerm%27"><span class="hs-identifier hs-type">getTerm'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406055"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#GetTermResult"><span class="hs-identifier hs-type">GetTermResult</span></a></span></span><span>
</span><span id="line-3395"></span><span id="getTerm%27"><span class="annot"><span class="annottext">getTerm' :: String -&gt; Cli r GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#getTerm%27"><span class="hs-identifier hs-var hs-var">getTerm'</span></a></span></span><span> </span><span id="local-6989586621679403102"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403102"><span class="hs-identifier hs-var">mainName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3396"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403101"><span class="annot"><span class="annottext">getFromCodebase :: Cli r GetTermResult
</span><a href="#local-6989586621679403101"><span class="hs-identifier hs-var hs-var">getFromCodebase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3397"></span><span>        </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403100"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403100"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403099"><span class="annot"><span class="annottext">Runtime Symbol
runtime :: Runtime Symbol
$sel:runtime:Env :: Env -&gt; Runtime Symbol
</span><a href="#local-6989586621679403099"><span class="hs-identifier hs-var hs-var">runtime</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3398"></span><span>
</span><span id="line-3399"></span><span>        </span><span id="local-6989586621679403098"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403098"><span class="hs-identifier hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Names
forall r. Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#basicParseNames"><span class="hs-identifier hs-var">basicParseNames</span></a></span><span>
</span><span id="line-3400"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403097"><span class="annot"><span class="annottext">loadTypeOfTerm :: Reference -&gt; Cli r (Maybe (Type Symbol Ann))
</span><a href="#local-6989586621679403097"><span class="hs-identifier hs-var hs-var">loadTypeOfTerm</span></a></span></span><span> </span><span id="local-6989586621679403096"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403096"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Type Symbol Ann)) -&gt; Cli r (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Reference -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a.
(Applicative m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Reference -&gt; m (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403100"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403096"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3401"></span><span>        </span><span class="annot"><span class="annottext">MainTerm Symbol -&gt; Cli r GetTermResult
forall r. MainTerm Symbol -&gt; Cli r GetTermResult
</span><a href="#local-6989586621679403095"><span class="hs-identifier hs-var">mainToFile</span></a></span><span>
</span><span id="line-3402"></span><span>          </span><span class="annot"><span class="annottext">(MainTerm Symbol -&gt; Cli r GetTermResult)
-&gt; Cli r (MainTerm Symbol) -&gt; Cli r GetTermResult
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(Reference -&gt; Cli r (Maybe (Type Symbol Ann)))
-&gt; Names -&gt; String -&gt; Type Symbol Ann -&gt; Cli r (MainTerm Symbol)
forall (m :: * -&gt; *) v.
(Monad m, Var v) =&gt;
(Reference -&gt; m (Maybe (Type v Ann)))
-&gt; Names -&gt; String -&gt; Type v Ann -&gt; m (MainTerm v)
</span><span class="hs-identifier hs-var">MainTerm.getMainTerm</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Cli r (Maybe (Type Symbol Ann))
</span><a href="#local-6989586621679403097"><span class="hs-identifier hs-var">loadTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403098"><span class="hs-identifier hs-var">parseNames</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403102"><span class="hs-identifier hs-var">mainName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime Symbol -&gt; Type Symbol Ann
forall v. Runtime v -&gt; Type v Ann
</span><span class="hs-identifier hs-var hs-var">Runtime.mainType</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679403099"><span class="hs-identifier hs-var">runtime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3403"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-3404"></span><span>          </span><span id="local-6989586621679403095"><span class="annot"><span class="annottext">mainToFile :: MainTerm Symbol -&gt; Cli r GetTermResult
</span><a href="#local-6989586621679403095"><span class="hs-identifier hs-var hs-var">mainToFile</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MainTerm.NotAFunctionName</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GetTermResult -&gt; Cli r GetTermResult
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#NoTermWithThatName"><span class="hs-identifier hs-var">NoTermWithThatName</span></a></span><span>
</span><span id="line-3405"></span><span>          </span><span class="annot"><a href="#local-6989586621679403095"><span class="hs-identifier hs-var">mainToFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MainTerm.NotFound</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GetTermResult -&gt; Cli r GetTermResult
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#NoTermWithThatName"><span class="hs-identifier hs-var">NoTermWithThatName</span></a></span><span>
</span><span id="line-3406"></span><span>          </span><span class="annot"><a href="#local-6989586621679403095"><span class="hs-identifier hs-var">mainToFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MainTerm.BadType</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679403090"><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679403090"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GetTermResult -&gt; Cli r GetTermResult
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(GetTermResult -&gt; Cli r GetTermResult)
-&gt; GetTermResult -&gt; Cli r GetTermResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GetTermResult
-&gt; (Type Symbol Ann -&gt; GetTermResult)
-&gt; Maybe (Type Symbol Ann)
-&gt; GetTermResult
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#NoTermWithThatName"><span class="hs-identifier hs-var">NoTermWithThatName</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#TermHasBadType"><span class="hs-identifier hs-var">TermHasBadType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><a href="#local-6989586621679403090"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-3407"></span><span>          </span><span class="annot"><a href="#local-6989586621679403095"><span class="hs-identifier hs-var">mainToFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MainTerm.Success</span></span><span> </span><span id="local-6989586621679403088"><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403088"><span class="hs-identifier hs-var">hq</span></a></span></span><span> </span><span id="local-6989586621679403087"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403087"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span id="local-6989586621679403086"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403086"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3408"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403085"><span class="annot"><span class="annottext">v :: Symbol
</span><a href="#local-6989586621679403085"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Symbol
forall v. Var v =&gt; Text -&gt; v
</span><span class="hs-identifier hs-var">Var.named</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">HashQualified Name
</span><a href="#local-6989586621679403088"><span class="hs-identifier hs-var">hq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3409"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
-&gt; (Type Symbol Ann -&gt; Cli r GetTermResult) -&gt; Cli r GetTermResult
forall r.
Type Symbol Ann
-&gt; (Type Symbol Ann -&gt; Cli r GetTermResult) -&gt; Cli r GetTermResult
</span><a href="#local-6989586621679403083"><span class="hs-identifier hs-var">checkType</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403086"><span class="hs-identifier hs-var">typ</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403082"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403082"><span class="hs-identifier hs-var">otyp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3410"></span><span>                  </span><span class="annot"><span class="annottext">GetTermResult -&gt; Cli r GetTermResult
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
-&gt; GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#GetTermSuccess"><span class="hs-identifier hs-var">GetTermSuccess</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403085"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403087"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403086"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403082"><span class="hs-identifier hs-var">otyp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3411"></span><span>      </span><span id="local-6989586621679403081"><span class="annot"><span class="annottext">getFromFile :: TypecheckedUnisonFile Symbol Ann -&gt; Cli r GetTermResult
</span><a href="#local-6989586621679403081"><span class="hs-identifier hs-var hs-var">getFromFile</span></a></span></span><span> </span><span id="local-6989586621679403080"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403080"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3412"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403079"><span class="annot"><span class="annottext">components :: [(Symbol, Term Symbol Ann, Type Symbol Ann)]
</span><a href="#local-6989586621679403079"><span class="hs-identifier hs-var hs-var">components</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
-&gt; [(Symbol, Term Symbol Ann, Type Symbol Ann)]
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="annot"><span class="annottext">([[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
 -&gt; [(Symbol, Term Symbol Ann, Type Symbol Ann)])
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
-&gt; [(Symbol, Term Symbol Ann, Type Symbol Ann)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
forall v a.
TypecheckedUnisonFile v a -&gt; [[(v, Term v a, Type v a)]]
</span><span class="hs-identifier hs-var">UF.topLevelComponents</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403080"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-3413"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403078"><span class="annot"><span class="annottext">mainComponent :: [(Symbol, Term Symbol Ann, Type Symbol Ann)]
</span><a href="#local-6989586621679403078"><span class="hs-identifier hs-var hs-var">mainComponent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Symbol, Term Symbol Ann, Type Symbol Ann) -&gt; Bool)
-&gt; [(Symbol, Term Symbol Ann, Type Symbol Ann)]
-&gt; [(Symbol, Term Symbol Ann, Type Symbol Ann)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679403077"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403077"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; String
forall v. Var v =&gt; v -&gt; String
</span><span class="hs-identifier hs-var">Var.nameStr</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403077"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679403102"><span class="hs-identifier hs-var">mainName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Symbol -&gt; Bool)
-&gt; ((Symbol, Term Symbol Ann, Type Symbol Ann) -&gt; Symbol)
-&gt; (Symbol, Term Symbol Ann, Type Symbol Ann)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting Symbol (Symbol, Term Symbol Ann, Type Symbol Ann) Symbol
-&gt; (Symbol, Term Symbol Ann, Type Symbol Ann) -&gt; Symbol
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting Symbol (Symbol, Term Symbol Ann, Type Symbol Ann) Symbol
forall s t a b. Field1 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Symbol, Term Symbol Ann, Type Symbol Ann)]
</span><a href="#local-6989586621679403079"><span class="hs-identifier hs-var">components</span></a></span><span>
</span><span id="line-3414"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Symbol, Term Symbol Ann, Type Symbol Ann)]
</span><a href="#local-6989586621679403078"><span class="hs-identifier hs-var">mainComponent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3415"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679403076"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403076"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403075"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403075"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403074"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403074"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3416"></span><span>            </span><span class="annot"><span class="annottext">Type Symbol Ann
-&gt; (Type Symbol Ann -&gt; Cli r GetTermResult) -&gt; Cli r GetTermResult
forall r.
Type Symbol Ann
-&gt; (Type Symbol Ann -&gt; Cli r GetTermResult) -&gt; Cli r GetTermResult
</span><a href="#local-6989586621679403083"><span class="hs-identifier hs-var">checkType</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403074"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679403073"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403073"><span class="hs-identifier hs-var">otyp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3417"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403072"><span class="annot"><span class="annottext">runMain :: Term Symbol Ann
</span><a href="#local-6989586621679403072"><span class="hs-identifier hs-var hs-var">runMain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Ann -&gt; Term Symbol Ann -&gt; Term Symbol Ann
forall v a. Var v =&gt; a -&gt; a -&gt; Term v a -&gt; Term v a
</span><span class="hs-identifier hs-var">DD.forceTerm</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621679403071"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621679403071"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Symbol -&gt; Term Symbol Ann
forall a v vt at ap. a -&gt; v -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.var</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621679403071"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403076"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3418"></span><span>                  </span><span id="local-6989586621679403070"><span class="annot"><span class="annottext">v2 :: Symbol
</span><a href="#local-6989586621679403070"><span class="hs-identifier hs-var hs-var">v2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Symbol -&gt; Symbol -&gt; Symbol
forall v. Var v =&gt; Set v -&gt; v -&gt; v
</span><span class="hs-identifier hs-var">Var.freshIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Symbol] -&gt; Set Symbol
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403076"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403076"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-3419"></span><span>                  </span><span id="local-6989586621679403071"><span class="annot"><span class="annottext">a :: Ann
</span><a href="#local-6989586621679403071"><span class="hs-identifier hs-var hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Ann
forall (f :: * -&gt; *) v a. Term f v a -&gt; a
</span><span class="hs-identifier hs-var hs-var">ABT.annotation</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403075"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-3420"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">GetTermResult -&gt; Cli r GetTermResult
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Symbol, Term Symbol Ann, Type Symbol Ann, Type Symbol Ann)
-&gt; GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#GetTermSuccess"><span class="hs-identifier hs-var">GetTermSuccess</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403070"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403072"><span class="hs-identifier hs-var">runMain</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403074"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403073"><span class="hs-identifier hs-var">otyp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3421"></span><span>          </span><span class="annot"><span class="annottext">[(Symbol, Term Symbol Ann, Type Symbol Ann)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r GetTermResult
</span><a href="#local-6989586621679403101"><span class="hs-identifier hs-var">getFromCodebase</span></a></span><span>
</span><span id="line-3422"></span><span>      </span><span id="local-6989586621679406048"><span class="annot"><a href="#local-6989586621679403083"><span class="hs-identifier hs-type">checkType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406048"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#GetTermResult"><span class="hs-identifier hs-type">GetTermResult</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406048"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#GetTermResult"><span class="hs-identifier hs-type">GetTermResult</span></a></span></span><span>
</span><span id="line-3423"></span><span>      </span><span id="local-6989586621679403083"><span class="annot"><span class="annottext">checkType :: Type Symbol Ann
-&gt; (Type Symbol Ann -&gt; Cli r GetTermResult) -&gt; Cli r GetTermResult
</span><a href="#local-6989586621679403083"><span class="hs-identifier hs-var hs-var">checkType</span></a></span></span><span> </span><span id="local-6989586621679403069"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403069"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621679403068"><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Cli r GetTermResult
</span><a href="#local-6989586621679403068"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3424"></span><span>        </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403067"><span class="annot"><span class="annottext">Runtime Symbol
runtime :: Runtime Symbol
$sel:runtime:Env :: Env -&gt; Runtime Symbol
</span><a href="#local-6989586621679403067"><span class="hs-identifier hs-var hs-var">runtime</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3425"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Type Symbol Ann -&gt; Bool
forall v loc. Var v =&gt; Type v loc -&gt; Type v loc -&gt; Bool
</span><span class="hs-identifier hs-var">Typechecker.fitsScheme</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403069"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Runtime Symbol -&gt; Type Symbol Ann
forall v. Runtime v -&gt; Type v Ann
</span><span class="hs-identifier hs-var hs-var">Runtime.mainType</span></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679403067"><span class="hs-identifier hs-var">runtime</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3426"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Cli r GetTermResult
</span><a href="#local-6989586621679403068"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; Type Symbol Ann
</span><a href="Unison.Codebase.Editor.HandleInput.html#synthesizeForce"><span class="hs-identifier hs-var">synthesizeForce</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403069"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3427"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GetTermResult -&gt; Cli r GetTermResult
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; GetTermResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#TermHasBadType"><span class="hs-identifier hs-var">TermHasBadType</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403069"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3428"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (TypecheckedUnisonFile Symbol Ann))
forall r. Cli r (Maybe (TypecheckedUnisonFile Symbol Ann))
</span><a href="Unison.Cli.MonadUtils.html#getLatestTypecheckedFile"><span class="hs-identifier hs-var">Cli.getLatestTypecheckedFile</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (TypecheckedUnisonFile Symbol Ann))
-&gt; (Maybe (TypecheckedUnisonFile Symbol Ann)
    -&gt; Cli r GetTermResult)
-&gt; Cli r GetTermResult
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3429"></span><span>        </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Cli r GetTermResult
</span><a href="#local-6989586621679403101"><span class="hs-identifier hs-var">getFromCodebase</span></a></span><span>
</span><span id="line-3430"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403065"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403065"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann -&gt; Cli r GetTermResult
</span><a href="#local-6989586621679403081"><span class="hs-identifier hs-var">getFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403065"><span class="hs-identifier hs-var">uf</span></a></span><span>
</span><span id="line-3431"></span><span>
</span><span id="line-3432"></span><span class="hs-comment">-- | Produce a typechecked unison file where the given term is the</span><span>
</span><span id="line-3433"></span><span class="hs-comment">-- only watcher, with the watch type set to 'magicMainWatcherString'.</span><span>
</span><span id="line-3434"></span><span id="local-6989586621679406751"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#createWatcherFile"><span class="hs-identifier hs-type">createWatcherFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406751"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-3435"></span><span id="createWatcherFile"><span class="annot"><span class="annottext">createWatcherFile :: Symbol
-&gt; Term Symbol Ann
-&gt; Type Symbol Ann
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#createWatcherFile"><span class="hs-identifier hs-var hs-var">createWatcherFile</span></a></span></span><span> </span><span id="local-6989586621679403064"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403064"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679403063"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403063"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span id="local-6989586621679403062"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403062"><span class="hs-identifier hs-var">typ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3436"></span><span>  </span><span class="annot"><span class="annottext">Cli r (Maybe (TypecheckedUnisonFile Symbol Ann))
forall r. Cli r (Maybe (TypecheckedUnisonFile Symbol Ann))
</span><a href="Unison.Cli.MonadUtils.html#getLatestTypecheckedFile"><span class="hs-identifier hs-var">Cli.getLatestTypecheckedFile</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Maybe (TypecheckedUnisonFile Symbol Ann))
-&gt; (Maybe (TypecheckedUnisonFile Symbol Ann)
    -&gt; Cli r (TypecheckedUnisonFile Symbol Ann))
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3437"></span><span>    </span><span class="annot"><span class="annottext">Maybe (TypecheckedUnisonFile Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Symbol (Id, DataDeclaration Symbol Ann)
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
-&gt; [(String, [(Symbol, Term Symbol Ann, Type Symbol Ann)])]
-&gt; TypecheckedUnisonFile Symbol Ann
forall v a.
Var v =&gt;
Map v (Id, DataDeclaration v a)
-&gt; Map v (Id, EffectDeclaration v a)
-&gt; [[(v, Term v a, Type v a)]]
-&gt; [(String, [(v, Term v a, Type v a)])]
-&gt; TypecheckedUnisonFile v a
</span><span class="hs-identifier hs-var">UF.typecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Id, DataDeclaration Symbol Ann)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Id, EffectDeclaration Symbol Ann)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">[[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="Unison.Codebase.Editor.HandleInput.html#magicMainWatcherString"><span class="hs-identifier hs-var">magicMainWatcherString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403064"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403063"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403062"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3438"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679403061"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403061"><span class="hs-identifier hs-var">uf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3439"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403060"><span class="annot"><span class="annottext">v2 :: Symbol
</span><a href="#local-6989586621679403060"><span class="hs-identifier hs-var hs-var">v2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Symbol -&gt; Symbol -&gt; Symbol
forall v. Var v =&gt; Set v -&gt; v -&gt; v
</span><span class="hs-identifier hs-var">Var.freshIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Symbol] -&gt; Set Symbol
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403064"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403064"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-3440"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile Symbol Ann
 -&gt; Cli r (TypecheckedUnisonFile Symbol Ann))
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; Cli r (TypecheckedUnisonFile Symbol Ann)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3441"></span><span>            </span><span class="annot"><span class="annottext">Map Symbol (Id, DataDeclaration Symbol Ann)
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
-&gt; [(String, [(Symbol, Term Symbol Ann, Type Symbol Ann)])]
-&gt; TypecheckedUnisonFile Symbol Ann
forall v a.
Var v =&gt;
Map v (Id, DataDeclaration v a)
-&gt; Map v (Id, EffectDeclaration v a)
-&gt; [[(v, Term v a, Type v a)]]
-&gt; [(String, [(v, Term v a, Type v a)])]
-&gt; TypecheckedUnisonFile v a
</span><span class="hs-identifier hs-var">UF.typecheckedUnisonFile</span></span><span>
</span><span id="line-3442"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Map Symbol (Id, DataDeclaration Symbol Ann)
forall v a.
TypecheckedUnisonFile v a -&gt; Map v (Id, DataDeclaration v a)
</span><span class="hs-identifier hs-var hs-var">UF.dataDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403061"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3443"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; Map Symbol (Id, EffectDeclaration Symbol Ann)
forall v a.
TypecheckedUnisonFile v a -&gt; Map v (Id, EffectDeclaration v a)
</span><span class="hs-identifier hs-var hs-var">UF.effectDeclarationsId'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403061"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3444"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
-&gt; [[(Symbol, Term Symbol Ann, Type Symbol Ann)]]
forall v a.
TypecheckedUnisonFile v a -&gt; [[(v, Term v a, Type v a)]]
</span><span class="hs-identifier hs-var hs-var">UF.topLevelComponents'</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679403061"><span class="hs-identifier hs-var">uf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3445"></span><span>              </span><span class="hs-comment">-- what about main's component? we have dropped them if they existed.</span><span>
</span><span id="line-3446"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="Unison.Codebase.Editor.HandleInput.html#magicMainWatcherString"><span class="hs-identifier hs-var">magicMainWatcherString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679403060"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403063"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403062"><span class="hs-identifier hs-var">typ</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3447"></span><span>
</span><span id="line-3448"></span><span id="local-6989586621679406748"><span id="local-6989586621679406749"><span id="local-6989586621679406750"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#executePPE"><span class="hs-identifier hs-type">executePPE</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3449"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679406750"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-3450"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621679406750"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406749"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3451"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406748"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span></span></span></span><span>
</span><span id="line-3452"></span><span id="executePPE"><span class="annot"><span class="annottext">executePPE :: TypecheckedUnisonFile v a -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#executePPE"><span class="hs-identifier hs-var hs-var">executePPE</span></a></span></span><span> </span><span id="local-6989586621679403059"><span class="annot"><span class="annottext">TypecheckedUnisonFile v a
</span><a href="#local-6989586621679403059"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3453"></span><span>  </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnv
</span><a href="Unison.Codebase.Editor.HandleInput.html#suffixifiedPPE"><span class="hs-identifier hs-var">suffixifiedPPE</span></a></span><span> </span><span class="annot"><span class="annottext">(NamesWithHistory -&gt; Cli r PrettyPrintEnv)
-&gt; Cli r NamesWithHistory -&gt; Cli r PrettyPrintEnv
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v a -&gt; Cli r NamesWithHistory
forall v a r.
Var v =&gt;
TypecheckedUnisonFile v a -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayNames"><span class="hs-identifier hs-var">displayNames</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v a
</span><a href="#local-6989586621679403059"><span class="hs-identifier hs-var">unisonFile</span></a></span><span>
</span><span id="line-3454"></span><span>
</span><span id="line-3455"></span><span class="hs-comment">-- Produce a `Names` needed to display all the hashes used in the given file.</span><span>
</span><span id="line-3456"></span><span id="local-6989586621679407173"><span id="local-6989586621679407174"><span id="local-6989586621679407175"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#displayNames"><span class="hs-identifier hs-type">displayNames</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3457"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Var</span></span><span> </span><span class="annot"><a href="#local-6989586621679407175"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-3458"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><a href="#local-6989586621679407175"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407174"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3459"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407173"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span></span></span></span><span>
</span><span id="line-3460"></span><span id="displayNames"><span class="annot"><span class="annottext">displayNames :: TypecheckedUnisonFile v a -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#displayNames"><span class="hs-identifier hs-var hs-var">displayNames</span></a></span></span><span> </span><span id="local-6989586621679403058"><span class="annot"><span class="annottext">TypecheckedUnisonFile v a
</span><a href="#local-6989586621679403058"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3461"></span><span>  </span><span class="hs-comment">-- voodoo</span><span>
</span><span id="line-3462"></span><span>  </span><span class="annot"><span class="annottext">Set LabeledDependency -&gt; Names -&gt; Cli r NamesWithHistory
forall r. Set LabeledDependency -&gt; Names -&gt; Cli r NamesWithHistory
</span><a href="Unison.Codebase.Editor.HandleInput.html#makeShadowedPrintNamesFromLabeled"><span class="hs-identifier hs-var">makeShadowedPrintNamesFromLabeled</span></a></span><span>
</span><span id="line-3463"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile v a -&gt; Set LabeledDependency
forall v a.
Ord v =&gt;
TypecheckedUnisonFile v a -&gt; Set LabeledDependency
</span><span class="hs-identifier hs-var">UF.termSignatureExternalLabeledDependencies</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v a
</span><a href="#local-6989586621679403058"><span class="hs-identifier hs-var">unisonFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3464"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypecheckedUnisonFile v a -&gt; Names
forall v a. Var v =&gt; TypecheckedUnisonFile v a -&gt; Names
</span><span class="hs-identifier hs-var">UF.typecheckedToNames</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile v a
</span><a href="#local-6989586621679403058"><span class="hs-identifier hs-var">unisonFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3465"></span><span>
</span><span id="line-3466"></span><span id="local-6989586621679407062"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-type">diffHelper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3467"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3468"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3469"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407062"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Unison.Codebase.Editor.Output.BranchDiff.html#BranchDiffOutput"><span class="hs-identifier hs-type">OBranchDiff.BranchDiffOutput</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-3470"></span><span id="diffHelper"><span class="annot"><span class="annottext">diffHelper :: Branch0 IO
-&gt; Branch0 IO
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#diffHelper"><span class="hs-identifier hs-var hs-var">diffHelper</span></a></span></span><span> </span><span id="local-6989586621679403056"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403056"><span class="hs-identifier hs-var">before</span></a></span></span><span> </span><span id="local-6989586621679403055"><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403055"><span class="hs-identifier hs-var">after</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3471"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall r a. String -&gt; Cli r a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#time"><span class="hs-identifier hs-var">Cli.time</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;diffHelper&quot;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3472"></span><span>    </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403054"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403054"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3473"></span><span>    </span><span id="local-6989586621679403053"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403053"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-3474"></span><span>    </span><span id="local-6989586621679403052"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403052"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-3475"></span><span>    </span><span id="local-6989586621679403051"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403051"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403054"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3476"></span><span>    </span><span id="local-6989586621679403050"><span class="annot"><span class="annottext">BranchDiff
</span><a href="#local-6989586621679403050"><span class="hs-identifier hs-var">diff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO BranchDiff -&gt; Cli r BranchDiff
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO -&gt; Branch0 IO -&gt; IO BranchDiff
forall (m :: * -&gt; *).
Monad m =&gt;
Branch0 m -&gt; Branch0 m -&gt; m BranchDiff
</span><span class="hs-identifier hs-var">BranchDiff.diff0</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403056"><span class="hs-identifier hs-var">before</span></a></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403055"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3477"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679403048"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403048"><span class="hs-identifier hs-var">_parseNames</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403047"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403047"><span class="hs-identifier hs-var">prettyNames0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679403046"><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403046"><span class="hs-identifier hs-var">_local</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; NameScoping -&gt; (Names, Names, Names)
forall (m :: * -&gt; *).
Branch m -&gt; NameScoping -&gt; (Names, Names, Names)
</span><span class="hs-identifier hs-var">Backend.namesForBranch</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403053"><span class="hs-identifier hs-var">rootBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.AllNames</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; NameScoping) -&gt; Path -&gt; NameScoping
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403052"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3478"></span><span>    </span><span id="local-6989586621679403045"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403045"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnvDecl -&gt; PrettyPrintEnv
</span><span class="hs-identifier hs-var hs-var">PPE.suffixifiedPPE</span></span><span> </span><span class="annot"><span class="annottext">(PrettyPrintEnvDecl -&gt; PrettyPrintEnv)
-&gt; Cli r PrettyPrintEnvDecl -&gt; Cli r PrettyPrintEnv
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
forall r. NamesWithHistory -&gt; Cli r PrettyPrintEnvDecl
</span><a href="Unison.Codebase.Editor.HandleInput.html#prettyPrintEnvDecl"><span class="hs-identifier hs-var">prettyPrintEnvDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403047"><span class="hs-identifier hs-var">prettyNames0</span></a></span><span> </span><span class="annot"><span class="annottext">Names
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-3479"></span><span>    </span><span class="annot"><span class="annottext">IO (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
-&gt; Cli r (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3480"></span><span>      </span><span class="annot"><span class="annottext">(BranchDiffOutput Symbol Ann
 -&gt; (PrettyPrintEnv, BranchDiffOutput Symbol Ann))
-&gt; IO (BranchDiffOutput Symbol Ann)
-&gt; IO (PrettyPrintEnv, BranchDiffOutput Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403045"><span class="hs-identifier hs-var">ppe</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3481"></span><span>        </span><span class="annot"><span class="annottext">(Referent -&gt; IO (Maybe (Type Symbol Ann)))
-&gt; (Reference -&gt; IO (Maybe (DeclOrBuiltin Symbol Ann)))
-&gt; Int
-&gt; Names
-&gt; Names
-&gt; PrettyPrintEnv
-&gt; BranchDiff
-&gt; IO (BranchDiffOutput Symbol Ann)
forall (m :: * -&gt; *) v a.
Monad m =&gt;
(Referent -&gt; m (Maybe (Type v a)))
-&gt; (Reference -&gt; m (Maybe (DeclOrBuiltin v a)))
-&gt; Int
-&gt; Names
-&gt; Names
-&gt; PrettyPrintEnv
-&gt; BranchDiff
-&gt; m (BranchDiffOutput v a)
</span><a href="Unison.Codebase.Editor.Output.BranchDiff.html#toOutput"><span class="hs-identifier hs-var">OBranchDiff.toOutput</span></a></span><span>
</span><span id="line-3482"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Referent -&gt; IO (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *).
Monad m =&gt;
Codebase m Symbol Ann -&gt; Referent -&gt; m (Maybe (Type Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeOfTerm"><span class="hs-identifier hs-var">loadTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403054"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3483"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Reference -&gt; IO (Maybe (DeclOrBuiltin Symbol Ann))
forall (m :: * -&gt; *).
Applicative m =&gt;
Codebase m Symbol Ann
-&gt; Reference -&gt; m (Maybe (DeclOrBuiltin Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#declOrBuiltin"><span class="hs-identifier hs-var">declOrBuiltin</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403054"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3484"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403051"><span class="hs-identifier hs-var">hqLength</span></a></span><span>
</span><span id="line-3485"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403056"><span class="hs-identifier hs-var">before</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3486"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch0 IO -&gt; Names
forall (m :: * -&gt; *). Branch0 m -&gt; Names
</span><span class="hs-identifier hs-var">Branch.toNames</span></span><span> </span><span class="annot"><span class="annottext">Branch0 IO
</span><a href="#local-6989586621679403055"><span class="hs-identifier hs-var">after</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3487"></span><span>          </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679403045"><span class="hs-identifier hs-var">ppe</span></a></span><span>
</span><span id="line-3488"></span><span>          </span><span class="annot"><span class="annottext">BranchDiff
</span><a href="#local-6989586621679403050"><span class="hs-identifier hs-var">diff</span></a></span><span>
</span><span id="line-3489"></span><span>
</span><span id="line-3490"></span><span id="local-6989586621679406725"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeOfTerm"><span class="hs-identifier hs-type">loadTypeOfTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679406725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679406725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-3491"></span><span id="loadTypeOfTerm"><span class="annot"><span class="annottext">loadTypeOfTerm :: Codebase m Symbol Ann -&gt; Referent -&gt; m (Maybe (Type Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeOfTerm"><span class="hs-identifier hs-var hs-var">loadTypeOfTerm</span></a></span></span><span> </span><span id="local-6989586621679403042"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679403042"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Ref</span></span><span> </span><span id="local-6989586621679403041"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403041"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann -&gt; Reference -&gt; m (Maybe (Type Symbol Ann))
forall (m :: * -&gt; *) a.
(Applicative m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Reference -&gt; m (Maybe (Type Symbol a))
</span><span class="hs-identifier hs-var">Codebase.getTypeOfTerm</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679403042"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403041"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-3492"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeOfTerm"><span class="hs-identifier hs-var">loadTypeOfTerm</span></a></span><span> </span><span id="local-6989586621679403040"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679403040"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ConstructorReference</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679403039"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403039"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679403038"><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679403038"><span class="hs-identifier hs-var">cid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConstructorType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3493"></span><span>  </span><span id="local-6989586621679403037"><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><a href="#local-6989586621679403037"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann -&gt; Id -&gt; m (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679403040"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403039"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-3494"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><a href="#local-6989586621679403037"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3495"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EffectDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann)
-&gt; (DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann)
-&gt; Decl Symbol Ann
-&gt; DataDeclaration Symbol Ann
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">EffectDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann
forall v a. EffectDeclaration v a -&gt; DataDeclaration v a
</span><span class="hs-identifier hs-var hs-var">DD.toDataDecl</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann -&gt; DataDeclaration Symbol Ann
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679403035"><span class="annot"><span class="annottext">DataDeclaration Symbol Ann
</span><a href="#local-6989586621679403035"><span class="hs-identifier hs-var">dd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann) -&gt; m (Maybe (Type Symbol Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Type Symbol Ann) -&gt; m (Maybe (Type Symbol Ann)))
-&gt; Maybe (Type Symbol Ann) -&gt; m (Maybe (Type Symbol Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann
-&gt; ConstructorId -&gt; Maybe (Type Symbol Ann)
forall v a.
DataDeclaration v a -&gt; ConstructorId -&gt; Maybe (Type v a)
</span><span class="hs-identifier hs-var">DD.typeOfConstructor</span></span><span> </span><span class="annot"><span class="annottext">DataDeclaration Symbol Ann
</span><a href="#local-6989586621679403035"><span class="hs-identifier hs-var">dd</span></a></span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><a href="#local-6989586621679403038"><span class="hs-identifier hs-var">cid</span></a></span><span>
</span><span id="line-3496"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Decl Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann) -&gt; m (Maybe (Type Symbol Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-3497"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#loadTypeOfTerm"><span class="hs-identifier hs-var">loadTypeOfTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Referent.Con</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3498"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; m (Maybe (Type Symbol Ann))
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m (Maybe (Type Symbol Ann)))
-&gt; String -&gt; m (Maybe (Type Symbol Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3499"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><span class="hs-identifier hs-var">reportBug</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;924628772&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Attempt to load a type declaration which is a builtin!&quot;</span></span><span>
</span><span id="line-3500"></span><span>
</span><span id="line-3501"></span><span id="local-6989586621679406029"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#declOrBuiltin"><span class="hs-identifier hs-type">declOrBuiltin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679406029"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><a href="#local-6989586621679406029"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406029"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DD.DeclOrBuiltin</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-3502"></span><span id="declOrBuiltin"><span class="annot"><span class="annottext">declOrBuiltin :: Codebase m Symbol Ann
-&gt; Reference -&gt; m (Maybe (DeclOrBuiltin Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#declOrBuiltin"><span class="hs-identifier hs-var hs-var">declOrBuiltin</span></a></span></span><span> </span><span id="local-6989586621679403034"><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679403034"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679403033"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403033"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403033"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3503"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.Builtin</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3504"></span><span>    </span><span class="annot"><span class="annottext">Maybe (DeclOrBuiltin Symbol Ann)
-&gt; m (Maybe (DeclOrBuiltin Symbol Ann))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (DeclOrBuiltin Symbol Ann)
 -&gt; m (Maybe (DeclOrBuiltin Symbol Ann)))
-&gt; (Maybe ConstructorType -&gt; Maybe (DeclOrBuiltin Symbol Ann))
-&gt; Maybe ConstructorType
-&gt; m (Maybe (DeclOrBuiltin Symbol Ann))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ConstructorType -&gt; DeclOrBuiltin Symbol Ann)
-&gt; Maybe ConstructorType -&gt; Maybe (DeclOrBuiltin Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ConstructorType -&gt; DeclOrBuiltin Symbol Ann
forall v a. ConstructorType -&gt; DeclOrBuiltin v a
</span><span class="hs-identifier hs-var">DD.Builtin</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ConstructorType -&gt; m (Maybe (DeclOrBuiltin Symbol Ann)))
-&gt; Maybe ConstructorType -&gt; m (Maybe (DeclOrBuiltin Symbol Ann))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Map Reference ConstructorType -&gt; Maybe ConstructorType
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403033"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Map Reference ConstructorType
</span><span class="hs-identifier hs-var">Builtin.builtinConstructorType</span></span><span>
</span><span id="line-3505"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Reference.DerivedId</span></span><span> </span><span id="local-6989586621679403030"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403030"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3506"></span><span>    </span><span class="annot"><span class="annottext">(Decl Symbol Ann -&gt; DeclOrBuiltin Symbol Ann)
-&gt; Maybe (Decl Symbol Ann) -&gt; Maybe (DeclOrBuiltin Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Decl Symbol Ann -&gt; DeclOrBuiltin Symbol Ann
forall v a. Decl v a -&gt; DeclOrBuiltin v a
</span><span class="hs-identifier hs-var">DD.Decl</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Decl Symbol Ann) -&gt; Maybe (DeclOrBuiltin Symbol Ann))
-&gt; m (Maybe (Decl Symbol Ann))
-&gt; m (Maybe (DeclOrBuiltin Symbol Ann))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann -&gt; Id -&gt; m (Maybe (Decl Symbol Ann))
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; Id -&gt; m (Maybe (Decl v a))
</span><span class="hs-identifier hs-var hs-var">Codebase.getTypeDeclaration</span></span><span> </span><span class="annot"><span class="annottext">Codebase m Symbol Ann
</span><a href="#local-6989586621679403034"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679403030"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-3507"></span><span>
</span><span id="line-3508"></span><span id="local-6989586621679407121"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#hqNameQuery"><span class="hs-identifier hs-type">hqNameQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679407121"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">QueryResult</span></span></span><span>
</span><span id="line-3509"></span><span id="hqNameQuery"><span class="annot"><span class="annottext">hqNameQuery :: [HashQualified Name] -&gt; Cli r QueryResult
</span><a href="Unison.Codebase.Editor.HandleInput.html#hqNameQuery"><span class="hs-identifier hs-var hs-var">hqNameQuery</span></a></span></span><span> </span><span id="local-6989586621679403028"><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403028"><span class="hs-identifier hs-var">query</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3510"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679403027"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679403027"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3511"></span><span>  </span><span id="local-6989586621679403026"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403026"><span class="hs-identifier hs-var">root'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-3512"></span><span>  </span><span id="local-6989586621679403025"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403025"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-3513"></span><span>  </span><span id="local-6989586621679403024"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403024"><span class="hs-identifier hs-var">hqLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; Cli r Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; IO Int
forall (m :: * -&gt; *) v a. Codebase m v a -&gt; m Int
</span><span class="hs-identifier hs-var hs-var">Codebase.hashLength</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403027"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3514"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403023"><span class="annot"><span class="annottext">parseNames :: Names
</span><a href="#local-6989586621679403023"><span class="hs-identifier hs-var hs-var">parseNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Branch IO -&gt; NameScoping -&gt; Names
forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><span class="hs-identifier hs-var">Backend.parseNamesForBranch</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679403026"><span class="hs-identifier hs-var">root'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.AllNames</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679403025"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3515"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403022"><span class="annot"><span class="annottext">nameSearch :: NameSearch
</span><a href="#local-6989586621679403022"><span class="hs-identifier hs-var hs-var">nameSearch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; NamesWithHistory -&gt; NameSearch
</span><span class="hs-identifier hs-var">Backend.makeNameSearch</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679403024"><span class="hs-identifier hs-var">hqLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Names -&gt; NamesWithHistory
</span><span class="hs-identifier hs-var">NamesWithHistory.fromCurrentNames</span></span><span> </span><span class="annot"><span class="annottext">Names
</span><a href="#local-6989586621679403023"><span class="hs-identifier hs-var">parseNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3516"></span><span>  </span><span class="annot"><span class="annottext">IO QueryResult -&gt; Cli r QueryResult
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; NameSearch -&gt; [HashQualified Name] -&gt; IO QueryResult
forall (m :: * -&gt; *) v.
Monad m =&gt;
Codebase m v Ann
-&gt; NameSearch -&gt; [HashQualified Name] -&gt; m QueryResult
</span><span class="hs-identifier hs-var">Backend.hqNameQuery</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679403027"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">NameSearch
</span><a href="#local-6989586621679403022"><span class="hs-identifier hs-var">nameSearch</span></a></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403028"><span class="hs-identifier hs-var">query</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3517"></span><span>
</span><span id="line-3518"></span><span class="hs-comment">-- | Select a definition from the given branch.</span><span>
</span><span id="line-3519"></span><span class="hs-comment">-- Returned names will match the provided 'Position' type.</span><span>
</span><span id="line-3520"></span><span id="local-6989586621679406844"><span id="local-6989586621679406845"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#fuzzySelectDefinition"><span class="hs-identifier hs-type">fuzzySelectDefinition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679406845"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Position</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406844"><span class="hs-identifier hs-type">m0</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406845"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3521"></span><span id="fuzzySelectDefinition"><span class="annot"><span class="annottext">fuzzySelectDefinition :: Position -&gt; Branch0 m0 -&gt; m (Maybe [HashQualified Name])
</span><a href="Unison.Codebase.Editor.HandleInput.html#fuzzySelectDefinition"><span class="hs-identifier hs-var hs-var">fuzzySelectDefinition</span></a></span></span><span> </span><span id="local-6989586621679403020"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679403020"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679403019"><span class="annot"><span class="annottext">Branch0 m0
</span><a href="#local-6989586621679403019"><span class="hs-identifier hs-var">searchBranch0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe [HashQualified Name]) -&gt; m (Maybe [HashQualified Name])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3522"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679403018"><span class="annot"><span class="annottext">termsAndTypes :: Set (HashQualified Name)
</span><a href="#local-6989586621679403018"><span class="hs-identifier hs-var hs-var">termsAndTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3523"></span><span>        </span><span class="annot"><span class="annottext">Relation (HashQualified Name) Referent -&gt; Set (HashQualified Name)
forall a b. Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">Relation.dom</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Name Referent -&gt; Relation (HashQualified Name) Referent
</span><span class="hs-identifier hs-var">Names.hashQualifyTermsRelation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Referent Name -&gt; Relation Name Referent
forall a b. Relation a b -&gt; Relation b a
</span><span class="hs-identifier hs-var">Relation.swap</span></span><span> </span><span class="annot"><span class="annottext">(Relation Referent Name -&gt; Relation Name Referent)
-&gt; Relation Referent Name -&gt; Relation Name Referent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m0 -&gt; Relation Referent Name
forall (m :: * -&gt; *). Branch0 m -&gt; Relation Referent Name
</span><span class="hs-identifier hs-var hs-var">Branch.deepTerms</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m0
</span><a href="#local-6989586621679403019"><span class="hs-identifier hs-var">searchBranch0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3524"></span><span>          </span><span class="annot"><span class="annottext">Set (HashQualified Name)
-&gt; Set (HashQualified Name) -&gt; Set (HashQualified Name)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Relation (HashQualified Name) Reference -&gt; Set (HashQualified Name)
forall a b. Relation a b -&gt; Set a
</span><span class="hs-identifier hs-var">Relation.dom</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Name Reference -&gt; Relation (HashQualified Name) Reference
</span><span class="hs-identifier hs-var">Names.hashQualifyTypesRelation</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Relation Reference Name -&gt; Relation Name Reference
forall a b. Relation a b -&gt; Relation b a
</span><span class="hs-identifier hs-var">Relation.swap</span></span><span> </span><span class="annot"><span class="annottext">(Relation Reference Name -&gt; Relation Name Reference)
-&gt; Relation Reference Name -&gt; Relation Name Reference
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m0 -&gt; Relation Reference Name
forall (m :: * -&gt; *). Branch0 m -&gt; Relation Reference Name
</span><span class="hs-identifier hs-var hs-var">Branch.deepTypes</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m0
</span><a href="#local-6989586621679403019"><span class="hs-identifier hs-var">searchBranch0</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3525"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403014"><span class="hs-identifier hs-type">inputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">HQ.HashQualified</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Name</span></span><span class="hs-special">]</span><span>
</span><span id="line-3526"></span><span>      </span><span id="local-6989586621679403014"><span class="annot"><span class="annottext">inputs :: [HashQualified Name]
</span><a href="#local-6989586621679403014"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3527"></span><span>        </span><span class="annot"><span class="annottext">Set (HashQualified Name)
</span><a href="#local-6989586621679403018"><span class="hs-identifier hs-var">termsAndTypes</span></a></span><span>
</span><span id="line-3528"></span><span>          </span><span class="annot"><span class="annottext">Set (HashQualified Name)
-&gt; (Set (HashQualified Name) -&gt; [HashQualified Name])
-&gt; [HashQualified Name]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Set (HashQualified Name) -&gt; [HashQualified Name]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span>
</span><span id="line-3529"></span><span>          </span><span class="annot"><span class="annottext">[HashQualified Name]
-&gt; ([HashQualified Name] -&gt; [HashQualified Name])
-&gt; [HashQualified Name]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(HashQualified Name -&gt; HashQualified Name)
-&gt; [HashQualified Name] -&gt; [HashQualified Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; HashQualified Name -&gt; HashQualified Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Position -&gt; Name -&gt; Name
</span><span class="hs-identifier hs-var">Name.setPosition</span></span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679403020"><span class="hs-identifier hs-var">pos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3530"></span><span>  </span><span class="annot"><span class="annottext">Options
-&gt; (HashQualified Name -&gt; Text)
-&gt; [HashQualified Name]
-&gt; IO (Maybe [HashQualified Name])
forall a. Options -&gt; (a -&gt; Text) -&gt; [a] -&gt; IO (Maybe [a])
</span><a href="Unison.CommandLine.FuzzySelect.html#fuzzySelect"><span class="hs-identifier hs-var">Fuzzy.fuzzySelect</span></a></span><span> </span><span class="annot"><span class="annottext">Options
</span><a href="Unison.CommandLine.FuzzySelect.html#defaultOptions"><span class="hs-identifier hs-var">Fuzzy.defaultOptions</span></a></span><span> </span><span class="annot"><span class="annottext">HashQualified Name -&gt; Text
forall n. Show n =&gt; HashQualified n -&gt; Text
</span><span class="hs-identifier hs-var">HQ.toText</span></span><span> </span><span class="annot"><span class="annottext">[HashQualified Name]
</span><a href="#local-6989586621679403014"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-3531"></span><span>
</span><span id="line-3532"></span><span class="hs-comment">-- | Select a namespace from the given branch.</span><span>
</span><span id="line-3533"></span><span class="hs-comment">-- Returned Path's will match the provided 'Position' type.</span><span>
</span><span id="line-3534"></span><span id="local-6989586621679406950"><span id="local-6989586621679406951"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#fuzzySelectNamespace"><span class="hs-identifier hs-type">fuzzySelectNamespace</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679406951"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Position</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Branch0</span></span><span> </span><span class="annot"><a href="#local-6989586621679406950"><span class="hs-identifier hs-type">m0</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679406951"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Path'</span></span><span class="hs-special">]</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-3535"></span><span id="fuzzySelectNamespace"><span class="annot"><span class="annottext">fuzzySelectNamespace :: Position -&gt; Branch0 m0 -&gt; m (Maybe [Path'])
</span><a href="Unison.Codebase.Editor.HandleInput.html#fuzzySelectNamespace"><span class="hs-identifier hs-var hs-var">fuzzySelectNamespace</span></a></span></span><span> </span><span id="local-6989586621679403010"><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679403010"><span class="hs-identifier hs-var">pos</span></a></span></span><span> </span><span id="local-6989586621679403009"><span class="annot"><span class="annottext">Branch0 m0
</span><a href="#local-6989586621679403009"><span class="hs-identifier hs-var">searchBranch0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe [Path']) -&gt; m (Maybe [Path'])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3536"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403008"><span class="hs-identifier hs-type">intoPath'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Path'</span></span><span>
</span><span id="line-3537"></span><span>      </span><span id="local-6989586621679403008"><span class="annot"><span class="annottext">intoPath' :: Path -&gt; Path'
</span><a href="#local-6989586621679403008"><span class="hs-identifier hs-var hs-var">intoPath'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Position
</span><a href="#local-6989586621679403010"><span class="hs-identifier hs-var">pos</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3538"></span><span>        </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">Relative</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Absolute Relative -&gt; Path'
</span><span class="hs-identifier hs-var">Path'</span></span><span> </span><span class="annot"><span class="annottext">(Either Absolute Relative -&gt; Path')
-&gt; (Path -&gt; Either Absolute Relative) -&gt; Path -&gt; Path'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Relative -&gt; Either Absolute Relative
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Relative -&gt; Either Absolute Relative)
-&gt; (Path -&gt; Relative) -&gt; Path -&gt; Either Absolute Relative
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Relative
</span><span class="hs-identifier hs-var">Path.Relative</span></span><span>
</span><span id="line-3539"></span><span>        </span><span class="annot"><span class="annottext">Position
</span><span class="hs-identifier hs-var">Absolute</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either Absolute Relative -&gt; Path'
</span><span class="hs-identifier hs-var">Path'</span></span><span> </span><span class="annot"><span class="annottext">(Either Absolute Relative -&gt; Path')
-&gt; (Path -&gt; Either Absolute Relative) -&gt; Path -&gt; Path'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Absolute -&gt; Either Absolute Relative
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Absolute -&gt; Either Absolute Relative)
-&gt; (Path -&gt; Absolute) -&gt; Path -&gt; Either Absolute Relative
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Absolute
</span><span class="hs-identifier hs-var">Path.Absolute</span></span><span>
</span><span id="line-3540"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403007"><span class="hs-identifier hs-type">inputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Path'</span></span><span class="hs-special">]</span><span>
</span><span id="line-3541"></span><span>      </span><span id="local-6989586621679403007"><span class="annot"><span class="annottext">inputs :: [Path']
</span><a href="#local-6989586621679403007"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3542"></span><span>        </span><span class="annot"><span class="annottext">Branch0 m0
</span><a href="#local-6989586621679403009"><span class="hs-identifier hs-var">searchBranch0</span></a></span><span>
</span><span id="line-3543"></span><span>          </span><span class="annot"><span class="annottext">Branch0 m0 -&gt; (Branch0 m0 -&gt; Set Path) -&gt; Set Path
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Branch0 m0 -&gt; Set Path
forall (m :: * -&gt; *). Branch0 m -&gt; Set Path
</span><span class="hs-identifier hs-var hs-var">Branch.deepPaths</span></span><span>
</span><span id="line-3544"></span><span>          </span><span class="annot"><span class="annottext">Set Path -&gt; (Set Path -&gt; [Path]) -&gt; [Path]
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">Set Path -&gt; [Path]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span>
</span><span id="line-3545"></span><span>          </span><span class="annot"><span class="annottext">[Path] -&gt; ([Path] -&gt; [Path']) -&gt; [Path']
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Path -&gt; Path') -&gt; [Path] -&gt; [Path']
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Path -&gt; Path'
</span><a href="#local-6989586621679403008"><span class="hs-identifier hs-var">intoPath'</span></a></span><span>
</span><span id="line-3546"></span><span>  </span><span class="annot"><span class="annottext">Options -&gt; (Path' -&gt; Text) -&gt; [Path'] -&gt; IO (Maybe [Path'])
forall a. Options -&gt; (a -&gt; Text) -&gt; [a] -&gt; IO (Maybe [a])
</span><a href="Unison.CommandLine.FuzzySelect.html#fuzzySelect"><span class="hs-identifier hs-var">Fuzzy.fuzzySelect</span></a></span><span>
</span><span id="line-3547"></span><span>    </span><span class="annot"><span class="annottext">Options
</span><a href="Unison.CommandLine.FuzzySelect.html#defaultOptions"><span class="hs-identifier hs-var">Fuzzy.defaultOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">$sel:allowMultiSelect:Options :: Bool
</span><a href="Unison.CommandLine.FuzzySelect.html#%24sel%3AallowMultiSelect%3AOptions"><span class="hs-identifier hs-var">Fuzzy.allowMultiSelect</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">}</span><span>
</span><span id="line-3548"></span><span>    </span><span class="annot"><span class="annottext">Path' -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">tShow</span></span><span>
</span><span id="line-3549"></span><span>    </span><span class="annot"><span class="annottext">[Path']
</span><a href="#local-6989586621679403007"><span class="hs-identifier hs-var">inputs</span></a></span><span>
</span><span id="line-3550"></span><span>
</span><span id="line-3551"></span><span class="hs-comment">-- | synthesize the type of forcing a term</span><span>
</span><span id="line-3552"></span><span class="hs-comment">--</span><span>
</span><span id="line-3553"></span><span class="hs-comment">-- precondition: @fitsScheme typeOfFunc Runtime.mainType@ is satisfied</span><span>
</span><span id="line-3554"></span><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#synthesizeForce"><span class="hs-identifier hs-type">synthesizeForce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span>
</span><span id="line-3555"></span><span id="synthesizeForce"><span class="annot"><span class="annottext">synthesizeForce :: Type Symbol Ann -&gt; Type Symbol Ann
</span><a href="Unison.Codebase.Editor.HandleInput.html#synthesizeForce"><span class="hs-identifier hs-var hs-var">synthesizeForce</span></a></span></span><span> </span><span id="local-6989586621679403004"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403004"><span class="hs-identifier hs-var">typeOfFunc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3556"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679403003"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span>
</span><span id="line-3557"></span><span>      </span><span id="local-6989586621679403003"><span class="annot"><span class="annottext">term :: Term Symbol Ann
</span><a href="#local-6989586621679403003"><span class="hs-identifier hs-var hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Reference -&gt; Term Symbol Ann
forall v a vt at ap. Ord v =&gt; a -&gt; Reference -&gt; Term2 vt at ap v a
</span><span class="hs-identifier hs-var">Term.ref</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">External</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403002"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-3558"></span><span>      </span><span id="local-6989586621679403002"><span class="annot"><span class="annottext">ref :: Reference
</span><a href="#local-6989586621679403002"><span class="hs-identifier hs-var hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Reference
</span><span class="hs-identifier hs-var">Reference.DerivedId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash -&gt; ConstructorId -&gt; Id
</span><span class="hs-identifier hs-var">Reference.Id</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; Hash
</span><span class="hs-identifier hs-var">Hash.fromByteString</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;deadbeef&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConstructorId
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-3559"></span><span>      </span><span id="local-6989586621679402999"><span class="annot"><span class="annottext">env :: Env Symbol Ann
</span><a href="#local-6989586621679402999"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3560"></span><span>        </span><span class="annot"><span class="annottext">Env :: forall v loc.
[Type v loc]
-&gt; TypeLookup v loc -&gt; Map Text [NamedReference v loc] -&gt; Env v loc
</span><span class="hs-identifier hs-type">Typechecker.Env</span></span><span>
</span><span id="line-3561"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:_ambientAbilities:Env :: [Type Symbol Ann]
</span><span class="hs-identifier hs-var">Typechecker._ambientAbilities</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Ann -&gt; Type Symbol Ann
forall v a. Ord v =&gt; a -&gt; Type v a
</span><span class="hs-identifier hs-var">DD.exceptionType</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">External</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ann -&gt; Type Symbol Ann
forall v a. Ord v =&gt; a -&gt; Type v a
</span><span class="hs-identifier hs-var">Type.builtinIO</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">External</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-3562"></span><span>            </span><span class="annot"><span class="annottext">$sel:_typeLookup:Env :: TypeLookup Symbol Ann
</span><span class="hs-identifier hs-var">Typechecker._typeLookup</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeLookup Symbol Ann
</span><a href="#local-6989586621679402993"><span class="hs-identifier hs-var">tl</span></a></span><span> </span><span class="annot"><span class="annottext">TypeLookup Symbol Ann
-&gt; TypeLookup Symbol Ann -&gt; TypeLookup Symbol Ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeLookup Symbol Ann
</span><span class="hs-identifier hs-var">Builtin.typeLookup</span></span><span class="hs-special">,</span><span>
</span><span id="line-3563"></span><span>            </span><span class="annot"><span class="annottext">$sel:_termsByShortname:Env :: Map Text [NamedReference Symbol Ann]
</span><span class="hs-identifier hs-var">Typechecker._termsByShortname</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Text [NamedReference Symbol Ann]
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-3564"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-3565"></span><span>      </span><span id="local-6989586621679402993"><span class="annot"><span class="annottext">tl :: TypeLookup Symbol Ann
</span><a href="#local-6989586621679402993"><span class="hs-identifier hs-var hs-var">tl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3566"></span><span>        </span><span class="annot"><span class="annottext">TypeLookup :: forall v a.
Map Reference (Type v a)
-&gt; Map Reference (DataDeclaration v a)
-&gt; Map Reference (EffectDeclaration v a)
-&gt; TypeLookup v a
</span><span class="hs-identifier hs-type">TypeLookup.TypeLookup</span></span><span>
</span><span id="line-3567"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:typeOfTerms:TypeLookup :: Map Reference (Type Symbol Ann)
</span><span class="hs-identifier hs-var">TypeLookup.typeOfTerms</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Type Symbol Ann -&gt; Map Reference (Type Symbol Ann)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679403002"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403004"><span class="hs-identifier hs-var">typeOfFunc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3568"></span><span>            </span><span class="annot"><span class="annottext">$sel:dataDecls:TypeLookup :: Map Reference (DataDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">TypeLookup.dataDecls</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Reference (DataDeclaration Symbol Ann)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span>
</span><span id="line-3569"></span><span>            </span><span class="annot"><span class="annottext">$sel:effectDecls:TypeLookup :: Map Reference (EffectDeclaration Symbol Ann)
</span><span class="hs-identifier hs-var">TypeLookup.effectDecls</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Reference (EffectDeclaration Symbol Ann)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-3570"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-3571"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ResultT (Notes Symbol Ann) Identity (Type Symbol Ann)
-&gt; Identity (Maybe (Type Symbol Ann), Notes Symbol Ann)
forall notes (f :: * -&gt; *) a.
ResultT notes f a -&gt; f (Maybe a, notes)
</span><span class="hs-identifier hs-var">Result.runResultT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env Symbol Ann
-&gt; Term Symbol Ann
-&gt; ResultT (Notes Symbol Ann) Identity (Type Symbol Ann)
forall (f :: * -&gt; *) v loc.
(Monad f, Var v, Ord loc) =&gt;
Env v loc -&gt; Term v loc -&gt; ResultT (Notes v loc) f (Type v loc)
</span><span class="hs-identifier hs-var">Typechecker.synthesize</span></span><span> </span><span class="annot"><span class="annottext">Env Symbol Ann
</span><a href="#local-6989586621679402999"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; Ann -&gt; Term Symbol Ann -&gt; Term Symbol Ann
forall v a. Var v =&gt; a -&gt; a -&gt; Term v a -&gt; Term v a
</span><span class="hs-identifier hs-var">DD.forceTerm</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">External</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">External</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679403003"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3572"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Type Symbol Ann)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402983"><span class="annot"><span class="annottext">Notes Symbol Ann
</span><a href="#local-6989586621679402983"><span class="hs-identifier hs-var">notes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3573"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; Type Symbol Ann
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span>
</span><span id="line-3574"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-3575"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;synthesizeForce fails although fitsScheme passed&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-3576"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Input Type:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-3577"></span><span>              </span><span class="annot"><span class="annottext">Type Symbol Ann -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679403004"><span class="hs-identifier hs-var">typeOfFunc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3578"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Notes:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-3579"></span><span>              </span><span class="annot"><span class="annottext">Notes Symbol Ann -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Notes Symbol Ann
</span><a href="#local-6989586621679402983"><span class="hs-identifier hs-var">notes</span></a></span><span>
</span><span id="line-3580"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-3581"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-3582"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Identity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679402981"><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679402981"><span class="hs-identifier hs-var">typ</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Notes Symbol Ann
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type Symbol Ann
</span><a href="#local-6989586621679402981"><span class="hs-identifier hs-var">typ</span></a></span><span>
</span><span id="line-3583"></span><span>
</span><span id="line-3584"></span><span id="local-6989586621679407214"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#typecheck"><span class="hs-identifier hs-type">typecheck</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3585"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3586"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3587"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3588"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.Token</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.Lexeme</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3589"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span>
</span><span id="line-3590"></span><span>    </span><span class="annot"><a href="#local-6989586621679407214"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-3591"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Result.Result</span></span><span>
</span><span id="line-3592"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Result.Note</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3593"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UF.UnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UF.TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3594"></span><span>    </span><span class="hs-special">)</span></span><span>
</span><span id="line-3595"></span><span id="typecheck"><span class="annot"><span class="annottext">typecheck :: [Type Symbol Ann]
-&gt; NamesWithHistory
-&gt; Text
-&gt; (Text, [Token Lexeme])
-&gt; Cli
     r
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
</span><a href="Unison.Codebase.Editor.HandleInput.html#typecheck"><span class="hs-identifier hs-var hs-var">typecheck</span></a></span></span><span> </span><span id="local-6989586621679402980"><span class="annot"><span class="annottext">[Type Symbol Ann]
</span><a href="#local-6989586621679402980"><span class="hs-identifier hs-var">ambient</span></a></span></span><span> </span><span id="local-6989586621679402979"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679402979"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621679402978"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679402978"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621679402977"><span class="annot"><span class="annottext">(Text, [Token Lexeme])
</span><a href="#local-6989586621679402977"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3596"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; Cli
     r
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
-&gt; Cli
     r
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall r a. String -&gt; Cli r a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#time"><span class="hs-identifier hs-var">Cli.time</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;typecheck&quot;</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3597"></span><span>    </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679402976"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679402976"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402975"><span class="annot"><span class="annottext">IO UniqueName
$sel:generateUniqueName:Env :: Env -&gt; IO UniqueName
generateUniqueName :: IO UniqueName
</span><a href="Unison.Cli.Monad.html#%24sel%3AgenerateUniqueName%3AEnv"><span class="hs-identifier hs-var hs-var">generateUniqueName</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3598"></span><span>    </span><span id="local-6989586621679402973"><span class="annot"><span class="annottext">UniqueName
</span><a href="#local-6989586621679402973"><span class="hs-identifier hs-var">uniqueName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UniqueName -&gt; Cli r UniqueName
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO UniqueName
</span><a href="#local-6989586621679402975"><span class="hs-identifier hs-var">generateUniqueName</span></a></span><span>
</span><span id="line-3599"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO
  (MaybeT
     (WriterT (Seq (Note Symbol Ann)) Identity)
     (Either
        (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
-&gt; Cli
     r
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (MaybeT
      (WriterT (Seq (Note Symbol Ann)) Identity)
      (Either
         (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
 -&gt; Cli
      r
      (MaybeT
         (WriterT (Seq (Note Symbol Ann)) Identity)
         (Either
            (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))))
-&gt; (ResultT
      (Seq (Note Symbol Ann))
      IO
      (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
    -&gt; IO
         (MaybeT
            (WriterT (Seq (Note Symbol Ann)) Identity)
            (Either
               (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))))
-&gt; ResultT
     (Seq (Note Symbol Ann))
     IO
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
-&gt; Cli
     r
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ResultT
  (Seq (Note Symbol Ann))
  IO
  (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
-&gt; IO
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall (f :: * -&gt; *) notes a.
Functor f =&gt;
ResultT notes f a -&gt; f (Result notes a)
</span><span class="hs-identifier hs-var">Result.getResult</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ResultT
   (Seq (Note Symbol Ann))
   IO
   (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
 -&gt; Cli
      r
      (MaybeT
         (WriterT (Seq (Note Symbol Ann)) Identity)
         (Either
            (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))))
-&gt; ResultT
     (Seq (Note Symbol Ann))
     IO
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
-&gt; Cli
     r
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3600"></span><span>      </span><span class="annot"><span class="annottext">[Type Symbol Ann]
-&gt; (Set Reference -&gt; IO (TypeLookup Symbol Ann))
-&gt; ParsingEnv
-&gt; String
-&gt; Text
-&gt; ResultT
     (Seq (Note Symbol Ann))
     IO
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
forall v (m :: * -&gt; *).
(Var v, Monad m) =&gt;
[Type v]
-&gt; (Set Reference -&gt; m (TypeLookup v Ann))
-&gt; ParsingEnv
-&gt; String
-&gt; Text
-&gt; ResultT
     (Seq (Note v Ann))
     m
     (Either (UnisonFile v Ann) (TypecheckedUnisonFile v Ann))
</span><span class="hs-identifier hs-var">parseAndSynthesizeFile</span></span><span>
</span><span id="line-3601"></span><span>        </span><span class="annot"><span class="annottext">[Type Symbol Ann]
</span><a href="#local-6989586621679402980"><span class="hs-identifier hs-var">ambient</span></a></span><span>
</span><span id="line-3602"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeLookup Symbol Ann
-&gt; TypeLookup Symbol Ann -&gt; TypeLookup Symbol Ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeLookup Symbol Ann
</span><span class="hs-identifier hs-var">Builtin.typeLookup</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeLookup Symbol Ann -&gt; TypeLookup Symbol Ann)
-&gt; IO (TypeLookup Symbol Ann) -&gt; IO (TypeLookup Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (TypeLookup Symbol Ann) -&gt; IO (TypeLookup Symbol Ann))
-&gt; (Set Reference -&gt; IO (TypeLookup Symbol Ann))
-&gt; Set Reference
-&gt; IO (TypeLookup Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Set Reference -&gt; IO (TypeLookup Symbol Ann)
forall (m :: * -&gt; *) a.
(Monad m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Set Reference -&gt; m (TypeLookup Symbol a)
</span><span class="hs-identifier hs-var">Codebase.typeLookupForDependencies</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679402976"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3603"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqueName -&gt; NamesWithHistory -&gt; ParsingEnv
</span><span class="hs-identifier hs-var">Parser.ParsingEnv</span></span><span> </span><span class="annot"><span class="annottext">UniqueName
</span><a href="#local-6989586621679402973"><span class="hs-identifier hs-var">uniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679402979"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3604"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679402978"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3605"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text, [Token Lexeme]) -&gt; Text
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Text, [Token Lexeme])
</span><a href="#local-6989586621679402977"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3606"></span><span>
</span><span id="line-3607"></span><span id="local-6989586621679402970"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#typecheckHelper"><span class="hs-identifier hs-type">typecheckHelper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3608"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621679402970"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-3609"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Codebase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Parser.UniqueName</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3610"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3611"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NamesWithHistory</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3612"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3613"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">L.Token</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">L.Lexeme</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3614"></span><span>    </span><span class="annot"><a href="#local-6989586621679402970"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-3615"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Result.Result</span></span><span>
</span><span id="line-3616"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Result.Note</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3617"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UF.UnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UF.TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3618"></span><span>    </span><span class="hs-special">)</span></span><span>
</span><span id="line-3619"></span><span id="typecheckHelper"><span class="annot"><span class="annottext">typecheckHelper :: Codebase IO Symbol Ann
-&gt; IO UniqueName
-&gt; [Type Symbol Ann]
-&gt; NamesWithHistory
-&gt; Text
-&gt; (Text, [Token Lexeme])
-&gt; m (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
</span><a href="Unison.Codebase.Editor.HandleInput.html#typecheckHelper"><span class="hs-identifier hs-var hs-var">typecheckHelper</span></a></span></span><span> </span><span id="local-6989586621679402969"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679402969"><span class="hs-identifier hs-var">codebase</span></a></span></span><span> </span><span id="local-6989586621679402968"><span class="annot"><span class="annottext">IO UniqueName
</span><a href="#local-6989586621679402968"><span class="hs-identifier hs-var">generateUniqueName</span></a></span></span><span> </span><span id="local-6989586621679402967"><span class="annot"><span class="annottext">[Type Symbol Ann]
</span><a href="#local-6989586621679402967"><span class="hs-identifier hs-var">ambient</span></a></span></span><span> </span><span id="local-6989586621679402966"><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679402966"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span id="local-6989586621679402965"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679402965"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621679402964"><span class="annot"><span class="annottext">(Text, [Token Lexeme])
</span><a href="#local-6989586621679402964"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3620"></span><span>    </span><span id="local-6989586621679402963"><span class="annot"><span class="annottext">UniqueName
</span><a href="#local-6989586621679402963"><span class="hs-identifier hs-var">uniqueName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UniqueName -&gt; m UniqueName
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO UniqueName
</span><a href="#local-6989586621679402968"><span class="hs-identifier hs-var">generateUniqueName</span></a></span><span>
</span><span id="line-3621"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO
  (MaybeT
     (WriterT (Seq (Note Symbol Ann)) Identity)
     (Either
        (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
-&gt; m (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO
   (MaybeT
      (WriterT (Seq (Note Symbol Ann)) Identity)
      (Either
         (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
 -&gt; m (MaybeT
         (WriterT (Seq (Note Symbol Ann)) Identity)
         (Either
            (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))))
-&gt; (ResultT
      (Seq (Note Symbol Ann))
      IO
      (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
    -&gt; IO
         (MaybeT
            (WriterT (Seq (Note Symbol Ann)) Identity)
            (Either
               (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))))
-&gt; ResultT
     (Seq (Note Symbol Ann))
     IO
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
-&gt; m (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ResultT
  (Seq (Note Symbol Ann))
  IO
  (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
-&gt; IO
     (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall (f :: * -&gt; *) notes a.
Functor f =&gt;
ResultT notes f a -&gt; f (Result notes a)
</span><span class="hs-identifier hs-var">Result.getResult</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ResultT
   (Seq (Note Symbol Ann))
   IO
   (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
 -&gt; m (MaybeT
         (WriterT (Seq (Note Symbol Ann)) Identity)
         (Either
            (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))))
-&gt; ResultT
     (Seq (Note Symbol Ann))
     IO
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
-&gt; m (MaybeT
        (WriterT (Seq (Note Symbol Ann)) Identity)
        (Either
           (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3622"></span><span>      </span><span class="annot"><span class="annottext">[Type Symbol Ann]
-&gt; (Set Reference -&gt; IO (TypeLookup Symbol Ann))
-&gt; ParsingEnv
-&gt; String
-&gt; Text
-&gt; ResultT
     (Seq (Note Symbol Ann))
     IO
     (Either (UnisonFile Symbol Ann) (TypecheckedUnisonFile Symbol Ann))
forall v (m :: * -&gt; *).
(Var v, Monad m) =&gt;
[Type v]
-&gt; (Set Reference -&gt; m (TypeLookup v Ann))
-&gt; ParsingEnv
-&gt; String
-&gt; Text
-&gt; ResultT
     (Seq (Note v Ann))
     m
     (Either (UnisonFile v Ann) (TypecheckedUnisonFile v Ann))
</span><span class="hs-identifier hs-var">parseAndSynthesizeFile</span></span><span>
</span><span id="line-3623"></span><span>        </span><span class="annot"><span class="annottext">[Type Symbol Ann]
</span><a href="#local-6989586621679402967"><span class="hs-identifier hs-var">ambient</span></a></span><span>
</span><span id="line-3624"></span><span>        </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeLookup Symbol Ann
-&gt; TypeLookup Symbol Ann -&gt; TypeLookup Symbol Ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TypeLookup Symbol Ann
</span><span class="hs-identifier hs-var">Builtin.typeLookup</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TypeLookup Symbol Ann -&gt; TypeLookup Symbol Ann)
-&gt; IO (TypeLookup Symbol Ann) -&gt; IO (TypeLookup Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (TypeLookup Symbol Ann) -&gt; IO (TypeLookup Symbol Ann))
-&gt; (Set Reference -&gt; IO (TypeLookup Symbol Ann))
-&gt; Set Reference
-&gt; IO (TypeLookup Symbol Ann)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
-&gt; Set Reference -&gt; IO (TypeLookup Symbol Ann)
forall (m :: * -&gt; *) a.
(Monad m, BuiltinAnnotation a) =&gt;
Codebase m Symbol a -&gt; Set Reference -&gt; m (TypeLookup Symbol a)
</span><span class="hs-identifier hs-var">Codebase.typeLookupForDependencies</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679402969"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3625"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqueName -&gt; NamesWithHistory -&gt; ParsingEnv
</span><span class="hs-identifier hs-var">Parser.ParsingEnv</span></span><span> </span><span class="annot"><span class="annottext">UniqueName
</span><a href="#local-6989586621679402963"><span class="hs-identifier hs-var">uniqueName</span></a></span><span> </span><span class="annot"><span class="annottext">NamesWithHistory
</span><a href="#local-6989586621679402966"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3626"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">Text.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679402965"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3627"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Text, [Token Lexeme]) -&gt; Text
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Text, [Token Lexeme])
</span><a href="#local-6989586621679402964"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3628"></span><span>
</span><span id="line-3629"></span><span>
</span><span id="line-3630"></span><span class="hs-comment">-- | Evaluate all watched expressions in a UnisonFile and return</span><span>
</span><span id="line-3631"></span><span class="hs-comment">-- their results, keyed by the name of the watch variable. The tuple returned</span><span>
</span><span id="line-3632"></span><span class="hs-comment">-- has the form:</span><span>
</span><span id="line-3633"></span><span class="hs-comment">--   (hash, (ann, sourceTerm, evaluatedTerm, isCacheHit))</span><span>
</span><span id="line-3634"></span><span class="hs-comment">--</span><span>
</span><span id="line-3635"></span><span class="hs-comment">-- where</span><span>
</span><span id="line-3636"></span><span class="hs-comment">--   `hash` is the hash of the original watch expression definition</span><span>
</span><span id="line-3637"></span><span class="hs-comment">--   `ann` gives the location of the watch expression</span><span>
</span><span id="line-3638"></span><span class="hs-comment">--   `sourceTerm` is a closed term (no free vars) for the watch expression</span><span>
</span><span id="line-3639"></span><span class="hs-comment">--   `evaluatedTerm` is the result of evaluating that `sourceTerm`</span><span>
</span><span id="line-3640"></span><span class="hs-comment">--   `isCacheHit` is True if the result was computed by just looking up</span><span>
</span><span id="line-3641"></span><span class="hs-comment">--   in a cache</span><span>
</span><span id="line-3642"></span><span class="hs-comment">--</span><span>
</span><span id="line-3643"></span><span class="hs-comment">-- It's expected that the user of this action might add the</span><span>
</span><span id="line-3644"></span><span class="hs-comment">-- `(hash, evaluatedTerm)` mapping to a cache to make future evaluations</span><span>
</span><span id="line-3645"></span><span class="hs-comment">-- of the same watches instantaneous.</span><span>
</span><span id="line-3646"></span><span id="local-6989586621679407168"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonFile"><span class="hs-identifier hs-type">evalUnisonFile</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3647"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3648"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3649"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3650"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3651"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span>
</span><span id="line-3652"></span><span>    </span><span class="annot"><a href="#local-6989586621679407168"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-3653"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-3654"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">WK.WatchKind</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-3655"></span><span>    </span><span class="hs-special">)</span></span><span>
</span><span id="line-3656"></span><span id="evalUnisonFile"><span class="annot"><span class="annottext">evalUnisonFile :: Bool
-&gt; PrettyPrintEnv
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; [String]
-&gt; Cli
     r
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonFile"><span class="hs-identifier hs-var hs-var">evalUnisonFile</span></a></span></span><span> </span><span id="local-6989586621679402961"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402961"><span class="hs-identifier hs-var">sandbox</span></a></span></span><span> </span><span id="local-6989586621679402960"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679402960"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679402959"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679402959"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span> </span><span id="local-6989586621679402958"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679402958"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3657"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679402957"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679402957"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402956"><span class="annot"><span class="annottext">Runtime Symbol
runtime :: Runtime Symbol
$sel:runtime:Env :: Env -&gt; Runtime Symbol
</span><a href="#local-6989586621679402956"><span class="hs-identifier hs-var hs-var">runtime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402955"><span class="annot"><span class="annottext">Runtime Symbol
sandboxedRuntime :: Runtime Symbol
$sel:sandboxedRuntime:Env :: Env -&gt; Runtime Symbol
</span><a href="#local-6989586621679402955"><span class="hs-identifier hs-var hs-var">sandboxedRuntime</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3658"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679402954"><span class="annot"><span class="annottext">theRuntime :: Runtime Symbol
</span><a href="#local-6989586621679402954"><span class="hs-identifier hs-var hs-var">theRuntime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402961"><span class="hs-identifier hs-var">sandbox</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679402955"><span class="hs-identifier hs-var">sandboxedRuntime</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679402956"><span class="hs-identifier hs-var">runtime</span></a></span><span>
</span><span id="line-3659"></span><span>
</span><span id="line-3660"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679402953"><span class="hs-identifier hs-type">watchCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3661"></span><span>      </span><span id="local-6989586621679402953"><span class="annot"><span class="annottext">watchCache :: Id -&gt; IO (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679402953"><span class="hs-identifier hs-var hs-var">watchCache</span></a></span></span><span> </span><span id="local-6989586621679402952"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402952"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3662"></span><span>        </span><span id="local-6989586621679402951"><span class="annot"><span class="annottext">Maybe (Term Symbol Ann)
</span><a href="#local-6989586621679402951"><span class="hs-identifier hs-var">maybeTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Id -&gt; IO (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Id -&gt; m (Maybe (Term v a))
</span><span class="hs-identifier hs-var">Codebase.lookupWatchCache</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679402957"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402952"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-3663"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ann -&gt; ()) -&gt; Term Symbol Ann -&gt; Term Symbol ()
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term Symbol Ann -&gt; Term Symbol ())
-&gt; Maybe (Term Symbol Ann) -&gt; Maybe (Term Symbol ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Term Symbol Ann)
</span><a href="#local-6989586621679402951"><span class="hs-identifier hs-var">maybeTerm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3664"></span><span>
</span><span id="line-3665"></span><span>  </span><span class="annot"><span class="annottext">(forall x. IO x -&gt; IO x)
-&gt; Cli
     (R r
        ([(Symbol, Term Symbol ())],
         Map
           Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
-&gt; Cli
     r
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
forall r a. (forall x. IO x -&gt; IO x) -&gt; Cli (R r a) a -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#with_"><span class="hs-identifier hs-var">Cli.with_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; IO x -&gt; IO x
forall a. [String] -&gt; IO a -&gt; IO a
</span><span class="hs-identifier hs-var">withArgs</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679402958"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3666"></span><span>    </span><span id="local-6989586621679402948"><span class="annot"><span class="annottext">rs :: ([(Symbol, Term Symbol ())],
 Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
</span><a href="#local-6989586621679402948"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Symbol, Term Symbol ())]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402947"><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
</span><a href="#local-6989586621679402947"><span class="hs-identifier hs-var">map</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-3667"></span><span>      </span><span class="annot"><span class="annottext">IO
  (Either
     (Pretty ColorText)
     ([(Symbol, Term Symbol ())],
      Map
        Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
-&gt; (Pretty ColorText
    -&gt; Cli
         (R r
            ([(Symbol, Term Symbol ())],
             Map
               Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
         ([(Symbol, Term Symbol ())],
          Map
            Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
-&gt; Cli
     (R r
        ([(Symbol, Term Symbol ())],
         Map
           Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
forall e a r. IO (Either e a) -&gt; (e -&gt; Cli r a) -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#ioE"><span class="hs-identifier hs-var">Cli.ioE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodeLookup Symbol IO Ann
-&gt; PrettyPrintEnv
-&gt; (Id -&gt; IO (Maybe (Term Symbol ())))
-&gt; Runtime Symbol
-&gt; TypecheckedUnisonFile Symbol Ann
-&gt; IO
     (Either
        (Pretty ColorText)
        ([(Symbol, Term Symbol ())],
         Map
           Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
forall v a.
Var v =&gt;
CodeLookup v IO a
-&gt; PrettyPrintEnv
-&gt; (Id -&gt; IO (Maybe (Term v)))
-&gt; Runtime v
-&gt; TypecheckedUnisonFile v a
-&gt; IO (WatchResults v a)
</span><span class="hs-identifier hs-var">Runtime.evaluateWatches</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; CodeLookup Symbol IO Ann
forall (m :: * -&gt; *).
Monad m =&gt;
Codebase m Symbol Ann -&gt; CodeLookup Symbol m Ann
</span><span class="hs-identifier hs-var">Codebase.toCodeLookup</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679402957"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679402960"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; IO (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679402953"><span class="hs-identifier hs-var">watchCache</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679402954"><span class="hs-identifier hs-var">theRuntime</span></a></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol Ann
</span><a href="#local-6989586621679402959"><span class="hs-identifier hs-var">unisonFile</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679402945"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679402945"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3668"></span><span>        </span><span class="annot"><span class="annottext">Output
-&gt; Cli
     (R r
        ([(Symbol, Term Symbol ())],
         Map
           Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
     ([(Symbol, Term Symbol ())],
      Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#EvaluationFailure"><span class="hs-identifier hs-var">EvaluationFailure</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679402945"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3669"></span><span>    </span><span class="annot"><span class="annottext">[(Ann, String, Id, Term Symbol (), Term Symbol (), Bool)]
-&gt; ((Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
    -&gt; Cli
         (R r
            ([(Symbol, Term Symbol ())],
             Map
               Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
         ())
-&gt; Cli
     (R r
        ([(Symbol, Term Symbol ())],
         Map
           Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
     ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
-&gt; [(Ann, String, Id, Term Symbol (), Term Symbol (), Bool)]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)
</span><a href="#local-6989586621679402947"><span class="hs-identifier hs-var">map</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679402943"><span class="annot"><span class="annottext">Ann
</span><a href="#local-6989586621679402943"><span class="hs-identifier hs-var">_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402942"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679402942"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402941"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402941"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402940"><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679402940"><span class="hs-identifier hs-var">_src</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402939"><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679402939"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402938"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402938"><span class="hs-identifier hs-var">isHit</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3670"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; Cli
     (R r
        ([(Symbol, Term Symbol ())],
         Map
           Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
     ()
-&gt; Cli
     (R r
        ([(Symbol, Term Symbol ())],
         Map
           Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
     ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402938"><span class="hs-identifier hs-var">isHit</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3671"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679402937"><span class="annot"><span class="annottext">value' :: Term Symbol Ann
</span><a href="#local-6989586621679402937"><span class="hs-identifier hs-var hs-var">value'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term Symbol () -&gt; Term Symbol Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.External</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679402939"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-3672"></span><span>        </span><span class="annot"><span class="annottext">IO ()
-&gt; Cli
     (R r
        ([(Symbol, Term Symbol ())],
         Map
           Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool)))
     ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; String -&gt; Id -&gt; Term Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; String -&gt; Id -&gt; Term v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putWatch</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679402957"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679402942"><span class="hs-identifier hs-var">kind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402941"><span class="hs-identifier hs-var">hash</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679402937"><span class="hs-identifier hs-var">value'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3673"></span><span>    </span><span class="hs-identifier">pure</span><span> </span><span class="annot"><span class="annottext">([(Symbol, Term Symbol ())],
 Map Symbol (Ann, String, Id, Term Symbol (), Term Symbol (), Bool))
</span><a href="#local-6989586621679402948"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-3674"></span><span>
</span><span id="line-3675"></span><span class="hs-comment">-- | Evaluate a single closed definition.</span><span>
</span><span id="line-3676"></span><span id="local-6989586621679406345"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTermE"><span class="hs-identifier hs-type">evalUnisonTermE</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3677"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3678"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3679"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3680"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3681"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406345"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Runtime.Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-3682"></span><span id="evalUnisonTermE"><span class="annot"><span class="annottext">evalUnisonTermE :: Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTermE"><span class="hs-identifier hs-var hs-var">evalUnisonTermE</span></a></span></span><span> </span><span id="local-6989586621679402935"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402935"><span class="hs-identifier hs-var">sandbox</span></a></span></span><span> </span><span id="local-6989586621679402934"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679402934"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679402933"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402933"><span class="hs-identifier hs-var">useCache</span></a></span></span><span> </span><span id="local-6989586621679402932"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679402932"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3683"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Env"><span class="hs-identifier hs-type">Cli.Env</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679402931"><span class="annot"><span class="annottext">Codebase IO Symbol Ann
codebase :: Codebase IO Symbol Ann
$sel:codebase:Env :: Env -&gt; Codebase IO Symbol Ann
</span><a href="#local-6989586621679402931"><span class="hs-identifier hs-var hs-var">codebase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402930"><span class="annot"><span class="annottext">Runtime Symbol
runtime :: Runtime Symbol
$sel:runtime:Env :: Env -&gt; Runtime Symbol
</span><a href="#local-6989586621679402930"><span class="hs-identifier hs-var hs-var">runtime</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679402929"><span class="annot"><span class="annottext">Runtime Symbol
sandboxedRuntime :: Runtime Symbol
$sel:sandboxedRuntime:Env :: Env -&gt; Runtime Symbol
</span><a href="#local-6989586621679402929"><span class="hs-identifier hs-var hs-var">sandboxedRuntime</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Env
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-3684"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679402928"><span class="annot"><span class="annottext">theRuntime :: Runtime Symbol
</span><a href="#local-6989586621679402928"><span class="hs-identifier hs-var hs-var">theRuntime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402935"><span class="hs-identifier hs-var">sandbox</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679402929"><span class="hs-identifier hs-var">sandboxedRuntime</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679402930"><span class="hs-identifier hs-var">runtime</span></a></span><span>
</span><span id="line-3685"></span><span>
</span><span id="line-3686"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679402927"><span class="hs-identifier hs-type">watchCache</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3687"></span><span>      </span><span id="local-6989586621679402927"><span class="annot"><span class="annottext">watchCache :: Id -&gt; IO (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679402927"><span class="hs-identifier hs-var hs-var">watchCache</span></a></span></span><span> </span><span id="local-6989586621679402926"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402926"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3688"></span><span>        </span><span id="local-6989586621679402925"><span class="annot"><span class="annottext">Maybe (Term Symbol Ann)
</span><a href="#local-6989586621679402925"><span class="hs-identifier hs-var">maybeTerm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; Id -&gt; IO (Maybe (Term Symbol Ann))
forall (m :: * -&gt; *) v a.
Monad m =&gt;
Codebase m v a -&gt; Id -&gt; m (Maybe (Term v a))
</span><span class="hs-identifier hs-var">Codebase.lookupWatchCache</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679402931"><span class="hs-identifier hs-var">codebase</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402926"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-3689"></span><span>        </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ann -&gt; ()) -&gt; Term Symbol Ann -&gt; Term Symbol ()
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Term Symbol Ann -&gt; Term Symbol ())
-&gt; Maybe (Term Symbol Ann) -&gt; Maybe (Term Symbol ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Term Symbol Ann)
</span><a href="#local-6989586621679402925"><span class="hs-identifier hs-var">maybeTerm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3690"></span><span>
</span><span id="line-3691"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679402924"><span class="annot"><span class="annottext">cache :: Id -&gt; IO (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679402924"><span class="hs-identifier hs-var hs-var">cache</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402933"><span class="hs-identifier hs-var">useCache</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IO (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679402927"><span class="hs-identifier hs-var">watchCache</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IO (Maybe (Term Symbol ()))
forall v. Id -&gt; IO (Maybe (Term v))
</span><span class="hs-identifier hs-var">Runtime.noCache</span></span><span>
</span><span id="line-3692"></span><span>  </span><span id="local-6989586621679402922"><span class="annot"><span class="annottext">Either (Pretty ColorText) (Term Symbol ())
</span><a href="#local-6989586621679402922"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either (Pretty ColorText) (Term Symbol ()))
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol ()))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodeLookup Symbol IO Ann
-&gt; (Id -&gt; IO (Maybe (Term Symbol ())))
-&gt; PrettyPrintEnv
-&gt; Runtime Symbol
-&gt; Term Symbol Ann
-&gt; IO (Either (Pretty ColorText) (Term Symbol ()))
forall v a.
(Var v, Monoid a) =&gt;
CodeLookup v IO a
-&gt; (Id -&gt; IO (Maybe (Term v)))
-&gt; PrettyPrintEnv
-&gt; Runtime v
-&gt; Term v a
-&gt; IO (Either (Pretty ColorText) (Term v))
</span><span class="hs-identifier hs-var">Runtime.evaluateTerm'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; CodeLookup Symbol IO Ann
forall (m :: * -&gt; *).
Monad m =&gt;
Codebase m Symbol Ann -&gt; CodeLookup Symbol m Ann
</span><span class="hs-identifier hs-var">Codebase.toCodeLookup</span></span><span> </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679402931"><span class="hs-identifier hs-var">codebase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IO (Maybe (Term Symbol ()))
</span><a href="#local-6989586621679402924"><span class="hs-identifier hs-var">cache</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679402934"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Runtime Symbol
</span><a href="#local-6989586621679402928"><span class="hs-identifier hs-var">theRuntime</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679402932"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3693"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Cli r () -&gt; Cli r ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402933"><span class="hs-identifier hs-var">useCache</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3694"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (Pretty ColorText) (Term Symbol ())
</span><a href="#local-6989586621679402922"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3695"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679402920"><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679402920"><span class="hs-identifier hs-var">tmr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3696"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; Cli r ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Cli r ()) -&gt; IO () -&gt; Cli r ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-3697"></span><span>          </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann -&gt; String -&gt; Id -&gt; Term Symbol Ann -&gt; IO ()
forall (m :: * -&gt; *) v a.
Codebase m v a -&gt; String -&gt; Id -&gt; Term v a -&gt; m ()
</span><span class="hs-identifier hs-var hs-var">Codebase.putWatch</span></span><span>
</span><span id="line-3698"></span><span>            </span><span class="annot"><span class="annottext">Codebase IO Symbol Ann
</span><a href="#local-6989586621679402931"><span class="hs-identifier hs-var">codebase</span></a></span><span>
</span><span id="line-3699"></span><span>            </span><span class="annot"><span class="annottext">String
forall a. (Eq a, IsString a) =&gt; a
</span><span class="hs-identifier hs-var">WK.RegularWatch</span></span><span>
</span><span id="line-3700"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term Symbol Ann -&gt; Id
forall v a. Var v =&gt; Term v a -&gt; Id
</span><span class="hs-identifier hs-var">Hashing.hashClosedTerm</span></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679402932"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3701"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term Symbol () -&gt; Term Symbol Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ann -&gt; () -&gt; Ann
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.External</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679402920"><span class="hs-identifier hs-var">tmr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3702"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Cli r ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3703"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-operator">$</span><span> </span><span class="annot"><span class="annottext">Either (Pretty ColorText) (Term Symbol ())
</span><a href="#local-6989586621679402922"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Either (Pretty ColorText) (Term Symbol ())
-&gt; (Term Symbol () -&gt; Term Symbol Ann)
-&gt; Either (Pretty ColorText) (Term Symbol Ann)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(() -&gt; Ann) -&gt; Term Symbol () -&gt; Term Symbol Ann
forall v a a2. Ord v =&gt; (a -&gt; a2) -&gt; Term v a -&gt; Term v a2
</span><span class="hs-identifier hs-var">Term.amap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ann
</span><span class="hs-identifier hs-var">Ann.External</span></span><span class="hs-special">)</span><span>
</span><span id="line-3704"></span><span>
</span><span id="line-3705"></span><span class="hs-comment">-- | Evaluate a single closed definition.</span><span>
</span><span id="line-3706"></span><span id="local-6989586621679406688"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTerm"><span class="hs-identifier hs-type">evalUnisonTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-3707"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3708"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">PPE.PrettyPrintEnv</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3709"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3710"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3711"></span><span>  </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406688"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ann</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-3712"></span><span id="evalUnisonTerm"><span class="annot"><span class="annottext">evalUnisonTerm :: Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Term Symbol Ann)
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTerm"><span class="hs-identifier hs-var hs-var">evalUnisonTerm</span></a></span></span><span> </span><span id="local-6989586621679402918"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402918"><span class="hs-identifier hs-var">sandbox</span></a></span></span><span> </span><span id="local-6989586621679402917"><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679402917"><span class="hs-identifier hs-var">ppe</span></a></span></span><span> </span><span id="local-6989586621679402916"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402916"><span class="hs-identifier hs-var">useCache</span></a></span></span><span> </span><span id="local-6989586621679402915"><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679402915"><span class="hs-identifier hs-var">tm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3713"></span><span>  </span><span class="annot"><span class="annottext">Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
forall r.
Bool
-&gt; PrettyPrintEnv
-&gt; Bool
-&gt; Term Symbol Ann
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
</span><a href="Unison.Codebase.Editor.HandleInput.html#evalUnisonTermE"><span class="hs-identifier hs-var">evalUnisonTermE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402918"><span class="hs-identifier hs-var">sandbox</span></a></span><span> </span><span class="annot"><span class="annottext">PrettyPrintEnv
</span><a href="#local-6989586621679402917"><span class="hs-identifier hs-var">ppe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679402916"><span class="hs-identifier hs-var">useCache</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol Ann
</span><a href="#local-6989586621679402915"><span class="hs-identifier hs-var">tm</span></a></span><span> </span><span class="annot"><span class="annottext">Cli r (Either (Pretty ColorText) (Term Symbol Ann))
-&gt; (Cli r (Either (Pretty ColorText) (Term Symbol Ann))
    -&gt; Cli r (Term Symbol Ann))
-&gt; Cli r (Term Symbol Ann)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Pretty ColorText -&gt; Cli r (Term Symbol Ann))
-&gt; Cli r (Either (Pretty ColorText) (Term Symbol Ann))
-&gt; Cli r (Term Symbol Ann)
forall (m :: * -&gt; *) a b.
Monad m =&gt;
(a -&gt; m b) -&gt; m (Either a b) -&gt; m b
</span><span class="hs-identifier hs-var">onLeftM</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679402913"><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679402913"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3714"></span><span>    </span><span class="annot"><span class="annottext">Output -&gt; Cli r (Term Symbol Ann)
forall r a. Output -&gt; Cli r a
</span><a href="Unison.Cli.Monad.html#returnEarly"><span class="hs-identifier hs-var">Cli.returnEarly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Pretty ColorText -&gt; Output
</span><a href="Unison.Codebase.Editor.Output.html#EvaluationFailure"><span class="hs-identifier hs-var">EvaluationFailure</span></a></span><span> </span><span class="annot"><span class="annottext">Pretty ColorText
</span><a href="#local-6989586621679402913"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3715"></span><span>
</span><span id="line-3716"></span><span id="local-6989586621679406846"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#getBasicPrettyPrintNames"><span class="hs-identifier hs-type">getBasicPrettyPrintNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Unison.Cli.Monad.html#Cli"><span class="hs-identifier hs-type">Cli</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679406846"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Names</span></span></span><span>
</span><span id="line-3717"></span><span id="getBasicPrettyPrintNames"><span class="annot"><span class="annottext">getBasicPrettyPrintNames :: Cli r Names
</span><a href="Unison.Codebase.Editor.HandleInput.html#getBasicPrettyPrintNames"><span class="hs-identifier hs-var hs-var">getBasicPrettyPrintNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3718"></span><span>  </span><span id="local-6989586621679402912"><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679402912"><span class="hs-identifier hs-var">rootBranch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r (Branch IO)
forall r. Cli r (Branch IO)
</span><a href="Unison.Cli.MonadUtils.html#getRootBranch"><span class="hs-identifier hs-var">Cli.getRootBranch</span></a></span><span>
</span><span id="line-3719"></span><span>  </span><span id="local-6989586621679402911"><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679402911"><span class="hs-identifier hs-var">currentPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Cli r Absolute
forall r. Cli r Absolute
</span><a href="Unison.Cli.MonadUtils.html#getCurrentPath"><span class="hs-identifier hs-var">Cli.getCurrentPath</span></a></span><span>
</span><span id="line-3720"></span><span>  </span><span class="hs-identifier">pure</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Branch IO -&gt; NameScoping -&gt; Names
forall (m :: * -&gt; *). Branch m -&gt; NameScoping -&gt; Names
</span><span class="hs-identifier hs-var">Backend.prettyNamesForBranch</span></span><span> </span><span class="annot"><span class="annottext">Branch IO
</span><a href="#local-6989586621679402912"><span class="hs-identifier hs-var">rootBranch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Path -&gt; NameScoping
</span><span class="hs-identifier hs-var">Backend.AllNames</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Absolute -&gt; Path
</span><span class="hs-identifier hs-var hs-var">Path.unabsolute</span></span><span> </span><span class="annot"><span class="annottext">Absolute
</span><a href="#local-6989586621679402911"><span class="hs-identifier hs-var">currentPath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3721"></span><span>
</span><span id="line-3722"></span><span class="hs-comment">-- Hack alert</span><span>
</span><span id="line-3723"></span><span class="hs-comment">--</span><span>
</span><span id="line-3724"></span><span class="hs-comment">-- After we evaluate a term all vars are transformed into references,</span><span>
</span><span id="line-3725"></span><span class="hs-comment">-- but we want to feed this result into 'slurpFile' which won't add</span><span>
</span><span id="line-3726"></span><span class="hs-comment">-- dependencies that are referenced by hash. The hacky solution for</span><span>
</span><span id="line-3727"></span><span class="hs-comment">-- now is to convert all references that match a variable defined</span><span>
</span><span id="line-3728"></span><span class="hs-comment">-- within the unison file to variable references. This is hacky both</span><span>
</span><span id="line-3729"></span><span class="hs-comment">-- because we needlessly flip-flopping between var and reference</span><span>
</span><span id="line-3730"></span><span class="hs-comment">-- representations, and because we might unexpectedly add a term from</span><span>
</span><span id="line-3731"></span><span class="hs-comment">-- the local file if it has the same hash as a term in the codebase.</span><span>
</span><span id="line-3732"></span><span id="local-6989586621679406738"><span class="annot"><a href="Unison.Codebase.Editor.HandleInput.html#stripUnisonFileReferences"><span class="hs-identifier hs-type">stripUnisonFileReferences</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypecheckedUnisonFile</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="annot"><a href="#local-6989586621679406738"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Term</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-3733"></span><span id="stripUnisonFileReferences"><span class="annot"><span class="annottext">stripUnisonFileReferences :: TypecheckedUnisonFile Symbol a -&gt; Term Symbol () -&gt; Term Symbol ()
</span><a href="Unison.Codebase.Editor.HandleInput.html#stripUnisonFileReferences"><span class="hs-identifier hs-var hs-var">stripUnisonFileReferences</span></a></span></span><span> </span><span id="local-6989586621679402910"><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol a
</span><a href="#local-6989586621679402910"><span class="hs-identifier hs-var">unisonFile</span></a></span></span><span> </span><span id="local-6989586621679402909"><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679402909"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3734"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679402908"><span class="hs-identifier hs-type">refMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reference.Id</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span>
</span><span id="line-3735"></span><span>      </span><span id="local-6989586621679402908"><span class="annot"><span class="annottext">refMap :: Map Id Symbol
</span><a href="#local-6989586621679402908"><span class="hs-identifier hs-var hs-var">refMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Id, Symbol)] -&gt; Map Id Symbol
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Id, Symbol)] -&gt; Map Id Symbol)
-&gt; (TypecheckedUnisonFile Symbol a -&gt; [(Id, Symbol)])
-&gt; TypecheckedUnisonFile Symbol a
-&gt; Map Id Symbol
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Symbol, (Id, Maybe String, Term Symbol a, Type Symbol a))
 -&gt; (Id, Symbol))
-&gt; [(Symbol, (Id, Maybe String, Term Symbol a, Type Symbol a))]
-&gt; [(Id, Symbol)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679402907"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679402907"><span class="hs-identifier hs-var">sym</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679402906"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402906"><span class="hs-identifier hs-var">refId</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Term Symbol a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type Symbol a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402906"><span class="hs-identifier hs-var">refId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679402907"><span class="hs-identifier hs-var">sym</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Symbol, (Id, Maybe String, Term Symbol a, Type Symbol a))]
 -&gt; [(Id, Symbol)])
-&gt; (TypecheckedUnisonFile Symbol a
    -&gt; [(Symbol, (Id, Maybe String, Term Symbol a, Type Symbol a))])
-&gt; TypecheckedUnisonFile Symbol a
-&gt; [(Id, Symbol)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map Symbol (Id, Maybe String, Term Symbol a, Type Symbol a)
-&gt; [(Symbol, (Id, Maybe String, Term Symbol a, Type Symbol a))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Symbol (Id, Maybe String, Term Symbol a, Type Symbol a)
 -&gt; [(Symbol, (Id, Maybe String, Term Symbol a, Type Symbol a))])
-&gt; (TypecheckedUnisonFile Symbol a
    -&gt; Map Symbol (Id, Maybe String, Term Symbol a, Type Symbol a))
-&gt; TypecheckedUnisonFile Symbol a
-&gt; [(Symbol, (Id, Maybe String, Term Symbol a, Type Symbol a))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol a
-&gt; Map Symbol (Id, Maybe String, Term Symbol a, Type Symbol a)
forall v a.
TypecheckedUnisonFile v a
-&gt; Map v (Id, Maybe String, Term v a, Type v a)
</span><span class="hs-identifier hs-var hs-var">UF.hashTermsId</span></span><span> </span><span class="annot"><span class="annottext">(TypecheckedUnisonFile Symbol a -&gt; Map Id Symbol)
-&gt; TypecheckedUnisonFile Symbol a -&gt; Map Id Symbol
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TypecheckedUnisonFile Symbol a
</span><a href="#local-6989586621679402910"><span class="hs-identifier hs-var">unisonFile</span></a></span><span>
</span><span id="line-3736"></span><span>      </span><span id="local-6989586621679402905"><span class="annot"><span class="annottext">alg :: ()
-&gt; ABT
     (F typeVar typeAnn patternAnn)
     Symbol
     (Term (F typeVar typeAnn patternAnn) Symbol ())
-&gt; Term (F typeVar typeAnn patternAnn) Symbol ()
</span><a href="#local-6989586621679402905"><span class="hs-identifier hs-var hs-var">alg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-3737"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ABT.Var</span></span><span> </span><span id="local-6989586621679402903"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679402903"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; Term (F typeVar typeAnn patternAnn) Symbol ()
forall v (f :: * -&gt; *). v -&gt; Term f v ()
</span><span class="hs-identifier hs-var">ABT.var</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679402903"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3738"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ABT.Cycle</span></span><span> </span><span id="local-6989586621679402900"><span class="annot"><span class="annottext">Term (F typeVar typeAnn patternAnn) Symbol ()
</span><a href="#local-6989586621679402900"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Term (F typeVar typeAnn patternAnn) Symbol ()
-&gt; Term (F typeVar typeAnn patternAnn) Symbol ()
forall (f :: * -&gt; *) v. Term f v () -&gt; Term f v ()
</span><span class="hs-identifier hs-var">ABT.cycle</span></span><span> </span><span class="annot"><span class="annottext">Term (F typeVar typeAnn patternAnn) Symbol ()
</span><a href="#local-6989586621679402900"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3739"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ABT.Abs</span></span><span> </span><span id="local-6989586621679402897"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679402897"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679402896"><span class="annot"><span class="annottext">Term (F typeVar typeAnn patternAnn) Symbol ()
</span><a href="#local-6989586621679402896"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Symbol
-&gt; Term (F typeVar typeAnn patternAnn) Symbol ()
-&gt; Term (F typeVar typeAnn patternAnn) Symbol ()
forall v (f :: * -&gt; *). Ord v =&gt; v -&gt; Term f v () -&gt; Term f v ()
</span><span class="hs-identifier hs-var">ABT.abs</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679402897"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Term (F typeVar typeAnn patternAnn) Symbol ()
</span><a href="#local-6989586621679402896"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3740"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">ABT.Tm</span></span><span> </span><span id="local-6989586621679402893"><span class="annot"><span class="annottext">F typeVar
  typeAnn
  patternAnn
  (Term (F typeVar typeAnn patternAnn) Symbol ())
</span><a href="#local-6989586621679402893"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">F typeVar
  typeAnn
  patternAnn
  (Term (F typeVar typeAnn patternAnn) Symbol ())
</span><a href="#local-6989586621679402893"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3741"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Term.Ref</span></span><span> </span><span id="local-6989586621679402891"><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679402891"><span class="hs-identifier hs-var">ref</span></a></span></span><span>
</span><span id="line-3742"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679402890"><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679402890"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679402889"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402889"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Map Id Symbol -&gt; Maybe Symbol
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621679402889"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Map Id Symbol
</span><a href="#local-6989586621679402908"><span class="hs-identifier hs-var">refMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Maybe Symbol) -&gt; Maybe Id -&gt; Maybe Symbol
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Reference -&gt; Maybe Id
</span><span class="hs-identifier hs-var">Reference.toId</span></span><span> </span><span class="annot"><span class="annottext">Reference
</span><a href="#local-6989586621679402891"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Symbol -&gt; Term (F typeVar typeAnn patternAnn) Symbol ()
forall v (f :: * -&gt; *). v -&gt; Term f v ()
</span><span class="hs-identifier hs-var">ABT.var</span></span><span> </span><span class="annot"><span class="annottext">Symbol
</span><a href="#local-6989586621679402890"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-3743"></span><span>          </span><span id="local-6989586621679402887"><span class="annot"><span class="annottext">F typeVar
  typeAnn
  patternAnn
  (Term (F typeVar typeAnn patternAnn) Symbol ())
</span><a href="#local-6989586621679402887"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">F typeVar
  typeAnn
  patternAnn
  (Term (F typeVar typeAnn patternAnn) Symbol ())
-&gt; Term (F typeVar typeAnn patternAnn) Symbol ()
forall (f :: * -&gt; *) v.
(Foldable f, Ord v) =&gt;
f (Term f v ()) -&gt; Term f v ()
</span><span class="hs-identifier hs-var">ABT.tm</span></span><span> </span><span class="annot"><span class="annottext">F typeVar
  typeAnn
  patternAnn
  (Term (F typeVar typeAnn patternAnn) Symbol ())
</span><a href="#local-6989586621679402887"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-3744"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(()
 -&gt; ABT (F Symbol () ()) Symbol (Term Symbol ()) -&gt; Term Symbol ())
-&gt; Term Symbol () -&gt; Term Symbol ()
forall (f :: * -&gt; *) a v x.
Functor f =&gt;
(a -&gt; ABT f v x -&gt; x) -&gt; Term f v a -&gt; x
</span><span class="hs-identifier hs-var">ABT.cata</span></span><span> </span><span class="annot"><span class="annottext">()
-&gt; ABT (F Symbol () ()) Symbol (Term Symbol ()) -&gt; Term Symbol ()
forall typeVar typeAnn patternAnn.
()
-&gt; ABT
     (F typeVar typeAnn patternAnn)
     Symbol
     (Term (F typeVar typeAnn patternAnn) Symbol ())
-&gt; Term (F typeVar typeAnn patternAnn) Symbol ()
</span><a href="#local-6989586621679402905"><span class="hs-identifier hs-var">alg</span></a></span><span> </span><span class="annot"><span class="annottext">Term Symbol ()
</span><a href="#local-6989586621679402909"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-3745"></span></pre></body></html>