<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Language.LSP.Logging</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Logging.html#logToShowMessage"><span class="hs-identifier">logToShowMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.LSP.Logging.html#logToLogMessage"><span class="hs-identifier">logToLogMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Language.LSP.Logging.html#defaultClientLogger"><span class="hs-identifier">defaultClientLogger</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Colog.Core</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Language.LSP.Server.Core.html"><span class="hs-identifier">Language.LSP.Server.Core</span></a></span><span>
</span><span id="line-6"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Language.LSP.Types</span></span><span>
</span><span id="line-7"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="annot"><a href="Language.LSP.Logging.html#logSeverityToMessageType"><span class="hs-identifier hs-type">logSeverityToMessageType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Severity</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MessageType</span></span><span>
</span><span id="line-10"></span><span id="logSeverityToMessageType"><span class="annot"><span class="annottext">logSeverityToMessageType :: Severity -&gt; MessageType
</span><a href="Language.LSP.Logging.html#logSeverityToMessageType"><span class="hs-identifier hs-var hs-var">logSeverityToMessageType</span></a></span></span><span> </span><span id="local-6989586621679188913"><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679188913"><span class="hs-identifier hs-var">sev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679188913"><span class="hs-identifier hs-var">sev</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-11"></span><span>  </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MessageType
</span><span class="hs-identifier hs-var">MtError</span></span><span>
</span><span id="line-12"></span><span>  </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Warning</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MessageType
</span><span class="hs-identifier hs-var">MtWarning</span></span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MessageType
</span><span class="hs-identifier hs-var">MtInfo</span></span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Debug</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MessageType
</span><span class="hs-identifier hs-var">MtLog</span></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">-- | Logs messages to the client via @window/logMessage@.</span><span>
</span><span id="line-17"></span><span id="local-6989586621679188903"><span id="local-6989586621679188904"><span class="annot"><a href="Language.LSP.Logging.html#logToLogMessage"><span class="hs-identifier hs-type">logToLogMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679188904"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679188903"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679188903"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-18"></span><span id="logToLogMessage"><span class="annot"><span class="annottext">logToLogMessage :: LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#logToLogMessage"><span class="hs-identifier hs-var hs-var">logToLogMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text)
forall (m :: * -&gt; *) msg. (msg -&gt; m ()) -&gt; LogAction m msg
</span><span class="hs-identifier hs-var">LogAction</span></span><span> </span><span class="annot"><span class="annottext">((WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text))
-&gt; (WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span id="local-6989586621679188900"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679188900"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679188899"><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679188899"><span class="hs-identifier hs-var">sev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><span class="annottext">FromServerMessage -&gt; m ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; m ()) -&gt; FromServerMessage -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NotificationMessage @'FromServer 'WindowLogMessage
-&gt; FromServerMessage
forall (m :: Method 'FromServer 'Notification).
((Message @'FromServer @'Notification m :: *)
 ~ (NotificationMessage @'FromServer m :: *)) =&gt;
NotificationMessage @'FromServer m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">(NotificationMessage @'FromServer 'WindowLogMessage
 -&gt; FromServerMessage)
-&gt; NotificationMessage @'FromServer 'WindowLogMessage
-&gt; FromServerMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><span class="annottext">Text
-&gt; SMethod @'FromServer @'Notification 'WindowLogMessage
-&gt; MessageParams @'FromServer @'Notification 'WindowLogMessage
-&gt; NotificationMessage @'FromServer 'WindowLogMessage
forall (f :: From) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; NotificationMessage @f m
</span><span class="hs-identifier hs-var">NotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'FromServer @'Notification 'WindowLogMessage
</span><span class="hs-identifier hs-var">SWindowLogMessage</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MessageType -&gt; Text -&gt; LogMessageParams
</span><span class="hs-identifier hs-var">LogMessageParams</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Severity -&gt; MessageType
</span><a href="Language.LSP.Logging.html#logSeverityToMessageType"><span class="hs-identifier hs-var">logSeverityToMessageType</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679188899"><span class="hs-identifier hs-var">sev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679188900"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-comment">-- | Logs messages to the client via @window/showMessage@.</span><span>
</span><span id="line-23"></span><span id="local-6989586621679188919"><span id="local-6989586621679188920"><span class="annot"><a href="Language.LSP.Logging.html#logToShowMessage"><span class="hs-identifier hs-type">logToShowMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679188920"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679188919"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679188919"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-24"></span><span id="logToShowMessage"><span class="annot"><span class="annottext">logToShowMessage :: LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#logToShowMessage"><span class="hs-identifier hs-var hs-var">logToShowMessage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text)
forall (m :: * -&gt; *) msg. (msg -&gt; m ()) -&gt; LogAction m msg
</span><span class="hs-identifier hs-var">LogAction</span></span><span> </span><span class="annot"><span class="annottext">((WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text))
-&gt; (WithSeverity Text -&gt; m ()) -&gt; LogAction m (WithSeverity Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span id="local-6989586621679188893"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679188893"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679188892"><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679188892"><span class="hs-identifier hs-var">sev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><span class="annottext">FromServerMessage -&gt; m ()
forall config (m :: * -&gt; *).
MonadLsp config m =&gt;
FromServerMessage -&gt; m ()
</span><a href="Language.LSP.Server.Core.html#sendToClient"><span class="hs-identifier hs-var">sendToClient</span></a></span><span> </span><span class="annot"><span class="annottext">(FromServerMessage -&gt; m ()) -&gt; FromServerMessage -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NotificationMessage @'FromServer 'WindowShowMessage
-&gt; FromServerMessage
forall (m :: Method 'FromServer 'Notification).
((Message @'FromServer @'Notification m :: *)
 ~ (NotificationMessage @'FromServer m :: *)) =&gt;
NotificationMessage @'FromServer m -&gt; FromServerMessage
</span><span class="hs-identifier hs-var">fromServerNot</span></span><span> </span><span class="annot"><span class="annottext">(NotificationMessage @'FromServer 'WindowShowMessage
 -&gt; FromServerMessage)
-&gt; NotificationMessage @'FromServer 'WindowShowMessage
-&gt; FromServerMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><span class="annottext">Text
-&gt; SMethod @'FromServer @'Notification 'WindowShowMessage
-&gt; MessageParams @'FromServer @'Notification 'WindowShowMessage
-&gt; NotificationMessage @'FromServer 'WindowShowMessage
forall (f :: From) (m :: Method f 'Notification).
Text
-&gt; SMethod @f @'Notification m
-&gt; MessageParams @f @'Notification m
-&gt; NotificationMessage @f m
</span><span class="hs-identifier hs-var">NotificationMessage</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;2.0&quot;</span></span><span> </span><span class="annot"><span class="annottext">SMethod @'FromServer @'Notification 'WindowShowMessage
</span><span class="hs-identifier hs-var">SWindowShowMessage</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MessageType -&gt; Text -&gt; ShowMessageParams
</span><span class="hs-identifier hs-var">ShowMessageParams</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Severity -&gt; MessageType
</span><a href="Language.LSP.Logging.html#logSeverityToMessageType"><span class="hs-identifier hs-var">logSeverityToMessageType</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621679188892"><span class="hs-identifier hs-var">sev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679188893"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-comment">-- | A 'sensible' log action for logging messages to the client:</span><span>
</span><span id="line-29"></span><span class="hs-comment">--</span><span>
</span><span id="line-30"></span><span class="hs-comment">--    * Shows 'Error' logs to the user via @window/showMessage@</span><span>
</span><span id="line-31"></span><span class="hs-comment">--    * Logs 'Info' and above logs in the client via @window/logMessage@</span><span>
</span><span id="line-32"></span><span class="hs-comment">--</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- If you want finer control (e.g. the ability to log 'Debug' logs based on a flag, or similar),</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- then do not use this and write your own based on 'logToShowMessage' and 'logToLogMessage'.</span><span>
</span><span id="line-35"></span><span id="local-6989586621679188888"><span id="local-6989586621679188889"><span class="annot"><a href="Language.LSP.Logging.html#defaultClientLogger"><span class="hs-identifier hs-type">defaultClientLogger</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Language.LSP.Server.Core.html#MonadLsp"><span class="hs-identifier hs-type">MonadLsp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679188889"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679188888"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogAction</span></span><span> </span><span class="annot"><a href="#local-6989586621679188888"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">WithSeverity</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-36"></span><span id="defaultClientLogger"><span class="annot"><span class="annottext">defaultClientLogger :: LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#defaultClientLogger"><span class="hs-identifier hs-var hs-var">defaultClientLogger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><span class="annottext">Severity
-&gt; (WithSeverity Text -&gt; Severity)
-&gt; LogAction m (WithSeverity Text)
-&gt; LogAction m (WithSeverity Text)
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Severity -&gt; (a -&gt; Severity) -&gt; LogAction m a -&gt; LogAction m a
</span><span class="hs-identifier hs-var">filterBySeverity</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Error</span></span><span> </span><span class="annot"><span class="annottext">WithSeverity Text -&gt; Severity
forall msg. WithSeverity msg -&gt; Severity
</span><span class="hs-identifier hs-var hs-var">getSeverity</span></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity Text)
forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#logToShowMessage"><span class="hs-identifier hs-var">logToShowMessage</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="annottext">LogAction m (WithSeverity Text)
-&gt; LogAction m (WithSeverity Text)
-&gt; LogAction m (WithSeverity Text)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Severity
-&gt; (WithSeverity Text -&gt; Severity)
-&gt; LogAction m (WithSeverity Text)
-&gt; LogAction m (WithSeverity Text)
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Severity -&gt; (a -&gt; Severity) -&gt; LogAction m a -&gt; LogAction m a
</span><span class="hs-identifier hs-var">filterBySeverity</span></span><span> </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier hs-var">Info</span></span><span> </span><span class="annot"><span class="annottext">WithSeverity Text -&gt; Severity
forall msg. WithSeverity msg -&gt; Severity
</span><span class="hs-identifier hs-var hs-var">getSeverity</span></span><span> </span><span class="annot"><span class="annottext">LogAction m (WithSeverity Text)
forall c (m :: * -&gt; *).
MonadLsp c m =&gt;
LogAction m (WithSeverity Text)
</span><a href="Language.LSP.Logging.html#logToLogMessage"><span class="hs-identifier hs-var">logToLogMessage</span></a></span><span>
</span><span id="line-39"></span></pre></body></html>